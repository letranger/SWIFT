<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2021-04-26 Mon 15:53 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Advanced Swift Ui</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Yung Chin, Yen" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="https://letranger.github.io/org-html-themes/styles/purplereadtheorg/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://letranger.github.io/org-html-themes/styles/purplereadtheorg/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/readtheorg.js"></script>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:1f739d935676111cfff4b4693e3816e664797050&amp;dn=gpl-3.0.txt GPL-v3-or-Later
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.cacheClassElem = elem.className;
         elem.cacheClassTarget = target.className;
         target.className = "code-highlighted";
         elem.className   = "code-highlighted";
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(elem.cacheClassElem)
         elem.className = elem.cacheClassElem;
       if(elem.cacheClassTarget)
         target.className = elem.cacheClassTarget;
     }
    /*]]>*///-->
// @license-end
</script>
</head>
<body>
<div id="content">
<h1 class="title">Advanced Swift Ui</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#SW-MVVM">1. MVVM</a>
<ul>
<li><a href="#org84e4910">1.1. Design pattern</a></li>
<li><a href="#org258b8f7">1.2. What is the idea behind MVVM</a></li>
<li><a href="#orgf9ad0c6">1.3. DEMO</a></li>
<li><a href="#orgbdd58c6">1.4. Model 要用 Struct 或是 Class</a></li>
<li><a href="#orgdb18d24">1.5. DICE DEMO</a></li>
<li><a href="#org25efd2e">1.6. Further Reading Resources</a></li>
</ul>
</li>
<li><a href="#SW-Review">2. Review</a>
<ul>
<li><a href="#org66f9116">2.1. Data Model</a></li>
<li><a href="#org038c5d6">2.2. Basic UI</a></li>
<li><a href="#orgc22d52f">2.3. MVVM</a></li>
<li><a href="#orgba39b53">2.4. New task</a></li>
<li><a href="#orgcbac35e">2.5. Delete task</a></li>
<li><a href="#org4f37a48">2.6. enum v.s. picker</a></li>
<li><a href="#SW-onTapGesture">2.7. Tap on Icon to change completion and priority status</a></li>
</ul>
</li>
<li><a href="#SW-AdvFuncs">3. Advance function</a>
<ul>
<li><a href="#org018c5d0">3.1. filter()</a></li>
<li><a href="#org874fc10">3.2. map()</a></li>
<li><a href="#orge6072e6">3.3. debounce</a></li>
</ul>
</li>
<li><a href="#org2aa3978">4. Web API: URLSession v.s. JSONDecoder</a>
<ul>
<li><a href="#org352ec18">4.1. Demo 1</a></li>
<li><a href="#org437427d">4.2. Demo 2</a></li>
<li><a href="#orgcbb976b">4.3. 公開資料平台</a></li>
<li><a href="#org2fdbaea">4.4. Further Reading</a></li>
</ul>
</li>
<li><a href="#SW-Protocols">5. Protocols</a>
<ul>
<li><a href="#orgf44198f">5.1. Protocol Syntax</a></li>
<li><a href="#org37e2424">5.2. DEMO</a></li>
<li><a href="#org2681f46">5.3. 範例</a></li>
<li><a href="#org4e755cc">5.4. mutating</a></li>
<li><a href="#org5a01025">5.5. 擴充 protocol</a></li>
<li><a href="#org3315b87">5.6. Further Reading</a></li>
</ul>
</li>
<li><a href="#SW-enum">6. Enum</a>
<ul>
<li><a href="#orgdd0741c">6.1. without enum</a></li>
<li><a href="#org622e8cc">6.2. with enum</a></li>
<li><a href="#org59fed92">6.3. enum的rawValue</a></li>
<li><a href="#orgb7ecc40">6.4. enum v.s. switch</a></li>
<li><a href="#org95f51d8">6.5. Swift列舉中最強大的功能之一：associated values</a></li>
</ul>
</li>
<li><a href="#org0b92072">7. Struct v.s. Class</a>
<ul>
<li><a href="#orga1a4020">7.1. What is in class/struct</a></li>
<li><a href="#org3b99653">7.2. 如何決擇? / When should I go for a struct and when for a class?</a></li>
<li><a href="#org722a802">7.3. DEMO</a></li>
</ul>
</li>
<li><a href="#orgf0f9a8e">8. Publihser and Subscriber</a>
<ul>
<li><a href="#org446a61a">8.1. Publisher</a></li>
</ul>
</li>
<li><a href="#orga5527ac">9. Combine</a>
<ul>
<li><a href="#org82df7df">9.1. Publisher</a></li>
<li><a href="#org1b03900">9.2. Subscriber</a></li>
<li><a href="#orgb441cfc">9.3. Subject</a></li>
<li><a href="#org8e634d9">9.4. Operator</a></li>
<li><a href="#orgb70b14f">9.5. sink(receiveCompletion:receiveValue:)</a></li>
<li><a href="#org9fdef75">9.6. assign(tp:on:)</a></li>
<li><a href="#org0d88cf5">9.7. Publisher &amp; Subsciber流程</a></li>
<li><a href="#org1406be2">9.8. 發佈者和訂閱者的生命週期</a></li>
<li><a href="#org6e6cf56">9.9. 典型的Publisher</a></li>
<li><a href="#org3e42d65">9.10. Marble Diagram</a></li>
<li><a href="#org949d4a4">9.11. Publisher的建立</a></li>
<li><a href="#org3bd0ca6">9.12. Cancellable</a></li>
<li><a href="#orgad868d1">9.13. Webs, Video</a></li>
</ul>
</li>
<li><a href="#some">10. <span class="todo TODO">TODO</span> some</a>
<ul>
<li><a href="#org6c0292d">10.1. Generics</a></li>
<li><a href="#orgc204fc2">10.2. opaque</a></li>
</ul>
</li>
<li><a href="#advanced">11. <span class="todo TODO">TODO</span> 進階主題</a></li>
</ul>
</div>
</div>

<div id="outline-container-SW-MVVM" class="outline-2">
<h2 id="SW-MVVM"><span class="section-number-2">1</span> MVVM</h2>
<div class="outline-text-2" id="text-SW-MVVM">
</div>
<div id="outline-container-org84e4910" class="outline-3">
<h3 id="org84e4910"><span class="section-number-3">1.1</span> Design pattern</h3>
<div class="outline-text-3" id="text-1-1">
<p>
MVVM 的概念最早應該是在 2005 年由 Microsoft的<a href="https://blogs.msdn.microsoft.com/johngossman/2005/10/08/introduction-to-modelviewviewmodel-pattern-for-building-wpf-apps/">John Gossman</a>提出來的，它的概念是，整個 Swift project 會拆分成三個部份: View、ViewModel、Model，其中 View 的角色就是單純的視覺元件，像是按鈕、文字標籤等等，在 View 裡面不會有邏輯、狀態等等，單純就是個呈現資料的元件。而要讓 View 呈現資料，最直覺的方式，就是把 View 跟 Model 做綁定，讓 View 的元件跟著 Model 一起做變化。但這樣會有個問題，就是通常 Model 來的資料，並不是簡單就能轉換成 View 的樣式的，這時候就需要有個物件，介在 View 跟 Model 的中間，這個物件會掌管這些跟 View 高度相關的邏輯的操作，像是轉換 Date 物件變成人看得懂的文字格式等，稱之為 ViewModel。上面的概念可以畫成這樣的資料流：<br />
</p>


<div id="orgcc831af" class="figure">
<p><img src="images/MVVM-Basic.jpg" alt="MVVM-Basic.jpg" width="600" /><br />
</p>
<p><span class="figure-number">Figure 1: </span>MVVM Architecture</p>
</div>

<p>
在 iOS 開發上，依照上述 MVVM 的定義，ContentView 變成一個單純的 View，而我們會另外產生一個 ViewModel 來負責 presentational logic 跟部份的 controller logic。所以在View裡面，就只會有：<br />
</p>
<ol class="org-ol">
<li>View logic，所有跟呈現有關的 Code<br /></li>
<li>綁定 ViewModel<br /></li>
</ol>
<p>
而在 ViewModel 裡面，則是負責兩個部份：<br />
</p>
<ol class="org-ol">
<li>Controller logic，如 pagination, error handling,… etc<br /></li>
<li>Presentation logic，提供接口讓 View 綁定(binding)(提供適合在View中呈現的資料)<br /></li>
</ol>
<p>
開發上，一旦 View 綁定好 ViewModel 的資料，在撰寫商業邏輯的時候，就可以不用管包括動畫、轉場、main thread 等等跟 View 相關的問題，因為分工明確所以就不會有寫起來綁手綁腳的感覺。更棒的是，並且因為 ViewModel 是一個單純的、沒有相依於 View 的物件，所以要做測試簡單多了！<br />
<a href="https://www.codementor.io/@koromiko/mvvm-app-cl1wvw2sh">資料來源: 歡迎來到真實世界 - 原來是那個傳說中的MVVM阿</a><br />
</p>
</div>
</div>
<div id="outline-container-org258b8f7" class="outline-3">
<h3 id="org258b8f7"><span class="section-number-3">1.2</span> What is the idea behind MVVM</h3>
<div class="outline-text-3" id="text-1-2">
</div>
<ol class="org-ol">
<li><a id="org0a6d769"></a>Model<br />
<div class="outline-text-4" id="text-1-2-1">
<ul class="org-ul">
<li>Business logic<br /></li>
<li>UI Independent<br /></li>
</ul>
</div>
</li>
<li><a id="org92be1e1"></a>View<br />
<div class="outline-text-4" id="text-1-2-2">
<ul class="org-ul">
<li>Presentation<br /></li>
<li>User interaction<br /></li>
</ul>
</div>
</li>
<li><a id="orgc41ae3a"></a>ViewModel<br />
<div class="outline-text-4" id="text-1-2-3">
<ul class="org-ul">
<li>Presentation logic<br /></li>
<li>Glue between Model and View<br /></li>
</ul>
</div>
</li>
<li><a id="org081fa14"></a>為什麼要拆成三部份(What does it solve?)<br />
<div class="outline-text-4" id="text-1-2-4">
<ul class="org-ul">
<li>MVC - Massive View Controller<br /></li>
<li>Testability<br /></li>
<li>Code organization<br /></li>
<li>Code reusability<br /></li>
</ul>
</div>
</li>
<li><a id="orgf985048"></a>Limitations / Cons<br />
<div class="outline-text-4" id="text-1-2-5">
<ul class="org-ul">
<li>Requires binding<br /></li>
<li>Potential for boilerplate code<br /></li>
<li>Overkill for simple views and logic<br /></li>
<li>Doesn&rsquo;t cover every case<br /></li>
</ul>
</div>
</li>
</ol>
</div>
<div id="outline-container-orgf9ad0c6" class="outline-3">
<h3 id="orgf9ad0c6"><span class="section-number-3">1.3</span> DEMO</h3>
<div class="outline-text-3" id="text-1-3">
<p>
以&ldquo;推薦書單&rdquo;的 APP 為例:<br />
</p>
<ul class="org-ul">
<li><p>
Model: 包含書名、作者、出版社&#x2026;.，而實際的資料來源可能是雲端資料庫(Firebase)、Web API、本機資料庫(Core data)。<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">Book</span> {
<span class="linenr">2: </span>    <span style="color: #51afef;">let</span> title: <span style="color: #c678dd;">String</span>
<span class="linenr">3: </span>    <span style="color: #51afef;">let</span> author: <span style="color: #c678dd;">String</span>
<span class="linenr">4: </span>    <span style="color: #51afef;">let</span> dateReleased: <span style="color: #c678dd;">String</span>
<span class="linenr">5: </span>    <span style="color: #51afef;">let</span> publishCamp: <span style="color: #c678dd;">String</span>
<span class="linenr">6: </span>    <span style="color: #51afef;">let</span> publishCity: <span style="color: #c678dd;">String</span>
<span class="linenr">7: </span>    <span style="color: #51afef;">let</span> isFavorite: <span style="color: #c678dd;">Bool</span>
<span class="linenr">8: </span>}
</pre>
</div></li>
<li>View: 在 APP 畫面上呈現 Model 中資料的元件，如 Text, Image, Button, List&#x2026;..<br /></li>
<li><p>
ViewModel: 將 Model 中的資料取出，供 View 呈現，或是接受 View 輸入的資料，存回 Model。以&ldquo;推薦書單 APP&rdquo;為例，其 ViewModel 可能包含如下 struct:<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">BookDetailViewModel</span> {
<span class="linenr"> 2: </span>    <span style="color: #51afef;">var</span> book: Book
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span>    <span style="color: #51afef;">var</span> isFavorite: <span style="color: #c678dd;">Bool</span>
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span>    <span style="color: #51afef;">init</span>(book: Book) {
<span class="linenr"> 7: </span>        <span style="color: #51afef;">self</span>.<span style="color: #dcaeea;">book</span> = book
<span class="linenr"> 8: </span>        <span style="color: #51afef;">self</span>.<span style="color: #dcaeea;">isFavorite</span> = <span style="color: #a9a1e1;">false</span>
<span class="linenr"> 9: </span>    }
<span class="linenr">10: </span>
<span class="linenr">11: </span>    <span style="color: #51afef;">var</span> title: <span style="color: #c678dd;">String</span> {
<span class="linenr">12: </span>        <span style="color: #51afef;">return</span> <span style="color: #51afef;">self</span>.<span style="color: #dcaeea;">book</span>.<span style="color: #c678dd;">title</span>
<span class="linenr">13: </span>    }
<span class="linenr">14: </span>
<span class="linenr">15: </span>    <span style="color: #51afef;">var</span> author: <span style="color: #c678dd;">String</span> {
<span class="linenr">16: </span>        <span style="color: #51afef;">return</span> <span style="color: #51afef;">self</span>.<span style="color: #dcaeea;">book</span>.<span style="color: #c678dd;">author</span>
<span class="linenr">17: </span>    }
<span class="linenr">18: </span>
<span class="linenr">19: </span>    <span style="color: #51afef;">var</span> dateReleased: <span style="color: #c678dd;">String</span> {
<span class="linenr">20: </span>        <span style="color: #51afef;">return</span> <span style="color: #51afef;">self</span>.<span style="color: #dcaeea;">book</span>.<span style="color: #dcaeea;">dateReleased</span>
<span class="linenr">21: </span>    }
<span class="linenr">22: </span>
<span class="linenr">23: </span>    <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#21576;&#29694;&#26178;&#35201;&#27714;&#20197; &#36960;&#27969;&#20986;&#29256;&#31038;(&#21488;&#21271;&#24066;) &#30340;&#26684;&#24335;&#20358;&#21576;&#29694;</span>
<span class="linenr">24: </span>    <span style="color: #51afef;">var</span> publisher: <span style="color: #c678dd;">String</span> {
<span class="linenr">25: </span>        <span style="color: #51afef;">let</span> output = <span style="color: #51afef;">self</span>.<span style="color: #dcaeea;">book</span>.<span style="color: #dcaeea;">publishCamp</span> + <span style="color: #98be65;">"("</span> + <span style="color: #51afef;">self</span>.<span style="color: #dcaeea;">book</span>.<span style="color: #dcaeea;">publishCity</span> + <span style="color: #98be65;">")"</span>
<span class="linenr">26: </span>        <span style="color: #51afef;">return</span> output
<span class="linenr">27: </span>    }
<span class="linenr">28: </span>}
</pre>
</div>
<p>
從 Model 中可以看到書籍的記錄欄位只有&ldquo;出版社&rdquo;(publishCamp)和&ldquo;出版地點&rdquo;(publishCity)，但若 app 對顯示結果的格式要求為&ldquo;出版社(出版地點)&rdquo;，則可以在 ViewModel 中來處理。<br />
此外，如果在 View 上有一個 Favorite Button，則當 user 點了 Favorite 後，ViewModel 應負責將 struct 中的 isFavorite 改存 True，並回存至 Model 中。Model 的資料只能透過 ViewModel 來新增刪除，View 無法直接染指。<br />
Model 與 UI 完全無關，單純用來儲存資料，ViewModel 為 Model 與 View 溝通的橋樑。<br />
</p></li>
</ul>
</div>
</div>
<div id="outline-container-orgbdd58c6" class="outline-3">
<h3 id="orgbdd58c6"><span class="section-number-3">1.4</span> Model 要用 Struct 或是 Class</h3>
<div class="outline-text-3" id="text-1-4">
<p>
<a href="https://www.appcoda.com.tw/swift-class/">資料來源:Swift Class vs Struct：設計 Model 時，該用 Struct 還是 Class 呢？</a><br />
</p>
</div>
<ol class="org-ol">
<li><a id="org04ea80f"></a>Struct 與 Class 的不同性質<br />
<div class="outline-text-4" id="text-1-4-1">
<p>
首先，當我們指派 (assign) 一個實體給一個辨識符（identifier，也就是變數／常數名）的時候，如果該實體是 struct 的話，該辨識符所容納的會是該實體的所有內容；但如果它是 class 的話，這個辨識符就只會容納存放該實體的位址：<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#29992; struct &#23450;&#32681; Dog&#12290;</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">Dog</span> {
<span class="linenr"> 3: </span>    <span style="color: #51afef;">var</span> name = <span style="color: #98be65;">"Bart"</span>
<span class="linenr"> 4: </span>}
<span class="linenr"> 5: </span><span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#25972;&#20491; Dog &#23526;&#39636;&#37117;&#26371;&#34987;&#23384;&#21040; myDog &#35041;&#12290;</span>
<span class="linenr"> 6: </span><span style="color: #51afef;">var</span> myDog = <span style="color: #c678dd;">Dog</span>()
<span class="linenr"> 7: </span><span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#29992; class &#23450;&#32681; Cat&#12290;</span>
<span class="linenr"> 8: </span><span style="color: #51afef;">class</span> <span style="color: #c678dd;">Cat</span> {
<span class="linenr"> 9: </span>    <span style="color: #51afef;">var</span> name = <span style="color: #98be65;">"Mimi"</span>
<span class="linenr">10: </span>}
<span class="linenr">11: </span><span style="color: #5B6268;">// </span><span style="color: #5B6268;">myCat &#21482;&#26371;&#20786;&#23384; Cat &#23526;&#39636;&#30340;&#20301;&#22336;&#12290;Cat &#23526;&#39636;&#26412;&#36523;&#26371;&#34987;&#23384;&#21040;&#21029;&#30340;&#22320;&#26041;&#12290;</span>
<span class="linenr">12: </span><span style="color: #51afef;">var</span> myCat = <span style="color: #c678dd;">Cat</span>()
</pre>
</div>
<p>
也就是說，當我們使用辨識符的時候，如果它的型別是 struct 的話，我們在操作的實體都會是本地的。但是當我們在操作 class 型別的辨識符的話，那麼我們實際上是透過辨識符在操作一個遠端的實體。所以，當我們更改這些實體的屬性的時候，它們的行為就不太一樣了：<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20351;&#29992; struct&#12290;</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">var</span> herDog = <span style="color: #c678dd;">Dog</span>() {
<span class="linenr"> 3: </span>    <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#22914;&#26524; herDog &#26377;&#35722;&#21205;&#30340;&#35441;&#23601;&#39023;&#31034;&#35338;&#24687;&#12290;</span>
<span class="linenr"> 4: </span>    <span style="color: #51afef;">didSet</span> {
<span class="linenr"> 5: </span>        <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"Her dog is changed!"</span>)
<span class="linenr"> 6: </span>    }
<span class="linenr"> 7: </span>}
<span class="linenr"> 8: </span>herDog.<span style="color: #c678dd;">name</span> = <span style="color: #98be65;">"Starlord"</span>
<span class="linenr"> 9: </span><span style="color: #5B6268;">// </span><span style="color: #5B6268;">Her dog is changed!</span>
<span class="linenr">10: </span><span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20351;&#29992; class&#12290;</span>
<span class="linenr">11: </span><span style="color: #51afef;">var</span> herCat = <span style="color: #c678dd;">Cat</span>() {
<span class="linenr">12: </span>    <span style="color: #51afef;">didSet</span> {
<span class="linenr">13: </span>        <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"Her cat is changed!"</span>)
<span class="linenr">14: </span>    }
<span class="linenr">15: </span>}
<span class="linenr">16: </span>herCat.<span style="color: #c678dd;">name</span> = <span style="color: #98be65;">"Mumu"</span>
<span class="linenr">17: </span><span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#27794;&#26377;&#35338;&#24687;&#12290;</span>
</pre>
</div>
<p>
怎麼會有這樣的差別呢？因為 herDog 儲存了所有的 Dog 實體內容，所以任何 Dog 實體的屬性的變動，就等於說 herDog 本身有變動。然而，herCat 並沒有儲存 Cat 實體的內容，所以 Cat 實體屬性的變動是在別的地方發生的，且 herCat 本身所儲存的 Cat 實體位址並沒有任何的改變。<br />
由圖<a href="#orgcc831af">1</a>可看出，<br />
</p>
</div>
</li>
<li><a id="org1ac0cbe"></a>MVVM 中的 Model<br /></li>
</ol>
</div>
<div id="outline-container-orgdb18d24" class="outline-3">
<h3 id="orgdb18d24"><span class="section-number-3">1.5</span> DICE DEMO</h3>
</div>
<div id="outline-container-org25efd2e" class="outline-3">
<h3 id="org25efd2e"><span class="section-number-3">1.6</span> Further Reading Resources</h3>
<div class="outline-text-3" id="text-1-6">
<ul class="org-ul">
<li><a href="https://www.youtube.com/watch?v=1IlUBHvgY8Q&amp;t=29s">SwiftUI MVVM Programming with ObservableObject @Published @ObservedObject</a><br /></li>
<li><a href="https://www.youtube.com/watch?v=LntH6moCuo0">SwiftUI 2.0: MVVM - A Practical Approach</a><br /></li>
<li><a href="https://www.youtube.com/watch?v=gkAV4D1nopA">SwiftUI Tip Calculator Using MVVM Design Pattern</a><br /></li>
<li><a href="https://www.youtube.com/watch?v=cbqMkIG6Qeg">Understanding MVVM Design Pattern</a>: 講的超清楚<br /></li>
<li>Video: <a href="https://www.youtube.com/watch?v=EhtK_H9LsYQ">MVVM SwiftUI - Model View ViewModel Pattern - Getting Started</a><br /></li>
<li>Video: <a href="https://www.youtube.com/watch?v=LntH6moCuo0">https://www.youtube.com/watch?v=LntH6moCuo0</a><br /></li>
<li>Video: <a href="https://www.youtube.com/watch?v=sWx8TtRBOfk">MVVM in Practice - RWDevCon Session - raywenderlich.com</a><br /></li>
<li>GitHub: <a href="https://github.com/rebeloper/SwiftUIMVVM.git">https://github.com/rebeloper/SwiftUIMVVM.git</a><br /></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-SW-Review" class="outline-2">
<h2 id="SW-Review"><span class="section-number-2">2</span> Review</h2>
<div class="outline-text-2" id="text-SW-Review">
<ul class="org-ul">
<li>Functions: Tasks management project: task listing, adding, removing, editing<br /></li>
<li>Technoloties: View navigation, variable sharing, data model<br /></li>
</ul>
<p>
參考資料: <a href="https://medium.com/better-programming/replicating-the-ios-reminders-app-part1-44211a7b7029">Building a To-Do List App with SwiftUI, Combine, and Firebase</a><br />
</p>
</div>
<div id="outline-container-org66f9116" class="outline-3">
<h3 id="org66f9116"><span class="section-number-3">2.1</span> Data Model</h3>
<div class="outline-text-3" id="text-2-1">
<div class="org-src-container">
<pre class="src src-swift"><span style="color: #5B6268;">//</span>
<span style="color: #5B6268;">//  </span><span style="color: #5B6268;">Task.swift</span>
<span style="color: #5B6268;">//  </span><span style="color: #5B6268;">taskManagement</span>
<span style="color: #5B6268;">//</span>
<span style="color: #5B6268;">//  </span><span style="color: #5B6268;">Created by yen yung chin on 2021/2/18.</span>
<span style="color: #5B6268;">//</span>

<span style="color: #51afef;">import</span> Foundation


<span style="color: #51afef;">struct</span> <span style="color: #c678dd;">Task</span>: Identifiable {
    <span style="color: #51afef;">var</span> id = <span style="color: #c678dd;">UUID</span>()
    <span style="color: #51afef;">var</span> title: <span style="color: #c678dd;">String</span>
    <span style="color: #51afef;">var</span> completed: <span style="color: #c678dd;">Bool</span>
}

<span style="color: #51afef; font-weight: bold;">#if</span> DEBUG
<span style="color: #51afef;">let</span> testDataTasks = [
    <span style="color: #c678dd;">Task</span>(title: <span style="color: #98be65;">"Implement UI"</span>, completed: <span style="color: #a9a1e1;">true</span>),
    <span style="color: #c678dd;">Task</span>(title: <span style="color: #98be65;">"Share data"</span>, completed: <span style="color: #a9a1e1;">false</span>),
    <span style="color: #c678dd;">Task</span>(title: <span style="color: #98be65;">"Create Chart"</span>, completed: <span style="color: #a9a1e1;">false</span>),
    <span style="color: #c678dd;">Task</span>(title: <span style="color: #98be65;">"Connect to Firebase"</span>, completed: <span style="color: #a9a1e1;">false</span>),
    <span style="color: #c678dd;">Task</span>(title: <span style="color: #98be65;">"PROFIT!!!"</span>, completed: <span style="color: #a9a1e1;">false</span>)
]
<span style="color: #51afef; font-weight: bold;">#endif</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org038c5d6" class="outline-3">
<h3 id="org038c5d6"><span class="section-number-3">2.2</span> Basic UI</h3>
<div class="outline-text-3" id="text-2-2">
</div>
<ol class="org-ol">
<li><a id="org1e47e96"></a>Change struct name (ContentView.swift)<br />
<div class="outline-text-4" id="text-2-2-1">
<ol class="org-ol">
<li>right click on struct ContentView<br /></li>
<li>Refactor<br /></li>
<li>Rename&#x2026;: to <b>TaskListView</b><br /></li>
<li>The file name on navigator (left panel in Xcode) will be renamed to <b>TaskListView.swift</b><br /></li>
</ol>
</div>
</li>
<li><a id="org91dabd3"></a>classify files into the following group<br />
<div class="outline-text-4" id="text-2-2-2">
<ul class="org-ul">
<li>App<br /></li>
<li>View<br /></li>
<li><p>
Model<br />
</p></li>
</ul>

<div id="orgdb718c6" class="figure">
<p><img src="images/renameStruct.jpg" alt="renameStruct.jpg" /><br />
</p>
</div>
</div>
</li>
<li><a id="org964cd0e"></a>Create basic UI<br />
<ol class="org-ol">
<li><a id="orgc48f765"></a>TaskListView.swift<br />
<div class="outline-text-5" id="text-2-2-3-1">
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 2: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">ContentView.swift</span>
<span class="linenr"> 3: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">taskManagement</span>
<span class="linenr"> 4: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 5: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">Created by yen yung chin on 2021/2/16.</span>
<span class="linenr"> 6: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #51afef;">import</span> SwiftUI
<span class="linenr"> 9: </span>
<span class="linenr">10: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">TaskListView</span>: View {
<span class="linenr">11: </span>    <span style="color: #51afef;">let</span> tasks = testDataTasks
<span class="linenr">12: </span>    <span style="color: #51afef;">var</span> body: <span style="color: #51afef;">some</span> View {
<span class="linenr">13: </span>        NavigationView {
<span class="linenr">14: </span>            <span style="color: #c678dd;">VStack</span>(alignment: .<span style="color: #dcaeea;">leading</span>, spacing: <span style="color: #da8548; font-weight: bold;">10</span>, content: {
<span class="linenr">15: </span>                <span style="color: #c678dd;">List</span>(tasks) { task <span style="color: #51afef;">in</span>
<span class="linenr">16: </span>                    <span style="color: #c678dd;">Image</span>(systemName: <span style="color: #98be65;">"circle"</span>)
<span class="linenr">17: </span>                    <span style="color: #c678dd;">Text</span>(task.<span style="color: #c678dd;">title</span>)
<span class="linenr">18: </span>                }
<span class="linenr">19: </span>                <span style="color: #c678dd;">HStack</span>(alignment: .<span style="color: #c678dd;">center</span>, spacing: <span style="color: #da8548; font-weight: bold;">10</span>, content: {
<span class="linenr">20: </span>                    <span style="color: #c678dd;">Image</span>(systemName: <span style="color: #98be65;">"plus.circle.fill"</span>)
<span class="linenr">21: </span>                    <span style="color: #c678dd;">Text</span>(<span style="color: #98be65;">"New Task"</span>)
<span class="linenr">22: </span>                }).<span style="color: #c678dd;">padding</span>()
<span class="linenr">23: </span>
<span class="linenr">24: </span>            }).<span style="color: #c678dd;">navigationTitle</span>(<span style="color: #98be65;">"Tasks"</span>)
<span class="linenr">25: </span>        }
<span class="linenr">26: </span>    }
<span class="linenr">27: </span>}
<span class="linenr">28: </span>
<span class="linenr">29: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">ContentView_Previews</span>: PreviewProvider {
<span class="linenr">30: </span>    <span style="color: #51afef;">static</span> <span style="color: #51afef;">var</span> previews: <span style="color: #51afef;">some</span> View {
<span class="linenr">31: </span>        <span style="color: #c678dd;">TaskListView</span>()
<span class="linenr">32: </span>    }
<span class="linenr">33: </span>}
<span class="linenr">34: </span>
</pre>
</div>
</div>
</li>
<li><a id="org38ece16"></a>Extract the task cell<br />
<div class="outline-text-5" id="text-2-2-3-2">
<ol class="org-ol">
<li>Grouping the Image and Text with HStack<br /></li>
<li>cmd+click Htack<br /></li>
<li>Extract SubView<br /></li>
<li>Fix the compile error(inject needed variable)<br /></li>
</ol>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 2: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">ContentView.swift</span>
<span class="linenr"> 3: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">taskManagement</span>
<span class="linenr"> 4: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 5: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">Created by yen yung chin on 2021/2/16.</span>
<span class="linenr"> 6: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #51afef;">import</span> SwiftUI
<span class="linenr"> 9: </span>
<span class="linenr">10: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">TaskListView</span>: View {
<span class="linenr">11: </span>    <span style="color: #51afef;">let</span> tasks = testDataTasks
<span class="linenr">12: </span>    <span style="color: #51afef;">var</span> body: <span style="color: #51afef;">some</span> View {
<span class="linenr">13: </span>        NavigationView {
<span class="linenr">14: </span>            <span style="color: #c678dd;">VStack</span>(alignment: .<span style="color: #dcaeea;">leading</span>, spacing: <span style="color: #da8548; font-weight: bold;">10</span>, content: {
<span class="linenr">15: </span>                <span style="color: #c678dd;">List</span>(tasks) { task <span style="color: #51afef;">in</span>
<span class="linenr">16: </span>                    <span style="color: #c678dd;">TaskCell</span>(task: task)
<span class="linenr">17: </span>                }
<span class="linenr">18: </span>                <span style="color: #c678dd;">HStack</span>(alignment: .<span style="color: #c678dd;">center</span>, spacing: <span style="color: #da8548; font-weight: bold;">10</span>, content: {
<span class="linenr">19: </span>                    <span style="color: #c678dd;">Image</span>(systemName: <span style="color: #98be65;">"plus.circle.fill"</span>)
<span class="linenr">20: </span>                    <span style="color: #c678dd;">Text</span>(<span style="color: #98be65;">"New Task"</span>)
<span class="linenr">21: </span>                }).<span style="color: #c678dd;">padding</span>()
<span class="linenr">22: </span>
<span class="linenr">23: </span>            }).<span style="color: #c678dd;">navigationTitle</span>(<span style="color: #98be65;">"Tasks"</span>)
<span class="linenr">24: </span>        }
<span class="linenr">25: </span>    }
<span class="linenr">26: </span>}
<span class="linenr">27: </span>
<span class="linenr">28: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">ContentView_Previews</span>: PreviewProvider {
<span class="linenr">29: </span>    <span style="color: #51afef;">static</span> <span style="color: #51afef;">var</span> previews: <span style="color: #51afef;">some</span> View {
<span class="linenr">30: </span>        <span style="color: #c678dd;">TaskListView</span>()
<span class="linenr">31: </span>    }
<span class="linenr">32: </span>}
<span class="linenr">33: </span>
<span class="linenr">34: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">TaskCell</span>: View {
<span class="linenr">35: </span>    <span style="color: #51afef;">var</span> task: Task
<span class="linenr">36: </span>    <span style="color: #51afef;">var</span> body: <span style="color: #51afef;">some</span> View {
<span class="linenr">37: </span>        HStack {
<span class="linenr">38: </span>            <span style="color: #c678dd;">Image</span>(systemName: <span style="color: #98be65;">"circle"</span>)
<span class="linenr">39: </span>            <span style="color: #c678dd;">Text</span>(task.<span style="color: #c678dd;">title</span>)
<span class="linenr">40: </span>        }
<span class="linenr">41: </span>    }
<span class="linenr">42: </span>}
<span class="linenr">43: </span>
</pre>
</div>
</div>
</li>
</ol>
</li>
</ol>
</div>
<div id="outline-container-orgc22d52f" class="outline-3">
<h3 id="orgc22d52f"><span class="section-number-3">2.3</span> MVVM</h3>
<div class="outline-text-3" id="text-2-3">
<p>
以MVVM架構來開發project<br />
</p>
</div>
<ol class="org-ol">
<li><a id="org02b74e2"></a>ViewModel<br />
<ol class="org-ol">
<li><a id="org48daa7b"></a>Diagram for now<br />
<div class="outline-text-5" id="text-2-3-1-1">

<div class="figure">
<p><img src="images/mvvm-d1.png" alt="mvvm-d1.png" /><br />
</p>
</div>
</div>
</li>

<li><a id="org4840719"></a>Model for the future<br />
<div class="outline-text-5" id="text-2-3-1-2">

<div class="figure">
<p><img src="images/mvvm-d2.png" alt="mvvm-d2.png" /><br />
</p>
</div>
</div>
</li>

<li><a id="org61a750b"></a>TaskCellViewModel<br />
<div class="outline-text-5" id="text-2-3-1-3">
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 2: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">TaskCellViewModel.swift</span>
<span class="linenr"> 3: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">taskManagement</span>
<span class="linenr"> 4: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 5: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">Created by yen yung chin on 2021/2/20.</span>
<span class="linenr"> 6: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #51afef;">import</span> Foundation
<span class="linenr"> 9: </span><span style="color: #51afef;">import</span> Combine
<span class="linenr">10: </span>
<span class="linenr">11: </span><span style="color: #51afef;">class</span> <span style="color: #c678dd;">TaskCellViewModel</span>: <span style="color: #c678dd;">ObservableObject</span>, Identifiable  {
<span class="linenr">12: </span>    <span style="color: #51afef;">@Published</span> <span style="color: #51afef;">var</span> task: Task
<span class="linenr">13: </span>
<span class="linenr">14: </span>    <span style="color: #51afef;">@Published</span> <span style="color: #51afef;">var</span> completionStateIconName = <span style="color: #98be65;">""</span>
<span class="linenr">15: </span>    <span style="color: #51afef;">private</span> <span style="color: #51afef;">var</span> cancellables = <span style="color: #c678dd;">Set</span>&lt;AnyCancellable&gt;()
<span class="linenr">16: </span>    <span style="color: #51afef;">init</span>(task: Task) {
<span class="linenr">17: </span>        <span style="color: #51afef;">self</span>.<span style="color: #c678dd;">task</span> = task
<span class="linenr">18: </span>        $task
<span class="linenr">19: </span>            .<span style="color: #c678dd;">map</span> { task <span style="color: #51afef;">in</span>
<span class="linenr">20: </span>                <span style="color: #51afef;">return</span> task.<span style="color: #c678dd;">completed</span> ? <span style="color: #98be65;">"checkmark.circle.fill"</span> : <span style="color: #98be65;">"circle"</span>
<span class="linenr">21: </span>            }
<span class="linenr">22: </span>            .<span style="color: #c678dd;">assign</span>(to: \.<span style="color: #dcaeea;">completionStateIconName</span>, on: <span style="color: #51afef;">self</span>)
<span class="linenr">23: </span>            .<span style="color: #c678dd;">store</span>(<span style="color: #51afef;">in</span>: &amp;cancellables)
<span class="linenr">24: </span>    }
<span class="linenr">25: </span>}
<span class="linenr">26: </span>
</pre>
</div>
</div>
</li>
<li><a id="orgfb27db5"></a>TaskListViewModel<br />
<div class="outline-text-5" id="text-2-3-1-4">
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 2: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">TaskListViewModel.swift</span>
<span class="linenr"> 3: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">taskManagement</span>
<span class="linenr"> 4: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 5: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">Created by yen yung chin on 2021/2/20.</span>
<span class="linenr"> 6: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #51afef;">import</span> Foundation
<span class="linenr"> 9: </span><span style="color: #51afef;">import</span> Combine
<span class="linenr">10: </span>
<span class="linenr">11: </span><span style="color: #51afef;">class</span> <span style="color: #c678dd;">TaskListMiewModel</span>: <span style="color: #c678dd;">ObservableObject</span> {
<span class="linenr">12: </span>    <span style="color: #51afef;">@Published</span> <span style="color: #51afef;">var</span> taskCellViewModels = [TaskCellViewModel]()
<span class="linenr">13: </span>
<span class="linenr">14: </span>    <span style="color: #51afef;">init</span>() {
<span class="linenr">15: </span>        <span style="color: #51afef;">self</span>.<span style="color: #dcaeea;">taskCellViewModels</span> = testDataTasks.<span style="color: #c678dd;">map</span> { task <span style="color: #51afef;">in</span>
<span class="linenr">16: </span>            <span style="color: #c678dd;">TaskCellViewModel</span>(task: task)
<span class="linenr">17: </span>        }
<span class="linenr">18: </span>    }
<span class="linenr">19: </span>
<span class="linenr">20: </span>}
<span class="linenr">21: </span>
</pre>
</div>
</div>
</li>
</ol>
</li>
<li><a id="orgaa46ffa"></a>View<br />
<div class="outline-text-4" id="text-2-3-2">
<p>
TaskListView.swift<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 2: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">ContentView.swift</span>
<span class="linenr"> 3: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">taskManagement</span>
<span class="linenr"> 4: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 5: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">Created by yen yung chin on 2021/2/16.</span>
<span class="linenr"> 6: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #51afef;">import</span> SwiftUI
<span class="linenr"> 9: </span>
<span class="linenr">10: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">TaskListView</span>: View {
<span class="linenr">11: </span>    <span style="color: #51afef;">@ObservedObject</span> <span style="color: #51afef;">var</span> taskListVM = <span style="color: #c678dd;">TaskListMiewModel</span>()
<span class="linenr">12: </span>
<span class="linenr">13: </span>    <span style="color: #51afef;">var</span> body: <span style="color: #51afef;">some</span> View {
<span class="linenr">14: </span>        NavigationView {
<span class="linenr">15: </span>            <span style="color: #c678dd;">VStack</span>(alignment: .<span style="color: #dcaeea;">leading</span>, spacing: <span style="color: #da8548; font-weight: bold;">10</span>, content: {
<span class="linenr">16: </span>                <span style="color: #c678dd;">List</span>(taskListVM.<span style="color: #dcaeea;">taskCellViewModels</span>) { task <span style="color: #51afef;">in</span>
<span class="linenr">17: </span>                    <span style="color: #c678dd;">TaskCell</span>(taskCellVM: task)
<span class="linenr">18: </span>                }
<span class="linenr">19: </span>                <span style="color: #c678dd;">HStack</span>(alignment: .<span style="color: #c678dd;">center</span>, spacing: <span style="color: #da8548; font-weight: bold;">10</span>, content: {
<span class="linenr">20: </span>                    <span style="color: #c678dd;">Image</span>(systemName: <span style="color: #98be65;">"plus.circle.fill"</span>)
<span class="linenr">21: </span>                    <span style="color: #c678dd;">Text</span>(<span style="color: #98be65;">"New Task"</span>)
<span class="linenr">22: </span>                }).<span style="color: #c678dd;">padding</span>()
<span class="linenr">23: </span>
<span class="linenr">24: </span>            }).<span style="color: #c678dd;">navigationTitle</span>(<span style="color: #98be65;">"Tasks"</span>)
<span class="linenr">25: </span>        }
<span class="linenr">26: </span>    }
<span class="linenr">27: </span>}
<span class="linenr">28: </span>
<span class="linenr">29: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">ContentView_Previews</span>: PreviewProvider {
<span class="linenr">30: </span>    <span style="color: #51afef;">static</span> <span style="color: #51afef;">var</span> previews: <span style="color: #51afef;">some</span> View {
<span class="linenr">31: </span>        <span style="color: #c678dd;">TaskListView</span>()
<span class="linenr">32: </span>    }
<span class="linenr">33: </span>}
<span class="linenr">34: </span>
<span class="linenr">35: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">TaskCell</span>: View {
<span class="linenr">36: </span>    <span style="color: #51afef;">@ObservedObject</span> <span style="color: #51afef;">var</span> taskCellVM: TaskCellViewModel
<span class="linenr">37: </span>
<span class="linenr">38: </span>    <span style="color: #51afef;">var</span> body: <span style="color: #51afef;">some</span> View {
<span class="linenr">39: </span>        HStack {
<span class="linenr">40: </span>            <span style="color: #c678dd;">Image</span>(systemName: taskCellVM.<span style="color: #dcaeea;">completionStateIconName</span>)
<span class="linenr">41: </span>            <span style="color: #c678dd;">Text</span>(taskCellVM.<span style="color: #c678dd;">task</span>.<span style="color: #c678dd;">title</span>)
<span class="linenr">42: </span>        }
<span class="linenr">43: </span>    }
<span class="linenr">44: </span>}
<span class="linenr">45: </span>
</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-orgba39b53" class="outline-3">
<h3 id="orgba39b53"><span class="section-number-3">2.4</span> New task</h3>
<div class="outline-text-3" id="text-2-4">
<p>
加入新增task功能，真正的新增功能由ViewModel實作，View負責界面及呼叫該功能<br />
</p>
</div>
<ol class="org-ol">
<li><a id="orgcb32251"></a>View<br />
<ol class="org-ol">
<li><a id="org72db516"></a>NewTaskView.swift<br />
<div class="outline-text-5" id="text-2-4-1-1">
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 2: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">NewTaskView.swift</span>
<span class="linenr"> 3: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">taskManagement</span>
<span class="linenr"> 4: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 5: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">Created by yen yung chin on 2021/2/20.</span>
<span class="linenr"> 6: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #51afef;">import</span> SwiftUI
<span class="linenr"> 9: </span>
<span class="linenr">10: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">NewTaskView</span>: View {
<span class="linenr">11: </span>    <span style="color: #51afef;">@ObservedObject</span> <span style="color: #51afef;">var</span> taskListVM = <span style="color: #c678dd;">TaskListMiewModel</span>()
<span class="linenr">12: </span>    <span style="color: #51afef;">@State</span> <span style="color: #51afef;">var</span> taskTitle: <span style="color: #c678dd;">String</span> = <span style="color: #98be65;">""</span>
<span class="linenr">13: </span>
<span class="linenr">14: </span>    <span style="color: #51afef;">@Environment</span>(\.<span style="color: #dcaeea;">presentationMode</span>) <span style="color: #51afef;">var</span> presentation
<span class="linenr">15: </span>
<span class="linenr">16: </span>    <span style="color: #51afef;">var</span> body: <span style="color: #51afef;">some</span> View {
<span class="linenr">17: </span>        VStack {
<span class="linenr">18: </span>            <span style="color: #c678dd;">Text</span>(<span style="color: #98be65;">"New Task"</span>)
<span class="linenr">19: </span>                .<span style="color: #c678dd;">font</span>(.<span style="color: #dcaeea;">largeTitle</span>)
<span class="linenr">20: </span>            <span style="color: #c678dd;">TextField</span>(<span style="color: #98be65;">"Enter task name"</span>, text: <span style="color: #51afef;">self</span>.$taskTitle)
<span class="linenr">21: </span>            <span style="color: #c678dd;">Button</span>(action: {
<span class="linenr">22: </span>                taskListVM.<span style="color: #c678dd;">addTask</span>(task: <span style="color: #c678dd;">Task</span>(title: <span style="color: #51afef;">self</span>.<span style="color: #dcaeea;">taskTitle</span>, completed: <span style="color: #a9a1e1;">false</span>))
<span class="linenr">23: </span>                <span style="color: #51afef;">self</span>.<span style="color: #dcaeea;">presentation</span>.<span style="color: #dcaeea;">wrappedValue</span>.<span style="color: #c678dd;">dismiss</span>()
<span class="linenr">24: </span>            }, label: {
<span class="linenr">25: </span>                <span style="color: #c678dd;">Text</span>(<span style="color: #98be65;">"Done"</span>)
<span class="linenr">26: </span>            })
<span class="linenr">27: </span>            <span style="color: #c678dd;">Spacer</span>()
<span class="linenr">28: </span>        }.<span style="color: #c678dd;">padding</span>()
<span class="linenr">29: </span>    }
<span class="linenr">30: </span>}
<span class="linenr">31: </span>
<span class="linenr">32: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">NewTaskView_Previews</span>: PreviewProvider {
<span class="linenr">33: </span>    <span style="color: #51afef;">static</span> <span style="color: #51afef;">var</span> previews: <span style="color: #51afef;">some</span> View {
<span class="linenr">34: </span>        <span style="color: #c678dd;">NewTaskView</span>()
<span class="linenr">35: </span>    }
<span class="linenr">36: </span>}
<span class="linenr">37: </span>
</pre>
</div>
</div>
</li>
<li><a id="org228205c"></a>TaskListView.swift<br />
<div class="outline-text-5" id="text-2-4-1-2">
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 2: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">ContentView.swift</span>
<span class="linenr"> 3: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">taskManagement</span>
<span class="linenr"> 4: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 5: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">Created by yen yung chin on 2021/2/16.</span>
<span class="linenr"> 6: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #51afef;">import</span> SwiftUI
<span class="linenr"> 9: </span>
<span class="linenr">10: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">TaskListView</span>: View {
<span class="linenr">11: </span>    <span style="color: #51afef;">@ObservedObject</span> <span style="color: #51afef;">var</span> taskListVM = <span style="color: #c678dd;">TaskListMiewModel</span>()
<span class="linenr">12: </span>    <span style="color: #51afef;">var</span> body: <span style="color: #51afef;">some</span> View {
<span class="linenr">13: </span>        NavigationView {
<span class="linenr">14: </span>            <span style="color: #c678dd;">VStack</span>(alignment: .<span style="color: #dcaeea;">leading</span>, spacing: <span style="color: #da8548; font-weight: bold;">10</span>, content: {
<span class="linenr">15: </span>                <span style="color: #c678dd;">List</span>(taskListVM.<span style="color: #dcaeea;">taskCellViewModels</span>) { task <span style="color: #51afef;">in</span>
<span class="linenr">16: </span>                    <span style="color: #c678dd;">TaskCell</span>(taskCellVM: task)
<span class="linenr">17: </span>                }
<span class="linenr">18: </span>
<span class="linenr">19: </span>
<span class="linenr">20: </span>                <span style="color: #c678dd;">HStack</span>(alignment: .<span style="color: #c678dd;">center</span>, spacing: <span style="color: #da8548; font-weight: bold;">10</span>, content: {
<span class="linenr">21: </span>                    <span style="color: #c678dd;">Image</span>(systemName: <span style="color: #98be65;">"plus.circle.fill"</span>)
<span class="linenr">22: </span>                    <span style="color: #c678dd;">Button</span>(action: <span style="color: #5B6268;">/*</span><span style="color: #5B6268;">@START_MENU_TOKEN@*/</span>{}<span style="color: #5B6268;">/*</span><span style="color: #5B6268;">@END_MENU_TOKEN@*/</span>, label: {
<span class="linenr">23: </span>                        <span style="color: #5B6268;">/*</span><span style="color: #5B6268;">@START_MENU_TOKEN@*/</span><span style="color: #c678dd;">Text</span>(<span style="color: #98be65;">"Button"</span>)<span style="color: #5B6268;">/*</span><span style="color: #5B6268;">@END_MENU_TOKEN@*/</span>
<span class="linenr">24: </span>                    })
<span class="linenr">25: </span>                    <span style="color: #c678dd;">Text</span>(<span style="color: #98be65;">"New Task"</span>)
<span class="linenr">26: </span>                }).<span style="color: #c678dd;">padding</span>()
<span class="linenr">27: </span>
<span class="linenr">28: </span>                .<span style="color: #c678dd;">navigationBarTitle</span>(<span style="color: #98be65;">"Tasks"</span>, displayMode: .<span style="color: #c678dd;">inline</span>)
<span class="linenr">29: </span>
<span class="linenr">30: </span>                .<span style="color: #c678dd;">navigationBarItems</span>(trailing: <span style="color: #c678dd;">NavigationLink</span>(
<span class="linenr">31: </span>                                        destination: <span style="color: #c678dd;">NewTaskView</span>(taskListVM: taskListVM, taskTitle: <span style="color: #98be65;">""</span>),
<span class="linenr">32: </span>                                        label: {
<span class="linenr">33: </span>                                            <span style="color: #c678dd;">Text</span>(<span style="color: #98be65;">"New Task"</span>)
<span class="linenr">34: </span>                                        }))
<span class="linenr">35: </span>
<span class="linenr">36: </span>            })
<span class="linenr">37: </span>        }
<span class="linenr">38: </span>    }
<span class="linenr">39: </span>}
<span class="linenr">40: </span>
<span class="linenr">41: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">ContentView_Previews</span>: PreviewProvider {
<span class="linenr">42: </span>    <span style="color: #51afef;">static</span> <span style="color: #51afef;">var</span> previews: <span style="color: #51afef;">some</span> View {
<span class="linenr">43: </span>        <span style="color: #c678dd;">TaskListView</span>()
<span class="linenr">44: </span>    }
<span class="linenr">45: </span>}
<span class="linenr">46: </span>
<span class="linenr">47: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">TaskCell</span>: View {
<span class="linenr">48: </span>    <span style="color: #51afef;">@ObservedObject</span> <span style="color: #51afef;">var</span> taskCellVM: TaskCellViewModel
<span class="linenr">49: </span>
<span class="linenr">50: </span>    <span style="color: #51afef;">var</span> body: <span style="color: #51afef;">some</span> View {
<span class="linenr">51: </span>        HStack {
<span class="linenr">52: </span>            <span style="color: #c678dd;">Image</span>(systemName: taskCellVM.<span style="color: #dcaeea;">completionStateIconName</span>)
<span class="linenr">53: </span>            <span style="color: #c678dd;">Text</span>(taskCellVM.<span style="color: #c678dd;">task</span>.<span style="color: #c678dd;">title</span>)
<span class="linenr">54: </span>        }
<span class="linenr">55: </span>    }
<span class="linenr">56: </span>}
<span class="linenr">57: </span>
</pre>
</div>
</div>
</li>
</ol>
</li>
<li><a id="orgcf0ef18"></a>ViewModel<br />
<ol class="org-ol">
<li><a id="org10cc101"></a>TaskListViewModel.swift<br />
<div class="outline-text-5" id="text-2-4-2-1">
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 2: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">TaskListViewModel.swift</span>
<span class="linenr"> 3: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">taskManagement</span>
<span class="linenr"> 4: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 5: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">Created by yen yung chin on 2021/2/20.</span>
<span class="linenr"> 6: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #51afef;">import</span> Foundation
<span class="linenr"> 9: </span><span style="color: #51afef;">import</span> Combine
<span class="linenr">10: </span>
<span class="linenr">11: </span><span style="color: #51afef;">class</span> <span style="color: #c678dd;">TaskListMiewModel</span>: <span style="color: #c678dd;">ObservableObject</span> {
<span class="linenr">12: </span>    <span style="color: #51afef;">@Published</span> <span style="color: #51afef;">var</span> taskCellViewModels = [TaskCellViewModel]()
<span class="linenr">13: </span>
<span class="linenr">14: </span>    <span style="color: #51afef;">init</span>() {
<span class="linenr">15: </span>        <span style="color: #51afef;">self</span>.<span style="color: #dcaeea;">taskCellViewModels</span> = testDataTasks.<span style="color: #c678dd;">map</span> { task <span style="color: #51afef;">in</span>
<span class="linenr">16: </span>            <span style="color: #c678dd;">TaskCellViewModel</span>(task: task)
<span class="linenr">17: </span>        }
<span class="linenr">18: </span>    }
<span class="linenr">19: </span>
<span class="linenr">20: </span>    <span style="color: #51afef;">func</span> <span style="color: #c678dd;">addTask</span>(task: Task) {
<span class="linenr">21: </span>        <span style="color: #51afef;">let</span> task = <span style="color: #c678dd;">TaskCellViewModel</span>(task: task)
<span class="linenr">22: </span>        <span style="color: #51afef;">self</span>.<span style="color: #dcaeea;">taskCellViewModels</span>.<span style="color: #c678dd;">append</span>(task)
<span class="linenr">23: </span>    }
<span class="linenr">24: </span>}
<span class="linenr">25: </span>
</pre>
</div>
</div>
</li>
</ol>
</li>
</ol>
</div>
<div id="outline-container-orgcbac35e" class="outline-3">
<h3 id="orgcbac35e"><span class="section-number-3">2.5</span> Delete task</h3>
<div class="outline-text-3" id="text-2-5">
<p>
加入swipe進行刪除的功能，真正刪除的功能由ViewModel實作，View負責呼叫<br />
</p>
</div>
<ol class="org-ol">
<li><a id="orgb76677f"></a>View<br />
<ol class="org-ol">
<li><a id="orgb568791"></a>TaskListView.swift<br />
<div class="outline-text-5" id="text-2-5-1-1">
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 2: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">ContentView.swift</span>
<span class="linenr"> 3: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">taskManagement</span>
<span class="linenr"> 4: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 5: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">Created by yen yung chin on 2021/2/16.</span>
<span class="linenr"> 6: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #51afef;">import</span> SwiftUI
<span class="linenr"> 9: </span>
<span class="linenr">10: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">TaskListView</span>: View {
<span class="linenr">11: </span>    <span style="color: #51afef;">@ObservedObject</span> <span style="color: #51afef;">var</span> taskListVM = <span style="color: #c678dd;">TaskListMiewModel</span>()
<span class="linenr">12: </span>    <span style="color: #51afef;">var</span> body: <span style="color: #51afef;">some</span> View {
<span class="linenr">13: </span>        NavigationView {
<span class="linenr">14: </span>            <span style="color: #c678dd;">VStack</span>(alignment: .<span style="color: #dcaeea;">leading</span>, spacing: <span style="color: #da8548; font-weight: bold;">10</span>, content: {
<span class="linenr">15: </span>                List {
<span class="linenr">16: </span>                    <span style="color: #c678dd;">ForEach</span>(taskListVM.<span style="color: #dcaeea;">taskCellViewModels</span>) { task <span style="color: #51afef;">in</span>
<span class="linenr">17: </span>                        <span style="color: #c678dd;">TaskCell</span>(taskCellVM: task)
<span class="linenr">18: </span>
<span class="linenr">19: </span>                    }
<span class="linenr">20: </span>                    .<span style="color: #c678dd;">onDelete</span>(perform: { indexSet <span style="color: #51afef;">in</span>
<span class="linenr">21: </span>                        taskListVM.<span style="color: #c678dd;">deleteTask</span>(indexSet: indexSet)
<span class="linenr">22: </span>                    })
<span class="linenr">23: </span>                }
<span class="linenr">24: </span>
<span class="linenr">25: </span>                <span style="color: #c678dd;">HStack</span>(alignment: .<span style="color: #c678dd;">center</span>, spacing: <span style="color: #da8548; font-weight: bold;">10</span>, content: {
<span class="linenr">26: </span>                    <span style="color: #c678dd;">Image</span>(systemName: <span style="color: #98be65;">"plus.circle.fill"</span>)
<span class="linenr">27: </span>                    <span style="color: #c678dd;">Button</span>(action: <span style="color: #5B6268;">/*</span><span style="color: #5B6268;">@START_MENU_TOKEN@*/</span>{}<span style="color: #5B6268;">/*</span><span style="color: #5B6268;">@END_MENU_TOKEN@*/</span>, label: {
<span class="linenr">28: </span>                        <span style="color: #5B6268;">/*</span><span style="color: #5B6268;">@START_MENU_TOKEN@*/</span><span style="color: #c678dd;">Text</span>(<span style="color: #98be65;">"Button"</span>)<span style="color: #5B6268;">/*</span><span style="color: #5B6268;">@END_MENU_TOKEN@*/</span>
<span class="linenr">29: </span>                    })
<span class="linenr">30: </span>                    <span style="color: #c678dd;">Text</span>(<span style="color: #98be65;">"New Task"</span>)
<span class="linenr">31: </span>                }).<span style="color: #c678dd;">padding</span>()
<span class="linenr">32: </span>
<span class="linenr">33: </span>                .<span style="color: #c678dd;">navigationBarTitle</span>(<span style="color: #98be65;">"Tasks"</span>, displayMode: .<span style="color: #c678dd;">inline</span>)
<span class="linenr">34: </span>
<span class="linenr">35: </span>                .<span style="color: #c678dd;">navigationBarItems</span>(trailing: <span style="color: #c678dd;">NavigationLink</span>(
<span class="linenr">36: </span>                                        destination: <span style="color: #c678dd;">NewTaskView</span>(taskListVM: taskListVM, taskTitle: <span style="color: #98be65;">""</span>),
<span class="linenr">37: </span>                                        label: {
<span class="linenr">38: </span>                                            <span style="color: #c678dd;">Text</span>(<span style="color: #98be65;">"New Task"</span>)
<span class="linenr">39: </span>                                        }))
<span class="linenr">40: </span>
<span class="linenr">41: </span>            })
<span class="linenr">42: </span>        }
<span class="linenr">43: </span>    }
<span class="linenr">44: </span>}
<span class="linenr">45: </span>
<span class="linenr">46: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">ContentView_Previews</span>: PreviewProvider {
<span class="linenr">47: </span>    <span style="color: #51afef;">static</span> <span style="color: #51afef;">var</span> previews: <span style="color: #51afef;">some</span> View {
<span class="linenr">48: </span>        <span style="color: #c678dd;">TaskListView</span>()
<span class="linenr">49: </span>    }
<span class="linenr">50: </span>}
<span class="linenr">51: </span>
<span class="linenr">52: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">TaskCell</span>: View {
<span class="linenr">53: </span>    <span style="color: #51afef;">@ObservedObject</span> <span style="color: #51afef;">var</span> taskCellVM: TaskCellViewModel
<span class="linenr">54: </span>
<span class="linenr">55: </span>    <span style="color: #51afef;">var</span> body: <span style="color: #51afef;">some</span> View {
<span class="linenr">56: </span>        HStack {
<span class="linenr">57: </span>            <span style="color: #c678dd;">Image</span>(systemName: taskCellVM.<span style="color: #dcaeea;">completionStateIconName</span>)
<span class="linenr">58: </span>            <span style="color: #c678dd;">Text</span>(taskCellVM.<span style="color: #c678dd;">task</span>.<span style="color: #c678dd;">title</span>)
<span class="linenr">59: </span>        }
<span class="linenr">60: </span>    }
<span class="linenr">61: </span>}
<span class="linenr">62: </span>
</pre>
</div>
</div>
</li>
</ol>
</li>
<li><a id="org913b091"></a>ViewModel<br />
<ol class="org-ol">
<li><a id="org4416f84"></a>TaskListViewModel.swift<br />
<div class="outline-text-5" id="text-2-5-2-1">
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 2: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">TaskListViewModel.swift</span>
<span class="linenr"> 3: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">taskManagement</span>
<span class="linenr"> 4: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 5: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">Created by yen yung chin on 2021/2/20.</span>
<span class="linenr"> 6: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #51afef;">import</span> Foundation
<span class="linenr"> 9: </span><span style="color: #51afef;">import</span> Combine
<span class="linenr">10: </span>
<span class="linenr">11: </span><span style="color: #51afef;">class</span> <span style="color: #c678dd;">TaskListMiewModel</span>: <span style="color: #c678dd;">ObservableObject</span> {
<span class="linenr">12: </span>    <span style="color: #51afef;">@Published</span> <span style="color: #51afef;">var</span> taskCellViewModels = [TaskCellViewModel]()
<span class="linenr">13: </span>
<span class="linenr">14: </span>    <span style="color: #51afef;">init</span>() {
<span class="linenr">15: </span>        <span style="color: #51afef;">self</span>.<span style="color: #dcaeea;">taskCellViewModels</span> = testDataTasks.<span style="color: #c678dd;">map</span> { task <span style="color: #51afef;">in</span>
<span class="linenr">16: </span>            <span style="color: #c678dd;">TaskCellViewModel</span>(task: task)
<span class="linenr">17: </span>        }
<span class="linenr">18: </span>    }
<span class="linenr">19: </span>
<span class="linenr">20: </span>    <span style="color: #51afef;">func</span> <span style="color: #c678dd;">addTask</span>(task: Task) {
<span class="linenr">21: </span>        <span style="color: #51afef;">let</span> task = <span style="color: #c678dd;">TaskCellViewModel</span>(task: task)
<span class="linenr">22: </span>        <span style="color: #51afef;">self</span>.<span style="color: #dcaeea;">taskCellViewModels</span>.<span style="color: #c678dd;">append</span>(task)
<span class="linenr">23: </span>    }
<span class="linenr">24: </span>
<span class="linenr">25: </span>    <span style="color: #51afef;">func</span> <span style="color: #c678dd;">deleteTask</span>(indexSet: <span style="color: #c678dd;">IndexSet</span>) {
<span class="linenr">26: </span>        <span style="color: #51afef;">self</span>.<span style="color: #dcaeea;">taskCellViewModels</span>.<span style="color: #c678dd;">remove</span>(atOffsets: indexSet)
<span class="linenr">27: </span>    }
<span class="linenr">28: </span>}
<span class="linenr">29: </span>
</pre>
</div>
</div>
</li>
</ol>
</li>
</ol>
</div>
<div id="outline-container-org4f37a48" class="outline-3">
<h3 id="org4f37a48"><span class="section-number-3">2.6</span> enum v.s. picker</h3>
<div class="outline-text-3" id="text-2-6">
<p>
加入task的priority欄位(enum)<br />
</p>
</div>
<ol class="org-ol">
<li><a id="org2c55660"></a>Model<br />
<div class="outline-text-4" id="text-2-6-1">
<p>
以enum來表示task的不同優先權<br />
</p>
</div>
<ol class="org-ol">
<li><a id="orgf8aae88"></a>Model.swift<br />
<div class="outline-text-5" id="text-2-6-1-1">
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 2: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">Task.swift</span>
<span class="linenr"> 3: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">taskManagement</span>
<span class="linenr"> 4: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 5: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">Created by yen yung chin on 2021/2/18.</span>
<span class="linenr"> 6: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #51afef;">import</span> Foundation
<span class="linenr"> 9: </span>
<span class="linenr">10: </span><span style="color: #51afef;">enum</span> <span style="color: #c678dd;">TaskPriority</span>: <span style="color: #c678dd;">String</span>, <span style="color: #c678dd;">CaseIterable</span>  {
<span class="linenr">11: </span>    <span style="color: #51afef;">case</span> high
<span class="linenr">12: </span>    <span style="color: #51afef;">case</span> medium
<span class="linenr">13: </span>    <span style="color: #51afef;">case</span> low
<span class="linenr">14: </span>}
<span class="linenr">15: </span>
<span class="linenr">16: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">Task</span>: Identifiable {
<span class="linenr">17: </span>    <span style="color: #51afef;">var</span> id = <span style="color: #c678dd;">UUID</span>()
<span class="linenr">18: </span>    <span style="color: #51afef;">var</span> title: <span style="color: #c678dd;">String</span>
<span class="linenr">19: </span>    <span style="color: #51afef;">var</span> priority: TaskPriority  <span style="color: #5B6268;">//</span><span style="color: #5B6268;">&#21482;&#26377;&#19977;&#31278;&#21487;&#33021;&#24615;</span>
<span class="linenr">20: </span>    <span style="color: #51afef;">var</span> completed: <span style="color: #c678dd;">Bool</span>
<span class="linenr">21: </span>}
<span class="linenr">22: </span>
<span class="linenr">23: </span><span style="color: #51afef; font-weight: bold;">#if</span> DEBUG
<span class="linenr">24: </span><span style="color: #51afef;">let</span> testDataTasks = [
<span class="linenr">25: </span>    <span style="color: #c678dd;">Task</span>(title: <span style="color: #98be65;">"Implement UI"</span>, priority: .<span style="color: #c678dd;">medium</span>, completed: <span style="color: #a9a1e1;">true</span>),
<span class="linenr">26: </span>    <span style="color: #c678dd;">Task</span>(title: <span style="color: #98be65;">"Share data"</span>, priority: .<span style="color: #c678dd;">high</span>, completed: <span style="color: #a9a1e1;">false</span>),
<span class="linenr">27: </span>    <span style="color: #c678dd;">Task</span>(title: <span style="color: #98be65;">"Create Chart"</span>, priority: .<span style="color: #c678dd;">medium</span>, completed: <span style="color: #a9a1e1;">false</span>),
<span class="linenr">28: </span>    <span style="color: #c678dd;">Task</span>(title: <span style="color: #98be65;">"Connect to Firebase"</span>, priority: .<span style="color: #c678dd;">high</span>, completed: <span style="color: #a9a1e1;">false</span>),
<span class="linenr">29: </span>    <span style="color: #c678dd;">Task</span>(title: <span style="color: #98be65;">"PROFIT!!!"</span>, priority: .<span style="color: #c678dd;">high</span>, completed: <span style="color: #a9a1e1;">false</span>)
<span class="linenr">30: </span>]
<span class="linenr">31: </span><span style="color: #51afef; font-weight: bold;">#endif</span>
<span class="linenr">32: </span>
</pre>
</div>
</div>
</li>
</ol>
</li>
<li><a id="org33ac44f"></a>View<br />
<ol class="org-ol">
<li><a id="org7a28145"></a>TaskListView.swift<br />
<div class="outline-text-5" id="text-2-6-2-1">
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 2: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">ContentView.swift</span>
<span class="linenr"> 3: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">taskManagement</span>
<span class="linenr"> 4: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 5: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">Created by yen yung chin on 2021/2/16.</span>
<span class="linenr"> 6: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #51afef;">import</span> SwiftUI
<span class="linenr"> 9: </span>
<span class="linenr">10: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">TaskListView</span>: View {
<span class="linenr">11: </span>    <span style="color: #51afef;">@ObservedObject</span> <span style="color: #51afef;">var</span> taskListVM = <span style="color: #c678dd;">TaskListMiewModel</span>()
<span class="linenr">12: </span>    <span style="color: #51afef;">var</span> body: <span style="color: #51afef;">some</span> View {
<span class="linenr">13: </span>        NavigationView {
<span class="linenr">14: </span>            <span style="color: #c678dd;">VStack</span>(alignment: .<span style="color: #dcaeea;">leading</span>, spacing: <span style="color: #da8548; font-weight: bold;">10</span>, content: {
<span class="linenr">15: </span>                List {
<span class="linenr">16: </span>                    <span style="color: #c678dd;">ForEach</span>(taskListVM.<span style="color: #dcaeea;">taskCellViewModels</span>) { task <span style="color: #51afef;">in</span>
<span class="linenr">17: </span>                        <span style="color: #c678dd;">TaskCell</span>(taskCellVM: task)
<span class="linenr">18: </span>
<span class="linenr">19: </span>                    }
<span class="linenr">20: </span>                    .<span style="color: #c678dd;">onDelete</span>(perform: { indexSet <span style="color: #51afef;">in</span>
<span class="linenr">21: </span>                        taskListVM.<span style="color: #c678dd;">deleteTask</span>(indexSet: indexSet)
<span class="linenr">22: </span>                    })
<span class="linenr">23: </span>                }
<span class="linenr">24: </span>
<span class="linenr">25: </span>                .<span style="color: #c678dd;">navigationBarTitle</span>(<span style="color: #98be65;">"Tasks"</span>, displayMode: .<span style="color: #c678dd;">inline</span>)
<span class="linenr">26: </span>
<span class="linenr">27: </span>                .<span style="color: #c678dd;">navigationBarItems</span>(trailing: <span style="color: #c678dd;">NavigationLink</span>(
<span class="linenr">28: </span>                                        destination: <span style="color: #c678dd;">NewTaskView</span>(taskListVM: taskListVM, taskTitle: <span style="color: #98be65;">""</span>, priority: TaskPriority.<span style="color: #c678dd;">low</span>),
<span class="linenr">29: </span>                                        label: {
<span class="linenr">30: </span>                                            <span style="color: #c678dd;">Text</span>(<span style="color: #98be65;">"New Task"</span>)
<span class="linenr">31: </span>                                        }))
<span class="linenr">32: </span>
<span class="linenr">33: </span>            })
<span class="linenr">34: </span>        }
<span class="linenr">35: </span>    }
<span class="linenr">36: </span>}
<span class="linenr">37: </span>
<span class="linenr">38: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">ContentView_Previews</span>: PreviewProvider {
<span class="linenr">39: </span>    <span style="color: #51afef;">static</span> <span style="color: #51afef;">var</span> previews: <span style="color: #51afef;">some</span> View {
<span class="linenr">40: </span>        <span style="color: #c678dd;">TaskListView</span>()
<span class="linenr">41: </span>    }
<span class="linenr">42: </span>}
<span class="linenr">43: </span>
<span class="linenr">44: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">TaskCell</span>: View {
<span class="linenr">45: </span>    <span style="color: #51afef;">@ObservedObject</span> <span style="color: #51afef;">var</span> taskCellVM: TaskCellViewModel
<span class="linenr">46: </span>
<span class="linenr">47: </span>    <span style="color: #51afef;">var</span> body: <span style="color: #51afef;">some</span> View {
<span class="linenr">48: </span>        HStack {
<span class="linenr">49: </span>            <span style="color: #c678dd;">Image</span>(systemName: taskCellVM.<span style="color: #dcaeea;">completionStateIconName</span>)
<span class="linenr">50: </span>            <span style="color: #c678dd;">Image</span>(systemName: taskCellVM.<span style="color: #dcaeea;">priorityStateIconName</span>)
<span class="linenr">51: </span>                .<span style="color: #c678dd;">foregroundColor</span>(Color.<span style="color: #dcaeea;">blue</span>)
<span class="linenr">52: </span>            <span style="color: #c678dd;">Text</span>(taskCellVM.<span style="color: #c678dd;">task</span>.<span style="color: #c678dd;">title</span>)
<span class="linenr">53: </span>        }
<span class="linenr">54: </span>    }
<span class="linenr">55: </span>}
</pre>
</div>
</div>
</li>
<li><a id="org1d5c9af"></a>NewTaskView.swift<br />
<div class="outline-text-5" id="text-2-6-2-2">
<p>
新增task時改以Picker來選取enum中的子類別<sup><a id="fnr.1" class="footref" href="#fn.1">1</a></sup><br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 2: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">NewTaskView.swift</span>
<span class="linenr"> 3: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">taskManagement</span>
<span class="linenr"> 4: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 5: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">Created by yen yung chin on 2021/2/20.</span>
<span class="linenr"> 6: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #51afef;">import</span> SwiftUI
<span class="linenr"> 9: </span>
<span class="linenr">10: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">NewTaskView</span>: View {
<span class="linenr">11: </span>    <span style="color: #51afef;">@ObservedObject</span> <span style="color: #51afef;">var</span> taskListVM = <span style="color: #c678dd;">TaskListMiewModel</span>()
<span class="linenr">12: </span>    <span style="color: #51afef;">@State</span> <span style="color: #51afef;">var</span> taskTitle: <span style="color: #c678dd;">String</span> = <span style="color: #98be65;">""</span>
<span class="linenr">13: </span>    <span style="color: #51afef;">@State</span> <span style="color: #51afef;">var</span> priority : TaskPriority
<span class="linenr">14: </span>    <span style="color: #51afef;">@Environment</span>(\.<span style="color: #dcaeea;">presentationMode</span>) <span style="color: #51afef;">var</span> presentation
<span class="linenr">15: </span>
<span class="linenr">16: </span>    <span style="color: #51afef;">var</span> body: <span style="color: #51afef;">some</span> View {
<span class="linenr">17: </span>        Form {
<span class="linenr">18: </span>            <span style="color: #c678dd;">Text</span>(<span style="color: #98be65;">"New Task"</span>)
<span class="linenr">19: </span>                .<span style="color: #c678dd;">font</span>(.<span style="color: #dcaeea;">largeTitle</span>)
<span class="linenr">20: </span>            <span style="color: #c678dd;">TextField</span>(<span style="color: #98be65;">"Enter task name"</span>, text: <span style="color: #51afef;">self</span>.$taskTitle)
<span class="linenr">21: </span>            <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20197;Picker&#20358;&#23384;&#21462;priority&#27396;&#20301;&#30340;&#36039;&#26009;</span>
<span class="linenr">22: </span>            <span style="color: #c678dd;">Picker</span>(<span style="color: #98be65;">"Task Priority"</span>, selection: <span style="color: #51afef;">self</span>.$priority) {
<span class="linenr">23: </span>                <span style="color: #c678dd;">ForEach</span>(TaskPriority.<span style="color: #c678dd;">allCases</span>, id: \.<span style="color: #51afef;">self</span>) {
<span class="linenr">24: </span>                    <span style="color: #c678dd;">Text</span>($0.<span style="color: #c678dd;">rawValue</span>)
<span class="linenr">25: </span>                }
<span class="linenr">26: </span>            }
<span class="linenr">27: </span>            <span style="color: #c678dd;">Button</span>(action: {
<span class="linenr">28: </span>                taskListVM.<span style="color: #c678dd;">addTask</span>(task: <span style="color: #c678dd;">Task</span>(title: <span style="color: #51afef;">self</span>.<span style="color: #dcaeea;">taskTitle</span>, priority: priority,completed: <span style="color: #a9a1e1;">false</span>))
<span class="linenr">29: </span>                <span style="color: #51afef;">self</span>.<span style="color: #dcaeea;">presentation</span>.<span style="color: #dcaeea;">wrappedValue</span>.<span style="color: #c678dd;">dismiss</span>()
<span class="linenr">30: </span>            }, label: {
<span class="linenr">31: </span>                <span style="color: #c678dd;">Text</span>(<span style="color: #98be65;">"Done"</span>)
<span class="linenr">32: </span>            })
<span class="linenr">33: </span>            <span style="color: #c678dd;">Spacer</span>()
<span class="linenr">34: </span>        }.<span style="color: #c678dd;">padding</span>()
<span class="linenr">35: </span>    }
<span class="linenr">36: </span>}
<span class="linenr">37: </span>
<span class="linenr">38: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">NewTaskView_Previews</span>: PreviewProvider {
<span class="linenr">39: </span>    <span style="color: #51afef;">static</span> <span style="color: #51afef;">var</span> previews: <span style="color: #51afef;">some</span> View {
<span class="linenr">40: </span>        <span style="color: #c678dd;">NewTaskView</span>( priority: TaskPriority.<span style="color: #c678dd;">low</span>)
<span class="linenr">41: </span>    }
<span class="linenr">42: </span>}
<span class="linenr">43: </span>
</pre>
</div>
</div>
</li>
</ol>
</li>
<li><a id="orgfdf39e5"></a>ViewModel<br />
<div class="outline-text-4" id="text-2-6-3">
<p>
依priority高低傳回不同的Icon<br />
</p>
</div>
<ol class="org-ol">
<li><a id="org8c2bd8f"></a>TaskCellViewModel.swift<br />
<div class="outline-text-5" id="text-2-6-3-1">
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 2: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">TaskCellViewModel.swift</span>
<span class="linenr"> 3: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">taskManagement</span>
<span class="linenr"> 4: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 5: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">Created by yen yung chin on 2021/2/20.</span>
<span class="linenr"> 6: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #51afef;">import</span> Foundation
<span class="linenr"> 9: </span><span style="color: #51afef;">import</span> Combine
<span class="linenr">10: </span>
<span class="linenr">11: </span><span style="color: #51afef;">class</span> <span style="color: #c678dd;">TaskCellViewModel</span>: <span style="color: #c678dd;">ObservableObject</span>, Identifiable  {
<span class="linenr">12: </span>    <span style="color: #51afef;">@Published</span> <span style="color: #51afef;">var</span> task: Task
<span class="linenr">13: </span>
<span class="linenr">14: </span>    <span style="color: #51afef;">@Published</span> <span style="color: #51afef;">var</span> completionStateIconName = <span style="color: #98be65;">""</span>
<span class="linenr">15: </span>    <span style="color: #51afef;">@Published</span> <span style="color: #51afef;">var</span> priorityStateIconName = <span style="color: #98be65;">""</span>
<span class="linenr">16: </span>    <span style="color: #51afef;">private</span> <span style="color: #51afef;">var</span> cancellables = <span style="color: #c678dd;">Set</span>&lt;AnyCancellable&gt;()
<span class="linenr">17: </span>    <span style="color: #51afef;">init</span>(task: Task) {
<span class="linenr">18: </span>        <span style="color: #51afef;">self</span>.<span style="color: #c678dd;">task</span> = task
<span class="linenr">19: </span>        $task
<span class="linenr">20: </span>            .<span style="color: #c678dd;">map</span> { task <span style="color: #51afef;">in</span>
<span class="linenr">21: </span>                <span style="color: #51afef;">return</span> task.<span style="color: #c678dd;">completed</span> ? <span style="color: #98be65;">"checkmark.circle.fill"</span> : <span style="color: #98be65;">"circle"</span>
<span class="linenr">22: </span>            }
<span class="linenr">23: </span>            .<span style="color: #c678dd;">assign</span>(to: \.<span style="color: #dcaeea;">completionStateIconName</span>, on: <span style="color: #51afef;">self</span>)
<span class="linenr">24: </span>            .<span style="color: #c678dd;">store</span>(<span style="color: #51afef;">in</span>: &amp;cancellables)
<span class="linenr">25: </span>        $task
<span class="linenr">26: </span>            .<span style="color: #c678dd;">map</span> { task <span style="color: #51afef;">in</span>
<span class="linenr">27: </span>                <span style="color: #51afef;">return</span> <span style="color: #51afef;">self</span>.<span style="color: #c678dd;">priorityIconName</span>(task: <span style="color: #51afef;">self</span>.<span style="color: #c678dd;">task</span>)
<span class="linenr">28: </span>            }
<span class="linenr">29: </span>            .<span style="color: #c678dd;">assign</span>(to: \.<span style="color: #dcaeea;">priorityStateIconName</span>, on: <span style="color: #51afef;">self</span>)
<span class="linenr">30: </span>            .<span style="color: #c678dd;">store</span>(<span style="color: #51afef;">in</span>: &amp;cancellables)
<span class="linenr">31: </span>    }
<span class="linenr">32: </span>
<span class="linenr">33: </span>    <span style="color: #51afef;">func</span> <span style="color: #c678dd;">priorityIconName</span>(task: Task) -&gt; <span style="color: #c678dd;">String</span> {
<span class="linenr">34: </span>        <span style="color: #51afef;">switch</span> task.<span style="color: #c678dd;">priority</span> {
<span class="linenr">35: </span>        <span style="color: #51afef;">case</span> .<span style="color: #c678dd;">low</span>:
<span class="linenr">36: </span>            <span style="color: #51afef;">return</span> <span style="color: #98be65;">"l.circle.fill"</span>
<span class="linenr">37: </span>        <span style="color: #51afef;">case</span> .<span style="color: #c678dd;">medium</span>:
<span class="linenr">38: </span>            <span style="color: #51afef;">return</span> <span style="color: #98be65;">"m.circle.fill"</span>
<span class="linenr">39: </span>        <span style="color: #51afef;">case</span> .<span style="color: #c678dd;">high</span>:
<span class="linenr">40: </span>            <span style="color: #51afef;">return</span> <span style="color: #98be65;">"h.circle.fill"</span>
<span class="linenr">41: </span>        }
<span class="linenr">42: </span>    }
<span class="linenr">43: </span>}
<span class="linenr">44: </span>
</pre>
</div>
</div>
</li>
</ol>
</li>

<li><a id="orgae1f696"></a>結果<br />
<div class="outline-text-4" id="text-2-6-4">

<div id="orgd49f524" class="figure">
<p><img src="images/picker.gif" alt="picker.gif" width="500" /><br />
</p>
<p><span class="figure-number">Figure 5: </span>Picker v.s. enum</p>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-SW-onTapGesture" class="outline-3">
<h3 id="SW-onTapGesture"><span class="section-number-3">2.7</span> Tap on Icon to change completion and priority status</h3>
<div class="outline-text-3" id="text-SW-onTapGesture">
</div>
<ol class="org-ol">
<li><a id="org3990d71"></a>View<br />
<ol class="org-ol">
<li><a id="org09c9959"></a>TaskListView.swift<br />
<div class="outline-text-5" id="text-2-7-1-1">
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 2: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">ContentView.swift</span>
<span class="linenr"> 3: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">taskManagement</span>
<span class="linenr"> 4: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 5: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">Created by yen yung chin on 2021/2/16.</span>
<span class="linenr"> 6: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #51afef;">import</span> SwiftUI
<span class="linenr"> 9: </span>
<span class="linenr">10: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">TaskListView</span>: View {
<span class="linenr">11: </span>    <span style="color: #51afef;">@ObservedObject</span> <span style="color: #51afef;">var</span> taskListVM = <span style="color: #c678dd;">TaskListViewModel</span>()
<span class="linenr">12: </span>    <span style="color: #51afef;">@State</span> <span style="color: #51afef;">var</span> showNewItem = <span style="color: #a9a1e1;">false</span>
<span class="linenr">13: </span>    <span style="color: #51afef;">var</span> body: <span style="color: #51afef;">some</span> View {
<span class="linenr">14: </span>        NavigationView {
<span class="linenr">15: </span>            <span style="color: #c678dd;">VStack</span>(alignment: .<span style="color: #dcaeea;">leading</span>, spacing: <span style="color: #da8548; font-weight: bold;">10</span>, content: {
<span class="linenr">16: </span>                List {
<span class="linenr">17: </span>                    <span style="color: #c678dd;">ForEach</span>(taskListVM.<span style="color: #dcaeea;">taskCellViewModels</span>) { task <span style="color: #51afef;">in</span>
<span class="linenr">18: </span>                        <span style="color: #c678dd;">TaskCell</span>(taskCellVM: task)
<span class="linenr">19: </span>
<span class="linenr">20: </span>                    }
<span class="linenr">21: </span>                    .<span style="color: #c678dd;">onDelete</span>(perform: { indexSet <span style="color: #51afef;">in</span>
<span class="linenr">22: </span>                        taskListVM.<span style="color: #c678dd;">deleteTask</span>(indexSet: indexSet)
<span class="linenr">23: </span>                    })
<span class="linenr">24: </span>                    <span style="color: #51afef;">if</span> <span style="color: #51afef;">self</span>.<span style="color: #dcaeea;">showNewItem</span> {
<span class="linenr">25: </span>                        <span style="color: #c678dd;">TaskCell</span>(taskCellVM: <span style="color: #c678dd;">TaskCellViewModel</span>(task: <span style="color: #c678dd;">Task</span>(title: <span style="color: #98be65;">""</span>, priority: TaskPriority.<span style="color: #c678dd;">low</span>, completed: <span style="color: #a9a1e1;">false</span>)))
<span class="linenr">26: </span>                    }
<span class="linenr">27: </span>                }
<span class="linenr">28: </span>                .<span style="color: #c678dd;">navigationBarTitle</span>(<span style="color: #98be65;">"Tasks"</span>, displayMode: .<span style="color: #c678dd;">inline</span>)
<span class="linenr">29: </span>
<span class="linenr">30: </span>                .<span style="color: #c678dd;">navigationBarItems</span>(trailing: <span style="color: #c678dd;">NavigationLink</span>(
<span class="linenr">31: </span>                                        destination: <span style="color: #c678dd;">NewTaskView</span>(taskListVM: taskListVM, taskTitle: <span style="color: #98be65;">""</span>, priority: TaskPriority.<span style="color: #c678dd;">low</span>),
<span class="linenr">32: </span>                                        label: {
<span class="linenr">33: </span>                                            <span style="color: #c678dd;">Text</span>(<span style="color: #98be65;">"New Task"</span>)
<span class="linenr">34: </span>                                        }))
<span class="linenr">35: </span>                HStack {
<span class="linenr">36: </span>                    <span style="color: #c678dd;">Image</span>(systemName: <span style="color: #98be65;">"plus.circle.fill"</span>)
<span class="linenr">37: </span>                    <span style="color: #c678dd;">Button</span>(action: {
<span class="linenr">38: </span>                        <span style="color: #51afef;">self</span>.<span style="color: #dcaeea;">showNewItem</span>.<span style="color: #c678dd;">toggle</span>()
<span class="linenr">39: </span>                    }, label: {
<span class="linenr">40: </span>                        <span style="color: #c678dd;">Text</span>(<span style="color: #98be65;">"New Task"</span>)
<span class="linenr">41: </span>                    })
<span class="linenr">42: </span>                }.<span style="color: #c678dd;">padding</span>()
<span class="linenr">43: </span>            })
<span class="linenr">44: </span>        }
<span class="linenr">45: </span>    }
<span class="linenr">46: </span>}
<span class="linenr">47: </span>
<span class="linenr">48: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">ContentView_Previews</span>: PreviewProvider {
<span class="linenr">49: </span>    <span style="color: #51afef;">static</span> <span style="color: #51afef;">var</span> previews: <span style="color: #51afef;">some</span> View {
<span class="linenr">50: </span>        <span style="color: #c678dd;">TaskListView</span>()
<span class="linenr">51: </span>    }
<span class="linenr">52: </span>}
<span class="linenr">53: </span>
<span class="linenr">54: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">TaskCell</span>: View {
<span class="linenr">55: </span>    <span style="color: #51afef;">@ObservedObject</span> <span style="color: #51afef;">var</span> taskCellVM: TaskCellViewModel
<span class="linenr">56: </span>
<span class="linenr">57: </span>    <span style="color: #51afef;">var</span> body: <span style="color: #51afef;">some</span> View {
<span class="linenr">58: </span>        HStack {
<span class="linenr">59: </span>            <span style="color: #c678dd;">Image</span>(systemName: taskCellVM.<span style="color: #dcaeea;">completionStateIconName</span>)
<span class="linenr">60: </span>                .<span style="color: #c678dd;">resizable</span>()
<span class="linenr">61: </span>                .<span style="color: #c678dd;">frame</span>(width: <span style="color: #da8548; font-weight: bold;">20</span>, height: <span style="color: #da8548; font-weight: bold;">20</span>)
<span class="linenr">62: </span>                .<span style="color: #dcaeea;">onTapGesture</span> {
<span class="linenr">63: </span>                    <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#35722;&#26356;&#23436;&#25104;&#29376;&#24907;</span>
<span class="linenr">64: </span>                    taskCellVM.<span style="color: #c678dd;">task</span>.<span style="color: #c678dd;">completed</span>.<span style="color: #c678dd;">toggle</span>()
<span class="linenr">65: </span>                }
<span class="linenr">66: </span>            <span style="color: #c678dd;">Image</span>(systemName: taskCellVM.<span style="color: #dcaeea;">priorityStateIconName</span>)
<span class="linenr">67: </span>                .<span style="color: #c678dd;">resizable</span>()
<span class="linenr">68: </span>                .<span style="color: #c678dd;">frame</span>(width: <span style="color: #da8548; font-weight: bold;">20</span>, height: <span style="color: #da8548; font-weight: bold;">20</span>)
<span class="linenr">69: </span>                .<span style="color: #c678dd;">foregroundColor</span>(Color.<span style="color: #dcaeea;">blue</span>)
<span class="linenr">70: </span>                .<span style="color: #dcaeea;">onTapGesture</span> {
<span class="linenr">71: </span>                    <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#35722;&#26356;&#20778;&#20808;&#27402;&#29376;&#24907;</span>
<span class="linenr">72: </span>                    <span style="color: #51afef;">self</span>.<span style="color: #dcaeea;">taskCellVM</span>.<span style="color: #c678dd;">changePriority</span>(task: taskCellVM.<span style="color: #c678dd;">task</span>)
<span class="linenr">73: </span>                }
<span class="linenr">74: </span>            <span style="color: #c678dd;">Text</span>(taskCellVM.<span style="color: #c678dd;">task</span>.<span style="color: #c678dd;">title</span>)
<span class="linenr">75: </span>        }
<span class="linenr">76: </span>    }
<span class="linenr">77: </span>}
</pre>
</div>
</div>
</li>
</ol>
</li>
<li><a id="orgf1e06ea"></a>ViewModel<br />
<ol class="org-ol">
<li><a id="orgb5bb014"></a>TaskCellViewModel.swift<br />
<div class="outline-text-5" id="text-2-7-2-1">
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 2: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">TaskCellViewModel.swift</span>
<span class="linenr"> 3: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">taskManagement</span>
<span class="linenr"> 4: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 5: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">Created by yen yung chin on 2021/2/20.</span>
<span class="linenr"> 6: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #51afef;">import</span> Foundation
<span class="linenr"> 9: </span><span style="color: #51afef;">import</span> Combine
<span class="linenr">10: </span>
<span class="linenr">11: </span><span style="color: #51afef;">class</span> <span style="color: #c678dd;">TaskCellViewModel</span>: <span style="color: #c678dd;">ObservableObject</span>, Identifiable  {
<span class="linenr">12: </span>    <span style="color: #51afef;">@Published</span> <span style="color: #51afef;">var</span> task: Task
<span class="linenr">13: </span>
<span class="linenr">14: </span>    <span style="color: #51afef;">@Published</span> <span style="color: #51afef;">var</span> completionStateIconName = <span style="color: #98be65;">""</span>
<span class="linenr">15: </span>    <span style="color: #51afef;">@Published</span> <span style="color: #51afef;">var</span> priorityStateIconName = <span style="color: #98be65;">""</span>
<span class="linenr">16: </span>    <span style="color: #51afef;">@Published</span> <span style="color: #51afef;">var</span> nextTaskPriority: TaskPriority = .<span style="color: #c678dd;">low</span>
<span class="linenr">17: </span>    <span style="color: #51afef;">private</span> <span style="color: #51afef;">var</span> cancellables = <span style="color: #c678dd;">Set</span>&lt;AnyCancellable&gt;()
<span class="linenr">18: </span>    <span style="color: #51afef;">init</span>(task: Task) {
<span class="linenr">19: </span>        <span style="color: #51afef;">self</span>.<span style="color: #c678dd;">task</span> = task
<span class="linenr">20: </span>        $task
<span class="linenr">21: </span>            .<span style="color: #c678dd;">map</span> { task <span style="color: #51afef;">in</span>
<span class="linenr">22: </span>                <span style="color: #51afef;">return</span> task.<span style="color: #c678dd;">completed</span> ? <span style="color: #98be65;">"checkmark.circle.fill"</span> : <span style="color: #98be65;">"circle"</span>
<span class="linenr">23: </span>            }
<span class="linenr">24: </span>            .<span style="color: #c678dd;">assign</span>(to: \.<span style="color: #dcaeea;">completionStateIconName</span>, on: <span style="color: #51afef;">self</span>)
<span class="linenr">25: </span>            .<span style="color: #c678dd;">store</span>(<span style="color: #51afef;">in</span>: &amp;cancellables)
<span class="linenr">26: </span>        $task
<span class="linenr">27: </span>            .<span style="color: #c678dd;">map</span> { task <span style="color: #51afef;">in</span>
<span class="linenr">28: </span>                <span style="color: #51afef;">return</span> <span style="color: #51afef;">self</span>.<span style="color: #c678dd;">priorityIconName</span>(task: <span style="color: #51afef;">self</span>.<span style="color: #c678dd;">task</span>)
<span class="linenr">29: </span>            }
<span class="linenr">30: </span>            .<span style="color: #c678dd;">assign</span>(to: \.<span style="color: #dcaeea;">priorityStateIconName</span>, on: <span style="color: #51afef;">self</span>)
<span class="linenr">31: </span>            .<span style="color: #c678dd;">store</span>(<span style="color: #51afef;">in</span>: &amp;cancellables)
<span class="linenr">32: </span>    }
<span class="linenr">33: </span>
<span class="linenr">34: </span>    <span style="color: #51afef;">func</span> <span style="color: #c678dd;">priorityIconName</span>(task: Task) -&gt; <span style="color: #c678dd;">String</span> {
<span class="linenr">35: </span>        <span style="color: #51afef;">switch</span> task.<span style="color: #c678dd;">priority</span> {
<span class="linenr">36: </span>        <span style="color: #51afef;">case</span> .<span style="color: #c678dd;">low</span>:
<span class="linenr">37: </span>            <span style="color: #51afef;">return</span> <span style="color: #98be65;">"l.circle.fill"</span>
<span class="linenr">38: </span>        <span style="color: #51afef;">case</span> .<span style="color: #c678dd;">medium</span>:
<span class="linenr">39: </span>            <span style="color: #51afef;">return</span> <span style="color: #98be65;">"m.circle.fill"</span>
<span class="linenr">40: </span>        <span style="color: #51afef;">case</span> .<span style="color: #c678dd;">high</span>:
<span class="linenr">41: </span>            <span style="color: #51afef;">return</span> <span style="color: #98be65;">"h.circle.fill"</span>
<span class="linenr">42: </span>        }
<span class="linenr">43: </span>    }
<span class="linenr">44: </span>
<span class="linenr">45: </span>    <span style="color: #51afef;">func</span> <span style="color: #c678dd;">changePriority</span>(task: Task) {
<span class="linenr">46: </span>        <span style="color: #51afef;">switch</span> task.<span style="color: #c678dd;">priority</span> {
<span class="linenr">47: </span>        <span style="color: #51afef;">case</span> .<span style="color: #c678dd;">low</span>:
<span class="linenr">48: </span>            <span style="color: #51afef;">self</span>.<span style="color: #c678dd;">task</span>.<span style="color: #c678dd;">priority</span> = .<span style="color: #c678dd;">medium</span>
<span class="linenr">49: </span>        <span style="color: #51afef;">case</span> .<span style="color: #c678dd;">medium</span>:
<span class="linenr">50: </span>            <span style="color: #51afef;">self</span>.<span style="color: #c678dd;">task</span>.<span style="color: #c678dd;">priority</span> = .<span style="color: #c678dd;">high</span>
<span class="linenr">51: </span>        <span style="color: #51afef;">case</span> .<span style="color: #c678dd;">high</span>:
<span class="linenr">52: </span>            <span style="color: #51afef;">self</span>.<span style="color: #c678dd;">task</span>.<span style="color: #c678dd;">priority</span> = .<span style="color: #c678dd;">low</span>
<span class="linenr">53: </span>        }
<span class="linenr">54: </span>    }
<span class="linenr">55: </span>}
</pre>
</div>
</div>
</li>
<li><a id="org2bfc112"></a>結果<br />
<div class="outline-text-5" id="text-2-7-2-2">

<div id="orgb3f7915" class="figure">
<p><img src="images/tapgesture.gif" alt="tapgesture.gif" width="500" /><br />
</p>
<p><span class="figure-number">Figure 6: </span>onTapGesture</p>
</div>
</div>
</li>
</ol>
</li>
</ol>
</div>
</div>

<div id="outline-container-SW-AdvFuncs" class="outline-2">
<h2 id="SW-AdvFuncs"><span class="section-number-2">3</span> Advance function</h2>
<div class="outline-text-2" id="text-SW-AdvFuncs">
</div>
<div id="outline-container-org018c5d0" class="outline-3">
<h3 id="org018c5d0"><span class="section-number-3">3.1</span> filter()</h3>
<div class="outline-text-3" id="text-3-1">
<p>
filter() 宣告如下：<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span><span style="color: #51afef;">func</span> <span style="color: #c678dd;">filter</span>(includeElement: (T) -&gt; <span style="color: #c678dd;">Bool</span>) -&gt; <span style="color: #c678dd;">Array</span>&lt;T&gt;
</pre>
</div>
<ul class="org-ul">
<li>includeElement 表示傳入的 function 或 closure，用來判斷陣列個元素是否符合條件。<br /></li>
<li>filter() 回傳結果為陣列。<br /></li>
</ul>
</div>
<ol class="org-ol">
<li><a id="orgd7729c4"></a>在 closure 回傳每個元素使否符合判斷式的結果，決定最後 filter() 回傳的元素集合。<sup><a id="fnr.1.100" class="footref" href="#fn.1">1</a></sup><br />
<div class="outline-text-4" id="text-3-1-1">
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #51afef;">var</span> numbers = <span style="color: #c678dd;">Array</span>(<span style="color: #da8548; font-weight: bold;">1</span>...<span style="color: #da8548; font-weight: bold;">8</span>)
<span class="linenr"> 2: </span>
<span class="linenr"> 3: </span><span style="color: #51afef;">var</span> evenNumbers = numbers.<span style="color: #c678dd;">filter</span> { (x) -&gt; <span style="color: #c678dd;">Bool</span> <span style="color: #51afef;">in</span>
<span class="linenr"> 4: </span>    x % <span style="color: #da8548; font-weight: bold;">2</span> == <span style="color: #da8548; font-weight: bold;">0</span>
<span class="linenr"> 5: </span>}
<span class="linenr"> 6: </span>
<span class="linenr"> 7: </span><span style="color: #51afef;">var</span> oddNumbers = numbers.<span style="color: #c678dd;">filter</span> { (x) -&gt; <span style="color: #c678dd;">Bool</span> <span style="color: #51afef;">in</span>
<span class="linenr"> 8: </span>    x % <span style="color: #da8548; font-weight: bold;">2</span> != <span style="color: #da8548; font-weight: bold;">0</span>
<span class="linenr"> 9: </span>}
<span class="linenr">10: </span>
<span class="linenr">11: </span>numbers         <span style="color: #5B6268;">//</span><span style="color: #5B6268;">return: [1, 2, 3, 4, 5, 6, 7, 8]</span>
<span class="linenr">12: </span>evenNumbers     <span style="color: #5B6268;">//</span><span style="color: #5B6268;">return: [2, 4, 6, 8]</span>
<span class="linenr">13: </span>oddNumbers      <span style="color: #5B6268;">//</span><span style="color: #5B6268;">return: [1, 3, 5, 7]</span>
<span class="linenr">14: </span>
</pre>
</div>
</div>
</li>
<li><a id="orgb7dc0ee"></a>將一、三象限的點過濾出來<sup><a id="fnr.1.100" class="footref" href="#fn.1">1</a></sup><br />
<div class="outline-text-4" id="text-3-1-2">
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">Point</span> {
<span class="linenr"> 2: </span>    <span style="color: #51afef;">var</span> x: <span style="color: #c678dd;">Int</span>
<span class="linenr"> 3: </span>    <span style="color: #51afef;">var</span> y: <span style="color: #c678dd;">Int</span>
<span class="linenr"> 4: </span>}
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span><span style="color: #51afef;">var</span> p1 = <span style="color: #c678dd;">Point</span>(x: <span style="color: #da8548; font-weight: bold;">1</span>, y: <span style="color: #da8548; font-weight: bold;">1</span>)
<span class="linenr"> 7: </span><span style="color: #51afef;">var</span> p2 = <span style="color: #c678dd;">Point</span>(x: -<span style="color: #da8548; font-weight: bold;">1</span>, y: <span style="color: #da8548; font-weight: bold;">1</span>)
<span class="linenr"> 8: </span><span style="color: #51afef;">var</span> p3 = <span style="color: #c678dd;">Point</span>(x: -<span style="color: #da8548; font-weight: bold;">1</span>, y: -<span style="color: #da8548; font-weight: bold;">1</span>)
<span class="linenr"> 9: </span><span style="color: #51afef;">var</span> p4 = <span style="color: #c678dd;">Point</span>(x: <span style="color: #da8548; font-weight: bold;">1</span>, y: -<span style="color: #da8548; font-weight: bold;">1</span>)
<span class="linenr">10: </span><span style="color: #51afef;">var</span> points = [p1, p2, p3, p4]
<span class="linenr">11: </span>
<span class="linenr">12: </span><span style="color: #51afef;">var</span> quadrant_1 = points.<span style="color: #c678dd;">filter</span> { (p) -&gt; <span style="color: #c678dd;">Bool</span> <span style="color: #51afef;">in</span>
<span class="linenr">13: </span>    <span style="color: #51afef;">return</span> p.<span style="color: #c678dd;">x</span> &gt; <span style="color: #da8548; font-weight: bold;">0</span> &amp;&amp; p.<span style="color: #c678dd;">y</span> &gt; <span style="color: #da8548; font-weight: bold;">0</span>
<span class="linenr">14: </span>}
<span class="linenr">15: </span>
<span class="linenr">16: </span><span style="color: #51afef;">var</span> quadrant_3 = points.<span style="color: #c678dd;">filter</span> { (p) -&gt; <span style="color: #c678dd;">Bool</span> <span style="color: #51afef;">in</span>
<span class="linenr">17: </span>    <span style="color: #51afef;">return</span> p.<span style="color: #c678dd;">x</span> &lt; <span style="color: #da8548; font-weight: bold;">0</span> &amp;&amp; p.<span style="color: #c678dd;">y</span> &lt; <span style="color: #da8548; font-weight: bold;">0</span>
<span class="linenr">18: </span>}
<span class="linenr">19: </span>
<span class="linenr">20: </span>points          <span style="color: #5B6268;">//</span><span style="color: #5B6268;">return: [{x 1, y 1}, {x -1, y 1}, {x -1, y -1}, {x 1, y -1}]</span>
<span class="linenr">21: </span>quadrant_1      <span style="color: #5B6268;">//</span><span style="color: #5B6268;">return: [{x 1, y 1}]</span>
<span class="linenr">22: </span>quadrant_3      <span style="color: #5B6268;">//</span><span style="color: #5B6268;">return: [{x -1, y -1}]</span>
<span class="linenr">23: </span>
</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-org874fc10" class="outline-3">
<h3 id="org874fc10"><span class="section-number-3">3.2</span> map()</h3>
<div class="outline-text-3" id="text-3-2">
<p>
map() 宣告如下：<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span><span style="color: #51afef;">func</span> <span style="color: #c678dd;">map</span>&lt;U&gt;(transform: (T) -&gt; U) -&gt; <span style="color: #c678dd;">Array</span>&lt;U&gt;
</pre>
</div>
<ul class="org-ul">
<li>transform 表示傳入的 function 或 closure，用來轉換每個陣列的元素。輸入參數與回傳結果型別可以不同。<br /></li>
<li>map() 回傳結果為陣列。<br /></li>
</ul>
</div>
<ol class="org-ol">
<li><a id="org8a26d24"></a>透過map()將整數陣列轉化成兩倍數值與字串的陣列。<sup><a id="fnr.1.100" class="footref" href="#fn.1">1</a></sup><br />
<div class="outline-text-4" id="text-3-2-1">
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #51afef;">var</span> numbers = <span style="color: #c678dd;">Array</span>(<span style="color: #da8548; font-weight: bold;">1</span>...<span style="color: #da8548; font-weight: bold;">8</span>)
<span class="linenr"> 2: </span>
<span class="linenr"> 3: </span><span style="color: #51afef;">var</span> doubles = numbers.<span style="color: #c678dd;">map</span> { (n) -&gt; <span style="color: #c678dd;">Int</span> <span style="color: #51afef;">in</span>
<span class="linenr"> 4: </span>    <span style="color: #51afef;">return</span> n*<span style="color: #da8548; font-weight: bold;">2</span>
<span class="linenr"> 5: </span>}
<span class="linenr"> 6: </span>
<span class="linenr"> 7: </span><span style="color: #51afef;">var</span> strings = numbers.<span style="color: #c678dd;">map</span> { (n) -&gt; <span style="color: #c678dd;">String</span> <span style="color: #51afef;">in</span>
<span class="linenr"> 8: </span>    <span style="color: #51afef;">let</span> digital = [<span style="color: #da8548; font-weight: bold;">0</span>:<span style="color: #98be65;">"&#38646;"</span>, <span style="color: #da8548; font-weight: bold;">1</span>:<span style="color: #98be65;">"&#22777;"</span>, <span style="color: #da8548; font-weight: bold;">2</span>:<span style="color: #98be65;">"&#36019;"</span>, <span style="color: #da8548; font-weight: bold;">3</span>:<span style="color: #98be65;">"&#21442;"</span>, <span style="color: #da8548; font-weight: bold;">4</span>:<span style="color: #98be65;">"&#32902;"</span>, <span style="color: #da8548; font-weight: bold;">5</span>:<span style="color: #98be65;">"&#20237;"</span>, <span style="color: #da8548; font-weight: bold;">6</span>:<span style="color: #98be65;">"&#38520;"</span>, <span style="color: #da8548; font-weight: bold;">7</span>:<span style="color: #98be65;">"&#26578;"</span>, <span style="color: #da8548; font-weight: bold;">8</span>:<span style="color: #98be65;">"&#25420;"</span>, <span style="color: #da8548; font-weight: bold;">9</span>:<span style="color: #98be65;">"&#29590;"</span>]
<span class="linenr"> 9: </span>    <span style="color: #51afef;">return</span> digital[n] ?? <span style="color: #98be65;">"&#21861;"</span>
<span class="linenr">10: </span>}
<span class="linenr">11: </span>
<span class="linenr">12: </span>numbers     <span style="color: #5B6268;">//</span><span style="color: #5B6268;">return: [1, 2, 3, 4, 5, 6, 7, 8]</span>
<span class="linenr">13: </span>doubles     <span style="color: #5B6268;">//</span><span style="color: #5B6268;">return: [2, 4, 6, 8, 10, 12, 14, 16]</span>
<span class="linenr">14: </span>strings     <span style="color: #5B6268;">//</span><span style="color: #5B6268;">return: ["&#22777;", "&#36019;", "&#21442;", "&#32902;", "&#20237;", "&#38520;", "&#26578;", "&#25420;"]</span>
<span class="linenr">15: </span>
</pre>
</div>
</div>
<ol class="org-ol">
<li><a id="orgc90fb39"></a>map()如何將一組二度空間的點對 X 軸與 Y 軸做鏡射。<sup><a id="fnr.1.100" class="footref" href="#fn.1">1</a></sup><br />
<div class="outline-text-5" id="text-3-2-1-1">
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">Point</span> {
<span class="linenr"> 2: </span>    <span style="color: #51afef;">var</span> x: <span style="color: #c678dd;">Int</span>
<span class="linenr"> 3: </span>    <span style="color: #51afef;">var</span> y: <span style="color: #c678dd;">Int</span>
<span class="linenr"> 4: </span>}
<span class="linenr"> 5: </span><span style="color: #51afef;">var</span> points = [<span style="color: #c678dd;">Point</span>(x: <span style="color: #da8548; font-weight: bold;">1</span>, y: <span style="color: #da8548; font-weight: bold;">2</span>), <span style="color: #c678dd;">Point</span>(x: -<span style="color: #da8548; font-weight: bold;">2</span>, y: -<span style="color: #da8548; font-weight: bold;">1</span>)]
<span class="linenr"> 6: </span>
<span class="linenr"> 7: </span><span style="color: #51afef;">var</span> mirror_x = points.<span style="color: #c678dd;">map</span> { (p) -&gt; Point <span style="color: #51afef;">in</span>
<span class="linenr"> 8: </span>    <span style="color: #51afef;">return</span> <span style="color: #c678dd;">Point</span>(x: -p.<span style="color: #c678dd;">x</span>, y: p.<span style="color: #c678dd;">y</span>)
<span class="linenr"> 9: </span>}
<span class="linenr">10: </span>
<span class="linenr">11: </span><span style="color: #51afef;">var</span> mirror_y = points.<span style="color: #c678dd;">map</span> { (p) -&gt; Point <span style="color: #51afef;">in</span>
<span class="linenr">12: </span>    <span style="color: #51afef;">return</span> <span style="color: #c678dd;">Point</span>(x: p.<span style="color: #c678dd;">x</span>, y: -p.<span style="color: #c678dd;">y</span>)
<span class="linenr">13: </span>}
<span class="linenr">14: </span>
<span class="linenr">15: </span>points      <span style="color: #5B6268;">//</span><span style="color: #5B6268;">return: [{x 1, y 2}, {x -2, y -1}]</span>
<span class="linenr">16: </span>mirror_x    <span style="color: #5B6268;">//</span><span style="color: #5B6268;">return: [{x -1, y 2}, {x 2, y -1}]</span>
<span class="linenr">17: </span>mirror_y    <span style="color: #5B6268;">//</span><span style="color: #5B6268;">return: [{x 1, y -2}, {x -2, y 1}]</span>
<span class="linenr">18: </span>
</pre>
</div>
</div>
</li>
</ol>
</li>
</ol>
</div>
<div id="outline-container-orge6072e6" class="outline-3">
<h3 id="orge6072e6"><span class="section-number-3">3.3</span> debounce</h3>
<div class="outline-text-3" id="text-3-3">
<p>
What is debounce? Its a function which forces the execution to wait a certain amount of time before running again.<sup><a id="fnr.2" class="footref" href="#fn.2">2</a></sup><br />
</p>
</div>
<ol class="org-ol">
<li><a id="orgf972141"></a>Example<br />
<div class="outline-text-4" id="text-3-3-1">
<p>
source: <a href="https://peterfriese.dev/swift-combine-love/">SwiftUI + Combine = ❤️</a><br />
</p>
</div>
<ol class="org-ol">
<li><a id="orgb40aeb3"></a>UI<br />
<div class="outline-text-5" id="text-3-3-1-1">
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">ContentView</span>: View {
<span class="linenr"> 2: </span>
<span class="linenr"> 3: </span>  <span style="color: #51afef;">@ObservedObject</span> <span style="color: #51afef;">private</span> <span style="color: #51afef;">var</span> userViewModel = <span style="color: #c678dd;">UserViewModel</span>()
<span class="linenr"> 4: </span>
<span class="linenr"> 5: </span>  <span style="color: #51afef;">var</span> body: <span style="color: #51afef;">some</span> View {
<span class="linenr"> 6: </span>    Form {
<span class="linenr"> 7: </span>      Section {
<span class="linenr"> 8: </span>        <span style="color: #c678dd;">TextField</span>(<span style="color: #98be65;">"Username"</span>, text: $userViewModel.<span style="color: #dcaeea;">username</span>)
<span class="linenr"> 9: </span>          .<span style="color: #c678dd;">autocapitalization</span>(.<span style="color: #51afef;">none</span>)
<span class="linenr">10: </span>        }
<span class="linenr">11: </span>        Section {
<span class="linenr">12: </span>          <span style="color: #c678dd;">SecureField</span>(<span style="color: #98be65;">"Password"</span>, text: $userViewModel.<span style="color: #c678dd;">password</span>)
<span class="linenr">13: </span>          <span style="color: #c678dd;">SecureField</span>(<span style="color: #98be65;">"Password again"</span>, text: $userViewModel.<span style="color: #dcaeea;">passwordAgain</span>)
<span class="linenr">14: </span>       }
<span class="linenr">15: </span>       Section {
<span class="linenr">16: </span>         <span style="color: #c678dd;">Button</span>(action: { }) {
<span class="linenr">17: </span>           <span style="color: #c678dd;">Text</span>(<span style="color: #98be65;">"Sign up"</span>)
<span class="linenr">18: </span>         }.<span style="color: #c678dd;">disabled</span>(!userViewModel.<span style="color: #c678dd;">valid</span>)
<span class="linenr">19: </span>       }
<span class="linenr">20: </span>     }
<span class="linenr">21: </span>  }
<span class="linenr">22: </span>}
<span class="linenr">23: </span>
<span class="linenr">24: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">ContentView_Previews</span>: PreviewProvider {
<span class="linenr">25: </span>  <span style="color: #51afef;">static</span> <span style="color: #51afef;">var</span> previews: <span style="color: #51afef;">some</span> View {
<span class="linenr">26: </span>    <span style="color: #c678dd;">ContentView</span>()
<span class="linenr">27: </span>  }
<span class="linenr">28: </span>}
</pre>
</div>
</div>
</li>
<li><a id="orga0c0e6f"></a>ViewModel<br />
<div class="outline-text-5" id="text-3-3-1-2">
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #51afef;">class</span> <span style="color: #c678dd;">UserViewModel</span>: <span style="color: #c678dd;">ObservableObject</span> {
<span class="linenr"> 2: </span>  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">Input</span>
<span class="linenr"> 3: </span>  <span style="color: #51afef;">@Published</span> <span style="color: #51afef;">var</span> username = <span style="color: #98be65;">""</span>
<span class="linenr"> 4: </span>  <span style="color: #51afef;">@Published</span> <span style="color: #51afef;">var</span> password = <span style="color: #98be65;">""</span>
<span class="linenr"> 5: </span>  <span style="color: #51afef;">@Published</span> <span style="color: #51afef;">var</span> passwordAgain = <span style="color: #98be65;">""</span>
<span class="linenr"> 6: </span>
<span class="linenr"> 7: </span>  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">Output</span>
<span class="linenr"> 8: </span>  <span style="color: #51afef;">@Published</span> <span style="color: #51afef;">var</span> isValid = <span style="color: #a9a1e1;">false</span>
<span class="linenr"> 9: </span>
<span class="linenr">10: </span>  $username
<span class="linenr">11: </span>  .<span style="color: #c678dd;">debounce</span>(<span style="color: #51afef;">for</span>: <span style="color: #da8548; font-weight: bold;">0.8</span>, scheduler: <span style="color: #c678dd;">RunLoop</span>.<span style="color: #c678dd;">main</span>)
<span class="linenr">12: </span>  .<span style="color: #c678dd;">removeDuplicates</span>()
<span class="linenr">13: </span>  .<span style="color: #c678dd;">map</span> { input <span style="color: #51afef;">in</span>
<span class="linenr">14: </span>    <span style="color: #51afef;">return</span> input.<span style="color: #c678dd;">count</span> &gt;= <span style="color: #da8548; font-weight: bold;">3</span>
<span class="linenr">15: </span>  }
<span class="linenr">16: </span>  .<span style="color: #c678dd;">assign</span>(to: \.<span style="color: #c678dd;">valid</span>, on: <span style="color: #51afef;">self</span>)
<span class="linenr">17: </span>  .<span style="color: #c678dd;">store</span>(<span style="color: #51afef;">in</span>: &amp;cancellableSet)
<span class="linenr">18: </span>}
</pre>
</div>
</div>
</li>
</ol>
</li>
</ol>
</div>
</div>

<div id="outline-container-org2aa3978" class="outline-2">
<h2 id="org2aa3978"><span class="section-number-2">4</span> Web API: URLSession v.s. JSONDecoder</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-org352ec18" class="outline-3">
<h3 id="org352ec18"><span class="section-number-3">4.1</span> Demo 1</h3>
<div class="outline-text-3" id="text-4-1">
</div>
<ol class="org-ol">
<li><a id="org0afb889"></a>ContentView.swift<br />
<div class="outline-text-4" id="text-4-1-1">
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #51afef;">import</span> SwiftUI
<span class="linenr"> 2: </span>
<span class="linenr"> 3: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">Todo</span>: <span style="color: #c678dd;">Codable</span>, Identifiable {
<span class="linenr"> 4: </span>    <span style="color: #51afef;">public</span> <span style="color: #51afef;">var</span> id: <span style="color: #c678dd;">Int</span>
<span class="linenr"> 5: </span>    <span style="color: #51afef;">public</span> <span style="color: #51afef;">var</span> title: <span style="color: #c678dd;">String</span>
<span class="linenr"> 6: </span>    <span style="color: #51afef;">public</span> <span style="color: #51afef;">var</span> completed: <span style="color: #c678dd;">Bool</span>
<span class="linenr"> 7: </span>}
<span class="linenr"> 8: </span>
<span class="linenr"> 9: </span><span style="color: #51afef;">class</span> <span style="color: #c678dd;">FetchToDo</span>: <span style="color: #c678dd;">ObservableObject</span> {
<span class="linenr">10: </span>  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">1.</span>
<span class="linenr">11: </span>  <span style="color: #51afef;">@Published</span> <span style="color: #51afef;">var</span> todos = [Todo]()
<span class="linenr">12: </span>
<span class="linenr">13: </span>    <span style="color: #51afef;">init</span>() {
<span class="linenr">14: </span>        <span style="color: #51afef;">let</span> url = <span style="color: #c678dd;">URL</span>(string: <span style="color: #98be65;">"https://jsonplaceholder.typicode.com/todos"</span>)!
<span class="linenr">15: </span>        <span style="color: #5B6268;">// </span><span style="color: #5B6268;">2.</span>
<span class="linenr">16: </span>        <span style="color: #c678dd;">URLSession</span>.<span style="color: #c678dd;">shared</span>.<span style="color: #c678dd;">dataTask</span>(with: url) {(data, response, error) <span style="color: #51afef;">in</span>
<span class="linenr">17: </span>            <span style="color: #51afef;">do</span> {
<span class="linenr">18: </span>                <span style="color: #51afef;">if</span> <span style="color: #51afef;">let</span> todoData = data {
<span class="linenr">19: </span>                    <span style="color: #5B6268;">// </span><span style="color: #5B6268;">3.</span>
<span class="linenr">20: </span>                    <span style="color: #51afef;">let</span> decodedData = <span style="color: #51afef;">try</span> <span style="color: #c678dd;">JSONDecoder</span>().<span style="color: #c678dd;">decode</span>([Todo].<span style="color: #51afef;">self</span>, from: todoData)
<span class="linenr">21: </span>                    DispatchQueue.<span style="color: #c678dd;">main</span>.<span style="color: #dcaeea;">async</span> {
<span class="linenr">22: </span>                        <span style="color: #51afef;">self</span>.<span style="color: #dcaeea;">todos</span> = decodedData
<span class="linenr">23: </span>                    }
<span class="linenr">24: </span>                } <span style="color: #51afef;">else</span> {
<span class="linenr">25: </span>                    <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"No data"</span>)
<span class="linenr">26: </span>                }
<span class="linenr">27: </span>            } <span style="color: #51afef;">catch</span> {
<span class="linenr">28: </span>                <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"Error"</span>)
<span class="linenr">29: </span>            }
<span class="linenr">30: </span>        }.<span style="color: #c678dd;">resume</span>()
<span class="linenr">31: </span>    }
<span class="linenr">32: </span>}
<span class="linenr">33: </span>
<span class="linenr">34: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">ContentView</span>: View {
<span class="linenr">35: </span>    <span style="color: #5B6268;">// </span><span style="color: #5B6268;">1.</span>
<span class="linenr">36: </span>    <span style="color: #51afef;">@ObservedObject</span> <span style="color: #51afef;">var</span> fetch = <span style="color: #c678dd;">FetchToDo</span>()
<span class="linenr">37: </span>    <span style="color: #51afef;">var</span> body: <span style="color: #51afef;">some</span> View {
<span class="linenr">38: </span>        VStack {
<span class="linenr">39: </span>            <span style="color: #5B6268;">// </span><span style="color: #5B6268;">2.</span>
<span class="linenr">40: </span>            <span style="color: #c678dd;">List</span>(fetch.<span style="color: #dcaeea;">todos</span>) { todo <span style="color: #51afef;">in</span>
<span class="linenr">41: </span>                <span style="color: #c678dd;">VStack</span>(alignment: .<span style="color: #dcaeea;">leading</span>) {
<span class="linenr">42: </span>                    <span style="color: #5B6268;">// </span><span style="color: #5B6268;">3.</span>
<span class="linenr">43: </span>                    <span style="color: #c678dd;">Text</span>(todo.<span style="color: #c678dd;">title</span>)
<span class="linenr">44: </span>                    <span style="color: #c678dd;">Text</span>(<span style="color: #98be65;">"\(</span>todo.<span style="color: #c678dd;">completed</span>.<span style="color: #c678dd;">description</span><span style="color: #98be65;">)"</span>) <span style="color: #5B6268;">// </span><span style="color: #5B6268;">print boolean</span>
<span class="linenr">45: </span>                        .<span style="color: #c678dd;">font</span>(.<span style="color: #c678dd;">system</span>(size: <span style="color: #da8548; font-weight: bold;">11</span>))
<span class="linenr">46: </span>                        .<span style="color: #c678dd;">foregroundColor</span>(Color.<span style="color: #dcaeea;">gray</span>)
<span class="linenr">47: </span>                }
<span class="linenr">48: </span>            }
<span class="linenr">49: </span>        }
<span class="linenr">50: </span>    }
<span class="linenr">51: </span>}
</pre>
</div>

<div id="org4a9203c" class="figure">
<p><img src="images/json-1.jpg" alt="json-1.jpg" width="300" /><br />
</p>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-org437427d" class="outline-3">
<h3 id="org437427d"><span class="section-number-3">4.2</span> Demo 2</h3>
<div class="outline-text-3" id="text-4-2">
</div>
<ol class="org-ol">
<li><a id="orgb61508f"></a>MVVM<br />
<div class="outline-text-4" id="text-4-2-1">
<ul class="org-ul">
<li>Model: FlowModel.swift<br /></li>
<li>View: ContentView.swift<br /></li>
<li>ViewModel: Flow.swift<br /></li>
</ul>
</div>
</li>
<li><a id="org60bd6e5"></a>FlowModel.swift<br />
<div class="outline-text-4" id="text-4-2-2">
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #51afef;">import</span> Foundation
<span class="linenr"> 2: </span>
<span class="linenr"> 3: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">FlowModel</span>: <span style="color: #c678dd;">Decodable</span>, <span style="color: #c678dd;">Hashable</span> {
<span class="linenr"> 4: </span>    <span style="color: #51afef;">var</span> &#24180;: <span style="color: #c678dd;">Int</span>? = <span style="color: #a9a1e1;">nil</span>
<span class="linenr"> 5: </span>    <span style="color: #51afef;">var</span> &#26376;: <span style="color: #c678dd;">Int</span>? = <span style="color: #a9a1e1;">nil</span>
<span class="linenr"> 6: </span>    <span style="color: #51afef;">var</span> &#32317;&#36939;&#37327;: <span style="color: #c678dd;">Int</span>? = <span style="color: #a9a1e1;">nil</span>
<span class="linenr"> 7: </span>    <span style="color: #51afef;">var</span> &#26085;&#22343;&#36939;&#37327;: <span style="color: #c678dd;">Int</span>? = <span style="color: #a9a1e1;">nil</span>
<span class="linenr"> 8: </span>    <span style="color: #51afef;">var</span> &#20551;&#26085;&#22343;&#36939;&#37327;: <span style="color: #c678dd;">Int</span>? = <span style="color: #a9a1e1;">nil</span>
<span class="linenr"> 9: </span>    <span style="color: #51afef;">var</span> &#26376;&#21488;&#19978;&#21047;&#21345;&#26085;&#22343;&#31558;&#25976;: <span style="color: #c678dd;">Double</span>? = <span style="color: #a9a1e1;">nil</span>
<span class="linenr">10: </span>    <span style="color: #51afef;">var</span> &#36554;&#19978;&#21047;&#21345;&#26085;&#22343;&#31558;&#25976;: <span style="color: #c678dd;">Double</span>? = <span style="color: #a9a1e1;">nil</span>
<span class="linenr">11: </span>    <span style="color: #51afef;">var</span> &#21806;&#31080;&#27231;&#26085;&#22343;&#31558;&#25976;: <span style="color: #c678dd;">Double</span>? = <span style="color: #a9a1e1;">nil</span>
<span class="linenr">12: </span>    <span style="color: #51afef;">var</span> &#35036;&#31080;&#26085;&#22343;&#31558;&#25976;: <span style="color: #c678dd;">Double</span>? = <span style="color: #a9a1e1;">nil</span>
<span class="linenr">13: </span>    <span style="color: #51afef;">var</span> &#22296;&#39636;&#31080;&#26085;&#22343;&#31558;&#25976;: <span style="color: #c678dd;">Double</span>? = <span style="color: #a9a1e1;">nil</span>
<span class="linenr">14: </span>}
</pre>
</div>
</div>
</li>
<li><a id="org15194ef"></a>ContentView.swift<br />
<div class="outline-text-4" id="text-4-2-3">
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #51afef;">import</span> SwiftUI
<span class="linenr"> 2: </span>
<span class="linenr"> 3: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">ContentView</span>: View {
<span class="linenr"> 4: </span>    <span style="color: #51afef;">@ObservedObject</span> <span style="color: #51afef;">var</span> flow = <span style="color: #c678dd;">FetchFlow</span>()
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span>    <span style="color: #51afef;">var</span> body: <span style="color: #51afef;">some</span> View {
<span class="linenr"> 7: </span>        NavigationView {
<span class="linenr"> 8: </span>            <span style="color: #c678dd;">List</span>() {
<span class="linenr"> 9: </span>                <span style="color: #c678dd;">ForEach</span>(flow.<span style="color: #dcaeea;">flows</span>, id: \.<span style="color: #51afef;">self</span>) {(item) <span style="color: #51afef;">in</span>
<span class="linenr">10: </span>                    <span style="color: #c678dd;">NavigationLink</span>(destination: <span style="color: #c678dd;">Text</span>(<span style="color: #98be65;">"&#32317;&#36939;&#37327;: \(</span>item.<span style="color: #dcaeea;">&#32317;&#36939;&#37327;</span>!<span style="color: #98be65;">)"</span>)) {
<span class="linenr">11: </span>                        HStack {
<span class="linenr">12: </span>                            <span style="color: #c678dd;">Text</span>(<span style="color: #98be65;">"\(</span>item.<span style="color: #dcaeea;">&#24180;</span>!<span style="color: #98be65;">)&#24180;\(</span>item.<span style="color: #dcaeea;">&#26376;</span>!<span style="color: #98be65;">)&#26376;"</span>)
<span class="linenr">13: </span>                            <span style="color: #c678dd;">Text</span>(<span style="color: #98be65;">"\(</span>item.<span style="color: #dcaeea;">&#26085;&#22343;&#36939;&#37327;</span>!<span style="color: #98be65;">)"</span>)
<span class="linenr">14: </span>                        }
<span class="linenr">15: </span>                    }
<span class="linenr">16: </span>                }
<span class="linenr">17: </span>            }.<span style="color: #c678dd;">navigationTitle</span>(<span style="color: #98be65;">""</span>)
<span class="linenr">18: </span>        }
<span class="linenr">19: </span>    }
<span class="linenr">20: </span>}
<span class="linenr">21: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">ContentView_Previews</span>: PreviewProvider {
<span class="linenr">22: </span>    <span style="color: #51afef;">static</span> <span style="color: #51afef;">var</span> previews: <span style="color: #51afef;">some</span> View {
<span class="linenr">23: </span>        <span style="color: #c678dd;">ContentView</span>()
<span class="linenr">24: </span>    }
<span class="linenr">25: </span>}
<span class="linenr">26: </span>
</pre>
</div>
</div>
</li>
<li><a id="org1500670"></a>Flow.swift<br />
<div class="outline-text-4" id="text-4-2-4">
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #51afef;">import</span> Foundation
<span class="linenr"> 2: </span><span style="color: #51afef;">class</span> <span style="color: #c678dd;">FetchFlow</span>: <span style="color: #c678dd;">ObservableObject</span> {
<span class="linenr"> 3: </span>    <span style="color: #51afef;">@Published</span> <span style="color: #51afef;">var</span> flows = [FlowModel]()
<span class="linenr"> 4: </span>    <span style="color: #51afef;">init</span>() {
<span class="linenr"> 5: </span>        <span style="color: #51afef;">let</span> urlstr = <span style="color: #98be65;">"https://data.kcg.gov.tw/dataset/6f29f6f4-2549-4473-aa90-bf60d10895dc/resource/30dfc2cf-17b5-4a40-8bb7-c511ea166bd3/download/lightrailtraffic.json"</span>
<span class="linenr"> 6: </span>        <span style="color: #51afef;">guard</span> <span style="color: #51afef;">let</span> url = <span style="color: #c678dd;">URL</span>(string: urlstr) <span style="color: #51afef;">else</span> {
<span class="linenr"> 7: </span>            <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"Invalid json url"</span>)
<span class="linenr"> 8: </span>            <span style="color: #51afef;">return</span>
<span class="linenr"> 9: </span>        }
<span class="linenr">10: </span>        <span style="color: #c678dd;">URLSession</span>.<span style="color: #c678dd;">shared</span>.<span style="color: #c678dd;">dataTask</span>(with: url) {(data, response, error) <span style="color: #51afef;">in</span>
<span class="linenr">11: </span>            <span style="color: #51afef;">do</span> {
<span class="linenr">12: </span>                <span style="color: #51afef;">if</span> <span style="color: #51afef;">let</span> flowData = data {
<span class="linenr">13: </span>                    <span style="color: #51afef;">let</span> decodeData = <span style="color: #51afef;">try</span> <span style="color: #c678dd;">JSONDecoder</span>().<span style="color: #c678dd;">decode</span>([FlowModel].<span style="color: #51afef;">self</span>, from: flowData)
<span class="linenr">14: </span>
<span class="linenr">15: </span>                    DispatchQueue.<span style="color: #c678dd;">main</span>.<span style="color: #dcaeea;">async</span> {
<span class="linenr">16: </span>                        <span style="color: #51afef;">self</span>.<span style="color: #dcaeea;">flows</span> = decodeData
<span class="linenr">17: </span>                    }
<span class="linenr">18: </span>                } <span style="color: #51afef;">else</span> {
<span class="linenr">19: </span>                    <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"No data"</span>)
<span class="linenr">20: </span>                }
<span class="linenr">21: </span>            } <span style="color: #51afef;">catch</span> {
<span class="linenr">22: </span>                <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"\(</span>error<span style="color: #98be65;">)"</span>)
<span class="linenr">23: </span>            }
<span class="linenr">24: </span>        }.<span style="color: #c678dd;">resume</span>()
<span class="linenr">25: </span>    }
<span class="linenr">26: </span>}
</pre>
</div>
</div>
</li>
<li><a id="org984da82"></a>Result<br />
<div class="outline-text-4" id="text-4-2-5">

<div id="orgd5fabe6" class="figure">
<p><img src="images/json-2.jpg" alt="json-2.jpg" width="600" /><br />
</p>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-orgcbb976b" class="outline-3">
<h3 id="orgcbb976b"><span class="section-number-3">4.3</span> 公開資料平台</h3>
<div class="outline-text-3" id="text-4-3">
<ul class="org-ul">
<li><a href="https://data.gov.tw/">政府資料開放平台</a><br /></li>
<li><a href="https://data.kcg.gov.tw/dataset">高雄市政府開放資料集</a><br /></li>
<li><a href="https://data.tainan.gov.tw/dataset">台南市政府開放資料集</a><br /></li>
<li><a href="https://ptx.transportdata.tw/PTX/Service">公共運輸整合資訊</a><br /></li>
<li><a href="https://kaleidosblog.s3-eu-west-1.amazonaws.com/json/tutorial.json">country/code JSON sample</a><br /></li>
</ul>
</div>
</div>
<div id="outline-container-org2fdbaea" class="outline-3">
<h3 id="org2fdbaea"><span class="section-number-3">4.4</span> Further Reading</h3>
<div class="outline-text-3" id="text-4-4">
<ul class="org-ul">
<li><a href="https://www.youtube.com/watch?v=HvfE4G9PfeU">SwiftUI Tutorial - Using an API and Decoding JSON Data</a><br /></li>
<li><a href="https://www.youtube.com/watch?v=tdxKIPpPDAI">iOS Swift Tutorial: Use Web APIs and JSON Data with Swift 5</a>- <a href="https://www.ioscreator.com/tutorials/swiftui-json-list-tutorial">SwiftUI Fetch JSON Data into List</a><br /></li>
<li><a href="https://programmingwithswift.com/parse-json-from-file-and-url-with-swift/">Parse JSON from file and URL with Swift</a><br /></li>
<li><a href="https://www.youtube.com/watch?v=1en4JyW3XSI">Making an API call and fetch JSON data in SwiftUI</a><br /></li>
<li><a href="https://benoitpasquier.com/encoding-decoding-json-swift4/">The best way to encode and decode JSON in Swift4 </a><br /></li>
<li><a href="https://www.reddit.com/r/swift/comments/emw0i3/jsondecoder_fails_if_i_dont_have_an_id_for_each/">JSONDecoder fails if I don&rsquo;t have an &ldquo;id&rdquo; for each item&#x2026; why doesn&rsquo;t UUID work?</a><br /></li>
<li><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E6%95%99%E5%AE%A4/%E8%A7%A3%E6%B1%BAjson-key%E4%B8%8D%E5%9B%BA%E5%AE%9A%E6%99%82%E5%87%BA%E7%8F%BE-no-value-associated-with-key-codingkeys-%E7%8B%80%E6%B3%81-720d7d09486a">解決Json Key不固定時出現“No value associated with key CodingKeys” 狀況</a><br /></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-SW-Protocols" class="outline-2">
<h2 id="SW-Protocols"><span class="section-number-2">5</span> Protocols</h2>
<div class="outline-text-2" id="text-SW-Protocols">
<ul class="org-ul">
<li>Protocols are a fundamental feature of Swift. They play a leading role in the structure of the Swift standard library and are a common method of abstraction. They provide a similar experience to interfaces that some other languages have. An advantage of protocols in Swift is that objects can conform to multiple protocols.<sup><a id="fnr.3" class="footref" href="#fn.3">3</a></sup><br /></li>
<li>Protocol 是一個只宣告不定義的型別，然而這個特性可以讓我們的程式更有彈性，像在 IOS SDK 裡面，耳熟能詳的 Delegate，就大量的運用 Potocol，方便我們客製化事件發生時要處理的事情。<sup><a id="fnr.4" class="footref" href="#fn.4">4</a></sup><br /></li>

<li>對任何程式開發來說，減少重覆的 code，把權責明確分開，讓 code 維護性變好，是非常重要的課題。而在現今的軟體開發模式中，有許多方法可以做到這點，最為人所知的一個模式，就是利用繼承 (Inheritance)，把會重覆利用的部份放在母類別，讓其它子類別去繼承。另外一種做法，則是利用 Composition Pattern，將功能做成組件分出來，讓需要的模組去組合取用。<sup><a id="fnr.5" class="footref" href="#fn.5">5</a></sup><br /></li>
</ul>
<p class="verse">
A protocol defines a blueprint of methods, properties, and other requirements that suit a particular task or piece of functionality. The protocol can then be adopted by a class, structure, or enumeration to provide an actual implementation of those requirements. Any type that satisfies the requirements of a protocol is said to conform to that protocol. <sup><a id="fnr.6" class="footref" href="#fn.6">6</a></sup><br />
</p>

<ul class="org-ul">
<li>協定提供類型可以做的資訊，Classes 和 structs 則提供物件的資訊，協定則提供物件將會執行的動作。<sup><a id="fnr.7" class="footref" href="#fn.7">7</a></sup><br /></li>
</ul>
<p class="verse">
協定是 Swift 一個重要的特性，它會定義出為了完成某項任務或功能所需的方法、屬性，但是本身不會實作這些任務跟功能，而僅僅只是表達出該任務或功能的名稱。協定為方法、屬性、以及其他特定的任務需求或功能定義藍圖。協定可被 class、struct、或 enum 類型採納以提供所需功能的具體實現。滿足了協定中需求的任意類型都叫做遵循了該協定。<br />
</p>

<p>
除了指定遵循類型必須實現的要求外，你可以擴展一個協定以實現其中的一些需求或實現一個符合類型的可以利用的附加功能。<sup><a id="fnr.8" class="footref" href="#fn.8">8</a></sup><br />
</p>
<ul class="org-ul">
<li>例如，你可能有一個名為 str 的變量，其類型為 String。身為一個開發人員，你應該知道 str 代表 String，如果我們定義了一個名為 StringProtocol 的協定，它具有所有的 String 的 API，我們可以擴展任何類型去遵循 StringProtocol（意思是滿足其所有要求），如此一來，即可以使用該對象，讓它就像是一個 String，儘管我們不知道它是什麼！如果看起來像一隻鴨子，游泳像一隻鴨子，叫聲像一隻鴨子，那就是一隻鴨子。我們新的 StringProtocol 可以告訴那些遵守它協定的類型能夠做什麼，且不需要知道這些類型的資訊。<sup><a id="fnr.7.100" class="footref" href="#fn.7">7</a></sup><br /></li>
</ul>
</div>
<div id="outline-container-orgf44198f" class="outline-3">
<h3 id="orgf44198f"><span class="section-number-3">5.1</span> Protocol Syntax</h3>
<div class="outline-text-3" id="text-5-1">
</div>
<ol class="org-ol">
<li><a id="orgbd6f16b"></a>Syntax<br />
<div class="outline-text-4" id="text-5-1-1">
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span><span style="color: #51afef;">protocol</span> <span style="color: #c678dd;">SomeProtocol</span> {
<span class="linenr">2: </span>    <span style="color: #5B6268;">// </span><span style="color: #5B6268;">protocol definition goes here</span>
<span class="linenr">3: </span>}
</pre>
</div>
<p>
Classes , structs, enums can adopt these protocol by placing protocol’s name after the type’s name, separated by a colon, as part of their definition. Multiple protocols can be listed, and are separated by commas:<sup><a id="fnr.9" class="footref" href="#fn.9">9</a></sup><br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">SomeStructure</span>: FirstProtocol, AnotherProtocol {
<span class="linenr">2: </span>    <span style="color: #5B6268;">//</span><span style="color: #5B6268;">structure definition goes here</span>
<span class="linenr">3: </span>}
</pre>
</div>
</div>
</li>
<li><a id="orgbddd798"></a>DEMO<br />
<div class="outline-text-4" id="text-5-1-2">
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #51afef;">protocol</span> <span style="color: #c678dd;">Polite</span> {
<span class="linenr"> 2: </span>    <span style="color: #51afef;">func</span> <span style="color: #c678dd;">sayHello</span>()
<span class="linenr"> 3: </span>}
<span class="linenr"> 4: </span>
<span class="linenr"> 5: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">Teacher</span>: Polite {
<span class="linenr"> 6: </span>    <span style="color: #51afef;">var</span> name: <span style="color: #c678dd;">String</span>
<span class="linenr"> 7: </span>    <span style="color: #51afef;">func</span> <span style="color: #c678dd;">sayHello</span>() {
<span class="linenr"> 8: </span>        <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"&#21516;&#23416;&#22909;"</span>)
<span class="linenr"> 9: </span>    }
<span class="linenr">10: </span>}
<span class="linenr">11: </span>
<span class="linenr">12: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">Student</span>: Polite {
<span class="linenr">13: </span>    <span style="color: #51afef;">var</span> name: <span style="color: #c678dd;">String</span>
<span class="linenr">14: </span>    <span style="color: #51afef;">func</span> <span style="color: #c678dd;">sayHEllo</span>() {
<span class="linenr">15: </span>        <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"&#32769;&#24107;&#22909;"</span>)
<span class="linenr">16: </span>    }
<span class="linenr">17: </span>}
<span class="linenr">18: </span>
<span class="linenr">19: </span><span style="color: #51afef;">var</span> aPolitePerson: Polite = <span style="color: #c678dd;">Teacher</span>()
<span class="linenr">20: </span>aPolitePerson.<span style="color: #c678dd;">name</span> = <span style="color: #98be65;">"Mr. Yen"</span>
<span class="linenr">21: </span>aPolitePerson.<span style="color: #c678dd;">sayHellow</span>()
<span class="linenr">22: </span>aPolitePerson = <span style="color: #c678dd;">Student</span>()
<span class="linenr">23: </span>aPolitePerson.<span style="color: #c678dd;">sayHello</span>()
</pre>
</div>
</div>
</li>
<li><a id="org130e197"></a>Adding property requirements<br />
<div class="outline-text-4" id="text-5-1-3">
<p>
source: <a href="https://abhimuralidharan.medium.com/all-about-protocols-in-swift-11a72d6ea354">All about protocols in swift</a><br />
</p>
<ul class="org-ul">
<li>A protocol can have properties as well as methods that a class, enum or struct conforming to this protocol can implement.<br /></li>
<li>A protocol declaration only specifies the required property name and type. It doesn’t say anything about whether the property should be a stored one or a computed one.<br /></li>
<li>A protocol also specifies whether each property must be gettable or gettable and settable.<br /></li>
<li>Property requirements are always declared as variable properties, prefixed with the var keyword.<br /></li>
<li>Gettable and settable properties are indicated by writing { get set } after their type declaration, and gettable properties are indicated by writing { get }.<br /></li>
</ul>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span><span style="color: #51afef;">protocol</span> <span style="color: #c678dd;">SomeProtocol</span> {
<span class="linenr">2: </span>    <span style="color: #51afef;">var</span> mustBeSettable: <span style="color: #c678dd;">Int</span> { <span style="color: #51afef;">get</span> <span style="color: #51afef;">set</span> }
<span class="linenr">3: </span>    <span style="color: #51afef;">var</span> doesNotNeedToBeSettable: <span style="color: #c678dd;">Int</span> { <span style="color: #51afef;">get</span> }
<span class="linenr">4: </span>}
</pre>
</div>
</div>
</li>
<li><a id="orgb04e506"></a>Protocols with mutating methods<br />
<div class="outline-text-4" id="text-5-1-4">
<p>
Mutating methods are methods that we use on value types like structs and enums. These methods are allowed to modify the instance it belongs to and any properties of that instance. A small example:<br />
</p>

<p>
Consider a simple struct Rectangle:<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">Rectangle</span> {
<span class="linenr"> 2: </span>    <span style="color: #51afef;">var</span> width = <span style="color: #da8548; font-weight: bold;">1</span>
<span class="linenr"> 3: </span>    <span style="color: #51afef;">var</span> height = <span style="color: #da8548; font-weight: bold;">1</span>
<span class="linenr"> 4: </span>
<span class="linenr"> 5: </span>    <span style="color: #51afef;">func</span> <span style="color: #c678dd;">area</span>() -&gt; <span style="color: #c678dd;">Int</span> {
<span class="linenr"> 6: </span>        <span style="color: #51afef;">return</span> width * height
<span class="linenr"> 7: </span>    }
<span class="linenr"> 8: </span>
<span class="linenr"> 9: </span>    <span style="color: #51afef;">mutating</span> <span style="color: #51afef;">func</span> <span style="color: #c678dd;">scaleBy</span>(value: <span style="color: #c678dd;">Int</span>) {
<span class="linenr">10: </span>        width *= value
<span class="linenr">11: </span>        height *= value
<span class="linenr">12: </span>    }
<span class="linenr">13: </span>}
</pre>
</div>
<p>
The scaleBy(value:) method modifies the value of width and height. So it should be marked as mutating. Otherwise the compiler will throw error at you.<br />
</p>

<p class="verse">
If you mark a protocol instance method requirement as mutating, you do not need to write the mutatingkeyword when writing an implementation of that method for a class. The mutating keyword is only used by structures and enumerations.<br />
</p>
<p>
Consider an enum and class implementing a protocol with mutating function:<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #51afef;">protocol</span> <span style="color: #c678dd;">Togglable</span> {
<span class="linenr"> 2: </span>    <span style="color: #51afef;">mutating</span> <span style="color: #51afef;">func</span> <span style="color: #c678dd;">toggle</span>()
<span class="linenr"> 3: </span>}
<span class="linenr"> 4: </span>
<span class="linenr"> 5: </span><span style="color: #51afef;">enum</span> <span style="color: #c678dd;">OnOffSwitch</span>: Toggglable {
<span class="linenr"> 6: </span>    <span style="color: #51afef;">case</span> off, on
<span class="linenr"> 7: </span>    <span style="color: #51afef;">mutating</span> <span style="color: #51afef;">func</span> <span style="color: #c678dd;">toggle</span>() {
<span class="linenr"> 8: </span>        <span style="color: #51afef;">switch</span> <span style="color: #51afef;">self</span> {
<span class="linenr"> 9: </span>        <span style="color: #51afef;">case</span> .<span style="color: #dcaeea;">off</span>:
<span class="linenr">10: </span>            <span style="color: #51afef;">self</span> = .<span style="color: #dcaeea;">on</span>
<span class="linenr">11: </span>        <span style="color: #51afef;">case</span> .<span style="color: #dcaeea;">on</span>:
<span class="linenr">12: </span>            <span style="color: #51afef;">self</span> = .<span style="color: #dcaeea;">off</span>
<span class="linenr">13: </span>        }
<span class="linenr">14: </span>    }
<span class="linenr">15: </span>}
<span class="linenr">16: </span>
<span class="linenr">17: </span><span style="color: #51afef;">var</span> lightSwitch = OnOffSwitch.<span style="color: #dcaeea;">off</span>
<span class="linenr">18: </span>lightSwitch.<span style="color: #c678dd;">toggle</span>()
<span class="linenr">19: </span>
<span class="linenr">20: </span><span style="color: #51afef;">class</span> <span style="color: #c678dd;">ToggleClass</span>: Togglable {
<span class="linenr">21: </span>    <span style="color: #51afef;">var</span> someBool = <span style="color: #a9a1e1;">false</span>
<span class="linenr">22: </span>    <span style="color: #51afef;">func</span> <span style="color: #c678dd;">toggle</span>() {
<span class="linenr">23: </span>        someBool = <span style="color: #a9a1e1;">true</span>
<span class="linenr">24: </span>    }
<span class="linenr">25: </span>}
<span class="linenr">26: </span>
<span class="linenr">27: </span><span style="color: #51afef;">let</span> toggleClassObj = <span style="color: #c678dd;">ToggleClass</span>()
<span class="linenr">28: </span>toggleClassObj.<span style="color: #c678dd;">toggle</span>()
</pre>
</div>
</div>
</li>
<li><a id="org9299c64"></a>Initializer Requirements<br />
<div class="outline-text-4" id="text-5-1-5">
<p>
Protocols can have specific initializers like normal methods which the conforming types can implement.<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span><span style="color: #51afef;">protocol</span> <span style="color: #c678dd;">SomeProtocol</span> {
<span class="linenr">2: </span>    <span style="color: #51afef;">init</span>(someParameter: <span style="color: #c678dd;">Int</span>)
<span class="linenr">3: </span>}
</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-org37e2424" class="outline-3">
<h3 id="org37e2424"><span class="section-number-3">5.2</span> DEMO</h3>
<div class="outline-text-3" id="text-5-2">
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #51afef;">protocol</span> <span style="color: #c678dd;">Sound</span> {
<span class="linenr"> 2: </span>    <span style="color: #51afef;">func</span> <span style="color: #c678dd;">makeSound</span>()
<span class="linenr"> 3: </span>}
<span class="linenr"> 4: </span>
<span class="linenr"> 5: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">Dog</span>: Sound {
<span class="linenr"> 6: </span>    <span style="color: #51afef;">func</span> <span style="color: #c678dd;">makeSound</span>() {
<span class="linenr"> 7: </span>        <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"Woof"</span>)
<span class="linenr"> 8: </span>    }
<span class="linenr"> 9: </span>}
<span class="linenr">10: </span>
<span class="linenr">11: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">Tree</span>: Sound {
<span class="linenr">12: </span>    <span style="color: #51afef;">func</span> <span style="color: #c678dd;">makeSound</span>() {
<span class="linenr">13: </span>        <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"Susrrate"</span>)
<span class="linenr">14: </span>    }
<span class="linenr">15: </span>}
<span class="linenr">16: </span>
<span class="linenr">17: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">iPhone</span>: Sound {
<span class="linenr">18: </span>    <span style="color: #51afef;">func</span> <span style="color: #c678dd;">makeSound</span>() {
<span class="linenr">19: </span>        <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"Ring"</span>)
<span class="linenr">20: </span>    }
<span class="linenr">21: </span>}
</pre>
</div>
</div>
</div>
<div id="outline-container-org2681f46" class="outline-3">
<h3 id="org2681f46"><span class="section-number-3">5.3</span> 範例</h3>
<div class="outline-text-3" id="text-5-3">
</div>
<ol class="org-ol">
<li><a id="orgce16b9b"></a>版本 1<br />
<div class="outline-text-4" id="text-5-3-1">
<p>
本例中有兩個 struct: Song, Album 以及一個 class 用來播放 Song 或 Album，原本的 Player 要為不同的 struct 寫不同的 func，而且程式碼大多重複。<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #51afef;">import</span> Cocoa
<span class="linenr"> 2: </span><span style="color: #51afef;">import</span> AVKit
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">Song</span> {
<span class="linenr"> 5: </span>    <span style="color: #51afef;">var</span> name: <span style="color: #c678dd;">String</span>
<span class="linenr"> 6: </span>    <span style="color: #51afef;">var</span> album: Album
<span class="linenr"> 7: </span>    <span style="color: #51afef;">var</span> audioURL: <span style="color: #c678dd;">URL</span>
<span class="linenr"> 8: </span>    <span style="color: #51afef;">var</span> isLiked: <span style="color: #c678dd;">Bool</span>
<span class="linenr"> 9: </span>}
<span class="linenr">10: </span>
<span class="linenr">11: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">Album</span> {
<span class="linenr">12: </span>    <span style="color: #51afef;">var</span> name: <span style="color: #c678dd;">String</span>
<span class="linenr">13: </span>    <span style="color: #51afef;">var</span> imageURL: <span style="color: #c678dd;">URL</span>
<span class="linenr">14: </span>    <span style="color: #51afef;">var</span> audioURL: <span style="color: #c678dd;">URL</span>
<span class="linenr">15: </span>    <span style="color: #51afef;">var</span> isLiked: <span style="color: #c678dd;">Bool</span>
<span class="linenr">16: </span>}
<span class="linenr">17: </span>
<span class="linenr">18: </span><span style="color: #51afef;">class</span> <span style="color: #c678dd;">Player</span> {
<span class="linenr">19: </span>    <span style="color: #51afef;">private</span> <span style="color: #51afef;">let</span> avPlayer = <span style="color: #c678dd;">AVPlayer</span>()
<span class="linenr">20: </span>
<span class="linenr">21: </span>    <span style="color: #51afef;">func</span> <span style="color: #c678dd;">play</span>(_ song: Song) {
<span class="linenr">22: </span>        <span style="color: #51afef;">let</span> item = <span style="color: #c678dd;">AVPlayerItem</span>(url: song.<span style="color: #dcaeea;">audioURL</span>)
<span class="linenr">23: </span>        avPlayer.<span style="color: #c678dd;">replaceCurrentItem</span>(with: item)
<span class="linenr">24: </span>        avPlayer.<span style="color: #c678dd;">play</span>()
<span class="linenr">25: </span>    }
<span class="linenr">26: </span>
<span class="linenr">27: </span>    <span style="color: #51afef;">func</span> <span style="color: #c678dd;">play</span>(_ album: Album) {
<span class="linenr">28: </span>        <span style="color: #51afef;">let</span> item = <span style="color: #c678dd;">AVPlayerItem</span>(url: album.<span style="color: #dcaeea;">audioURL</span>)
<span class="linenr">29: </span>        avPlayer.<span style="color: #c678dd;">replaceCurrentItem</span>(with: item)
<span class="linenr">30: </span>        avPlayer.<span style="color: #c678dd;">play</span>()
<span class="linenr">31: </span>    }
<span class="linenr">32: </span>}
</pre>
</div>
</div>
</li>
<li><a id="org082fd92"></a>版本 2<br />
<div class="outline-text-4" id="text-5-3-2">
<p>
宣告一個 protocol，定義 audioURL 變數(read only)，然後令兩個 struct 皆遵循該 protocol(方式有二)，如此，原本的 Player class 中的 play func 就能只寫一次。<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #51afef;">import</span> Cocoa
<span class="linenr"> 2: </span><span style="color: #51afef;">import</span> AVKit
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span><span style="color: #51afef;">protocol</span> <span style="color: #c678dd;">Playable</span> {
<span class="linenr"> 5: </span>    <span style="color: #51afef;">var</span> audioURL: <span style="color: #c678dd;">URL</span> { <span style="color: #51afef;">get</span> }
<span class="linenr"> 6: </span>}
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">Song</span>: Playable {
<span class="linenr"> 9: </span>    <span style="color: #51afef;">var</span> name: <span style="color: #c678dd;">String</span>
<span class="linenr">10: </span>    <span style="color: #51afef;">var</span> album: Album
<span class="linenr">11: </span>    <span style="color: #51afef;">var</span> audioURL: <span style="color: #c678dd;">URL</span>
<span class="linenr">12: </span>    <span style="color: #51afef;">var</span> isLiked: <span style="color: #c678dd;">Bool</span>
<span class="linenr">13: </span>}
<span class="linenr">14: </span>
<span class="linenr">15: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">Album</span> {
<span class="linenr">16: </span>    <span style="color: #51afef;">var</span> name: <span style="color: #c678dd;">String</span>
<span class="linenr">17: </span>    <span style="color: #51afef;">var</span> imageURL: <span style="color: #c678dd;">URL</span>
<span class="linenr">18: </span>    <span style="color: #51afef;">var</span> audioURL: <span style="color: #c678dd;">URL</span>
<span class="linenr">19: </span>    <span style="color: #51afef;">var</span> isLiked: <span style="color: #c678dd;">Bool</span>
<span class="linenr">20: </span>}
<span class="linenr">21: </span>
<span class="linenr">22: </span><span style="color: #51afef;">extension</span> <span style="color: #c678dd;">Album</span>: Playable {}
<span class="linenr">23: </span><span style="color: #51afef;">class</span> <span style="color: #c678dd;">Player</span> {
<span class="linenr">24: </span>    <span style="color: #51afef;">private</span> <span style="color: #51afef;">let</span> avPlayer = <span style="color: #c678dd;">AVPlayer</span>()
<span class="linenr">25: </span>
<span class="linenr">26: </span>    <span style="color: #51afef;">func</span> <span style="color: #c678dd;">play</span>(_ resource: Playable) {
<span class="linenr">27: </span>        <span style="color: #51afef;">let</span> item = <span style="color: #c678dd;">AVPlayerItem</span>(url: resource.<span style="color: #dcaeea;">audioURL</span>)
<span class="linenr">28: </span>        avPlayer.<span style="color: #c678dd;">replaceCurrentItem</span>(with: item)
<span class="linenr">29: </span>        avPlayer.<span style="color: #c678dd;">play</span>()
<span class="linenr">30: </span>    }
<span class="linenr">31: </span>}
</pre>
</div>
</div>
</li>
<li><a id="orgd5bc207"></a>版本 3<br />
<div class="outline-text-4" id="text-5-3-3">
<p>
原本 protocol 的真正意思其實只是在確定 audioURL 是否能正確轉換成 Audio，所以其實將 protocol name 由 Playable 改為 AudioURLConvertable 會更貼近事實。<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #51afef;">import</span> Cocoa
<span class="linenr"> 2: </span><span style="color: #51afef;">import</span> AVKit
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span><span style="color: #51afef;">protocol</span> <span style="color: #c678dd;">AudioURLConvertable</span> {
<span class="linenr"> 5: </span>    <span style="color: #51afef;">var</span> audioURL: <span style="color: #c678dd;">URL</span> { <span style="color: #51afef;">get</span> }
<span class="linenr"> 6: </span>}
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">Song</span>: AudioURLConvertable {
<span class="linenr"> 9: </span>    <span style="color: #51afef;">var</span> name: <span style="color: #c678dd;">String</span>
<span class="linenr">10: </span>    <span style="color: #51afef;">var</span> album: Album
<span class="linenr">11: </span>    <span style="color: #51afef;">var</span> audioURL: <span style="color: #c678dd;">URL</span>
<span class="linenr">12: </span>    <span style="color: #51afef;">var</span> isLiked: <span style="color: #c678dd;">Bool</span>
<span class="linenr">13: </span>}
<span class="linenr">14: </span>
<span class="linenr">15: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">Album</span>: AudioURLConvertable {
<span class="linenr">16: </span>    <span style="color: #51afef;">var</span> name: <span style="color: #c678dd;">String</span>
<span class="linenr">17: </span>    <span style="color: #51afef;">var</span> imageURL: <span style="color: #c678dd;">URL</span>
<span class="linenr">18: </span>    <span style="color: #51afef;">var</span> audioURL: <span style="color: #c678dd;">URL</span>
<span class="linenr">19: </span>    <span style="color: #51afef;">var</span> isLiked: <span style="color: #c678dd;">Bool</span>
<span class="linenr">20: </span>}
<span class="linenr">21: </span>
<span class="linenr">22: </span><span style="color: #51afef;">class</span> <span style="color: #c678dd;">Player</span> {
<span class="linenr">23: </span>    <span style="color: #51afef;">private</span> <span style="color: #51afef;">let</span> avPlayer = <span style="color: #c678dd;">AVPlayer</span>()
<span class="linenr">24: </span>
<span class="linenr">25: </span>    <span style="color: #51afef;">func</span> <span style="color: #c678dd;">play</span>(_ resource: AudioURLConvertable) {
<span class="linenr">26: </span>        <span style="color: #51afef;">let</span> item = <span style="color: #c678dd;">AVPlayerItem</span>(url: resource.<span style="color: #dcaeea;">audioURL</span>)
<span class="linenr">27: </span>        avPlayer.<span style="color: #c678dd;">replaceCurrentItem</span>(with: item)
<span class="linenr">28: </span>        avPlayer.<span style="color: #c678dd;">play</span>()
<span class="linenr">29: </span>    }
<span class="linenr">30: </span>}
<span class="linenr">31: </span>
</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-org4e755cc" class="outline-3">
<h3 id="org4e755cc"><span class="section-number-3">5.4</span> mutating</h3>
<div class="outline-text-3" id="text-5-4">
<p>
protocol 除了可以提供傳回值型態的彈性，也可以用來變更 class/struct 中的屬性。如：<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #51afef;">import</span> Cocoa
<span class="linenr"> 2: </span><span style="color: #51afef;">import</span> AVKit
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span><span style="color: #51afef;">protocol</span> <span style="color: #c678dd;">Likeable</span> {
<span class="linenr"> 5: </span>    <span style="color: #51afef;">mutating</span> <span style="color: #51afef;">func</span> <span style="color: #c678dd;">markAsLiked</span>()
<span class="linenr"> 6: </span>}
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">Song</span> {
<span class="linenr"> 9: </span>    <span style="color: #51afef;">var</span> name: <span style="color: #c678dd;">String</span>
<span class="linenr">10: </span>    <span style="color: #51afef;">var</span> album: Album
<span class="linenr">11: </span>    <span style="color: #51afef;">var</span> audioURL: <span style="color: #c678dd;">URL</span>
<span class="linenr">12: </span>    <span style="color: #51afef;">var</span> isLiked: <span style="color: #c678dd;">Bool</span>
<span class="linenr">13: </span>}
<span class="linenr">14: </span>
<span class="linenr">15: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">Album</span> {
<span class="linenr">16: </span>    <span style="color: #51afef;">var</span> name: <span style="color: #c678dd;">String</span>
<span class="linenr">17: </span>    <span style="color: #51afef;">var</span> imageURL: <span style="color: #c678dd;">URL</span>
<span class="linenr">18: </span>    <span style="color: #51afef;">var</span> audioURL: <span style="color: #c678dd;">URL</span>
<span class="linenr">19: </span>    <span style="color: #51afef;">var</span> isLiked: <span style="color: #c678dd;">Bool</span>
<span class="linenr">20: </span>}
<span class="linenr">21: </span>
<span class="linenr">22: </span><span style="color: #51afef;">extension</span> <span style="color: #c678dd;">Song</span>: Likeable {
<span class="linenr">23: </span>    <span style="color: #51afef;">mutating</span> <span style="color: #51afef;">func</span> <span style="color: #c678dd;">markAsLiked</span>() {
<span class="linenr">24: </span>        isLiked = <span style="color: #a9a1e1;">true</span>
<span class="linenr">25: </span>    }
<span class="linenr">26: </span>}
</pre>
</div>
<p>
可以在不改變原 struct Album 的情況下，藉由 extension 來擴充 Song，使其遵循 Likeable protocol，提供變供屬性 isLiked 的值，*這在擴充 API 功能時特別有用*。<br />
</p>
</div>
</div>
<div id="outline-container-org5a01025" class="outline-3">
<h3 id="org5a01025"><span class="section-number-3">5.5</span> 擴充 protocol</h3>
<div class="outline-text-3" id="text-5-5">
<p>
除了擴充現有 struct，protocol 也可以用來擴充 protocol，如：<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #51afef;">import</span> Cocoa
<span class="linenr"> 2: </span><span style="color: #51afef;">import</span> AVKit
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span><span style="color: #51afef;">protocol</span> <span style="color: #c678dd;">Likeable</span> {
<span class="linenr"> 5: </span>    <span style="color: #51afef;">var</span> isLiked: <span style="color: #c678dd;">Bool</span> {<span style="color: #51afef;">get</span> <span style="color: #51afef;">set</span>}
<span class="linenr"> 6: </span>}
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #51afef;">extension</span> <span style="color: #c678dd;">Likeable</span> {
<span class="linenr"> 9: </span>    <span style="color: #51afef;">mutating</span> <span style="color: #51afef;">func</span> <span style="color: #c678dd;">markAsLiked</span>() {
<span class="linenr">10: </span>        isLiked = <span style="color: #a9a1e1;">true</span>
<span class="linenr">11: </span>    }
<span class="linenr">12: </span>}
<span class="linenr">13: </span>
<span class="linenr">14: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">Song</span> {
<span class="linenr">15: </span>    <span style="color: #51afef;">var</span> name: <span style="color: #c678dd;">String</span>
<span class="linenr">16: </span>    <span style="color: #51afef;">var</span> album: Album
<span class="linenr">17: </span>    <span style="color: #51afef;">var</span> audioURL: <span style="color: #c678dd;">URL</span>
<span class="linenr">18: </span>    <span style="color: #51afef;">var</span> isLiked: <span style="color: #c678dd;">Bool</span>
<span class="linenr">19: </span>}
<span class="linenr">20: </span>
<span class="linenr">21: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">Album</span> {
<span class="linenr">22: </span>    <span style="color: #51afef;">var</span> name: <span style="color: #c678dd;">String</span>
<span class="linenr">23: </span>    <span style="color: #51afef;">var</span> imageURL: <span style="color: #c678dd;">URL</span>
<span class="linenr">24: </span>    <span style="color: #51afef;">var</span> audioURL: <span style="color: #c678dd;">URL</span>
<span class="linenr">25: </span>    <span style="color: #51afef;">var</span> isLiked: <span style="color: #c678dd;">Bool</span>
<span class="linenr">26: </span>}
<span class="linenr">27: </span>
<span class="linenr">28: </span><span style="color: #51afef;">extension</span> <span style="color: #c678dd;">Song</span>: Likeable {}
<span class="linenr">29: </span><span style="color: #51afef;">extension</span> <span style="color: #c678dd;">Album</span>: Likeable {}
</pre>
</div>
</div>
</div>
<div id="outline-container-org3315b87" class="outline-3">
<h3 id="org3315b87"><span class="section-number-3">5.6</span> Further Reading</h3>
<div class="outline-text-3" id="text-5-6">
<ul class="org-ul">
<li><a href="https://docs.swift.org/swift-book/LanguageGuide/Protocols.html">Protocol</a><br /></li>
<li><a href="https://appcoda.com.tw/swift-protocol/">Swift開發指南：Protocols與Protocol Extensions的使用心法</a><br /></li>
<li><a href="https://abhimuralidharan.medium.com/all-about-protocols-in-swift-11a72d6ea354">All about protocols in SWIFT</a><br /></li>
<li><a href="https://blog.csdn.net/XunCiy/article/details/107367571">Swift5 14.Protocols</a><br /></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-SW-enum" class="outline-2">
<h2 id="SW-enum"><span class="section-number-2">6</span> Enum</h2>
<div class="outline-text-2" id="text-SW-enum">
<p>
enumerations(或稱為enums)是Swift中一種特殊類型，它允許你表示多個「情況」或可能性。Enums(列舉)類似於Bool，但Bool只能是true或false，enums可以由開發者自行定義各種情況<sup><a id="fnr.10" class="footref" href="#fn.10">10</a></sup><br />
</p>
</div>

<div id="outline-container-orgdd0741c" class="outline-3">
<h3 id="orgdd0741c"><span class="section-number-3">6.1</span> without enum</h3>
<div class="outline-text-3" id="text-6-1">
<p>
假設我們要登錄學生的學習等第(A, B, C, D, E, F)，如下<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span><span style="color: #51afef;">var</span> Tom = <span style="color: #98be65;">"A"</span>
<span class="linenr">2: </span><span style="color: #51afef;">var</span> John = <span style="color: #98be65;">"B"</span>
<span class="linenr">3: </span><span style="color: #51afef;">var</span> James = <span style="color: #98be65;">"I"</span> <span style="color: #5B6268;">//</span><span style="color: #5B6268;">Error</span>
<span class="linenr">4: </span><span style="color: #c678dd;">print</span>(James)
</pre>
</div>

<p>
上述程式中的James其等第明顯超出合理範圍，對於後續要進行的判斷可能會出現很大問題，此時便是enum適用時機<br />
</p>
</div>
</div>

<div id="outline-container-org622e8cc" class="outline-3">
<h3 id="org622e8cc"><span class="section-number-3">6.2</span> with enum</h3>
<div class="outline-text-3" id="text-6-2">
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #51afef;">enum</span> <span style="color: #c678dd;">grade</span> {
<span class="linenr"> 2: </span>    <span style="color: #51afef;">case</span> A
<span class="linenr"> 3: </span>    <span style="color: #51afef;">case</span> B
<span class="linenr"> 4: </span>    <span style="color: #51afef;">case</span> C
<span class="linenr"> 5: </span>    <span style="color: #51afef;">case</span> D
<span class="linenr"> 6: </span>    <span style="color: #51afef;">case</span> E
<span class="linenr"> 7: </span>    <span style="color: #51afef;">case</span> F
<span class="linenr"> 8: </span>}
<span class="linenr"> 9: </span>
<span class="linenr">10: </span><span style="color: #51afef;">var</span> Tome = grade.<span style="color: #dcaeea;">A</span>
<span class="linenr">11: </span><span style="color: #51afef;">var</span> John = grade.<span style="color: #dcaeea;">B</span>
<span class="linenr">12: </span><span style="color: #51afef;">var</span> James = grade.<span style="color: #dcaeea;">C</span>
</pre>
</div>
<p>
判斷檔案下載結果為另一項典型的enum適用情境:<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span><span style="color: #51afef;">enum</span> <span style="color: #c678dd;">DownloadStatus</span> {
<span class="linenr">2: </span>    <span style="color: #51afef;">case</span> downloading
<span class="linenr">3: </span>    <span style="color: #51afef;">case</span> finished
<span class="linenr">4: </span>    <span style="color: #51afef;">case</span> failed
<span class="linenr">5: </span>    <span style="color: #51afef;">case</span> cancelled
<span class="linenr">6: </span>}
<span class="linenr">7: </span><span style="color: #51afef;">var</span> currentStatus = DownloadStatus.<span style="color: #c678dd;">downloading</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org59fed92" class="outline-3">
<h3 id="org59fed92"><span class="section-number-3">6.3</span> enum的rawValue</h3>
<div class="outline-text-3" id="text-6-3">
<p>
配合rawValue定義enum的值，可以讓enum自帶有意義的資訊。<sup><a id="fnr.11" class="footref" href="#fn.11">11</a></sup><br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span><span style="color: #51afef;">enum</span> <span style="color: #c678dd;">Pet</span>: <span style="color: #c678dd;">String</span> {
<span class="linenr">2: </span>    <span style="color: #51afef;">case</span> Dog = <span style="color: #98be65;">"&#128054;"</span>
<span class="linenr">3: </span>    <span style="color: #51afef;">case</span> Cat = <span style="color: #98be65;">"&#128049;"</span>
<span class="linenr">4: </span>    <span style="color: #51afef;">case</span> Rabbit = <span style="color: #98be65;">"R"</span>
<span class="linenr">5: </span>}
<span class="linenr">6: </span>
<span class="linenr">7: </span><span style="color: #51afef;">var</span> myPet = Pet.<span style="color: #dcaeea;">Rabbit</span>
<span class="linenr">8: </span><span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"my pet is a \(</span>myPet.<span style="color: #c678dd;">rawValue</span><span style="color: #98be65;">)"</span>)    <span style="color: #5B6268;">//</span><span style="color: #5B6268;">output: my pet is a &#128048;</span>
</pre>
</div>

<pre class="example">
my pet is a R
</pre>
</div>
</div>
<div id="outline-container-orgb7ecc40" class="outline-3">
<h3 id="orgb7ecc40"><span class="section-number-3">6.4</span> enum v.s. switch</h3>
<div class="outline-text-3" id="text-6-4">
<p>
enum最大的用處就是搭配switch。<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #51afef;">let</span> currentStatus = DownloadStatus.<span style="color: #c678dd;">downloading</span>
<span class="linenr"> 2: </span>
<span class="linenr"> 3: </span><span style="color: #51afef;">switch</span> currentStatus {
<span class="linenr"> 4: </span><span style="color: #51afef;">case</span> .<span style="color: #c678dd;">downloading</span>:
<span class="linenr"> 5: </span>    <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"Downloading..."</span>)
<span class="linenr"> 6: </span>
<span class="linenr"> 7: </span><span style="color: #51afef;">case</span> .<span style="color: #c678dd;">finished</span>:
<span class="linenr"> 8: </span>    <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"Just finished the download..."</span>)
<span class="linenr"> 9: </span>
<span class="linenr">10: </span><span style="color: #51afef;">case</span> .<span style="color: #dcaeea;">failed</span>:
<span class="linenr">11: </span>    <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"Failed to download the file..."</span>)
<span class="linenr">12: </span>
<span class="linenr">13: </span><span style="color: #51afef;">case</span> .<span style="color: #c678dd;">cancelled</span>:
<span class="linenr">14: </span>    <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"The download is cancelled..."</span>)
<span class="linenr">15: </span>}
</pre>
</div>
</div>
</div>

<div id="outline-container-org95f51d8" class="outline-3">
<h3 id="org95f51d8"><span class="section-number-3">6.5</span> Swift列舉中最強大的功能之一：associated values</h3>
<div class="outline-text-3" id="text-6-5">
<p>
associated values。它允許我們在列舉中儲存額外的數據。我們宣告一個新的列舉，稱為WeatherCondition，它讓我們在每個天氣條件中可額外挾帶一些資訊：<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #51afef;">enum</span> <span style="color: #c678dd;">Cloud</span> {
<span class="linenr"> 2: </span>    <span style="color: #51afef;">case</span> cirrus
<span class="linenr"> 3: </span>    <span style="color: #51afef;">case</span> cumulus
<span class="linenr"> 4: </span>    <span style="color: #51afef;">case</span> altocumulus
<span class="linenr"> 5: </span>    <span style="color: #51afef;">case</span> stratus
<span class="linenr"> 6: </span>    <span style="color: #51afef;">case</span> cumulonimbus
<span class="linenr"> 7: </span>}
<span class="linenr"> 8: </span>
<span class="linenr"> 9: </span><span style="color: #51afef;">enum</span> <span style="color: #c678dd;">WeatherCondition</span> {
<span class="linenr">10: </span>    <span style="color: #51afef;">case</span> <span style="color: #c678dd;">sunny</span>(temperature: <span style="color: #c678dd;">Float</span>)
<span class="linenr">11: </span>    <span style="color: #51afef;">case</span> <span style="color: #c678dd;">rainy</span>(inchesPerHour: <span style="color: #c678dd;">Float</span>)
<span class="linenr">12: </span>    <span style="color: #51afef;">case</span> <span style="color: #c678dd;">cloudy</span>(cloudType: Cloud, windSpeed: <span style="color: #c678dd;">Float</span>)
<span class="linenr">13: </span>}
</pre>
</div>
<p>
WeatherCondition的宣告。我們提供三個情境，在enum每個情境中都存有附加資訊。在sunny情況下，儲存一個參數名稱為temperature的Float。在rainy情況下，附帶一個Float類型的參數，命名為inchesPerHour，另外在cloudy情況下，我們附帶兩個參數，分別為Cloud類型的cloudType和Float類型的windSpeed。<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #51afef;">let</span> currentWeather = WeatherCondition.<span style="color: #c678dd;">cloudy</span>(cloudType: .<span style="color: #dcaeea;">cirrus</span>, windSpeed: <span style="color: #da8548; font-weight: bold;">4.2</span>)
<span class="linenr"> 2: </span>
<span class="linenr"> 3: </span><span style="color: #51afef;">switch</span> currentWeather {
<span class="linenr"> 4: </span><span style="color: #51afef;">case</span> .<span style="color: #c678dd;">sunny</span>(<span style="color: #51afef;">let</span> temperature):
<span class="linenr"> 5: </span>    <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"It is sunny and the temperature is \(</span>temperature<span style="color: #98be65;">)."</span>)
<span class="linenr"> 6: </span>
<span class="linenr"> 7: </span><span style="color: #51afef;">case</span> .<span style="color: #c678dd;">rainy</span>(<span style="color: #51afef;">let</span> inchesPerHour):
<span class="linenr"> 8: </span>    <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"It is raining at a rate of \(</span>inchesPerHour<span style="color: #98be65;">) inches per hour."</span>)
<span class="linenr"> 9: </span>
<span class="linenr">10: </span><span style="color: #51afef;">case</span> .<span style="color: #c678dd;">cloudy</span>(<span style="color: #51afef;">let</span> cloudType, <span style="color: #51afef;">let</span> windSpeed):
<span class="linenr">11: </span>    <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"It is cloudy; there are \(</span>cloudType<span style="color: #98be65;">) clouds in the sky, and the wind speed is \(</span>windSpeed<span style="color: #98be65;">)."</span>)
<span class="linenr">12: </span>}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org0b92072" class="outline-2">
<h2 id="org0b92072"><span class="section-number-2">7</span> Struct v.s. Class</h2>
<div class="outline-text-2" id="text-7">
<p>
<a href="https://www.hackingwithswift.com/books/ios-swiftui/why-does-swiftui-use-structs-for-views">資料來源:Why does SwiftUI use structs for views?</a><br />
If you ever programmed for UIKit or AppKit (Apple’s original user interface frameworks for iOS and macOS) you’ll know that they use classes for views rather than structs. SwiftUI does not: we prefer to use structs for views across the board, and there are a couple of reasons why.<sup><a id="fnr.12" class="footref" href="#fn.12">12</a></sup><br />
</p>
<ul class="org-ul">
<li>Structs are simpler and faster than classes.<br />
In SwiftUI, all our views are trivial structs and are almost free to create. Think about it: if you make a struct that holds a single integer, the entire size of your struct is… that one integer. Nothing else. No surprise extra values inherited from parent classes, or grandparent classes, or great-grandparent classes, etc – they contain exactly what you can see and nothing more.<br /></li>

<li>You can see this in action when you look at the kinds of things that can be a view. We already used Color.red and LinearGradient as views – trivial types that hold very little data. In fact, you can’t get a great deal simpler than using Color.red as a view: it holds no information other than “fill my space with red”.<br /></li>

<li>In comparison, Apple’s documentation for UIView lists about 200 properties and methods that UIView has, all of which get passed on to its subclasses whether they need them or not.<br /></li>
</ul>
</div>
<div id="outline-container-orga1a4020" class="outline-3">
<h3 id="orga1a4020"><span class="section-number-3">7.1</span> What is in class/struct</h3>
<div class="outline-text-3" id="text-7-1">
<p>
<a href="https://www.avanderlee.com/swift/struct-class-differences/">資料來源:Struct vs classes in Swift: The differences explained</a><br />
</p>
</div>
<ol class="org-ol">
<li><a id="orgdc5c36e"></a>What is a class in Swift?<br />
<div class="outline-text-4" id="text-7-1-1">
<p>
A class in Swift is a reference type which can contain:<br />
</p>
<ul class="org-ul">
<li>properties<br /></li>
<li>methods<br /></li>
<li>subscripts<br /></li>
<li>initializers<br /></li>
<li>protocol conformances<br /></li>
<li>extensions<br /></li>
</ul>

<p>
It’s often described as a template definition of an object, like in the following Article instance definition:<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #51afef;">class</span> <span style="color: #c678dd;">ArticleClass</span> {
<span class="linenr"> 2: </span>    <span style="color: #51afef;">let</span> title: <span style="color: #c678dd;">String</span>
<span class="linenr"> 3: </span>    <span style="color: #51afef;">let</span> url: <span style="color: #c678dd;">URL</span>
<span class="linenr"> 4: </span>    <span style="color: #51afef;">var</span> readCount: <span style="color: #c678dd;">Int</span> = <span style="color: #da8548; font-weight: bold;">0</span>
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span>    <span style="color: #51afef;">init</span>(title: <span style="color: #c678dd;">String</span>, url: <span style="color: #c678dd;">URL</span>) {
<span class="linenr"> 7: </span>        <span style="color: #51afef;">self</span>.<span style="color: #c678dd;">title</span> = title
<span class="linenr"> 8: </span>        <span style="color: #51afef;">self</span>.<span style="color: #c678dd;">url</span> = url
<span class="linenr"> 9: </span>    }
<span class="linenr">10: </span>}
</pre>
</div>
</div>
</li>
<li><a id="org0c1aa4c"></a>What is a struct in Swift?<br />
<div class="outline-text-4" id="text-7-1-2">
<p>
A struct in Swift is a value type which, just like classes, can contain:<br />
</p>
<ul class="org-ul">
<li>properties<br /></li>
<li>methods<br /></li>
<li>subscripts<br /></li>
<li>initializers<br /></li>
<li>protocol conformances<br /></li>
<li>extensions<br /></li>
</ul>

<p>
It can also be seen as a template definition of an object, like in the following Article instance definition:<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">ArticleStruct</span> {
<span class="linenr">2: </span>    <span style="color: #51afef;">let</span> title: <span style="color: #c678dd;">String</span>
<span class="linenr">3: </span>    <span style="color: #51afef;">let</span> url: <span style="color: #c678dd;">URL</span>
<span class="linenr">4: </span>    <span style="color: #51afef;">var</span> readCount: <span style="color: #c678dd;">Int</span> = <span style="color: #da8548; font-weight: bold;">0</span>
<span class="linenr">5: </span>}
</pre>
</div>
</div>
</li>
<li><a id="org937bf6e"></a>What are the differences between a struct and a class?<br />
<div class="outline-text-4" id="text-7-1-3">
<p width="300">
<img src="images/coffee.gif" alt="coffee.gif" width="300" /><br />
When you pass a class object around your program, you are actually passing a reference to that object, so different parts of your program can share and modify your object. When you pass a structure [ or enum] around your program, what gets passes around is a copy of the structure. So modifications to structures don’t get shared.<sup><a id="fnr.13" class="footref" href="#fn.13">13</a></sup><br />
</p>

<p>
One of the major benefits of value types is that they are thread-safe not requiring any<br />
 synchronization.<sup><a id="fnr.13.100" class="footref" href="#fn.13">13</a></sup> Structs always have unique owners, whereas with classes multiple things can point to the same value.<sup><a id="fnr.14" class="footref" href="#fn.14">14</a></sup><br />
</p>

<p>
Classes don’t need the <b>mutating</b> keyword before methods that change their properties, because you can change properties of constant classes.<br />
In practice, what this means is that if we have two SwiftUI views and we send them both the same struct to work with, they actually each have a unique copy of that struct; if one changes it, the other won’t see that change. On the other hand, if we create an instance of a class and send that to both views, they will share changes.<sup><a id="fnr.14.100" class="footref" href="#fn.14">14</a></sup><br />
Value vs reference types<br />
</p>

<p>
One of the most important differences is that a struct is a value type while a class is a reference type. References to a class instance share single data which means that any changes in that class will be available to each reference.<br />
</p>

<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span><span style="color: #51afef;">let</span> articleClass = <span style="color: #c678dd;">ArticleClass</span>(title: <span style="color: #98be65;">"Struct vs Class"</span>, url: <span style="color: #c678dd;">URL</span>(string: <span style="color: #98be65;">"www.avanderlee.com"</span>)!)
<span class="linenr">2: </span><span style="color: #51afef;">let</span> articleClassCopy = articleClass
<span class="linenr">3: </span>
<span class="linenr">4: </span>articleClass.<span style="color: #dcaeea;">readCount</span> = <span style="color: #da8548; font-weight: bold;">10</span>
<span class="linenr">5: </span><span style="color: #c678dd;">print</span>(articleClassCopy.<span style="color: #dcaeea;">readCount</span>) <span style="color: #5B6268;">// </span><span style="color: #5B6268;">Prints: 10</span>
</pre>
</div>

<p>
A struct is a value type and will create a unique copy for each new reference.<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span><span style="color: #51afef;">var</span> articleStruct = <span style="color: #c678dd;">ArticleStruct</span>(title: <span style="color: #98be65;">"Struct vs Class"</span>, url: <span style="color: #c678dd;">URL</span>(string: <span style="color: #98be65;">"www.avanderlee.com"</span>)!, readCount: <span style="color: #da8548; font-weight: bold;">0</span>)
<span class="linenr">2: </span><span style="color: #51afef;">var</span> articleStructCopy = articleStruct
<span class="linenr">3: </span>
<span class="linenr">4: </span>articleStruct.<span style="color: #dcaeea;">readCount</span> = <span style="color: #da8548; font-weight: bold;">10</span>
<span class="linenr">5: </span><span style="color: #c678dd;">print</span>(articleStructCopy.<span style="color: #dcaeea;">readCount</span>) <span style="color: #5B6268;">// </span><span style="color: #5B6268;">Prints: 0</span>
</pre>
</div>
</div>
<ol class="org-ol">
<li><a id="org04309b5"></a>The benefit of mutation in safety<br />
<div class="outline-text-5" id="text-7-1-3-1">
<p>
With this, structs have the benefit of mutation in safety as you can trust that no other part of your app is changing the data at the same time. This makes it easier to reason about your code and is especially helpful in multi-threaded environments where a different thread could alter your data at the same time.<br />
</p>
</div>
</li>
<li><a id="org6d5ec98"></a>Structs get an initializer for free<br />
<div class="outline-text-5" id="text-7-1-3-2">
<p>
If you go back and compare the above code examples you can see that the ArticleClass has a defined initializer which is required for classes. Structs, however, get an initializer for free.<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span><span style="color: #5B6268;">// </span><span style="color: #5B6268;">Before Swift 5.1 Memberwise initializers:</span>
<span class="linenr">2: </span><span style="color: #5B6268;">// </span><span style="color: #5B6268;">Generated memberwise init: init(title: String, url: URL, readCount: Int)</span>
<span class="linenr">3: </span><span style="color: #51afef;">let</span> article = <span style="color: #c678dd;">ArticleStruct</span>(title: <span style="color: #98be65;">""</span>, url: <span style="color: #c678dd;">URL</span>(string: <span style="color: #98be65;">""</span>)!, readCount: <span style="color: #da8548; font-weight: bold;">0</span>)
<span class="linenr">4: </span>
<span class="linenr">5: </span><span style="color: #5B6268;">// </span><span style="color: #5B6268;">After Swift 5.1 Memberwise initializers, using the default 0 for read count</span>
<span class="linenr">6: </span><span style="color: #5B6268;">// </span><span style="color: #5B6268;">Generated memberwise init: init(title: String, url: URL, readCount: Int = 0)</span>
<span class="linenr">7: </span><span style="color: #51afef;">let</span> article = <span style="color: #c678dd;">ArticleStruct</span>(title: <span style="color: #98be65;">""</span>, url: <span style="color: #c678dd;">URL</span>(string: <span style="color: #98be65;">""</span>)!)
</pre>
</div>
</div>
</li>
<li><a id="org73d37a9"></a>Classes allow inheritance<br />
<div class="outline-text-5" id="text-7-1-3-3">
<p>
Classes can inherit the characteristics of another class and with that, act like abstract classes. A common example is a custom view controller which inherit from UIViewController.<br />
</p>

<p>
With protocols in Swift, this is often no longer needed and replaceable with protocols. Protocols can be used with both classes and structs while inheritance is only possible with classes.<br />
Classes can be deinitialized<br />
</p>

<p>
A class allows executing code just before it gets destroyed by using a deinit method. When you define the same deinit method in a struct you’ll get the following error:<br />
</p>
<p class="verse">
Deinitializers may only be declared within a class<br />
</p>
</div>
</li>
</ol>
</li>
</ol>
</div>
<div id="outline-container-org3b99653" class="outline-3">
<h3 id="org3b99653"><span class="section-number-3">7.2</span> 如何決擇? / When should I go for a struct and when for a class?</h3>
<div class="outline-text-3" id="text-7-2">
<p>
A simple bullet point list will make it a lot easier to decide.<br />
</p>
</div>
<ol class="org-ol">
<li><a id="org5554122"></a>You should use a class when:<br />
<div class="outline-text-4" id="text-7-2-1">
<ul class="org-ul">
<li>Comparing instance identity is needed by using <code>=</code><br /></li>
<li>Shared mutable state is required<br /></li>
<li>Objective-C interoperability is required<br /></li>
</ul>
</div>
</li>
<li><a id="org8be3a7f"></a>You should use a struct when:<br />
<div class="outline-text-4" id="text-7-2-2">
<ul class="org-ul">
<li>Comparing instance data is needed by using ==<br /></li>
<li>Unique copies with an independent state are required<br /></li>
<li>The data is used in multiple threads<br /></li>
</ul>
</div>
</li>
<li><a id="org3042ba7"></a>Try to go for a struct by default.<br />
<div class="outline-text-4" id="text-7-2-3">
<p>
Structs make your code easier to reason about and make it easier to work in multithreaded environments which we often have while developing in Swift.<br />
</p>
</div>
</li>
</ol>
</div>
<div id="outline-container-org722a802" class="outline-3">
<h3 id="org722a802"><span class="section-number-3">7.3</span> DEMO</h3>
<div class="outline-text-3" id="text-7-3">
<p>
以下這個 View 可正常運作，於 TextField 中所做的編輯修改都會即時顯示於 Text 中。<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">User</span> {
<span class="linenr"> 2: </span>    <span style="color: #51afef;">var</span> firstName<span style="color: #98be65;">" = Bilbo"</span>
<span class="linenr"> 3: </span>    <span style="color: #51afef;">var</span> lastName = <span style="color: #98be65;">"Baggins"</span>
<span class="linenr"> 4: </span>}
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">ContentView</span>: View {
<span class="linenr"> 7: </span>    <span style="color: #51afef;">@State</span> <span style="color: #51afef;">private</span> <span style="color: #51afef;">var</span> user = <span style="color: #c678dd;">User</span>()
<span class="linenr"> 8: </span>
<span class="linenr"> 9: </span>    <span style="color: #51afef;">var</span> body: <span style="color: #51afef;">some</span> View {
<span class="linenr">10: </span>        VStack {
<span class="linenr">11: </span>            <span style="color: #c678dd;">Text</span>(<span style="color: #98be65;">"Your name is \(</span>user.<span style="color: #dcaeea;">firstName</span><span style="color: #98be65;">) \(</span>user.<span style="color: #dcaeea;">lastName</span><span style="color: #98be65;">)."</span>)
<span class="linenr">12: </span>
<span class="linenr">13: </span>            <span style="color: #c678dd;">TextField</span>(<span style="color: #98be65;">"First name"</span>, text: $user.<span style="color: #dcaeea;">firstName</span>)
<span class="linenr">14: </span>            <span style="color: #c678dd;">TextField</span>(<span style="color: #98be65;">"Last name"</span>, text: $user.<span style="color: #dcaeea;">lastName</span>)
<span class="linenr">15: </span>        }
<span class="linenr">16: </span>    }
<span class="linenr">17: </span>}
</pre>
</div>
<p>
但若將 struct 改為 class，雖程式仍可執行，但 Text 中的姓名卻不再隨 TextField 的修改而連動。<br />
To fix this, we need to tell SwiftUI when interesting parts of our class have changed. By “interesting parts” I mean parts that should cause SwiftUI to reload any views that are watching our class – it’s possible you might have lots of properties inside your class, but only a few should be exposed to the wider world in this way.<sup><a id="fnr.15" class="footref" href="#fn.15">15</a></sup><br />
若要將 struct 改為 class，則程式要改成：<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #51afef;">class</span> <span style="color: #c678dd;">User</span>: <span style="color: #c678dd;">ObservableObject</span>{
<span class="linenr"> 2: </span>    <span style="color: #51afef;">@Published</span> <span style="color: #51afef;">var</span> firstName = <span style="color: #98be65;">"Bilbo"</span>
<span class="linenr"> 3: </span>    <span style="color: #51afef;">@Published</span> <span style="color: #51afef;">var</span> lastName = <span style="color: #98be65;">"Baggins"</span>
<span class="linenr"> 4: </span>}
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">ContentView</span>: View {
<span class="linenr"> 7: </span>    <span style="color: #51afef;">@ObservedObject</span> <span style="color: #51afef;">var</span> user = <span style="color: #c678dd;">User</span>()
<span class="linenr"> 8: </span>
<span class="linenr"> 9: </span>    <span style="color: #51afef;">var</span> body: <span style="color: #51afef;">some</span> View {
<span class="linenr">10: </span>        VStack {
<span class="linenr">11: </span>            <span style="color: #c678dd;">Text</span>(<span style="color: #98be65;">"Your name is \(</span>user.<span style="color: #dcaeea;">firstName</span><span style="color: #98be65;">) \(</span>user.<span style="color: #dcaeea;">lastName</span><span style="color: #98be65;">)."</span>)
<span class="linenr">12: </span>
<span class="linenr">13: </span>            <span style="color: #c678dd;">TextField</span>(<span style="color: #98be65;">"First name"</span>, text: $user.<span style="color: #dcaeea;">firstName</span>)
<span class="linenr">14: </span>            <span style="color: #c678dd;">TextField</span>(<span style="color: #98be65;">"Last name"</span>, text: $user.<span style="color: #dcaeea;">lastName</span>)
<span class="linenr">15: </span>        }
<span class="linenr">16: </span>    }
<span class="linenr">17: </span>}
</pre>
</div>
<p>
Our User class has two properties: firstName and lastName. Whenever either of those two changes, we want to notify any views that are watching our class that a change has happened so they can be reloaded. We can do this using the @Published property observer.<br />
</p>

<p>
@Published is more or less half of @State: it tells Swift that whenever either of those two properties changes, it should send an announcement out to any SwiftUI views that are watching that they should reload.<br />
</p>

<p>
How do those views know which classes might send out these notifications? That’s another property wrapper, @ObservedObject, which is the other half of @State – it tells SwiftUI to watch a class for any change announcements.<br />
</p>

<p>
The @ObservedObject property wrapper can only be used on types that conform to the ObservableObject protocol. This protocol has no requirements, and really all it means is “we want other things to be able to monitor this for changes.”<br />
</p>

<p>
As you’ve seen, rather than just using @State to declare local state, we now take three steps:<br />
</p>

<ul class="org-ul">
<li>Make a class that conforms to the ObservableObject protocol.<br /></li>
<li>Mark some properties with @Published so that any views using the class get updated when they change.<br /></li>
<li>Create an instance of our class using the @ObservedObject property wrapper.<br /></li>
</ul>

<p>
The end result is that we can have our state stored in an external object, and, even better, we can now use that object in multiple views and have them all point to the same values.<br />
</p>
</div>
</div>
</div>

<div id="outline-container-orgf0f9a8e" class="outline-2">
<h2 id="orgf0f9a8e"><span class="section-number-2">8</span> Publihser and Subscriber</h2>
<div class="outline-text-2" id="text-8">
<p>
發佈者（Publisher）的角色就是提供輸出（output），當有值或者被請求就輸出值，如果一個Publisher沒有任何請求則被優化不做任何處理，Combine中提供兩種基本輸出，正常輸出（output type）和失敗（Failure）<br />
與發佈者(Publisher)對應的是訂閱者（Subscriber），訂閱者（Subscriber）訂閱發佈者的輸出並進行處理。發佈者（Publisher）和訂閱者（Subcriber）構成Combine的核心概念。和Publisher對應的，Subscriber有一個輸入類型（Input Type）和失敗(Failure),關係如下圖<sup><a id="fnr.16" class="footref" href="#fn.16">16</a></sup>：<br />
</p>
<p width="500">
<img src="images/PS-2.png" alt="PS-2.png" width="500" /><br />
僅僅是Publisher和Subcriber還不夠，我們可能需要對數據進行一定的處理再交給下一個，這就引入了另外一個概念，operator，operator同時支持了publisher和Subcriber協議，通過operator你可以訂閱一個Publisher，接受它的輸出處理後重新發佈給其他Subcriber，組合起來就是這樣：<br />
</p>

<div id="org4719903" class="figure">
<p><img src="images/PS-3.png" alt="PS-3.png" width="500" /><br />
</p>
<p><span class="figure-number">Figure 9: </span>Publisher v.s. Operator v.s. Subscriber</p>
</div>

<p>
操作者通常用來做數據類型變換，同時作用於輸出類型和失敗類型，操作者也可以用於分割輸出，複製輸出或者組合多個流。操作者的一個限制是輸入和輸出連接需要對齊，就像一個管道一樣，所有連接處都必須一致。我們稱這種組合方式為管道（Pipeline）<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #51afef;">import</span> Combine
<span class="linenr"> 2: </span><span style="color: #51afef;">let</span> _ = <span style="color: #c678dd;">Just</span>(<span style="color: #da8548; font-weight: bold;">5</span>) <span style="color: #5B6268;">//</span><span style="color: #5B6268;">&#31649;&#36947;&#36215;&#22987;&#26044;&#30332;&#20296;&#32773;Just&#65292;&#36664;&#20986;&#26159;5 &#39006;&#22411;, &#28961;&#22833;&#25943;&#39006;&#22411;</span>
<span class="linenr"> 3: </span>.<span style="color: #c678dd;">map</span> { value -&gt; <span style="color: #c678dd;">String</span> <span style="color: #51afef;">in</span>
<span class="linenr"> 4: </span>    <span style="color: #5B6268;">//</span><span style="color: #5B6268;">&#31649;&#36947;&#36890;&#36942;&#20102;map&#25805;&#20316;&#65292;&#36820;&#22238;&#20102;&#19968;&#20491;&#23383;&#31526;&#20018;</span>
<span class="linenr"> 5: </span>    <span style="color: #5B6268;">// </span><span style="color: #5B6268;">do something with the incoming value here</span>
<span class="linenr"> 6: </span>    <span style="color: #5B6268;">// </span><span style="color: #5B6268;">and return a string</span>
<span class="linenr"> 7: </span>    <span style="color: #51afef;">return</span> <span style="color: #98be65;">"a string"</span>
<span class="linenr"> 8: </span>}
<span class="linenr"> 9: </span>.<span style="color: #c678dd;">sink</span> { receivedValue <span style="color: #51afef;">in</span>
<span class="linenr">10: </span>    <span style="color: #5B6268;">// </span><span style="color: #5B6268;">sink is the subscriber and terminates the pipeline</span>
<span class="linenr">11: </span>    <span style="color: #5B6268;">// </span><span style="color: #5B6268;">subcriber&#35330;&#38321;&#20102;map&#24460;&#30340;&#36664;&#20986;&#65292;&#20006;&#25171;&#21360;&#20102;result</span>
<span class="linenr">12: </span>    <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"The end result was \(</span>receivedValue<span style="color: #98be65;">)"</span>)
<span class="linenr">13: </span>}
</pre>
</div>

<pre class="example">
The end result was a string
</pre>
</div>

<div id="outline-container-org446a61a" class="outline-3">
<h3 id="org446a61a"><span class="section-number-3">8.1</span> Publisher</h3>
<div class="outline-text-3" id="text-8-1">
<p>
Declares that a type can transmit a sequence of values over time.<br />
</p>
</div>
<ol class="org-ol">
<li><a id="orgb4706bb"></a>Declaration<br />
<div class="outline-text-4" id="text-8-1-1">
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span><span style="color: #51afef;">protocol</span> <span style="color: #c678dd;">Publisher</span>
</pre>
</div>
</div>
</li>
<li><a id="orgeb9fdf8"></a>Overview<br />
<div class="outline-text-4" id="text-8-1-2">
<p>
A publisher delivers elements to one or more <a href="https://developer.apple.com/documentation/combine/subscriber">Subscriber</a> instances. The subscriber’s Input and Failure associated types must match the Output and Failure types declared by the publisher. The publisher implements the receive (subscriber:) method to accept a subscriber.<br />
You connect a subscriber to a publisher by calling the publisher’s subscribe(<span class="underline">:) method. After making this call, the publisher invokes the subscriber’s receive(subscription:) method. This gives the subscriber a Subscription instance, which it uses to demand elements from the publisher, and to optionally cancel the subscription. After the subscriber makes an initial demand, the publisher calls receive(</span>:), possibly asynchronously, to deliver newly-published elements. If the publisher stops publishing, it calls receive(completion:), using a parameter of type Subscribers.Completion to indicate whether publishing completes normally or with an error.<br />
</p>

<ul class="org-ul">
<li>sink(receiveCompletion:receiveValue:) executes arbitrary closures when it receives a completion signal and each time it receives a new element.<br /></li>
<li>assign(to:on:) writes each newly-received value to a property identified by a key path on a given instance.<br /></li>
</ul>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-orga5527ac" class="outline-2">
<h2 id="orga5527ac"><span class="section-number-2">9</span> Combine</h2>
<div class="outline-text-2" id="text-9">
<p>
在 2019 年時，Apple 推出了兩套強大的框架分別是 SwiftUI 以及 Combine，而這兩種全新的框架對於開發者來說是一個重大的改動，它也跟以往我們熟悉的編成方式不同，因此要能夠熟悉這兩個新推出的框架也算是一個大挑戰<sup><a id="fnr.17" class="footref" href="#fn.17">17</a></sup>。<br />
</p>
</div>
<div id="outline-container-org82df7df" class="outline-3">
<h3 id="org82df7df"><span class="section-number-3">9.1</span> Publisher<sup><a id="fnr.17.100" class="footref" href="#fn.17">17</a></sup></h3>
<div class="outline-text-3" id="text-9-1">
<p>
Combine 框架提供了一個宣告性（declarative）的 Swift API，其用於隨時間推移的值處理，這些值可以表示多種異步事件。Combine 宣告發布者（Publishers）去暴露隨時間變化的值，而訂閱者（Subscribers）去從發布者那裡接收這些值:<br />
</p>
<ul class="org-ul">
<li>Publisher 協議宣告了一個可以隨時間傳遞序列值的類型。發布者具有運算符（Operators）來從上游發布者那裡獲得的值採取行動，然後重新發布他們。<br /></li>
<li>在發布者鏈的結尾，訂閱者在接收元素的時候對其進行操作。發布者只能在訂閱者明確要求時才發出值。如此一來，你的訂閱者程式碼就可以控制從連接的發布者那裡接受事件的速度<br /></li>
</ul>

<p>
發布者傳遞元素到一個或多個訂閱者實例。訂閱者的 Input 以及 Failure 的關聯類型必須與發布者宣告的 Output 以及 Failure 的類型相匹配。發布者實現了 receive(subscriber:) 方法來接受訂閱者。<br />
</p>

<p>
在這之後，發布者可以在訂閱者上調用以下方法：<br />
</p>
<ul class="org-ul">
<li>receive(subscription:)： 確認訂閱請求並且返回一個 Subscription 實例。訂閱者使用訂閱來向發布者需求元素，並且可以使用它來取消發布。<br /></li>
<li>receive(_:)：從發布者向訂閱者傳遞一個元素。<br /></li>
<li>receive(completion:)：通知訂閱者發布已正常結束或發生錯誤。<br /></li>
</ul>

<p>
每個 Publisher 必須遵守此約定，下游訂閱者才能正常運作。此外，@Published 特性受class約束。必須將它與class的屬性一起使用，而不是與非類類型（例如：struct）一起使用。<br />
</p>
</div>
<ol class="org-ol">
<li><a id="org511cc04"></a>Published<br />
<div class="outline-text-4" id="text-9-1-1">
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #51afef;">import</span> Combine
<span class="linenr"> 2: </span>
<span class="linenr"> 3: </span><span style="color: #51afef;">class</span> <span style="color: #c678dd;">Weather</span> {
<span class="linenr"> 4: </span>    <span style="color: #51afef;">@Published</span> <span style="color: #51afef;">var</span> temperature: <span style="color: #c678dd;">Double</span>
<span class="linenr"> 5: </span>    <span style="color: #51afef;">init</span>(temperature: <span style="color: #c678dd;">Double</span>) {
<span class="linenr"> 6: </span>        <span style="color: #51afef;">self</span>.<span style="color: #dcaeea;">temperature</span> = temperature
<span class="linenr"> 7: </span>    }
<span class="linenr"> 8: </span>}
<span class="linenr"> 9: </span><span style="color: #51afef;">let</span> weather = <span style="color: #c678dd;">Weather</span>(temperature: <span style="color: #da8548; font-weight: bold;">20</span>)
<span class="linenr">10: </span><span style="color: #51afef;">var</span> cancellable = weather.$temperature
<span class="linenr">11: </span>  .<span style="color: #c678dd;">sink</span>() {
<span class="linenr">12: </span>      <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"Temperatuer now: \(</span>$0<span style="color: #98be65;">)"</span>)
<span class="linenr">13: </span>}
<span class="linenr">14: </span>weather.<span style="color: #dcaeea;">temperature</span> = <span style="color: #da8548; font-weight: bold;">25</span>
<span class="linenr">15: </span>weather.<span style="color: #dcaeea;">temperature</span> = <span style="color: #da8548; font-weight: bold;">30</span>
</pre>
</div>

<pre class="example">
Temperatuer now: 20.0
Temperatuer now: 25.0
Temperatuer now: 30.0
</pre>
</div>
</li>
</ol>
</div>

<div id="outline-container-org1b03900" class="outline-3">
<h3 id="org1b03900"><span class="section-number-3">9.2</span> Subscriber<sup><a id="fnr.17.100" class="footref" href="#fn.17">17</a></sup></h3>
<div class="outline-text-3" id="text-9-2">
<p>
Combine 內置的 Subscriber 有三種：<br />
</p>
<ul class="org-ul">
<li>sink:  通用的closure方式處理Publisher的值<br /></li>
<li>assign: 可以很方便地將接收到的值通過 KeyPath 設置到指定的 Class 上（不支持 Struct），很適合將已有的程序改造成Reactive。<br /></li>
<li>Subject: 有些時候我們想隨時在 Publisher 插入值來通知訂閱者，在 Combine 中也提供了一個 Subject 類型來實現。Subject 通常是一個中間代理，即可以作為 Publisher，也可以作為 Observer。Subject要求實現一個send方法，允許向combine鏈條發送值。<br /></li>
</ul>
</div>
<ol class="org-ol">
<li><a id="org92e885a"></a>sink<br />
<div class="outline-text-4" id="text-9-2-1">
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span><span style="color: #51afef;">import</span> Combine
<span class="linenr">2: </span><span style="color: #51afef;">private</span> <span style="color: #51afef;">var</span> cancellables = <span style="color: #c678dd;">Set</span>&lt;AnyCancellable&gt;()
<span class="linenr">3: </span>
<span class="linenr">4: </span>[<span style="color: #98be65;">"A"</span>, <span style="color: #98be65;">"B"</span>, <span style="color: #98be65;">"C"</span>, <span style="color: #98be65;">"D"</span>, <span style="color: #98be65;">"E"</span>].<span style="color: #c678dd;">publisher</span>
<span class="linenr">5: </span>  .<span style="color: #c678dd;">sink</span>(receiveCompletion: { <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"completion: \(</span>$0<span style="color: #98be65;">)"</span>) },
<span class="linenr">6: </span>        receiveValue: { <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"item:\(</span>$0<span style="color: #98be65;">)"</span>) })
<span class="linenr">7: </span>  .<span style="color: #c678dd;">store</span>(<span style="color: #51afef;">in</span>: &amp;cancellables)
</pre>
</div>

<pre class="example">
item:A
item:B
item:C
item:D
item:E
completion:finished
</pre>

<p>
sink: 針對收到元素與結束通知時, 分別執行指定的指令<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #51afef;">import</span> Combine
<span class="linenr"> 2: </span>
<span class="linenr"> 3: </span><span style="color: #51afef;">var</span> <span style="color: #51afef;">set</span> = <span style="color: #c678dd;">Set</span>&lt;AnyCancellable&gt;()
<span class="linenr"> 4: </span><span style="color: #51afef;">let</span> pst = PassthroughSubject&lt;<span style="color: #c678dd;">String</span>,<span style="color: #c678dd;">Error</span>&gt;()
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span>pst.<span style="color: #c678dd;">sink</span>(receiveCompletion: { result <span style="color: #51afef;">in</span> <span style="color: #5B6268;">// </span><span style="color: #5B6268;">1</span>
<span class="linenr"> 7: </span>    <span style="color: #51afef;">switch</span> result {  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">2</span>
<span class="linenr"> 8: </span>    <span style="color: #51afef;">case</span> .<span style="color: #c678dd;">finished</span>:
<span class="linenr"> 9: </span>        <span style="color: #51afef;">break</span>
<span class="linenr">10: </span>    <span style="color: #51afef;">case</span> .<span style="color: #c678dd;">failure</span>(<span style="color: #51afef;">let</span> e):
<span class="linenr">11: </span>        <span style="color: #c678dd;">print</span>(e)
<span class="linenr">12: </span>    }
<span class="linenr">13: </span>}, receiveValue: {<span style="color: #c678dd;">print</span>($0)})
<span class="linenr">14: </span>.<span style="color: #c678dd;">store</span>(<span style="color: #51afef;">in</span>: &amp;<span style="color: #51afef;">set</span>)
<span class="linenr">15: </span>pst.<span style="color: #c678dd;">send</span>(<span style="color: #98be65;">"123"</span>)
<span class="linenr">16: </span>
</pre>
</div>

<pre class="example">
123
</pre>

<p>
在這個例子中, 我們完成了一個簡單的 Combine 運作.<br />
</p>
<ol class="org-ol">
<li>我們使用 sink, 取得分別可以應對收到結束與收到元素的執行閉包設定方式, 在這裡我習慣把這件事稱為 執行綁定.<br /></li>
<li>透過 recevieCompletion 的設定, 我們可以用 Promise 的方式, 注入對應成功或失敗的方式.<br /></li>
</ol>
</div>
</li>

<li><a id="org625a952"></a>assign<br />
<div class="outline-text-4" id="text-9-2-2">
<p>
sink 和 assign 兩種訂閱者都向其發布者請求無限數量的元素。想要控制接收元素的比率，請透過實現 Subscriber 協議來創建自己的訂閱者。<br />
如要更改發布者的輸出類型，請添加一個 map(_:) 運算符，其閉包將返回不同的類型。在這種情況下，你可以將通知的對象獲取為一個 UITextFiled，然後獲取其 text。<br />
在發布者產生所需的類型後，將 sink(receiveCompletion:receiveValue:) 替換為 assign(to:on:)。下面的範例獲取從發布者鏈接收到的字串，並將其分配給自定義的 ViewModel 對象的 fillterString ：<br />
assign: 將元素直接付與到 Object 的屬性.<br />
</p>

<p>
沒錯, 只能是 Object, 不能是 Struct/enum, 也不能是 static<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #51afef;">import</span> Combine
<span class="linenr"> 2: </span>
<span class="linenr"> 3: </span><span style="color: #51afef;">class</span> <span style="color: #c678dd;">OBJECT</span> {
<span class="linenr"> 4: </span>    <span style="color: #51afef;">static</span> <span style="color: #51afef;">let</span> shared = <span style="color: #c678dd;">OBJECT</span>()
<span class="linenr"> 5: </span>    <span style="color: #51afef;">private</span> <span style="color: #51afef;">init</span>() {}
<span class="linenr"> 6: </span>    <span style="color: #51afef;">var</span> str:<span style="color: #c678dd;">String</span> = <span style="color: #98be65;">""</span>
<span class="linenr"> 7: </span>}
<span class="linenr"> 8: </span>
<span class="linenr"> 9: </span><span style="color: #51afef;">var</span> <span style="color: #51afef;">set</span> = <span style="color: #c678dd;">Set</span>&lt;AnyCancellable&gt;()
<span class="linenr">10: </span><span style="color: #51afef;">let</span> pst = PassthroughSubject&lt;<span style="color: #c678dd;">String</span>, <span style="color: #c678dd;">Never</span>&gt;()
<span class="linenr">11: </span>
<span class="linenr">12: </span>pst
<span class="linenr">13: </span>  .<span style="color: #c678dd;">assign</span>(to: \.<span style="color: #dcaeea;">str</span>, on: OBJECT.<span style="color: #c678dd;">shared</span>)
<span class="linenr">14: </span>  .<span style="color: #c678dd;">store</span>(<span style="color: #51afef;">in</span>: &amp;<span style="color: #51afef;">set</span>)
<span class="linenr">15: </span>pst.<span style="color: #c678dd;">send</span>(<span style="color: #98be65;">"123"</span>)
<span class="linenr">16: </span>
</pre>
</div>
</div>
</li>

<li><a id="org9a657a1"></a>Subject<br />
<div class="outline-text-4" id="text-9-2-3">
<p>
有些時候我們想隨時在 Publisher 插入值來通知訂閱者，在 Combine 中也提供了一個 Subject 類型來實現。Subject 通常是一個中間代理，即可以作為 Publisher，也可以作為 Observer。Subject要求實現一個send方法，允許向combine鏈條發送值。<br />
Combine有兩個內置的Subject類型 CurrentValueSubject和PassthroughSubject<br />
CurrentValueSubject 的功能很簡單，就是包含一個初始值，並且會在每次值變化的時候發送一個消息，這個值會被保存，可以很方便的用來替代 Property Observer。<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #51afef;">import</span> Combine
<span class="linenr"> 2: </span>
<span class="linenr"> 3: </span><span style="color: #5B6268;">// </span><span style="color: #5B6268;">Before</span>
<span class="linenr"> 4: </span><span style="color: #51afef;">class</span> <span style="color: #c678dd;">ContentManager</span> {
<span class="linenr"> 5: </span>    <span style="color: #51afef;">var</span> content: [<span style="color: #c678dd;">String</span>] {
<span class="linenr"> 6: </span>        <span style="color: #51afef;">didSet</span> {
<span class="linenr"> 7: </span>            delegate?.<span style="color: #c678dd;">contentDidChange</span>(content)
<span class="linenr"> 8: </span>        }
<span class="linenr"> 9: </span>    }
<span class="linenr">10: </span>
<span class="linenr">11: </span>    <span style="color: #51afef;">func</span> <span style="color: #c678dd;">changeContent</span>() {
<span class="linenr">12: </span>        content = [<span style="color: #98be65;">"hello"</span>, <span style="color: #98be65;">"world"</span>]
<span class="linenr">13: </span>    }
<span class="linenr">14: </span>}
<span class="linenr">15: </span>
<span class="linenr">16: </span><span style="color: #5B6268;">// </span><span style="color: #5B6268;">After</span>
<span class="linenr">17: </span><span style="color: #51afef;">class</span> <span style="color: #c678dd;">RxContentController</span> {
<span class="linenr">18: </span>    <span style="color: #51afef;">var</span> content = CurrentValueSubject&lt;[<span style="color: #c678dd;">String</span>], <span style="color: #c678dd;">NSError</span>&gt;([])
<span class="linenr">19: </span>
<span class="linenr">20: </span>    <span style="color: #51afef;">func</span> <span style="color: #c678dd;">changeContent</span>() {
<span class="linenr">21: </span>        content.<span style="color: #c678dd;">value</span> = [<span style="color: #98be65;">"hello"</span>, <span style="color: #98be65;">"world"</span>]
<span class="linenr">22: </span>    }
<span class="linenr">23: </span>}
</pre>
</div>
</div>
</li>
<li><a id="org0785dda"></a>使用操作符自定義發布者<sup><a id="fnr.17.100" class="footref" href="#fn.17">17</a></sup><br />
<div class="outline-text-4" id="text-9-2-4">
<p>
你可以使用執行某些行為的運算符來擴展 Publisher 實例，否則這些操作需要手動進行編碼。你可以使用以下三個方式來使運算符改善此事件處理鏈：<br />
</p>
<ul class="org-ul">
<li>可以使用 filter(_:) 運算符來忽略特定長度下的輸入或是拒絕非字母數字的字，而不是使用在 text filed 中輸入任何內容時更新 ViewModel。<br /></li>
<li>如果過濾運算很昂貴（例如：查詢大型數據庫），則可能要等待用戶停止輸入。為此，我們可以使用 debounce(for:scheduler:options:) 運算符可以設置發布者發出事件之前必須經過的最短時間。RunLoop 類為指定以秒或毫秒為單位的延遲時間提供了方便。<br /></li>
<li>如果結果更新了 UI，則可以透過調用 receive(on:options:) 方法 callback 回主線程。透過將 RunLoop 類提供的 Scheduler 實例指定為第一個參數，可以告訴 Combine 在主運算循環上調用你的訂閱者。<br /></li>
</ul>
<p>
結果發布者宣告如下：<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span><span style="color: #51afef;">let</span> sub = <span style="color: #c678dd;">NotificationCenter</span>.<span style="color: #51afef;">default</span>
<span class="linenr">2: </span>  .<span style="color: #c678dd;">publisher</span>(<span style="color: #51afef;">for</span>: UITextField.<span style="color: #c678dd;">textDidChangeNotification</span>, object: filterField)
<span class="linenr">3: </span>  .<span style="color: #c678dd;">map</span>( { ($0.<span style="color: #c678dd;">object</span> <span style="color: #51afef;">as</span>! UITextField).<span style="color: #c678dd;">text</span>!) })
<span class="linenr">4: </span>  .<span style="color: #c678dd;">filter</span>( {$0.<span style="color: #c678dd;">unicodeScalars</span>.<span style="color: #c678dd;">allStatisfy</span>({<span style="color: #c678dd;">CharacterSet</span>.<span style="color: #c678dd;">alphanumerics</span>.<span style="color: #c678dd;">contains</span>($0)})} )
<span class="linenr">5: </span>  .<span style="color: #c678dd;">debounce</span>(<span style="color: #51afef;">for</span>: .<span style="color: #c678dd;">milliseconds</span>(<span style="color: #da8548; font-weight: bold;">500</span>), scheduler: <span style="color: #c678dd;">RunLoop</span>.<span style="color: #c678dd;">main</span>)
<span class="linenr">6: </span>  .<span style="color: #c678dd;">receive</span>(on: <span style="color: #c678dd;">RunLoop</span>.<span style="color: #c678dd;">main</span>)
<span class="linenr">7: </span>  .<span style="color: #c678dd;">assign</span>(to: \MyViewModel.<span style="color: #dcaeea;">filterString</span>, on: myViewModel)
</pre>
</div>
</div>
</li>
<li><a id="orge1909d8"></a>back pressure<br />
<div class="outline-text-4" id="text-9-2-5">
<p>
透過發送信號通知訂閱者準備接收元素來控制流量的概念稱之為背壓（back pressure）<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #51afef;">import</span> SwiftUI
<span class="linenr"> 2: </span><span style="color: #51afef;">import</span> Combine
<span class="linenr"> 3: </span><span style="color: #5B6268;">// </span><span style="color: #5B6268;">Publisher: Uses a timer to emit the date once per second</span>
<span class="linenr"> 4: </span><span style="color: #51afef;">let</span> timerPub = <span style="color: #c678dd;">Timer</span>.<span style="color: #c678dd;">publish</span>(every: <span style="color: #da8548; font-weight: bold;">1</span>, on: .<span style="color: #c678dd;">main</span>, <span style="color: #51afef;">in</span>: .<span style="color: #51afef;">default</span>)
<span class="linenr"> 5: </span><span style="color: #5B6268;">//</span><span style="color: #5B6268;">Subscriber: Waits 5 second after subscription, then request a maximum of 3 values.</span>
<span class="linenr"> 6: </span><span style="color: #51afef;">class</span> <span style="color: #c678dd;">MySubscriber</span>: Subscriber {
<span class="linenr"> 7: </span>    <span style="color: #51afef;">typealias</span> <span style="color: #c678dd;">Input</span> = <span style="color: #c678dd;">Date</span>
<span class="linenr"> 8: </span>    <span style="color: #51afef;">typealias</span> <span style="color: #c678dd;">Failure</span> = <span style="color: #c678dd;">Never</span>
<span class="linenr"> 9: </span>    <span style="color: #51afef;">var</span> subscription: Subscription?
<span class="linenr">10: </span>
<span class="linenr">11: </span>    <span style="color: #51afef;">func</span> <span style="color: #c678dd;">receive</span>(subscription: Subscription) {
<span class="linenr">12: </span>        <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"published\t\treceived"</span>)
<span class="linenr">13: </span>        <span style="color: #51afef;">self</span>.<span style="color: #dcaeea;">subscription</span> = subscription
<span class="linenr">14: </span>        DispatchQueue.<span style="color: #c678dd;">main</span>.<span style="color: #c678dd;">asyncAfter</span>(deadline: .<span style="color: #c678dd;">now</span>() + <span style="color: #da8548; font-weight: bold;">3</span>) {
<span class="linenr">15: </span>            subscription.<span style="color: #c678dd;">request</span>(.<span style="color: #c678dd;">max</span>(<span style="color: #da8548; font-weight: bold;">2</span>))
<span class="linenr">16: </span>        }
<span class="linenr">17: </span>    }
<span class="linenr">18: </span>    <span style="color: #51afef;">func</span> <span style="color: #c678dd;">receive</span>(_ input: <span style="color: #c678dd;">Date</span>) -&gt; Subscribers.<span style="color: #dcaeea;">Demand</span> {
<span class="linenr">19: </span>        <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"\(</span>input<span style="color: #98be65;">)\t\t\(</span><span style="color: #c678dd;">Date</span>()<span style="color: #98be65;">)"</span>)
<span class="linenr">20: </span>        <span style="color: #51afef;">return</span> Subscribers.<span style="color: #dcaeea;">Demand</span>.<span style="color: #51afef;">none</span>
<span class="linenr">21: </span>    }
<span class="linenr">22: </span>    <span style="color: #51afef;">func</span> <span style="color: #c678dd;">receive</span>(completion: Subscribers.<span style="color: #dcaeea;">Completion</span>&lt;<span style="color: #c678dd;">Never</span>&gt;) {
<span class="linenr">23: </span>        <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"--done--"</span>)
<span class="linenr">24: </span>    }
<span class="linenr">25: </span>}
<span class="linenr">26: </span><span style="color: #5B6268;">//</span><span style="color: #5B6268;">Subscribe to timberPub.</span>
<span class="linenr">27: </span><span style="color: #51afef;">let</span> mySub = <span style="color: #c678dd;">MySubscriber</span>()
<span class="linenr">28: </span><span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"Subscribing at \(</span><span style="color: #c678dd;">Date</span>()<span style="color: #98be65;">)"</span>)
<span class="linenr">29: </span>timerPub.<span style="color: #c678dd;">subscribe</span>(mySub)
</pre>
</div>

<pre class="example">
Subscribing at 2021-04-25 12:36:25 +0000
published		received
</pre>
</div>
</li>
<li><a id="orgb793a70"></a>需要時取消發布<sup><a id="fnr.17.100" class="footref" href="#fn.17">17</a></sup><br />
<div class="outline-text-4" id="text-9-2-6">
<p>
發布者持續發出元素，直到其正常完成或失敗為止。如果你不想再訂閱發布者，則可以取消訂閱。由 sink 和 assign 所創建的訂閱者都實現的 Cancellable 協議，該協議提供了 cancel() 方法：<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span>sub.<span style="color: #c678dd;">cancel</span>()
</pre>
</div>
<p>
如果創建自定義 Subscriber，則發布者在首次訂閱時會發送一個 Subscription 對象。存儲此訂閱，然後再要取消發布的時候調用其 cancel() 方法。當創建自定義訂閱者時，你應該要實現 Cancellable 協議，並讓你的 cancel() 實現將調用轉發給存儲的訂閱。<br />
</p>
</div>
</li>
</ol>
</div>

<div id="outline-container-orgb441cfc" class="outline-3">
<h3 id="orgb441cfc"><span class="section-number-3">9.3</span> Subject</h3>
<div class="outline-text-3" id="text-9-3">
<p>
Subject 是一種特殊的 Publisher, protocol Subject 是 protocol Publisher 的繼承類:<br />
特別注意, 不同於 Publisher, Subject 透過 AnyObjcet, 限制了 Reference type.<br />
</p>

<p>
如果 一個事件流要用特別的方式介入, Suject 就是這個 inject 的載體, 也因此可以快速的將原本的非 Combine 的程式改寫套用. 若是熟係設計模式, Subject 以實作觀察者模式來理解會比較直接.<br />
</p>

<p>
Subject 在 Combine 有兩個實作類別:<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span><span style="color: #51afef;">final</span> <span style="color: #51afef;">class</span> <span style="color: #c678dd;">PassthroughSubject</span>&lt;<span style="color: #c678dd;">Output</span>, <span style="color: #c678dd;">Failure</span>&gt; <span style="color: #51afef;">where</span> <span style="color: #c678dd;">Failure</span> : <span style="color: #c678dd;">Error</span>
<span class="linenr">2: </span><span style="color: #51afef;">final</span> <span style="color: #51afef;">class</span> <span style="color: #c678dd;">CurrentValueSubject</span>&lt;<span style="color: #c678dd;">Output</span>, <span style="color: #c678dd;">Failure</span>&gt; <span style="color: #51afef;">where</span> <span style="color: #c678dd;">Failure</span> : <span style="color: #c678dd;">Error</span>
</pre>
</div>

<pre class="example">
Unlike CurrentValueSubject, a PassthroughSubject doesn’t have an initial value or a buffer of the most recently-published element.
PassthroughSubject 和 CurrentValueSubject 幾乎一樣，只是沒有初始值，也不會保存任何值。
</pre>
<p>
Subject也可以理解成特殊的Publisher，不同于publisher，subject可以用.send()来想subscriber发送values。先介绍两种常用的subjects：<br />
</p>
<ul class="org-ul">
<li>PassthroughSubject - 可以持续向subscriber传输值或者结束事件，可以没有初始值<br /></li>
<li>CurrentValueSubject - 初始化时必须有初始值，可以通过subject.value来查看当前publisher发送的值<br /></li>
</ul>
</div>

<ol class="org-ol">
<li><a id="orgf48ffe1"></a>CurrentValueSubject<br />
<div class="outline-text-4" id="text-9-3-1">
<p>
CurrentValueSubject 相對於 PassthroughSubject, 是沒有.send(), 取而代之的是一個真真確確的 value, 就像是 didSet 的方式, 就像 if then 的方式.<br />
</p>

<p>
與 PassthroughSubject 不同，CurrentValueSubject 維護最近發布元素的緩衝區。在 CurrentValueSubject 上調用 send(_:) 也會更新當前值，使其等效於直接更新該值。<br />
</p>
</div>
</li>
<li><a id="org73cfbfd"></a>PassthroughSubject<br />
<div class="outline-text-4" id="text-9-3-2">
<p>
PassthroughSubject 是一個相近於 NotificationCenter 的模式, 透過 .send() 可以控制結束或是發送 Value, 很容易入門且濫用.<br />
</p>

<p>
作為 Subject 的具體實現，PassthroughSubject 提供了一種便利方式來使現有命令式程式碼適應 Combine 模型。<br />
</p>

<p>
與 CurrentValueSubject 不同，PassthroughSubject 沒有初始值或最新發布元素元素的緩衝區。如果沒有訂閱者，或當前需求為零，則 PassthrougnSubject 會丟棄值。<br />
</p>
</div>
</li>
</ol>
</div>

<div id="outline-container-org8e634d9" class="outline-3">
<h3 id="org8e634d9"><span class="section-number-3">9.4</span> Operator</h3>
<div class="outline-text-3" id="text-9-4">
<p>
就像是物件導向的不同部分有不同的變形一樣，Operator 在 Combine 中扮演了舉足輕重的角色，沒有了他，Combine 只是 if then。<br />
</p>

<p>
Operator 可以區分為幾大類<br />
</p>
<ol class="org-ol">
<li>轉換類型 map, scan, flapMap<br /></li>
<li>一般篩選類型 compactMap, filter, removeDuplicates<br /></li>
<li>整併類型 reduce, collect<br /></li>
<li>運算類型 count, comparison<br /></li>
<li>符合篩選類型 contains, allSatisfy<br /></li>
<li>序列篩選類型 first, last, drop, firstWhere,<br /></li>
<li>上流整合類型 zip, merge, combineLatest<br /></li>
<li>型別銜接類型 eraseToAnyPublisher, switchToLatest<br /></li>
<li>失敗處理類型 catch, retry, mapError<br /></li>
<li>時間控制類型 debounce, throttle, delay, timeout<br /></li>
<li>格式解析類型 Encode, decode<br /></li>
<li>Debugging類型 print, breakpoint, handleEvents<br /></li>
</ol>
</div>
<ol class="org-ol">
<li><a id="orgf89dc15"></a>collect()<br />
<div class="outline-text-4" id="text-9-4-1">
<p>
collect就是把一个一个输出的value全都放在array里，然后等publisher结束后，输出这个array:<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span><span style="color: #51afef;">import</span> Combine
<span class="linenr">2: </span><span style="color: #51afef;">private</span> <span style="color: #51afef;">var</span> cancellables = <span style="color: #c678dd;">Set</span>&lt;AnyCancellable&gt;()
<span class="linenr">3: </span>
<span class="linenr">4: </span>[<span style="color: #98be65;">"A"</span>, <span style="color: #98be65;">"B"</span>, <span style="color: #98be65;">"C"</span>, <span style="color: #98be65;">"D"</span>, <span style="color: #98be65;">"E"</span>].<span style="color: #c678dd;">publisher</span>
<span class="linenr">5: </span>  .<span style="color: #c678dd;">collect</span>()
<span class="linenr">6: </span>  .<span style="color: #c678dd;">sink</span>(receiveCompletion: { <span style="color: #c678dd;">print</span>($0) },
<span class="linenr">7: </span>        receiveValue: { <span style="color: #c678dd;">print</span>($0) })
<span class="linenr">8: </span>    .<span style="color: #c678dd;">store</span>(<span style="color: #51afef;">in</span>: &amp;cancellables)
</pre>
</div>

<pre class="example">
["A", "B", "C", "D", "E"]
finished
</pre>

<p>
通常我们会限制collect需要收集values的个数，不然无限等着可能浪费内存：<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span><span style="color: #51afef;">import</span> Combine
<span class="linenr">2: </span><span style="color: #51afef;">private</span> <span style="color: #51afef;">var</span> cancellables = <span style="color: #c678dd;">Set</span>&lt;AnyCancellable&gt;()
<span class="linenr">3: </span>
<span class="linenr">4: </span>[<span style="color: #98be65;">"A"</span>, <span style="color: #98be65;">"B"</span>, <span style="color: #98be65;">"C"</span>, <span style="color: #98be65;">"D"</span>, <span style="color: #98be65;">"E"</span>].<span style="color: #c678dd;">publisher</span>
<span class="linenr">5: </span>  .<span style="color: #c678dd;">collect</span>(<span style="color: #da8548; font-weight: bold;">3</span>)
<span class="linenr">6: </span>  .<span style="color: #c678dd;">sink</span>(receiveCompletion: { <span style="color: #c678dd;">print</span>($0) },
<span class="linenr">7: </span>        receiveValue: { <span style="color: #c678dd;">print</span>($0) })
<span class="linenr">8: </span>    .<span style="color: #c678dd;">store</span>(<span style="color: #51afef;">in</span>: &amp;cancellables)
<span class="linenr">9: </span>
</pre>
</div>

<pre class="example">
["A", "B", "C"]
["D", "E"]
finished
</pre>
</div>
</li>

<li><a id="orgf473e16"></a>map:<br />
<div class="outline-text-4" id="text-9-4-2">
<p>
轉換上游元素為另一元素<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span><span style="color: #51afef;">import</span> Combine
<span class="linenr">2: </span><span style="color: #51afef;">import</span> Foundation
<span class="linenr">3: </span>
<span class="linenr">4: </span><span style="color: #51afef;">private</span> <span style="color: #51afef;">var</span> cancellable: AnyCancellable?
<span class="linenr">5: </span>
<span class="linenr">6: </span>cancellable = [<span style="color: #da8548; font-weight: bold;">1</span>, <span style="color: #da8548; font-weight: bold;">2</span>, <span style="color: #da8548; font-weight: bold;">3</span>].<span style="color: #c678dd;">publisher</span>
<span class="linenr">7: </span>.<span style="color: #c678dd;">map</span>{ int <span style="color: #51afef;">in</span> <span style="color: #98be65;">"Transfer to Number: \(</span>int<span style="color: #98be65;">)"</span> }
<span class="linenr">8: </span>.<span style="color: #c678dd;">sink</span>(receiveValue: { int <span style="color: #51afef;">in</span>
<span class="linenr">9: </span>      <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"Received: \(</span>int<span style="color: #98be65;">)"</span>)})
</pre>
</div>

<pre class="example">
Received: Transfer to Number: 1
Received: Transfer to Number: 2
Received: Transfer to Number: 3
</pre>
</div>
</li>
<li><a id="orgdb30968"></a>map key path<br />
<div class="outline-text-4" id="text-9-4-3">
<p>
如果输出的value有多个属性，那么也可以用map和keypath来拆分：<br />
</p>

<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span><span style="color: #51afef;">import</span> Combine
<span class="linenr">2: </span>
<span class="linenr">3: </span><span style="color: #51afef;">private</span> <span style="color: #51afef;">var</span> cancellables = <span style="color: #c678dd;">Set</span>&lt;AnyCancellable&gt;()
<span class="linenr">4: </span>
<span class="linenr">5: </span>[(x: <span style="color: #da8548; font-weight: bold;">2</span>, y: <span style="color: #da8548; font-weight: bold;">3</span>), (x: <span style="color: #da8548; font-weight: bold;">1</span>, y: <span style="color: #da8548; font-weight: bold;">5</span>), (x: <span style="color: #da8548; font-weight: bold;">2</span>, y: <span style="color: #da8548; font-weight: bold;">6</span>)].<span style="color: #c678dd;">publisher</span>
<span class="linenr">6: </span>    .<span style="color: #c678dd;">map</span>(\.<span style="color: #c678dd;">x</span>, \.<span style="color: #c678dd;">y</span>)
<span class="linenr">7: </span>    .<span style="color: #c678dd;">sink</span>(receiveCompletion: { <span style="color: #c678dd;">print</span>($0) },
<span class="linenr">8: </span>        receiveValue: { x, y <span style="color: #51afef;">in</span> <span style="color: #c678dd;">print</span>(x + y) })
<span class="linenr">9: </span>    .<span style="color: #c678dd;">store</span>(<span style="color: #51afef;">in</span>: &amp;cancellables)
</pre>
</div>

<pre class="example">
5
6
8
finished
</pre>


<p>
The result of this chain of calls is a Cancellable, which we can use to cancel processing if required (useful for longer-running chains). We’ll store this (and all the others that we will create later on) into a Set&lt;AnyCancellable&gt;, so we can clean up upon deinit.<br />
</p>
</div>
</li>
<li><a id="org2db80ff"></a>tryMap<br />
<div class="outline-text-4" id="text-9-4-4">
<p>
tryMap就是map的closure里有可能throw，throw的话就筛选掉这个value：<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #51afef;">import</span> Combine
<span class="linenr"> 2: </span><span style="color: #51afef;">import</span> Foundation
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span><span style="color: #51afef;">private</span> <span style="color: #51afef;">var</span> cancellables = <span style="color: #c678dd;">Set</span>&lt;AnyCancellable&gt;()
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span><span style="color: #c678dd;">Just</span>(<span style="color: #98be65;">"/fake"</span>)
<span class="linenr"> 7: </span>    .<span style="color: #c678dd;">tryMap</span> { <span style="color: #51afef;">try</span> <span style="color: #c678dd;">FileManager</span>.<span style="color: #51afef;">default</span>.<span style="color: #c678dd;">contentsOfDirectory</span>(atPath: $0) }
<span class="linenr"> 8: </span>    .<span style="color: #c678dd;">sink</span>(receiveCompletion: { <span style="color: #c678dd;">print</span>($0) },
<span class="linenr"> 9: </span>        receiveValue: { <span style="color: #c678dd;">print</span>($0) })
<span class="linenr">10: </span>    .<span style="color: #c678dd;">store</span>(<span style="color: #51afef;">in</span>: &amp;cancellables)
</pre>
</div>

<pre class="example">
failure(Error Domain=NSCocoaErrorDomain Code=260 "The folder “fake” doesn’t exist." UserInfo={NSFilePath=/fake, NSUserStringVariant=(
    Folder
), NSUnderlyingError=0x7fb53bfdf7c0 {Error Domain=NSOSStatusErrorDomain Code=-43 "fnfErr: File not found"}})
</pre>
</div>
</li>
<li><a id="org6b24593"></a>flatMap<br />
<div class="outline-text-4" id="text-9-4-5">
<p>
如果你有一个publisher发送的value的某些属性也是publisher， 那sink只会receive外面这个publisher发出的value，属性publisher发出的value要是也想接收，那你就可以用flatMap<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #51afef;">import</span> Combine
<span class="linenr"> 2: </span><span style="color: #51afef;">private</span> <span style="color: #51afef;">var</span> cancellables = <span style="color: #c678dd;">Set</span>&lt;AnyCancellable&gt;()
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">Person</span> {
<span class="linenr"> 5: </span>    <span style="color: #51afef;">let</span> name : <span style="color: #c678dd;">String</span>
<span class="linenr"> 6: </span>    <span style="color: #51afef;">var</span> age: CurrentValueSubject&lt;<span style="color: #c678dd;">Int</span>, <span style="color: #c678dd;">Never</span>&gt;
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span>    <span style="color: #51afef;">init</span>(name: <span style="color: #c678dd;">String</span>, age: <span style="color: #c678dd;">Int</span>) {
<span class="linenr"> 9: </span>        <span style="color: #51afef;">self</span>.<span style="color: #c678dd;">name</span> = name
<span class="linenr">10: </span>        <span style="color: #51afef;">self</span>.<span style="color: #c678dd;">age</span> = <span style="color: #c678dd;">CurrentValueSubject</span>(age)
<span class="linenr">11: </span>    }
<span class="linenr">12: </span>}
<span class="linenr">13: </span>
<span class="linenr">14: </span><span style="color: #51afef;">var</span> me = <span style="color: #c678dd;">Person</span>(name: <span style="color: #98be65;">"Joshua"</span>, age: <span style="color: #da8548; font-weight: bold;">18</span>)
<span class="linenr">15: </span><span style="color: #51afef;">var</span> you = <span style="color: #c678dd;">Person</span>(name: <span style="color: #98be65;">"Dog"</span>, age: <span style="color: #da8548; font-weight: bold;">28</span>)
<span class="linenr">16: </span>
<span class="linenr">17: </span><span style="color: #51afef;">let</span> people = PassthroughSubject&lt;Person, <span style="color: #c678dd;">Never</span>&gt;()
<span class="linenr">18: </span>people
<span class="linenr">19: </span>  .<span style="color: #c678dd;">flatMap</span>{ $0.<span style="color: #c678dd;">age</span> }
<span class="linenr">20: </span>  .<span style="color: #c678dd;">sink</span>(receiveCompletion: { _ <span style="color: #51afef;">in</span>
<span class="linenr">21: </span>            <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"people completed"</span>)
<span class="linenr">22: </span>        }, receiveValue: { val <span style="color: #51afef;">in</span>
<span class="linenr">23: </span>               <span style="color: #c678dd;">print</span>(val)
<span class="linenr">24: </span>           })
<span class="linenr">25: </span>  .<span style="color: #c678dd;">store</span>(<span style="color: #51afef;">in</span>: &amp;cancellables)
<span class="linenr">26: </span>
<span class="linenr">27: </span>people.<span style="color: #c678dd;">send</span>(me)
<span class="linenr">28: </span>people.<span style="color: #c678dd;">send</span>(you)
<span class="linenr">29: </span>me.<span style="color: #c678dd;">age</span>.<span style="color: #c678dd;">value</span> = <span style="color: #da8548; font-weight: bold;">19</span>
<span class="linenr">30: </span>you.<span style="color: #c678dd;">age</span>.<span style="color: #c678dd;">value</span> = <span style="color: #da8548; font-weight: bold;">30</span>
<span class="linenr">31: </span>
</pre>
</div>

<pre class="example">
18
28
19
30
</pre>

<p>
好好看一下这个例子，我觉得大家应该就都理解了吧，这属于比较复杂的一个operator了。flatMap还可以限制订阅publisher的个数：<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #51afef;">import</span> Combine
<span class="linenr"> 2: </span><span style="color: #51afef;">private</span> <span style="color: #51afef;">var</span> cancellables = <span style="color: #c678dd;">Set</span>&lt;AnyCancellable&gt;()
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">Person</span> {
<span class="linenr"> 5: </span>    <span style="color: #51afef;">let</span> name : <span style="color: #c678dd;">String</span>
<span class="linenr"> 6: </span>    <span style="color: #51afef;">var</span> age: CurrentValueSubject&lt;<span style="color: #c678dd;">Int</span>, <span style="color: #c678dd;">Never</span>&gt;
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span>    <span style="color: #51afef;">init</span>(name: <span style="color: #c678dd;">String</span>, age: <span style="color: #c678dd;">Int</span>) {
<span class="linenr"> 9: </span>        <span style="color: #51afef;">self</span>.<span style="color: #c678dd;">name</span> = name
<span class="linenr">10: </span>        <span style="color: #51afef;">self</span>.<span style="color: #c678dd;">age</span> = <span style="color: #c678dd;">CurrentValueSubject</span>(age)
<span class="linenr">11: </span>    }
<span class="linenr">12: </span>}
<span class="linenr">13: </span>
<span class="linenr">14: </span><span style="color: #51afef;">var</span> me = <span style="color: #c678dd;">Person</span>(name: <span style="color: #98be65;">"Joshua"</span>, age: <span style="color: #da8548; font-weight: bold;">18</span>)
<span class="linenr">15: </span><span style="color: #51afef;">var</span> you = <span style="color: #c678dd;">Person</span>(name: <span style="color: #98be65;">"Dog"</span>, age: <span style="color: #da8548; font-weight: bold;">28</span>)
<span class="linenr">16: </span><span style="color: #51afef;">var</span> she = <span style="color: #c678dd;">Person</span>(name: <span style="color: #98be65;">"SHE"</span>, age: <span style="color: #da8548; font-weight: bold;">16</span>)
<span class="linenr">17: </span>
<span class="linenr">18: </span><span style="color: #51afef;">let</span> people = PassthroughSubject&lt;Person, <span style="color: #c678dd;">Never</span>&gt;()
<span class="linenr">19: </span>people
<span class="linenr">20: </span>    .<span style="color: #c678dd;">flatMap</span>(maxPublishers: .<span style="color: #c678dd;">max</span>(<span style="color: #da8548; font-weight: bold;">1</span>)) { $0.<span style="color: #c678dd;">age</span> }
<span class="linenr">21: </span>    .<span style="color: #c678dd;">sink</span>(receiveCompletion: { _ <span style="color: #51afef;">in</span>
<span class="linenr">22: </span>        <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"people completed"</span>)
<span class="linenr">23: </span>    }, receiveValue: { val <span style="color: #51afef;">in</span>
<span class="linenr">24: </span>        <span style="color: #c678dd;">print</span>(val)
<span class="linenr">25: </span>
<span class="linenr">26: </span>    })
<span class="linenr">27: </span>.<span style="color: #c678dd;">store</span>(<span style="color: #51afef;">in</span>: &amp;cancellables)
<span class="linenr">28: </span>
<span class="linenr">29: </span>people.<span style="color: #c678dd;">send</span>(me)
<span class="linenr">30: </span>people.<span style="color: #c678dd;">send</span>(you)
<span class="linenr">31: </span>people.<span style="color: #c678dd;">send</span>(she)
<span class="linenr">32: </span>me.<span style="color: #c678dd;">age</span>.<span style="color: #c678dd;">value</span> = <span style="color: #da8548; font-weight: bold;">19</span>
<span class="linenr">33: </span>you.<span style="color: #c678dd;">age</span>.<span style="color: #c678dd;">value</span> = <span style="color: #da8548; font-weight: bold;">30</span>
<span class="linenr">34: </span>she.<span style="color: #c678dd;">age</span>.<span style="color: #c678dd;">value</span> = <span style="color: #da8548; font-weight: bold;">17</span>
<span class="linenr">35: </span>
<span class="linenr">36: </span><span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#36755;&#20986;&#21644;&#20043;&#21069;&#37027;&#20010;&#19968;&#26679;</span>
</pre>
</div>

<pre class="example">
18
19
</pre>
</div>
</li>
<li><a id="orgecd96da"></a>replaceNil(with:)<br />
<div class="outline-text-4" id="text-9-4-6">
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span><span style="color: #51afef;">import</span> Combine
<span class="linenr">2: </span><span style="color: #51afef;">private</span> <span style="color: #51afef;">var</span> cancellables = <span style="color: #c678dd;">Set</span>&lt;AnyCancellable&gt;()
<span class="linenr">3: </span>[<span style="color: #98be65;">"A"</span>, <span style="color: #a9a1e1;">nil</span>, <span style="color: #98be65;">"C"</span>].<span style="color: #c678dd;">publisher</span>
<span class="linenr">4: </span>.<span style="color: #c678dd;">replaceNil</span>(with: <span style="color: #98be65;">"null"</span>)
<span class="linenr">5: </span>.<span style="color: #c678dd;">map</span> { $0! }
<span class="linenr">6: </span>.<span style="color: #c678dd;">sink</span>(receiveCompletion: { <span style="color: #c678dd;">print</span>($0) },
<span class="linenr">7: </span>    receiveValue: { <span style="color: #c678dd;">print</span>($0) })
<span class="linenr">8: </span>.<span style="color: #c678dd;">store</span>(<span style="color: #51afef;">in</span>: &amp;cancellables)
</pre>
</div>

<pre class="example">
A
null
C
finished
</pre>
</div>
</li>
<li><a id="orgeb70fae"></a>replaceEnpty(with:)<br />
<div class="outline-text-4" id="text-9-4-7">
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span><span style="color: #51afef;">import</span> Combine
<span class="linenr">2: </span><span style="color: #51afef;">private</span> <span style="color: #51afef;">var</span> cancellables = <span style="color: #c678dd;">Set</span>&lt;AnyCancellable&gt;()
<span class="linenr">3: </span>
<span class="linenr">4: </span><span style="color: #51afef;">let</span> empty = Empty&lt;<span style="color: #c678dd;">String</span>, <span style="color: #c678dd;">Never</span>&gt;()
<span class="linenr">5: </span>empty
<span class="linenr">6: </span>  .<span style="color: #c678dd;">replaceEmpty</span>(with: <span style="color: #98be65;">"Empty"</span>)
<span class="linenr">7: </span>  .<span style="color: #c678dd;">sink</span>(receiveCompletion: { <span style="color: #c678dd;">print</span>($0) },
<span class="linenr">8: </span>        receiveValue: { <span style="color: #c678dd;">print</span>($0) })
<span class="linenr">9: </span>  .<span style="color: #c678dd;">store</span>(<span style="color: #51afef;">in</span>: &amp;cancellables)
</pre>
</div>

<pre class="example">
Empty
finished
</pre>

<p>
这个Empty一般就是用来测试或demo，直接发送.finish<br />
</p>
</div>
</li>
<li><a id="orga2115e5"></a>reduce(0)<br />
<div class="outline-text-4" id="text-9-4-8">
<p>
这个和之前文章中介绍的reduce一样。publisher一定要结束才会输出最后值<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span><span style="color: #51afef;">import</span> Combine
<span class="linenr">2: </span><span style="color: #51afef;">private</span> <span style="color: #51afef;">var</span> cancellables = <span style="color: #c678dd;">Set</span>&lt;AnyCancellable&gt;()
<span class="linenr">3: </span>
<span class="linenr">4: </span>[<span style="color: #da8548; font-weight: bold;">1</span>, <span style="color: #da8548; font-weight: bold;">2</span>, <span style="color: #da8548; font-weight: bold;">3</span>].<span style="color: #c678dd;">publisher</span>
<span class="linenr">5: </span>    .<span style="color: #c678dd;">reduce</span>(<span style="color: #da8548; font-weight: bold;">0</span>, +)
<span class="linenr">6: </span>    .<span style="color: #c678dd;">sink</span>(receiveCompletion: { <span style="color: #c678dd;">print</span>($0) },
<span class="linenr">7: </span>        receiveValue: { <span style="color: #c678dd;">print</span>($0) })
<span class="linenr">8: </span>    .<span style="color: #c678dd;">store</span>(<span style="color: #51afef;">in</span>: &amp;cancellables)
</pre>
</div>

<pre class="example">
6
finished
</pre>
</div>
</li>
<li><a id="org63265f3"></a>scan<br />
<div class="outline-text-4" id="text-9-4-9">
<p>
scan 對每個信號都進行處理類似 map，但是可以取得前一個上路元素。scan和reduce差不多，但是scan不是最后才输出值，每个都会输出<br />
</p>

<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span><span style="color: #51afef;">import</span> Combine
<span class="linenr">2: </span>
<span class="linenr">3: </span><span style="color: #51afef;">let</span> pub = (<span style="color: #da8548; font-weight: bold;">0</span>...<span style="color: #da8548; font-weight: bold;">5</span>)
<span class="linenr">4: </span>  .<span style="color: #c678dd;">publisher</span>
<span class="linenr">5: </span>  .<span style="color: #c678dd;">scan</span>(<span style="color: #da8548; font-weight: bold;">0</span>, { <span style="color: #51afef;">return</span> $0 + $1 })
<span class="linenr">6: </span>  .<span style="color: #c678dd;">sink</span>(receiveValue: { <span style="color: #c678dd;">print</span> (<span style="color: #98be65;">"\(</span>$0<span style="color: #98be65;">)"</span>, terminator: <span style="color: #98be65;">"\n"</span>) })
</pre>
</div>

<pre class="example">
0
1
3
6
10
15
</pre>

<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span><span style="color: #51afef;">import</span> Combine
<span class="linenr">2: </span><span style="color: #51afef;">private</span> <span style="color: #51afef;">var</span> cancellables = <span style="color: #c678dd;">Set</span>&lt;AnyCancellable&gt;()
<span class="linenr">3: </span>[<span style="color: #da8548; font-weight: bold;">1</span>, <span style="color: #da8548; font-weight: bold;">2</span>, <span style="color: #da8548; font-weight: bold;">3</span>].<span style="color: #c678dd;">publisher</span>
<span class="linenr">4: </span>    .<span style="color: #c678dd;">scan</span>(<span style="color: #da8548; font-weight: bold;">0</span>, +)
<span class="linenr">5: </span>    .<span style="color: #c678dd;">sink</span>(receiveCompletion: { <span style="color: #c678dd;">print</span>($0) },
<span class="linenr">6: </span>        receiveValue: { <span style="color: #c678dd;">print</span>($0) })
<span class="linenr">7: </span>    .<span style="color: #c678dd;">store</span>(<span style="color: #51afef;">in</span>: &amp;cancellables)
</pre>
</div>

<pre class="example">
1
3
6
finished
</pre>
</div>
</li>
<li><a id="org78ba3bb"></a>tryScan<br />
<div class="outline-text-4" id="text-9-4-10">
<p>
和上面類似，允許拋出錯誤<br />
</p>
</div>
</li>
<li><a id="orgfb6e5f7"></a>filter<br />
<div class="outline-text-4" id="text-9-4-11">
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span><span style="color: #51afef;">import</span> Combine
<span class="linenr">2: </span><span style="color: #51afef;">private</span> <span style="color: #51afef;">var</span> cancellables = <span style="color: #c678dd;">Set</span>&lt;AnyCancellable&gt;()
<span class="linenr">3: </span>
<span class="linenr">4: </span>[<span style="color: #da8548; font-weight: bold;">1</span>, <span style="color: #da8548; font-weight: bold;">2</span>, <span style="color: #da8548; font-weight: bold;">3</span>].<span style="color: #c678dd;">publisher</span>
<span class="linenr">5: </span>    .<span style="color: #c678dd;">filter</span> { $0 &lt; <span style="color: #da8548; font-weight: bold;">3</span> }
<span class="linenr">6: </span>    .<span style="color: #c678dd;">sink</span>(receiveCompletion: { <span style="color: #c678dd;">print</span>($0) },
<span class="linenr">7: </span>        receiveValue: { <span style="color: #c678dd;">print</span>($0) })
<span class="linenr">8: </span>    .<span style="color: #c678dd;">store</span>(<span style="color: #51afef;">in</span>: &amp;cancellables)
</pre>
</div>

<pre class="example">
1
2
finished
</pre>
</div>
</li>
<li><a id="orgdb9fe13"></a>removeDuplicates()<br />
<div class="outline-text-4" id="text-9-4-12">
<p>
注意这个并不是所有重复的都去掉，只是publisher当前要发出的value和上个发出的一样的才会去掉。要让系统排重，那value一定是Equatable, 不然你就得自定义相等的条件：<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span><span style="color: #51afef;">import</span> Combine
<span class="linenr">2: </span><span style="color: #51afef;">private</span> <span style="color: #51afef;">var</span> cancellables = <span style="color: #c678dd;">Set</span>&lt;AnyCancellable&gt;()
<span class="linenr">3: </span>
<span class="linenr">4: </span>[<span style="color: #da8548; font-weight: bold;">1</span>, <span style="color: #da8548; font-weight: bold;">1</span>, <span style="color: #da8548; font-weight: bold;">2</span>, <span style="color: #da8548; font-weight: bold;">2</span>, <span style="color: #da8548; font-weight: bold;">2</span>, <span style="color: #da8548; font-weight: bold;">3</span>].<span style="color: #c678dd;">publisher</span>
<span class="linenr">5: </span>    .<span style="color: #c678dd;">removeDuplicates</span>()
<span class="linenr">6: </span>    .<span style="color: #c678dd;">sink</span>(receiveCompletion: { <span style="color: #c678dd;">print</span>($0) },
<span class="linenr">7: </span>        receiveValue: { <span style="color: #c678dd;">print</span>($0) })
<span class="linenr">8: </span>    .<span style="color: #c678dd;">store</span>(<span style="color: #51afef;">in</span>: &amp;cancellables)
</pre>
</div>

<pre class="example">
1
2
3
finished
</pre>
</div>
</li>
<li><a id="org5ed7ff5"></a>first() 和 first(where:)<br />
<div class="outline-text-4" id="text-9-4-13">
<p>
接收到第一个值就取消订阅，可以用where加条件<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span><span style="color: #51afef;">import</span> Combine
<span class="linenr">2: </span><span style="color: #51afef;">private</span> <span style="color: #51afef;">var</span> cancellables = <span style="color: #c678dd;">Set</span>&lt;AnyCancellable&gt;()
<span class="linenr">3: </span>[<span style="color: #da8548; font-weight: bold;">1</span>, <span style="color: #da8548; font-weight: bold;">2</span>, <span style="color: #da8548; font-weight: bold;">3</span>].<span style="color: #c678dd;">publisher</span>
<span class="linenr">4: </span>    .<span style="color: #c678dd;">first</span> { $0 &gt; <span style="color: #da8548; font-weight: bold;">1</span> }
<span class="linenr">5: </span>    .<span style="color: #c678dd;">sink</span>(receiveCompletion: { <span style="color: #c678dd;">print</span>($0) },
<span class="linenr">6: </span>        receiveValue: { <span style="color: #c678dd;">print</span>($0) })
<span class="linenr">7: </span>    .<span style="color: #c678dd;">store</span>(<span style="color: #51afef;">in</span>: &amp;cancellables)
<span class="linenr">8: </span>
</pre>
</div>

<pre class="example">
2
finished
</pre>
</div>
</li>
<li><a id="orge92b7c1"></a>last()和last(where:)<br />
<div class="outline-text-4" id="text-9-4-14">
<p>
跟上一个一样，唯一区别是publisher必须结束才会输出<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span><span style="color: #51afef;">import</span> Combine
<span class="linenr">2: </span><span style="color: #51afef;">private</span> <span style="color: #51afef;">var</span> cancellables = <span style="color: #c678dd;">Set</span>&lt;AnyCancellable&gt;()
<span class="linenr">3: </span>[<span style="color: #da8548; font-weight: bold;">1</span>, <span style="color: #da8548; font-weight: bold;">2</span>, <span style="color: #da8548; font-weight: bold;">3</span>].<span style="color: #c678dd;">publisher</span>
<span class="linenr">4: </span>    .<span style="color: #c678dd;">last</span> { $0 &gt; <span style="color: #da8548; font-weight: bold;">1</span> }
<span class="linenr">5: </span>    .<span style="color: #c678dd;">sink</span>(receiveCompletion: { <span style="color: #c678dd;">print</span>($0) },
<span class="linenr">6: </span>        receiveValue: { <span style="color: #c678dd;">print</span>($0) })
<span class="linenr">7: </span>    .<span style="color: #c678dd;">store</span>(<span style="color: #51afef;">in</span>: &amp;cancellables)
<span class="linenr">8: </span>
</pre>
</div>

<pre class="example">
3
finished
</pre>
</div>
</li>
<li><a id="org3261e7b"></a>dropFirst()<br />
<div class="outline-text-4" id="text-9-4-15">
<p>
.dropFirst(3)就是不要前3个<br />
</p>
</div>
</li>
<li><a id="org5878eb3"></a>last()和last(where:)<br />
<div class="outline-text-4" id="text-9-4-16">
<p>
跟上一个一样，唯一区别是publisher必须结束才会输出<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span><span style="color: #51afef;">import</span> Combine
<span class="linenr">2: </span><span style="color: #51afef;">private</span> <span style="color: #51afef;">var</span> cancellables = <span style="color: #c678dd;">Set</span>&lt;AnyCancellable&gt;()
<span class="linenr">3: </span>[<span style="color: #da8548; font-weight: bold;">1</span>, <span style="color: #da8548; font-weight: bold;">2</span>, <span style="color: #da8548; font-weight: bold;">3</span>, <span style="color: #da8548; font-weight: bold;">4</span>, <span style="color: #da8548; font-weight: bold;">5</span>].<span style="color: #c678dd;">publisher</span>
<span class="linenr">4: </span>    .<span style="color: #c678dd;">drop</span>(<span style="color: #51afef;">while</span>: { $0 &lt; <span style="color: #da8548; font-weight: bold;">3</span> })
<span class="linenr">5: </span>    .<span style="color: #c678dd;">sink</span>(receiveCompletion: { <span style="color: #c678dd;">print</span>($0) },
<span class="linenr">6: </span>        receiveValue: { <span style="color: #c678dd;">print</span>($0) })
<span class="linenr">7: </span>    .<span style="color: #c678dd;">store</span>(<span style="color: #51afef;">in</span>: &amp;cancellables)
<span class="linenr">8: </span>
</pre>
</div>

<pre class="example">
3
4
5
finished
</pre>
</div>
</li>
<li><a id="org591f3e2"></a>drop(untilOutputFrom:)<br />
<div class="outline-text-4" id="text-9-4-17">
<p>
这个其实也很简单理解，就是你有两个publisher，用这个operator的publisher必须要等另一个publisher输出才会输出，之前的都不要了<br />
</p>
</div>
</li>
<li><a id="org01a2846"></a>prefix()、prefix(while:)、prefix(untilOutputFrom:)<br />
<div class="outline-text-4" id="text-9-4-18">
<p>
跟drop的三个正好相反，保留前几个values直到&#x2026;.唯一要注意的是，跟first一样，符合条件之后就cancel<br />
</p>
</div>
</li>
<li><a id="org1070f06"></a>prepend()<br />
<div class="outline-text-4" id="text-9-4-19">
<p>
在publisher输出之前先输出prepend里面的同类型values<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span><span style="color: #51afef;">import</span> Combine
<span class="linenr">2: </span><span style="color: #51afef;">private</span> <span style="color: #51afef;">var</span> cancellables = <span style="color: #c678dd;">Set</span>&lt;AnyCancellable&gt;()
<span class="linenr">3: </span>[<span style="color: #da8548; font-weight: bold;">1</span>, <span style="color: #da8548; font-weight: bold;">2</span>, <span style="color: #da8548; font-weight: bold;">3</span>, <span style="color: #da8548; font-weight: bold;">4</span>, <span style="color: #da8548; font-weight: bold;">5</span>].<span style="color: #c678dd;">publisher</span>
<span class="linenr">4: </span>    .<span style="color: #c678dd;">prepend</span>(<span style="color: #da8548; font-weight: bold;">9</span>, <span style="color: #da8548; font-weight: bold;">8</span>) <span style="color: #5B6268;">//</span><span style="color: #5B6268;">&#20063;&#21487;&#20197;prepend([9, 8])&#65292;&#32467;&#26524;&#19968;&#26679;</span>
<span class="linenr">5: </span>    .<span style="color: #c678dd;">sink</span>(receiveCompletion: { <span style="color: #c678dd;">print</span>($0) },
<span class="linenr">6: </span>        receiveValue: { <span style="color: #c678dd;">print</span>($0) })
<span class="linenr">7: </span>    .<span style="color: #c678dd;">store</span>(<span style="color: #51afef;">in</span>: &amp;cancellables)
</pre>
</div>

<pre class="example">
9
8
1
2
3
4
5
finished
</pre>

<p>
还可以prepend(另一个publisher)，这样只有prepend的publisher完成输出，本来的publisher才开始输出<br />
</p>
</div>
</li>
</ol>
</div>

<div id="outline-container-orgb70b14f" class="outline-3">
<h3 id="orgb70b14f"><span class="section-number-3">9.5</span> sink(receiveCompletion:receiveValue:)</h3>
<div class="outline-text-3" id="text-9-5">
</div>
<ol class="org-ol">
<li><a id="orgdaf8668"></a>參數：<br />
<div class="outline-text-4" id="text-9-5-1">
<ul class="org-ul">
<li>receiveComplete: 在完成時執行的閉包。<br /></li>
<li>receiveValue: 在收到值時執行的閉包。<br /></li>
</ul>
</div>
</li>
<li><a id="org54d0be9"></a>返回值：<br />
<div class="outline-text-4" id="text-9-5-2">
<p>
為一個可取消實例，在結束分配接收值使用。結果的取消分配將拆除（tear down）訂閱數據流。<br />
</p>

<p>
使用 sink(receiveCompletion:receiveValue:) 來觀察發布者收到的值，並且使用你指定的閉包對其進行處理。<br />
</p>

<p>
在此範例中，Range 發布者將整數發布到 sink(receiveCompletion:receiveValue:) 運算符的 receiveValue 閉包中，該閉包將其打印到控制台中。完成接收器 sink(receiveCompletion:receiveValue:) 運算符的 receiveCompletion 閉包表示數據流成功終止。<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span><span style="color: #51afef;">import</span> Combine
<span class="linenr">2: </span><span style="color: #51afef;">let</span> myRange = (<span style="color: #da8548; font-weight: bold;">0</span>...<span style="color: #da8548; font-weight: bold;">3</span>)
<span class="linenr">3: </span><span style="color: #51afef;">var</span> cancellable = myRange.<span style="color: #c678dd;">publisher</span>
<span class="linenr">4: </span>  .<span style="color: #c678dd;">sink</span>(receiveCompletion: { <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"completion: \(</span>$0<span style="color: #98be65;">)"</span>) },
<span class="linenr">5: </span>        receiveValue: { <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"value: \(</span>$0<span style="color: #98be65;">)"</span>) })
</pre>
</div>

<pre class="example">
value: 0
value: 1
value: 2
value: 3
completion: finished
</pre>

<p>
此方法創建訂閱者並且在返回訂閱者之前立即請求無限數量的值，返回值應該被保留，否則數據流將被取消。<br />
</p>
</div>
</li>
</ol>
</div>

<div id="outline-container-org9fdef75" class="outline-3">
<h3 id="org9fdef75"><span class="section-number-3">9.6</span> assign(tp:on:)</h3>
<div class="outline-text-3" id="text-9-6">
</div>
<ol class="org-ol">
<li><a id="org989df93"></a>參數：<br />
<div class="outline-text-4" id="text-9-6-1">
<ul class="org-ul">
<li>keyPath：表示要分配屬性的 keyPath。關於 Key-Path 表達式請參考此官方文章。<br /></li>
<li>object：包含此屬性的對象。訂閱者在每次接收到新值時都會分配給該對象的屬性。<br /></li>
</ul>
</div>
</li>

<li><a id="orgf3d3dc7"></a>返回值：<br />
<div class="outline-text-4" id="text-9-6-2">
<p>
一個 AnyCancellable 實例。當你不再想要發布者分配屬性時，請在此實例上調用 cancel()。返初始化此實例也將取消自動分配。<br />
</p>

<p>
當你想要發布者每次產生值的時候都設置給給定的屬性時，請使用 assign(to:on:) 訂閱者。<br />
</p>

<p>
在此範例中，assign(to:on:) 設置在 MyClass 實例上的 anInt 屬性：<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #51afef;">import</span> Combine
<span class="linenr"> 2: </span><span style="color: #51afef;">var</span> cancellable: AnyCancellable?
<span class="linenr"> 3: </span><span style="color: #51afef;">class</span> <span style="color: #c678dd;">MyClass</span> {
<span class="linenr"> 4: </span>    <span style="color: #51afef;">var</span> anInt: <span style="color: #c678dd;">Int</span> = <span style="color: #da8548; font-weight: bold;">0</span> {
<span class="linenr"> 5: </span>        <span style="color: #51afef;">didSet</span> {
<span class="linenr"> 6: </span>            <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"anInt was set to: \(</span>anInt<span style="color: #98be65;">)"</span>, terminator: <span style="color: #98be65;">";"</span>)
<span class="linenr"> 7: </span>        }
<span class="linenr"> 8: </span>    }
<span class="linenr"> 9: </span>}
<span class="linenr">10: </span><span style="color: #51afef;">var</span> myObject = <span style="color: #c678dd;">MyClass</span>()
<span class="linenr">11: </span><span style="color: #51afef;">let</span> myRange = (<span style="color: #da8548; font-weight: bold;">0</span>...<span style="color: #da8548; font-weight: bold;">3</span>)
<span class="linenr">12: </span>cancellable = myRange.<span style="color: #c678dd;">publisher</span>
<span class="linenr">13: </span>  .<span style="color: #c678dd;">assign</span>(to: \.<span style="color: #dcaeea;">anInt</span>, on: myObject)
</pre>
</div>

<pre class="example">
anInt was set to: 0;anInt was set to: 1;anInt was set to: 2;anInt was set to: 3;
</pre>
</div>
</li>
</ol>
</div>

<div id="outline-container-org0d88cf5" class="outline-3">
<h3 id="org0d88cf5"><span class="section-number-3">9.7</span> Publisher &amp; Subsciber流程<sup><a id="fnr.18" class="footref" href="#fn.18">18</a></sup></h3>
<div class="outline-text-3" id="text-9-7">
<p>
基本上就是 Subscriber 會訂閱（附加 or 連接）在一個 Publisher，而這時 Publisher 會返回一個 Subscription 也就是所謂的訂閱，我們會藉由這個訂閱來保持兩者間的訂閱關係，我們也可以藉由移除它或是主動調用 cancel() 來取消訂閱關係。一旦有了這個訂閱關係後，Subscriber 會向 Publisher 要求值，而 Publisher 會向 Subscriber 發送值以及發送完成或是錯誤。<br />
</p>
<p>
<img src="./images/PS-2.png" alt="PS-2.png" /><br />
而 operator 則是 publisher 之間的轉換器(adoptor), 可以訂閱一個 publisher, 也可以讓任何 subscriber 要求數據.<br />
甚至可以產出 publisher 鏈(chain).<br />
</p>
<p>
<img src="./images/PS-3.png" alt="PS-3.png" /><br />
這些組合完成的序列結構, 稱為 pipelines(管路).<br />
</p>

<p>
Operators 可以轉換 publisher 與 subscriber 之間的數據, 分流或集合流.<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span><span style="color: #51afef;">import</span> Combine
<span class="linenr">2: </span>
<span class="linenr">3: </span><span style="color: #51afef;">let</span> publisher = <span style="color: #c678dd;">Just</span>(<span style="color: #da8548; font-weight: bold;">5</span>)
<span class="linenr">4: </span><span style="color: #51afef;">let</span> publisherString = publisher.<span style="color: #c678dd;">map</span>{$0.<span style="color: #c678dd;">description</span>}
<span class="linenr">5: </span><span style="color: #51afef;">let</span> publisherDouble = publisher.<span style="color: #c678dd;">map</span>{<span style="color: #c678dd;">Double</span>($0)}
<span class="linenr">6: </span>
<span class="linenr">7: </span><span style="color: #51afef;">let</span> subcriber = publisher.<span style="color: #c678dd;">sink</span>(receiveValue: {<span style="color: #c678dd;">print</span>($0)})        <span style="color: #5B6268;">// </span><span style="color: #5B6268;">5</span>
<span class="linenr">8: </span><span style="color: #51afef;">let</span> anotherScriber = publisherDouble.<span style="color: #c678dd;">sink</span>(receiveValue: {<span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"Another"</span>,$0)})         <span style="color: #5B6268;">//</span><span style="color: #5B6268;">Another 5.0</span>
</pre>
</div>

<pre class="example">
5
Another 5.0
</pre>

<p>
Combine 中的 operators 具備相對應的轉換功能來達成特殊的轉換. 例如 map 是單純轉換 Input, 而 tryMap 是同時間傳換 Input 與 Failure, 像是 Never 轉換成 Decode Error.<br />
</p>

<p>
Combine 之中, Publisher 是資料來源, Subscriber 是控制資料流的操作員, Subscriber 可以限制接收的資料信息量, 透過 Demand (需求), 使 Subscriber 得以在連接 Publisher 之後, 得到透過 Pipeline 處理後的資料.<br />
</p>

<p>
Combine 同時使 Subscriber 可以取消(cancel) Demand 的要求, 在 Combine 里, 所有的 Subscriber 都具備 Cancelable, 每個 Subscriber 都可以透過 Cancel() 函式, 取消 Publisher 或 pipeline 的 連接.<br />
</p>

<p>
因此, 我們可以知道 Publisher 是事件產生資料的單元, Pipeline 是轉換資料的單元, Subscriber 是控制 Publisher 週期的單元.<br />
</p>
</div>
</div>

<div id="outline-container-org1406be2" class="outline-3">
<h3 id="org1406be2"><span class="section-number-3">9.8</span> 發佈者和訂閱者的生命週期</h3>
<div class="outline-text-3" id="text-9-8">
<p>
Combine的設計是讓終端操作可以完全控制數據流和管道處理流程，這是一種 back-pressure設計（可以理解為末端控制整個流程），這也意味著subscriber驅動訂閱或者operator應該怎麼輸出數據。subscriber的請求通過通道（Pipeline）逐級向上鏈條傳遞。一個典型的例子就是cancel，當Subcriber要求取消的時候可中斷鏈條上的所有操作。<br />
</p>
<p width="500">
<img src="images/PS.jpg" alt="PS.jpg" width="500" /><br />
也就是subscriber控制整個鏈條的生命週期<br />
</p>
</div>
</div>

<div id="outline-container-org6e6cf56" class="outline-3">
<h3 id="org6e6cf56"><span class="section-number-3">9.9</span> 典型的Publisher</h3>
<div class="outline-text-3" id="text-9-9">
<ul class="org-ul">
<li>Just<br />
返回單個值並立即結束Publisher<br /></li>
<li>Future<br />
創建一個異步的最終返回單個值或失敗Publisher<br /></li>
<li>@Published<br />
swift 語法糖，允許將任意屬性轉換為一個Publisher<br /></li>
<li>Empty<br />
不返回任何值，然後直接結束&lt;可選&gt;<br /></li>
<li>Sequence<br />
將容器類型轉變為值發佈<br /></li>
<li>Fail<br />
<ul class="org-ul">
<li>發送一次值更新，然後立即因錯誤而終止<br /></li>
<li>立即因錯誤而終止<br /></li>
</ul></li>
<li>Deferred<br />
Deferred 初始化需要提供一個生成 Publisher 的 closure，只有在有 Subscriber 訂閱的時候才會生成指定的 Publisher，並且每個 Subscriber 獲得的 Publisher 都是全新的。<br /></li>
<li>ObservableObjectPublisher<br /></li>
</ul>
</div>
</div>

<div id="outline-container-org3e42d65" class="outline-3">
<h3 id="org3e42d65"><span class="section-number-3">9.10</span> Marble Diagram</h3>
<div class="outline-text-3" id="text-9-10">
<p>
使用 Marble diagram 可以加快我們學習 Operator 的運作原理. 接下來介紹本篇主題所使用的符號:<br />
</p>
</div>
<ol class="org-ol">
<li><a id="org77e14f6"></a>格式<br />
<div class="outline-text-4" id="text-9-10-1">
<pre class="example">
// 這是註解
- //單位時間, 沒有特別寫會是 1 秒
X //Error 發生
| //代表 Complete normally
source: //表示事件來源
operat: //代表 operation 表示上流事件的轉換
output: //表示最後結果, 只有在 operation 之後才會出現
</pre>
</div>
</li>
<li><a id="org3f9b888"></a>基本圖形範例<br />
<div class="outline-text-4" id="text-9-10-2">
<pre class="example">
// Attach subscribtion then complete without notify
-------------------|
// Attach subscribtion then error occur before any notify
-------------------X
// Attach subscribtion then nothing happen yet
--------------------
</pre>
</div>
</li>
<li><a id="org0e8efba"></a>經過 Operator 的圖形範例<br />
<div class="outline-text-4" id="text-9-10-3">
<pre class="example">
1.
source: ------1------2------3---|
                map{$0 + 1}
output: ------2------3------4---|

2.
source: ------1------2------3---|
   filter{$0.isMultiple(of: 2)}
output: -------------2----------|

3.
source: ------1------2------3---|
                map{$0 + 1}
operat: ------2------3------4---|
   filter{$0.isMultiple(of: 2)}
output: ------2-------------4---|
</pre>
</div>
</li>
</ol>
</div>

<div id="outline-container-org949d4a4" class="outline-3">
<h3 id="org949d4a4"><span class="section-number-3">9.11</span> Publisher的建立</h3>
<div class="outline-text-3" id="text-9-11">
<p>
Publisher 有許多方式可以建立, 有單獨的, 復合的, 組合的, 媒介的, 不同的 Publisher 分別有不同的型別.其中以 Just 與 Future 較為常見.<br />
</p>

<p>
一般來說, Publisher 是 Value type, 每次 Subscriber 訂閱時, 都會將原本定義的 Publisher 流程重頭執行, 不論其他複製的 Publisher 是否曾經訂閱發佈過.<br />
</p>
</div>
</div>

<div id="outline-container-org3bd0ca6" class="outline-3">
<h3 id="org3bd0ca6"><span class="section-number-3">9.12</span> Cancellable</h3>
<div class="outline-text-3" id="text-9-12">
<p>
雖然 Subscriber 感覺好像是 必須相依與 Publisher 的, 但是事實上是 Publisher 將事件源頭確立之後, 提供了一個建立 Subscriber 的工廠接口, 而這些接口都會回傳一個 AnyCancellable 的參考型別, 依照 AnyCancellable 文件, 其代表的是 cancellation token 作為取消事件流的途徑, 而由於 ARC 的記憶體管理, 這個 Token 若是沒有保持 ARC 的計數時, 將會在 function Scope 結束後自動解除訂閱.<br />
</p>

<p>
因此, 在 AnyCancellable 只有 3 個 API 可以使用:<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span>AnyCancellable.<span style="color: #c678dd;">cancel</span>()
<span class="linenr">2: </span>AnyCancellable.<span style="color: #dcaeea;">store</span>&lt;C&gt;(<span style="color: #51afef;">in</span>: <span style="color: #51afef;">inout</span> C) <span style="color: #51afef;">where</span> C : <span style="color: #c678dd;">RangeReplaceableCollection</span>, C.<span style="color: #c678dd;">Element</span> == AnyCancellable
<span class="linenr">3: </span>AnyCancellable.<span style="color: #c678dd;">store</span>(<span style="color: #51afef;">in</span>: <span style="color: #51afef;">inout</span> <span style="color: #c678dd;">Set</span>&lt;AnyCancellable&gt;)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgad868d1" class="outline-3">
<h3 id="orgad868d1"><span class="section-number-3">9.13</span> Webs, Video</h3>
<div class="outline-text-3" id="text-9-13">
<p>
<a href="https://peterfriese.dev/swift-combine-love/">SwiftUI + Combine = ❤️</a>: validation of username and password<br />
<a href="https://www.youtube.com/watch?v=r7ef2W3kevY">SwiftUI and Combine All The Things</a><br />
<a href="https://www.youtube.com/watch?v=bRpFHqv0tRQ">SwiftUI 2.0 + Combine - Getting Started (2020)</a><br />
<a href="https://www.youtube.com/watch?v=YJRApch2cc4">SwiftUI 2.0 &amp; Combine: Building a Form with Inline Error Validation</a><br />
<a href="https://www.youtube.com/watch?v=IBelvWwZkJw">SwiftUI Binding</a> : @Binding, @StateObject, @ObservedObject, @EnvironmentObject<br />
</p>
</div>
</div>
</div>

<div id="outline-container-some" class="outline-2">
<h2 id="some"><span class="section-number-2">10</span> <span class="todo TODO">TODO</span> some</h2>
<div class="outline-text-2" id="text-some">
<p class="verse">
Adding the keyword some in front of a return type indicates that the return type is opaque. <sup><a id="fnr.19" class="footref" href="#fn.19">19</a></sup><br />
</p>
</div>
<div id="outline-container-org6c0292d" class="outline-3">
<h3 id="org6c0292d"><span class="section-number-3">10.1</span> Generics</h3>
<div class="outline-text-3" id="text-10-1">
</div>
<ol class="org-ol">
<li><a id="orgcd50c18"></a>問題<br />
<div class="outline-text-4" id="text-10-1-1">
<p>
Generics 允許開發者在不同類型中複用你的程式碼，用來解決下列問題：<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #51afef;">func</span> <span style="color: #c678dd;">swapInts</span>(_ a: <span style="color: #51afef;">inout</span> <span style="color: #c678dd;">Int</span>, _ b: <span style="color: #51afef;">inout</span> <span style="color: #c678dd;">Int</span>) {
<span class="linenr"> 2: </span>    <span style="color: #51afef;">let</span> temporaryB = b
<span class="linenr"> 3: </span>    b = a
<span class="linenr"> 4: </span>    a = temporaryB
<span class="linenr"> 5: </span>}
<span class="linenr"> 6: </span>
<span class="linenr"> 7: </span><span style="color: #51afef;">var</span> num1 = <span style="color: #da8548; font-weight: bold;">10</span>
<span class="linenr"> 8: </span><span style="color: #51afef;">var</span> num2 = <span style="color: #da8548; font-weight: bold;">20</span>
<span class="linenr"> 9: </span>
<span class="linenr">10: </span><span style="color: #c678dd;">swapInts</span>(&amp;num1, &amp;num2)
<span class="linenr">11: </span><span style="color: #c678dd;">print</span>(num1)   <span style="color: #5B6268;">// </span><span style="color: #5B6268;">20</span>
<span class="linenr">12: </span><span style="color: #c678dd;">print</span>(num2)   <span style="color: #5B6268;">// </span><span style="color: #5B6268;">10</span>
</pre>
</div>
<p>
但若想交換字串，則要寫成<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span><span style="color: #51afef;">func</span> <span style="color: #c678dd;">swapStrings</span>(_ a: <span style="color: #51afef;">inout</span> <span style="color: #c678dd;">String</span>, _ b: <span style="color: #51afef;">inout</span> <span style="color: #c678dd;">String</span>) {
<span class="linenr">2: </span>    <span style="color: #51afef;">let</span> temporaryB = b
<span class="linenr">3: </span>    b = a
<span class="linenr">4: </span>    a = temporaryB
<span class="linenr">5: </span>}
</pre>
</div>
<p>
可以發現除了參數之外，重複的 code 實在太多<br />
</p>
</div>
</li>
<li><a id="org9329141"></a>解決方案<br />
<div class="outline-text-4" id="text-10-1-2">
<p>
將固定型態的參數轉為 Generic type<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #51afef;">import</span> Cocoa
<span class="linenr"> 2: </span>
<span class="linenr"> 3: </span><span style="color: #51afef;">func</span> <span style="color: #c678dd;">swapTwoValues</span>&lt;T&gt;(_ a: <span style="color: #51afef;">inout</span> T, _ b: <span style="color: #51afef;">inout</span> T) {
<span class="linenr"> 4: </span>    <span style="color: #51afef;">let</span> temporaryA = a
<span class="linenr"> 5: </span>    a = b
<span class="linenr"> 6: </span>    b = temporaryA
<span class="linenr"> 7: </span>}
<span class="linenr"> 8: </span>
<span class="linenr"> 9: </span>
<span class="linenr">10: </span><span style="color: #51afef;">var</span> num1 = <span style="color: #da8548; font-weight: bold;">10</span>
<span class="linenr">11: </span><span style="color: #51afef;">var</span> num2 = <span style="color: #da8548; font-weight: bold;">20</span>
<span class="linenr">12: </span>
<span class="linenr">13: </span><span style="color: #c678dd;">swapTwoValues</span>(&amp;num1, &amp;num2)
<span class="linenr">14: </span><span style="color: #c678dd;">print</span>(num1)   <span style="color: #5B6268;">// </span><span style="color: #5B6268;">20</span>
<span class="linenr">15: </span><span style="color: #c678dd;">print</span>(num2)   <span style="color: #5B6268;">// </span><span style="color: #5B6268;">10</span>
</pre>
</div>
<p>
另一個例子為 Stack 的實作：<br />
原本只能儲存 Int 的 Stack 如下，若要儲存字串則要再另行定義。<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">IntStack</span> {
<span class="linenr">2: </span>    <span style="color: #51afef;">var</span> items = [<span style="color: #c678dd;">Int</span>]()
<span class="linenr">3: </span>    <span style="color: #51afef;">mutating</span> <span style="color: #51afef;">func</span> <span style="color: #c678dd;">push</span>(_ item: <span style="color: #c678dd;">Int</span>) {
<span class="linenr">4: </span>        items.<span style="color: #c678dd;">append</span>(item)
<span class="linenr">5: </span>    }
<span class="linenr">6: </span>    <span style="color: #51afef;">mutating</span> <span style="color: #51afef;">func</span> <span style="color: #c678dd;">pop</span>() -&gt; <span style="color: #c678dd;">Int</span> {
<span class="linenr">7: </span>        <span style="color: #51afef;">return</span> items.<span style="color: #c678dd;">removeLast</span>()
<span class="linenr">8: </span>    }
<span class="linenr">9: </span>}
</pre>
</div>
<p>
改為 Generic type 後可動態變更為整數 stack 或字串 stack，如：<br />
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">Stack</span>&lt;<span style="color: #c678dd;">Element</span>&gt; {
<span class="linenr"> 2: </span>    <span style="color: #51afef;">var</span> items = [<span style="color: #c678dd;">Element</span>]()
<span class="linenr"> 3: </span>    <span style="color: #51afef;">mutating</span> <span style="color: #51afef;">func</span> <span style="color: #c678dd;">push</span>(_ item: <span style="color: #c678dd;">Element</span>) {
<span class="linenr"> 4: </span>        items.<span style="color: #c678dd;">append</span>(item)
<span class="linenr"> 5: </span>    }
<span class="linenr"> 6: </span>    <span style="color: #51afef;">mutating</span> <span style="color: #51afef;">func</span> <span style="color: #c678dd;">pop</span>() -&gt; <span style="color: #c678dd;">Element</span> {
<span class="linenr"> 7: </span>        <span style="color: #51afef;">return</span> items.<span style="color: #c678dd;">removeLast</span>()
<span class="linenr"> 8: </span>    }
<span class="linenr"> 9: </span>}
<span class="linenr">10: </span>
<span class="linenr">11: </span><span style="color: #51afef;">var</span> stackOfStrings = Stack&lt;<span style="color: #c678dd;">String</span>&gt;()
<span class="linenr">12: </span>stackOfStrings.<span style="color: #c678dd;">push</span>(<span style="color: #98be65;">"uno"</span>)
<span class="linenr">13: </span>stackOfStrings.<span style="color: #c678dd;">push</span>(<span style="color: #98be65;">"dos"</span>)
<span class="linenr">14: </span>stackOfStrings.<span style="color: #c678dd;">push</span>(<span style="color: #98be65;">"tres"</span>)
<span class="linenr">15: </span>stackOfStrings.<span style="color: #c678dd;">push</span>(<span style="color: #98be65;">"cuatro"</span>)
<span class="linenr">16: </span><span style="color: #5B6268;">// </span><span style="color: #5B6268;">the stack now contains 4 strings</span>
<span class="linenr">17: </span>
</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-orgc204fc2" class="outline-3">
<h3 id="orgc204fc2"><span class="section-number-3">10.2</span> opaque</h3>
<div class="outline-text-3" id="text-10-2">
<p>
帶有不透明（opaque）返回類型的函數或方法，將會隱藏其返回值的類型<sup><a id="fnr.20" class="footref" href="#fn.20">20</a></sup><br />
</p>
</div>
</div>
</div>

<div id="outline-container-advanced" class="outline-2">
<h2 id="advanced"><span class="section-number-2">11</span> <span class="todo TODO">TODO</span> 進階主題</h2>
<div class="outline-text-2" id="text-advanced">
<ul class="org-ul">
<li><a href="https://developer.apple.com/design/human-interface-guidelines/">Human Interface Guidelines</a>: Apple 的人機設計界面指南<br /></li>
<li><a href="https://developer.apple.com/documentation">Apple Developer Documentation</a>: Apple 開發者文件<br /></li>
<li><a href="https://www.appcoda.com.tw/protocol-extension/">利用 Protocol Extension 減少重覆的 Code　大大增強 Code 的維護性</a><br /></li>
<li><a href="https://appcoda.com.tw/mastering-swift/">精通Swift：列舉、閉包、泛型、Protocols和高階函數</a><br /></li>
</ul>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup> <div class="footpara"><p class="footpara">
<a href="https://github.com/onmyway133/blog/issues/611"> How to use Picker with enum in SwiftUI</a>心<br />
</p></div></div>

<div class="footdef"><sup><a id="fn.2" class="footnum" href="#fnr.2">2</a></sup> <div class="footpara"><p class="footpara">
<a href="https://medium.com/tarkalabs/all-about-debounce-4-ways-to-achieve-debounce-in-swift-e8f8ce22f544">All about debounce: 4 ways to achieve debounce in Swift</a><br />
</p></div></div>

<div class="footdef"><sup><a id="fn.3" class="footnum" href="#fnr.3">3</a></sup> <div class="footpara"><p class="footpara">
<a href="https://www.raywenderlich.com/6742901-protocol-oriented-programming-tutorial-in-swift-5-1-getting-started">Protocol-Oriented Programming Tutorial in Swift 5.1: Getting Started</a><br />
</p></div></div>

<div class="footdef"><sup><a id="fn.4" class="footnum" href="#fnr.4">4</a></sup> <div class="footpara"><p class="footpara">
<a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E6%95%99%E5%AE%A4/%E7%B0%A1%E6%98%93%E8%AA%AA%E6%98%8Eswift-4-protocol-919b7f9cbaee">『簡易說明Swift 4』Protocol</a><br />
</p></div></div>

<div class="footdef"><sup><a id="fn.5" class="footnum" href="#fnr.5">5</a></sup> <div class="footpara"><p class="footpara">
<a href="https://www.appcoda.com.tw/protocol-extension/">利用 Protocol Extension 減少重覆的 Code　大大增強 Code 的維護性</a><br />
</p></div></div>

<div class="footdef"><sup><a id="fn.6" class="footnum" href="#fnr.6">6</a></sup> <div class="footpara"><p class="footpara">
<a href="https://docs.swift.org/swift-book/LanguageGuide/Protocols.html">Protocols</a><br />
</p></div></div>

<div class="footdef"><sup><a id="fn.7" class="footnum" href="#fnr.7">7</a></sup> <div class="footpara"><p class="footpara">
<a href="https://www.appcoda.com.tw/swift-protocol/">Swift開發指南：Protocols與Protocol Extensions的使用心法</a><br />
</p></div></div>

<div class="footdef"><sup><a id="fn.8" class="footnum" href="#fnr.8">8</a></sup> <div class="footpara"><p class="footpara">
<a href="https://ithelp.ithome.com.tw/articles/10197366">Day-29 Swift 語法(25) - 協定 Protocol</a><br />
</p></div></div>

<div class="footdef"><sup><a id="fn.9" class="footnum" href="#fnr.9">9</a></sup> <div class="footpara"><p class="footpara">
<a href="https://abhimuralidharan.medium.com/all-about-protocols-in-swift-11a72d6ea354">All about protocols in swift</a><br />
</p></div></div>

<div class="footdef"><sup><a id="fn.10" class="footnum" href="#fnr.10">10</a></sup> <div class="footpara"><p class="footpara">
<a href="https://appcoda.com.tw/mastering-swift/">精通Swift：列舉、閉包、泛型、Protocols和高階函數</a><br />
</p></div></div>

<div class="footdef"><sup><a id="fn.11" class="footnum" href="#fnr.11">11</a></sup> <div class="footpara"><p class="footpara">
<a href="https://hugolu.gitbooks.io/learn-swift/content/Advanced/Enum.html">Swift學習筆記 </a><br />
</p></div></div>

<div class="footdef"><sup><a id="fn.12" class="footnum" href="#fnr.12">12</a></sup> <div class="footpara"><p class="footpara">
<a href="https://www.hackingwithswift.com/books/ios-swiftui/why-does-swiftui-use-structs-for-views">Why does SwiftUI use structs for views?</a><br />
</p></div></div>

<div class="footdef"><sup><a id="fn.13" class="footnum" href="#fnr.13">13</a></sup> <div class="footpara"><p class="footpara">
<a href="https://abhimuralidharan.medium.com/difference-between-a-struct-and-a-class-in-swift-53e08df73714">Difference between a struct and a class in Swift</a><br />
</p></div></div>

<div class="footdef"><sup><a id="fn.14" class="footnum" href="#fnr.14">14</a></sup> <div class="footpara"><p class="footpara">
<a href="https://www.hackingwithswift.com/books/ios-swiftui/why-state-only-works-with-structs">Why @State only works with structs</a><br />
</p></div></div>

<div class="footdef"><sup><a id="fn.15" class="footnum" href="#fnr.15">15</a></sup> <div class="footpara"><p class="footpara">
<a href="https://www.hackingwithswift.com/books/ios-swiftui/sharing-swiftui-state-with-observedobject">Sharing SwiftUI state with @ObservedObject</a><br />
</p></div></div>

<div class="footdef"><sup><a id="fn.16" class="footnum" href="#fnr.16">16</a></sup> <div class="footpara"><p class="footpara">
<a href="https://www.codenong.com/jse1bf39f39820/">Apple原生Rx框架Combine簡介</a><br />
</p></div></div>

<div class="footdef"><sup><a id="fn.17" class="footnum" href="#fnr.17">17</a></sup> <div class="footpara"><p class="footpara">
<a href="https://medium.com/jeremy-xue-s-blog/swift-combine-%E5%85%A5%E9%96%80%E4%BB%8B%E7%B4%B9-333623e21d3d">Swift — Combine 入門介紹</a><br />
</p></div></div>

<div class="footdef"><sup><a id="fn.18" class="footnum" href="#fnr.18">18</a></sup> <div class="footpara"><p class="footpara">
<a href="https://medium.com/jeremy-xue-s-blog/swift-%E7%8E%A9%E7%8E%A9-publishers-subscribers-3fc4e7542b3d">Swift — 玩玩 Publishers &amp; Subscribers</a><br />
</p></div></div>

<div class="footdef"><sup><a id="fn.19" class="footnum" href="#fnr.19">19</a></sup> <div class="footpara"><p class="footpara">
<a href="https://medium.com/@PhiJay/whats-this-some-in-swiftui-34e2c126d4c4">What’s this “some” in SwiftUI?</a><br />
</p></div></div>

<div class="footdef"><sup><a id="fn.20" class="footnum" href="#fnr.20">20</a></sup> <div class="footpara"><p class="footpara">
<a href="https://medium.com/jeremy-xue-s-blog/swift-%E7%A8%8B%E5%BC%8F%E8%AA%9E%E8%A8%80-opaque-types-600ad5758b91">Swift 程式語言 — Opaque Types</a><br />
</p></div></div>


</div>
</div></div>
<div id="postamble" class="status">
<p class="author">Author: Yung Chin, Yen</p>
<p class="date">Created: 2021-04-26 Mon 15:53</p>
</div>
</body>
</html>
