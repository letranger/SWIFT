<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2021-05-29 Sat 21:46 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SwiftUI v.s. Firebase</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Yung Chin, Yen" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<style type="text/css"> * { font-family: "Georgia";}h1, h2, h3, h4, h5, h6,h1 span, h2 span, h3 span, h4 span, h5 span, h6 span,h1 a, h2 a, h3 a, h4 a, h5 a, h6 a {    font-family: "Arial";}pre, code {    font-family: Monaco, "Courier New", Courier;}#text-table-of-contents a {    font-family: "Arial";}/* @end *//* @group Baseline */body {	font-size: 14px;	line-height: 1.5em;	padding: 0;	margin: 0;}h1 {	margin: 0;	font-size: 1.6666666666666667em;	line-height: 0.9em;	margin-bottom: 0.9em;}h2 {	margin: 0;	font-size: 1.5em;	line-height: 1em;	margin-bottom: 1em;}h3 {	margin: 0;	font-size: 1.3333333333333333em;	line-height: 1.125em;	margin-bottom: 1.125em;}h4 {	margin: 0;	font-size: 1.1666666666666667em;	line-height: 1.2857142857142858em;	margin-bottom: 1.2857142857142858em;}p, ul, blockquote, pre, td, th, label {	margin: 0;	font-size: 1em;	line-height: 1.5em;	margin-bottom: 1.5em;}p.small, #postamble {	margin: 0;	font-size: 0.8333333333333334em;	line-height: 1.8em;	margin-bottom: 1.8em;}table {	border-collapse: collapse;	margin-bottom: 1.5em;}/* @end *//* @group Layout */#content {	width: 70em;	margin-left: auto;	margin-right: auto;}/* #header {	height: 10em;}*/#table-of-contents {	width: 15em;	float: left;	overflow: auto;}/* #main { */div.outline-2 {        width: 52em;	float: right;	/* The lines below are useful if the "main" div isn't available and	   div.outline-2 has to be used. */	position: relative;}#postamble {	clear: both;	text-align: center;}div.outline-2 pre {    width: 40em;    overflow: auto;}/* @end *//* @group Header */h1.title {	margin-top: 10px;	text-align: center;}h1.title {	font-size: 3em;	font-weight: bold;	margin-bottom: 0.8em;}/* @end *//* @group Org Keywords */.todo {	color: red;}.done {	color: green;}.tag {	color: blue;	text-transform: lowercase;	/* This will be obscured by the surrounding span tag, so blank everything. */	background: #fff;	border: none;	/* position: relative;	text-align: right;	right: 1em; */}.timestamp {}.timestamp-kwd  {	/* keyword associated with a time stamp, like SCHEDULED */}.target {	/* target for links */}/* @end *//* @group Table of Contents */#table-of-contents h2 {	letter-spacing: -0.1em;}#table-of-contents ul,#table-of-contents ol {    padding-left: 1em;}/* @end *//* @group Outline Level 2 */.outline-2 h2 {    background: #ffc;    border-bottom: 1px solid #ccc;}.outline-2 h2, .outline-2 h3 {    letter-spacing: -0.05em;}.outline-2 {	padding: 5px;	/* margin-bottom: 10px; */	/* border-top: 1px solid #ccc; */}/* @end */td {	border: 1px solid #ccc;}h1 span, h2 span, h3 span, h4 span, h5 span, h6 span {    background-color: #eee;    padding: 2px;    border: 1px solid #ccc;}.outline-1, .outline-2, .outline-3, .outline-4, .outline-5, .outline-6 {    margin-left: 2em;}a {    text-decoration: none;    color: #57d; /* TODO: Find a better colour for this. */}a:hover {    border-bottom: 1px dotted #57d;}#postamble p {    margin: 0px;}.footpara { display: inline; }.footdef { margin-bottom: 3em; font-size: 80%; }/*]]>*/--></style><script type="text/javascript">/*@licstart  The following is the entire license notice for theJavaScript code in this tag.Copyright (C) 2012-2013 Free Software Foundation, Inc.The JavaScript code in this tag is free software: you canredistribute it and/or modify it under the terms of the GNUGeneral Public License (GNU GPL) as published by the Free SoftwareFoundation, either version 3 of the License, or (at your option)any later version.  The code is distributed WITHOUT ANY WARRANTY;without even the implied warranty of MERCHANTABILITY or FITNESSFOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.As additional permission under GNU GPL version 3 section 7, youmay distribute non-source (e.g., minimized or compacted) forms ofthat code without the copy of the GNU GPL normally required bysection 4, provided you include this license notice and a URLthrough which recipients can access the Corresponding Source.@licend  The above is the entire license noticefor the JavaScript code in this tag.*/<!--/*--><![CDATA[/*><!--*/ function CodeHighlightOn(elem, id) {   var target = document.getElementById(id);   if(null != target) {     elem.cacheClassElem = elem.className;     elem.cacheClassTarget = target.className;     target.className = "code-highlighted";     elem.className   = "code-highlighted";   } } function CodeHighlightOff(elem, id) {   var target = document.getElementById(id);   if(elem.cacheClassElem)     elem.className = elem.cacheClassElem;   if(elem.cacheClassTarget)     target.className = elem.cacheClassTarget; }</script>
<style>*{font-family: Courier New !important}</style>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:1f739d935676111cfff4b4693e3816e664797050&amp;dn=gpl-3.0.txt GPL-v3-or-Later
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.cacheClassElem = elem.className;
         elem.cacheClassTarget = target.className;
         target.className = "code-highlighted";
         elem.className   = "code-highlighted";
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(elem.cacheClassElem)
         elem.className = elem.cacheClassElem;
       if(elem.cacheClassTarget)
         target.className = elem.cacheClassTarget;
     }
    /*]]>*///-->
// @license-end
</script>
</head>
<body>
<div id="content">
<h1 class="title">SwiftUI v.s. Firebase</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#SW-Firebase-Intro">1. Introduction</a>
<ul>
<li><a href="#org8d57399">1.1. A Brief History</a></li>
<li><a href="#org15a9164">1.2. With Firebase you can</a>
<ul>
<li><a href="#org22a9653">1.2.1. Build better apps</a></li>
<li><a href="#orgfc088c5">1.2.2. Improve app quality</a></li>
<li><a href="#org231c052">1.2.3. Grow your business</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#SW-Firebase-database">2. Firebase database</a>
<ul>
<li><a href="#org930ee54">2.1. Data model</a></li>
</ul>
</li>
<li><a href="#SW-Firebase-datamodel">3. Cloud Firestore Data model</a>
<ul>
<li><a href="#orgc26efd9">3.1. Documents</a></li>
<li><a href="#orgd5ba4f1">3.2. Collections</a></li>
<li><a href="#org753d928">3.3. References</a></li>
<li><a href="#org689c399">3.4. Supported data types</a></li>
<li><a href="#org338e843">3.5. Index types in Cloud Firestore</a>
<ul>
<li><a href="#org68112ec">3.5.1. An index behind every query</a></li>
<li><a href="#org3396ba1">3.5.2. Less index management, more app development</a></li>
<li><a href="#org0cb29be">3.5.3. Automatic indexing</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#SW-Firebase-CreateDatabase">4. Create your own Cloud Firestore database</a></li>
<li><a href="#SW-Firebase-AddFirebase">5. Adding Firebase to your iOS project</a>
<ul>
<li><a href="#orgd21e28f">5.1. key process</a></li>
<li><a href="#orgaa08b15">5.2. Setting up Firebase project: Step by step</a>
<ul>
<li><a href="#org7f155ae">5.2.1. Create/Register</a></li>
<li><a href="#org8811d86">5.2.2. Install SDKs</a></li>
</ul>
</li>
<li><a href="#org47d328b">5.3. 資料來源</a></li>
</ul>
</li>
<li><a href="#SW-Firebase-BasicOperations">6. Basic operations to Firebase with iOS</a>
<ul>
<li><a href="#orgf8991f3">6.1. Add document</a>
<ul>
<li><a href="#org76bc0e7">6.1.1. create a document with specific document ID</a></li>
<li><a href="#orgdbbbbe2">6.1.2. create a document with auto-generate document ID</a></li>
</ul>
</li>
<li><a href="#org0a34c29">6.2. Get data from Cloud Firestore: Basic</a>
<ul>
<li><a href="#org9f29909">6.2.1. Getting collection</a></li>
<li><a href="#org13b4bd5">6.2.2. Getting document</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#SW-GetDataFromCloud">7. Get data from Cloud: UI with Firebase [MVVM]</a>
<ul>
<li><a href="#org8672b36">7.1. MVVM architecture</a></li>
<li><a href="#orgeaed1b5">7.2. Model</a></li>
<li><a href="#org7200dc0">7.3. View</a></li>
<li><a href="#org9893b5c">7.4. ViewModel</a></li>
<li><a href="#org467cdea">7.5. Repository</a></li>
<li><a href="#orgb4f8983">7.6. 資料來源</a></li>
</ul>
</li>
<li><a href="#SW-Delete">8. Add, Delete #1 data from Cloud: UI with Firebase [MVVM]</a>
<ul>
<li><a href="#org00bf9cf">8.1. Repository</a></li>
<li><a href="#orgf22e0cf">8.2. View</a></li>
<li><a href="#orgbefaa84">8.3. ViewModel</a></li>
</ul>
</li>
<li><a href="#orgfc7ee79">9. Delete #2 data from Cloud: UI with Firebase [MVVM]</a>
<ul>
<li><a href="#orgbd9964b">9.1. Repository</a></li>
<li><a href="#org68faf35">9.2. View</a></li>
<li><a href="#org48ee1c6">9.3. ViewModel</a></li>
</ul>
</li>
<li><a href="#SW-Detail">10. Detail/Edit data from Cloud: UI with Firebase [MVVM]</a>
<ul>
<li><a href="#orgd6acf0a">10.1. Repository</a></li>
<li><a href="#org90c839c">10.2. View</a>
<ul>
<li><a href="#org9ffe39f">10.2.1. TaskListView.swift</a></li>
<li><a href="#org34a528e">10.2.2. TaskDetailView.swift</a></li>
<li><a href="#orgfe630b6">10.2.3. UpdateListView.swift</a></li>
</ul>
</li>
<li><a href="#orga61e1d1">10.3. ViewModel</a>
<ul>
<li><a href="#org67cea7a">10.3.1. TaskListViewModel.swift</a></li>
<li><a href="#orgef49500">10.3.2. TaskCellViewModel.swift</a></li>
<li><a href="#org179c0e2">10.3.3. DEMO</a></li>
</ul>
</li>
<li><a href="#org36a65d7">10.4. Topics:</a></li>
</ul>
</li>
<li><a href="#SW-Icon">11. Add Icon to App</a>
<ul>
<li><a href="#orga030ffc">11.1. ViewModel</a>
<ul>
<li><a href="#org2c0e6fe">11.1.1. TaskCellViewModel.swift</a></li>
</ul>
</li>
<li><a href="#orge471da1">11.2. View</a>
<ul>
<li><a href="#org3fb64e6">11.2.1. TaskListView.swift</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#SW-Firebase-Storage">12. Storage</a>
<ul>
<li><a href="#org7722427">12.1. preparation</a></li>
<li><a href="#org375f287">12.2. tips</a></li>
<li><a href="#SW-ImagePicker">12.3. How to pick image in iOS</a>
<ul>
<li><a href="#org8886ced">12.3.1. Utility: ImagePicker</a></li>
<li><a href="#orgab6bcb6">12.3.2. How to call ImagePicker in SwiftUI</a></li>
</ul>
</li>
<li><a href="#SW-UploadImage">12.4. Just Upload Image to Firebase Storage</a></li>
<li><a href="#SW-UploadSaveImage">12.5. How to upload image to Firebase storage and get download URL (for saving into database)</a></li>
<li><a href="#SW-URLImage">12.6. Show online image: URLImage</a>
<ul>
<li><a href="#org22f24ec">12.6.1. url-image</a></li>
<li><a href="#orgb9e4095">12.6.2. TaskDetailView.swift</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#SW-Firebase-LearningResource">13. Learning resources</a>
<ul>
<li><a href="#org3792176">13.1. web</a></li>
<li><a href="#orgf54e7c7">13.2. Videos</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-SW-Firebase-Intro" class="outline-2">
<h2 id="SW-Firebase-Intro"><span class="section-number-2">1</span> Introduction</h2>
<div class="outline-text-2" id="text-SW-Firebase-Intro">
<p>
什麼是Firebase？Firebase是由Google收購的子公司，所提供的是行動應用程式開發的平台服務，也就是BaaS(Backend as a Service)，它能夠幫助我們快速開發我們的應用程式，並且支援跨平台包括Android、iOS以及Web，幫我們整合大部分建立一個服務所需要的後台功能。主要像是提供雲端給使用者架起網頁、提供資料庫供使用者存取資料以及做後台分析等等。<sup><a id="fnr.1" class="footref" href="#fn.1">1</a></sup>
</p>

<p>
Firebase can power your app’s backend, including data storage, user authentication, static hosting, and more. With Firebase, you can easily build mobile and web apps that scale from one user to one million.
</p>
</div>

<div id="outline-container-org8d57399" class="outline-3">
<h3 id="org8d57399"><span class="section-number-3">1.1</span> A Brief History<sup><a id="fnr.2" class="footref" href="#fn.2">2</a></sup></h3>
<div class="outline-text-3" id="text-1-1">
<p>
Back in 2011, before Firebase was Firebase, it was a startup called <b>Envolve</b>. As Envolve, it provided developers with an API that enabled <b>the integration of online chat functionality into their website</b>.
</p>

<p>
What’s interesting is that people used Envolve to pass application data that was more than just chat messages. Developers were using Envolve to <b>sync application data</b> such as a game state in real time across their users.
</p>

<p>
This led the founders of Envolve, James Tamplin and Andrew Lee, to separate the chat system and the real-time architecture. In April 2012, Firebase was created as a separate company that provided Backend-as-a-Service with real-time functionality.
</p>

<p>
After it was acquired by Google in 2014, Firebase rapidly evolved into the multifunctional behemoth of a mobile and web platform that it is today.
</p>
</div>
</div>

<div id="outline-container-org15a9164" class="outline-3">
<h3 id="org15a9164"><span class="section-number-3">1.2</span> With Firebase you can<sup><a id="fnr.2.100" class="footref" href="#fn.2">2</a></sup></h3>
<div class="outline-text-3" id="text-1-2">
<p>
Firebase helps mobile app teams succeed. With Firebase you can:
</p>
<ol class="org-ol">
<li>Build better apps</li>
<li>Improve app quality</li>
<li>Grow your business</li>
</ol>
</div>
<div id="outline-container-org22a9653" class="outline-4">
<h4 id="org22a9653"><span class="section-number-4">1.2.1</span> Build better apps</h4>
<div class="outline-text-4" id="text-1-2-1">
<p>
Firebase lets you build more powerful, secure and scalable apps, using world-class infrastructure using:
</p>
<ol class="org-ol">
<li>Cloud Firestore: is a flexible, scalable database for mobile, web, and server development from Firebase and Google Cloud Platform. It is a <b>NoSQL document database</b> that lets you easily <b>store, sync, and query data</b> for your mobile and web apps — at a global scale.It&rsquo;s supporting for Android, iOS and Web Platform.</li>
<li>ML Kit: is a mobile SDK that brings <b>Google’s machine learning expertise to Android and iOS apps</b> in a powerful yet easy-to-use package. Whether you’re new or experienced in machine learning, you can implement the functionality you need in just a few lines of code. There’s no need to have deep knowledge of neural networks or model optimization to get started. On the other hand, if you are an experienced ML developer, ML Kit provides convenient APIs that help you use your custom TensorFlow Lite models in your mobile apps. It’s supporting for Android and iOS Platform.</li>
<li>Cloud Functions: for Firebase lets you automatically run backend code in response to events <b>triggered</b> by Firebase features and HTTPS requests. Your code is stored in Google’s cloud and runs in a managed environment. There’s no need to manage and scale your own servers. It’s supporting for Android, iOS, C++, Unity and Web Platform.</li>
<li>Authentication: provides backend services, easy-to-use SDKs, and ready-made UI libraries to <b>authenticate users to your app</b>. It supports authentication using passwords, phone numbers, popular federated identity providers like Google, Facebook and Twitter, and more. It’s supporting for Android, iOS and Web Platform.</li>
<li>Hosting: is production-grade web content hosting for developers. <b>With a single command, you can quickly deploy web apps and serve both static and dynamic content to a global CDN</b> (content delivery network). You can also pair Firebase Hosting with Cloud Functions to build and host microservices on Firebase. It’s supporting only Web Platform.</li>
<li>Cloud Storages: is for <b>object storage service</b> built for Google scale. The Firebase SDKs for Cloud Storage add Google security to file uploads and downloads for your Firebase apps, regardless of network quality. You can use our SDKs to store images, audio, video, or other user-generated content. On the server, you can use Google Cloud Storage, to access the same files. It’s supporting for Android, iOS, C++, Unity and Web Platform.</li>
<li>Real-time Database: is a cloud-hosted NoSQL database that lets you <b>store and sync between your users in real-time</b>. The Real-time Database is really just <b>one big JSON object</b> that the developers can manage in real-time. It’s supporting for <b>Android, iOS, C++, Unity and Web Platform</b>.</li>
</ol>
</div>
</div>

<div id="outline-container-orgfc088c5" class="outline-4">
<h4 id="orgfc088c5"><span class="section-number-4">1.2.2</span> Improve app quality</h4>
<div class="outline-text-4" id="text-1-2-2">
<p>
Firebase gives you insights into app performance and stability, so you can channel your resources effectively using:
</p>

<ol class="org-ol">
<li>Crashlytics: is <b>a lightweight, real-time crash reporter</b> that helps you track, prioritize, and fix stability issues that erode your app quality. Crashlytics saves you troubleshooting time by intelligently grouping crashes and highlighting the circumstances that lead up to them. It’s supporting for Android and iOS Platform.</li>
<li>Performance Monitoring: is a service that helps you <b>to gain insight into the performance characteristics of your iOS and Android apps</b>. You use the Performance Monitoring SDK to collect performance data from your app, and then review and analyze that data in the Firebase console. Performance Monitoring helps you to understand where and when the performance of your app can be improved so that you can use that information to fix performance issues. It’s supporting for Android and iOS Platform.</li>
<li>Test Labs: is a cloud-based app-testing infrastructure. It provides <b>a large number of mobile test devices</b> to help you test your apps. It’s supporting for Android and iOS Platform.</li>
</ol>
</div>
</div>

<div id="outline-container-org231c052" class="outline-4">
<h4 id="org231c052"><span class="section-number-4">1.2.3</span> Grow your business</h4>
<div class="outline-text-4" id="text-1-2-3">
<p>
Firebase helps you grow to millions of users, simplifying user engagement and retention using:
</p>

<ol class="org-ol">
<li>In-App Messaging: helps you engage users who are actively using your app by <b>sending them targeted and contextual messages</b> that nudge them to complete key in-app actions — like beating a game level, buying an item, or subscribing to content. It’s supporting for Android and iOS Platform.</li>
<li>Google Analytics: for Firebase is a free app measurement solution that provides insight on <b>app usage and user engagement</b>. At the heart of Firebase is Google Analytics for Firebase, a free and unlimited analytics solution. Analytics integrates across Firebase features and provides you with unlimited reporting for up to 500 distinct events that you can define using the Firebase SDK. Analytics reports help you understand clearly how your users behave, which enables you to make informed decisions regarding app marketing and performance optimizations. It’s supporting for Android, iOS, C++ and Unity Platform.</li>
<li>Predictions: applies <b>machine learning</b> to your analytics data to create dynamic user segments based on the predicted behavior of users in your app. These predictions are automatically available for use with Firebase Remote Config, the Notifications composer, Firebase In-App Messaging, and A/B Testing. You can also link your app’s Predictions data to BigQuery so you can get daily exports that you can further analyze or push to third party tools. It’s supporting for Android, iOS, C++ and Unity Platform.</li>
<li>A/B Testing: helps you optimize your app experience by making it easy to run, analyze, and scale product and marketing experiments. It gives you the power to test changes to your app’s UI, features, or engagement campaigns to see if they actually move the needle on your key metrics (like revenue and retention) before you roll them out widely. It’s supporting for Android, iOS, C++ and Unity Platform.</li>
<li>Cloud Messaging(FCM): provides a reliable and battery-efficient connection between your server and devices that allows you to deliver and receive messages and notifications on iOS, Android, and the web at no cost.</li>
<li>Remote Config: essentially allows us to publish updates to our users immediately. Whether we wish to change the color scheme for a screen, the layout for a particular section in our app or show promotional/seasonal options — this is completely doable using the server side parameters without the need to publish a new version. It’s supporting for Android, iOS, C++ and Unity Platform.</li>
<li>Dynamic Links: With Dynamic Links, your users get the best available experience for the platform they open your link on. If a user opens a Dynamic Link on iOS or Android, they can be taken directly to the linked content in your native app. If a user opens the same Dynamic Link in a desktop browser, they can be taken to the equivalent content on your website. It’s supporting for Android, iOS, Web, C++ and Unity Platform.</li>
<li>App Indexing: gets your app into Google Search. If users have your app installed, they can launch your app and go directly to the content they’re searching for. App Indexing reengages your app users by helping them find both public and personal content right on their device, even offering query autocompletion to help them more quickly find what they need. If users don’t yet have your app, relevant queries trigger an install card for your app in Search results. It’s supporting for Android and iOS Platform.</li>
</ol>
</div>
</div>
</div>
</div>

<div id="outline-container-SW-Firebase-database" class="outline-2">
<h2 id="SW-Firebase-database"><span class="section-number-2">2</span> Firebase database</h2>
<div class="outline-text-2" id="text-SW-Firebase-database">
<p>
Firebase offers two cloud-based, client-accessible database solutions that support realtime data syncing:
</p>

<ul class="org-ul">
<li>Cloud Firestore is Firebase&rsquo;s <b>newest</b> database for mobile app development. It builds on the successes of the Realtime Database with a <b>new, more intuitive data model</b>. Cloud Firestore also features <b>richer, faster queries</b> and scales further than the Realtime Database.</li>
<li>Realtime Database is Firebase&rsquo;s <b>original</b> database. It&rsquo;s an efficient, low-latency solution for mobile apps that require synced states across clients in realtime.</li>
</ul>
</div>

<div id="outline-container-org930ee54" class="outline-3">
<h3 id="org930ee54"><span class="section-number-3">2.1</span> Data model</h3>
<div class="outline-text-3" id="text-2-1">
<p>
Both Realtime Database and Cloud Firestore are NoSQL Databases<sup><a id="fnr.3" class="footref" href="#fn.3">3</a></sup>.
</p>
<table id="org21c3191" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Realtime Database</th>
<th scope="col" class="org-left">Cloud Firestore</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Stores data as one large JSON tree.</td>
<td class="org-left">Stores data as collections of documents.</td>
</tr>

<tr>
<td class="org-left">- Simple data is very easy to store.</td>
<td class="org-left">- Simple data is easy to store in documents, which are very similar to JSON.</td>
</tr>

<tr>
<td class="org-left">- Complex, hierarchical data is harder to organize at scale.</td>
<td class="org-left">- Complex, hierarchical data is easier to organize at scale, using subcollections within documents.</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">- Requires less denormalization and data flattening.</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-SW-Firebase-datamodel" class="outline-2">
<h2 id="SW-Firebase-datamodel"><span class="section-number-2">3</span> Cloud Firestore Data model</h2>
<div class="outline-text-2" id="text-SW-Firebase-datamodel">
<p>
Cloud Firestore is a NoSQL, document-oriented database. Unlike a SQL database, there are no tables or rows. Instead, you store data in <b>documents</b>, which are organized into <b>collections</b>.
</p>

<p>
Each document contains a set of key-value pairs. Cloud Firestore is optimized for storing large collections of small documents.
</p>

<p>
All documents must be stored in collections. Documents can contain subcollections and nested objects, both of which can include primitive fields like strings or complex objects like lists.
</p>

<p>
Collections and documents are created implicitly in Cloud Firestore. Simply assign data to a document within a collection. If either the collection or document does not exist, Cloud Firestore creates it.
</p>
</div>

<div id="outline-container-orgc26efd9" class="outline-3">
<h3 id="orgc26efd9"><span class="section-number-3">3.1</span> Documents</h3>
<div class="outline-text-3" id="text-3-1">
<p>
In Cloud Firestore, the unit of storage is the document. A document is a lightweight record that contains fields, which map to values. Each document is identified by a name.
</p>

<p>
A document representing a user alovelace might look like this:
</p>
<pre class="example">
first : "Ada"
last : "Lovelace"
born : 1815
</pre>

<p>
Complex, <b>nested objects in a document</b> are called <b>maps</b>. For example, you could structure the user&rsquo;s name from the example above with a map, like this:
</p>

<pre class="example">
name :
    first : "Ada"
    last : "Lovelace"
born : 1815
</pre>

<p>
You may notice that documents <b>look a lot like JSON</b>. In fact, <b>they basically are</b>. There are some differences (for example, documents support extra data types and are limited in size to 1 MB), but in general, you can treat documents as lightweight JSON records.
</p>
</div>
</div>

<div id="outline-container-orgd5ba4f1" class="outline-3">
<h3 id="orgd5ba4f1"><span class="section-number-3">3.2</span> Collections</h3>
<div class="outline-text-3" id="text-3-2">
<p>
Documents live in collections, which are simply containers for documents.
</p>
<p width="400">
<img src="images/structure-data.png" alt="structure-data.png" width="400" />
For example, you could have a users collection to contain your various users, each represented by a document:
</p>
<pre class="example">
collections_bookmark users

    alovelace

    first : "Ada"
    last : "Lovelace"
    born : 1815

    aturing

    first : "Alan"
    last : "Turing"
    born : 1912
</pre>
<p>
Cloud Firestore is schemaless, so you have complete freedom over what fields you put in each document and what data types you store in those fields. Documents within the same collection can all contain different fields or store different types of data in those fields. However, it&rsquo;s a good idea to use the same fields and data types across multiple documents, so that you can query the documents more easily.
</p>

<p>
A collection contains documents and nothing else. It can&rsquo;t directly contain raw fields with values, and it can&rsquo;t contain other collections. (See Hierarchical Data for an explanation of how to structure more complex data in Cloud Firestore.)
</p>

<p>
The names of documents within a collection are unique. You can provide your own keys, such as user IDs, or you can let Cloud Firestore create random IDs for you automatically.
</p>

<p>
You do not need to &ldquo;create&rdquo; or &ldquo;delete&rdquo; collections. After you create the first document in a collection, the collection exists. If you delete all of the documents in a collection, it no longer exists.
</p>
</div>
</div>

<div id="outline-container-org753d928" class="outline-3">
<h3 id="org753d928"><span class="section-number-3">3.3</span> References</h3>
<div class="outline-text-3" id="text-3-3">
<p>
Every document in Cloud Firestore is <b>uniquely identified</b> by its location within the database. The previous example showed a document alovelace within the collection users. To refer to this location in your code, you can create a reference to it.
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span><span style="color: #51afef;">let</span> alovelaceDocumentRef = db.<span style="color: #c678dd;">collection</span>(<span style="color: #98be65;">"users"</span>).<span style="color: #c678dd;">document</span>(<span style="color: #98be65;">"alovelace"</span>)
</pre>
</div>

<p>
A reference is <b>a lightweight object that just points to a location in your database</b>. You can create a reference <b>whether or not data exists there</b>, and creating a reference does not perform any network operations.
</p>

<p>
You can also create references to collections:
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span><span style="color: #51afef;">let</span> usersCollectionRef = db.<span style="color: #c678dd;">collection</span>(<span style="color: #98be65;">"users"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org689c399" class="outline-3">
<h3 id="org689c399"><span class="section-number-3">3.4</span> Supported data types</h3>
<div class="outline-text-3" id="text-3-4">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Data type</th>
<th scope="col" class="org-left">Sort order</th>
<th scope="col" class="org-left">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Array</td>
<td class="org-left">By element values</td>
<td class="org-left">An array cannot contain another array value as one of its elements.</td>
</tr>

<tr>
<td class="org-left">Boolean</td>
<td class="org-left">false &lt; true</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Bytes</td>
<td class="org-left">Byte order</td>
<td class="org-left">Up to 1,048,487 bytes (1 MiB - 89 bytes). Only the first 1,500 bytes are considered by queries.</td>
</tr>

<tr>
<td class="org-left">Data and time</td>
<td class="org-left">Chronological</td>
<td class="org-left">When stored in Cloud Firestore, precise only to microseconds; any additional precision is rounded down.</td>
</tr>

<tr>
<td class="org-left">Floating-point-number</td>
<td class="org-left">Numeric</td>
<td class="org-left">64-bit double precision, IEEE 754.</td>
</tr>

<tr>
<td class="org-left">Geographical point</td>
<td class="org-left">By latitude, then longitude</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Integer</td>
<td class="org-left">Numeric</td>
<td class="org-left">64-bit, signed</td>
</tr>

<tr>
<td class="org-left">Map</td>
<td class="org-left">By keys, then by value</td>
<td class="org-left">Key ordering is always sorted. For example, if you write {c: &ldquo;foo&rdquo;, a: &ldquo;bar&rdquo;, b: &ldquo;qux&rdquo;} the map is sorted by key and saved as {a: &ldquo;bar&rdquo;, b: &ldquo;qux&rdquo;, c: &ldquo;foo&rdquo;}.</td>
</tr>

<tr>
<td class="org-left">Null</td>
<td class="org-left">None</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Reference</td>
<td class="org-left">By path elements (collection, document ID, collection, document ID&#x2026;)</td>
<td class="org-left">For example, projects/[PROJECT_ID]/databases/[DATABASE_ID]/documents/[DOCUMENT_PATH].</td>
</tr>

<tr>
<td class="org-left">Text string</td>
<td class="org-left">UTF-8 encoded byte order</td>
<td class="org-left">Up to 1,048,487 bytes (1 MiB - 89 bytes). Only the first 1,500 bytes of the UTF-8 representation are considered by queries.</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org338e843" class="outline-3">
<h3 id="org338e843"><span class="section-number-3">3.5</span> Index types in Cloud Firestore</h3>
<div class="outline-text-3" id="text-3-5">
<p>
Indexes are an important factor in the performance of a database. Much like the index of a book which maps topics in a book to page numbers, a database index maps the items in a database to their locations in the database. When you send a database a query, the database can use an index to quickly look up the locations of the items you requested.
</p>

<p>
This page describes the two types of indexes that Cloud Firestore uses, single-field indexes and composite indexes.
</p>
</div>

<div id="outline-container-org68112ec" class="outline-4">
<h4 id="org68112ec"><span class="section-number-4">3.5.1</span> An index behind every query</h4>
<div class="outline-text-4" id="text-3-5-1">
<p>
If no index exists for a query, most databases crawl through their contents item by item, a slow process that slows down even more as the database grows. Cloud Firestore guarantees high query performance by using indexes for all queries. As a result, query performance depends on the size of the result set and not on the number of items in the database.
</p>
</div>
</div>

<div id="outline-container-org3396ba1" class="outline-4">
<h4 id="org3396ba1"><span class="section-number-4">3.5.2</span> Less index management, more app development</h4>
<div class="outline-text-4" id="text-3-5-2">
<p>
Cloud Firestore includes features that reduce the amount of time you need to spend managing indexes. The indexes required for the most basic queries are automatically created for you. As you use and test your app, Cloud Firestore helps you identify and create additional indexes your app requires.
</p>
</div>
</div>

<div id="outline-container-org0cb29be" class="outline-4">
<h4 id="org0cb29be"><span class="section-number-4">3.5.3</span> Automatic indexing</h4>
<div class="outline-text-4" id="text-3-5-3">
<p>
By default, Cloud Firestore automatically maintains single-field indexes for each field in a document and each subfield in a map. Cloud Firestore uses the following default settings for single-field indexes:
</p>
<ul class="org-ul">
<li>For each non-array and non-map field, Cloud Firestore defines two collection-scope single-field indexes, one in ascending mode and one in descending mode.</li>
<li>For each map field, Cloud Firestore creates one collection-scope ascending index and one descending index for each non-array and non-map subfield in the map.</li>
<li>For each array field in a document, Cloud Firestore creates and maintains a collection-scope array-contains index.</li>
<li>Single-field indexes with collection group scope are not maintained by default.</li>
</ul>
</div>
</div>
</div>
</div>

<div id="outline-container-SW-Firebase-CreateDatabase" class="outline-2">
<h2 id="SW-Firebase-CreateDatabase"><span class="section-number-2">4</span> Create your own Cloud Firestore database</h2>
<div class="outline-text-2" id="text-SW-Firebase-CreateDatabase">
<ol class="org-ol">
<li>Sign in <a href="https://firebase.google.com">https://firebase.google.com</a></li>
<li>Click Get started</li>
<li>Two mode of Firebase web navigation
<ul class="org-ul">
<li>console</li>
<li>docs: 讀doc破萬卷、寫code如有神</li>
</ul></li>
<li>Create project</li>
<li>Create a Cloud Firestore database
<ol class="org-ol">
<li>If you haven&rsquo;t already, create a Firebase project: In the Firebase console, click <b>Add project</b>, then follow the on-screen instructions to create a Firebase project or to add Firebase services to an existing GCP project.</li>
<li>Navigate to the <b>Cloud Firestore section</b> of the <b>Firebase console</b>. You&rsquo;ll be prompted to select an existing Firebase project. Follow the database creation workflow.</li>
<li>Select a starting mode for your Cloud Firestore Security Rules:
<ul class="org-ul">
<li><p>
Locked mode
Denies all reads and writes from mobile and web clients. Your authenticated application servers (C#, Go, Java, Node.js, PHP, Python, or Ruby) can still access your database.
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span>rules_version = '<span style="color: #da8548; font-weight: bold;">2</span>';
<span class="linenr">2: </span>service cloud.<span style="color: #dcaeea;">firestore</span> {
<span class="linenr">3: </span>  match /databases/{database}/documents {
<span class="linenr">4: </span>    match /{document=**} {
<span class="linenr">5: </span>      allow read, write: <span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">false</span>;
<span class="linenr">6: </span>    }
<span class="linenr">7: </span>  }
<span class="linenr">8: </span>}
</pre>
</div>
<p>
To get started with the C#, Go, Java, Node.js, PHP, Python, or Ruby server client library, select locked mode.Select a location for you database.
</p></li>
<li><p>
Test mode
<b>Good for getting</b> started with the mobile and web client libraries, but allows <b>anyone</b> to read and overwrite your data. <b>After testing, make sure to review the Secure your data section</b>.
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span>rules_version = '<span style="color: #da8548; font-weight: bold;">2</span>';
<span class="linenr">2: </span>service cloud.<span style="color: #dcaeea;">firestore</span> {
<span class="linenr">3: </span>  match /databases/{database}/documents {
<span class="linenr">4: </span>    match /{document=**} {
<span class="linenr">5: </span>      allow read, write: <span style="color: #51afef;">if</span>
<span class="linenr">6: </span>          request.<span style="color: #dcaeea;">time</span> &lt; timestamp.<span style="color: #c678dd;">date</span>(<span style="color: #da8548; font-weight: bold;">2021</span>, <span style="color: #da8548; font-weight: bold;">4</span>, <span style="color: #da8548; font-weight: bold;">15</span>);
<span class="linenr">7: </span>    }
<span class="linenr">8: </span>  }
<span class="linenr">9: </span>}
</pre>
</div>
<p>
To get started with the web, iOS, or Android SDK, select test mode.
</p></li>
</ul></li>
<li>Select a location for your database.
This location setting is your project&rsquo;s default Google Cloud Platform (GCP) resource location. Note that this location will be used for GCP services in your project that require a location setting, specifically, your default Cloud Storage bucket and your App Engine app (which is required if you use Cloud Scheduler).
If you aren&rsquo;t able to select a location, then your project already has a default GCP resource location. It was set either during project creation or when setting up another service that requires a location setting.</li>
<li>done</li>
</ol></li>
<li>Create your own collection in your database
You can create multiple collections in one database</li>
<li>Why you should switch to english mode when reading Firebase Web pages?</li>
</ol>
</div>
</div>

<div id="outline-container-SW-Firebase-AddFirebase" class="outline-2">
<h2 id="SW-Firebase-AddFirebase"><span class="section-number-2">5</span> Adding Firebase to your iOS project</h2>
<div class="outline-text-2" id="text-SW-Firebase-AddFirebase">
</div>
<div id="outline-container-orgd21e28f" class="outline-3">
<h3 id="orgd21e28f"><span class="section-number-3">5.1</span> key process</h3>
<div class="outline-text-3" id="text-5-1">
<ol class="org-ol">
<li>Create a FIrebase project [DONE]</li>
<li>Register your app with Firebase</li>
<li>Add a Firebase configuration file</li>
<li>Add Firebase SDKs to your app</li>
<li>Initialize Firebase in your app</li>
</ol>
<p>
詳組說明參見<a href="https://firebase.google.com/docs/ios/setup">Firebase Documentation</a>
</p>
</div>
</div>

<div id="outline-container-orgaa08b15" class="outline-3">
<h3 id="orgaa08b15"><span class="section-number-3">5.2</span> Setting up Firebase project: Step by step</h3>
<div class="outline-text-3" id="text-5-2">
</div>
<div id="outline-container-org7f155ae" class="outline-4">
<h4 id="org7f155ae"><span class="section-number-4">5.2.1</span> Create/Register</h4>
<div class="outline-text-4" id="text-5-2-1">
<ol class="org-ol">
<li>Create or open a Firebase project
Firebase Console: <a href="https://console.firebase.google.com/">https://console.firebase.google.com/</a></li>
<li>Add Firebase to your iOS app
<ol class="org-ol">
<li>Register app
<ul class="org-ul">
<li>iOS bundle ID</li>
<li>App nickname (optional)</li>
<li>App Store ID (optional)</li>
</ul></li>
<li>Download config file
this config file (GoogleService-info.plist) will be added to your project</li>
</ol></li>
</ol>
</div>
</div>
<div id="outline-container-org8811d86" class="outline-4">
<h4 id="org8811d86"><span class="section-number-4">5.2.2</span> Install SDKs</h4>
<div class="outline-text-4" id="text-5-2-2">
</div>
<ol class="org-ol">
<li><a id="org25a13eb"></a>Method #1: CocoaPods<br />
<div class="outline-text-5" id="text-5-2-2-1">
<ol class="org-ol">
<li>Add Firebase SDKs
<ol class="org-ol">
<li>Create a Podfile
<ol class="org-ol">
<li>open Terminal app</li>
<li><p>
switch to Xcode folder (xcodeproj location)
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #ECBE7B;">cd</span> ~/Desktop/ProjectName
</pre>
</div></li>
<li><p>
Create Podfile (terminal command)
Create Podfile
</p>
<div class="org-src-container">
<pre class="src src-bash">pod init
</pre>
</div></li>
</ol></li>
<li>Edit Podfile
<ol class="org-ol">
<li><p>
Open your Podfile (terminal command)
</p>
<div class="org-src-container">
<pre class="src src-bash">open Podfile
</pre>
</div>
<p>
or use text editor to open Podfile
</p></li>
<li><p>
Add the following code to Podfile (target(iOS))
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #5B6268;"># </span><span style="color: #5B6268;">Uncomment the next line to define a global platform for your project</span>
<span style="color: #5B6268;"># </span><span style="color: #5B6268;">platform :ios, '9.0'</span>

target <span style="color: #98be65;">'FirebaseTask'</span> do
  <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Comment the next line if you don't want to use dynamic frameworks</span>
  use_frameworks!

  <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Pods for FirebaseTask</span>
  <span style="color: #5B6268;"># </span><span style="color: #5B6268;">the Firebase module your project need</span>
  pod <span style="color: #98be65;">'Firebase'</span>
  pod <span style="color: #98be65;">'Firebase/Firestore'</span>
  pod <span style="color: #98be65;">'Firebase/Analytics'</span>
  pod <span style="color: #98be65;">'FirebaseFirestoreSwift'</span>
end

</pre>
</div>
<p>
edit and save
</p></li>
<li>save Podfile
cmd+S or via menu File/Save</li>
</ol></li>
<li><p>
Install Firebase SDK by pod install (terminal command)
</p>
<div class="org-src-container">
<pre class="src src-bash">pod install
</pre>
</div>
<p>
and then wait&#x2026;&#x2026;
</p></li>
</ol></li>
</ol>
</div>
</li>
<li><a id="org6163de4"></a>Method #2: Swift Package Manager for Firebase<br />
<div class="outline-text-5" id="text-5-2-2-2">
<ol class="org-ol">
<li>If you&rsquo;ve previously used CocoaPods, remove them from the project with pod deintegrate.</li>
<li><p>
Install Firebase via Swift Package Manager:
</p>

<div id="orgdc5ad51" class="figure">
<p><img src="images/sdk-1.jpg" alt="sdk-1.jpg" width="500" />
</p>
<p><span class="figure-number">Figure 1: </span>Install Firebase SDK #1</p>
</div></li>
<li><p>
Select the Firebase GitHub repository
ios sdk URL: <a href="https://github.com/firebase/firebase-ios-sdk.git">https://github.com/firebase/firebase-ios-sdk.git</a>:
</p>

<div id="orge8de814" class="figure">
<p><img src="images/sdk-2.jpg" alt="sdk-2.jpg" width="500" />
</p>
<p><span class="figure-number">Figure 2: </span>Install Firebase SDK #2</p>
</div></li>
<li><p>
Select the Branch: maser
</p>

<div id="orgd0591cf" class="figure">
<p><img src="images/sdk-3.jpg" alt="sdk-3.jpg" width="500" />
</p>
<p><span class="figure-number">Figure 3: </span>Install Firebase SDK #3</p>
</div></li>
<li><p>
Wait about 2000 years
</p>

<div id="org2908224" class="figure">
<p><img src="images/sdk-3.jpg" alt="sdk-3.jpg" width="500" />
</p>
<p><span class="figure-number">Figure 4: </span>Install Firebase SDK #3</p>
</div></li>
<li><p>
Choose the Firebase products that you want installed in your app.
</p>

<div id="orgaaacd94" class="figure">
<p><img src="images/sdk-4.jpg" alt="sdk-4.jpg" width="500" />
</p>
<p><span class="figure-number">Figure 5: </span>Install Firebase SDK #4</p>
</div></li>
<li><p>
DEMO
</p>

<div id="org6953abb" class="figure">
<p><img src="images/sdk.gif" alt="sdk.gif" width="500" />
</p>
<p><span class="figure-number">Figure 6: </span>Install Firebase SDK #DEMO</p>
</div></li>
</ol>
</div>
</li>
<li><a id="org4de5ae3"></a>Initialize Project<br />
<div class="outline-text-5" id="text-5-2-2-3">
<ol class="org-ol">
<li>Open your project (xcworkspace)</li>
<li>add config file (GoogleService-info.plist) to your project</li>
<li><p>
Add initialization code
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span><span style="color: #51afef;">import</span> Firebase
</pre>
</div>
<p>
Initilize the App struct by adding the following code
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #51afef;">import</span> SwiftUI
<span class="linenr"> 2: </span><span style="color: #51afef;">import</span> Firebase
<span class="linenr"> 3: </span><span style="color: #51afef;">@main</span>
<span class="linenr"> 4: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">FirebaseTaskApp</span>: App {
<span class="linenr"> 5: </span>    <span style="color: #5B6268;">// </span><span style="color: #5B6268;">configure Firebase database</span>
<span class="linenr"> 6: </span>    <span style="color: #51afef;">init</span>() {
<span class="linenr"> 7: </span>        FirebaseApp.<span style="color: #c678dd;">configure</span>()
<span class="linenr"> 8: </span>    }
<span class="linenr"> 9: </span>    <span style="color: #51afef;">var</span> body: <span style="color: #51afef;">some</span> Scene {
<span class="linenr">10: </span>        WindowGroup {
<span class="linenr">11: </span>            <span style="color: #c678dd;">ContentView</span>()
<span class="linenr">12: </span>        }
<span class="linenr">13: </span>    }
<span class="linenr">14: </span>}
</pre>
</div></li>
</ol>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-org47d328b" class="outline-3">
<h3 id="org47d328b"><span class="section-number-3">5.3</span> 資料來源</h3>
<div class="outline-text-3" id="text-5-3">
<ul class="org-ul">
<li><a href="https://1998design.medium.com/%E5%A6%82%E4%BD%95-%E5%B0%87firebase%E5%8A%A0%E5%85%A5ios-swiftui-2-2020-d4315d0173ca">如何：將Firebase加入iOS SwiftUI 2 (2020)</a></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-SW-Firebase-BasicOperations" class="outline-2">
<h2 id="SW-Firebase-BasicOperations"><span class="section-number-2">6</span> Basic operations to Firebase with iOS</h2>
<div class="outline-text-2" id="text-SW-Firebase-BasicOperations">
<ul class="org-ul">
<li>Important: Check/Edit the rules of your Cloud Firestore before connecting to it.</li>
</ul>
<p>
Create a button on View for trying the following function
</p>
</div>
<div id="outline-container-orgf8991f3" class="outline-3">
<h3 id="orgf8991f3"><span class="section-number-3">6.1</span> Add document</h3>
<div class="outline-text-3" id="text-6-1">
</div>
<div id="outline-container-org76bc0e7" class="outline-4">
<h4 id="org76bc0e7"><span class="section-number-4">6.1.1</span> create a document with specific document ID</h4>
<div class="outline-text-4" id="text-6-1-1">
<ul class="org-ul">
<li><p>
setData
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span>store.<span style="color: #c678dd;">collection</span>(<span style="color: #98be65;">"tasks"</span>).<span style="color: #c678dd;">document</span>().<span style="color: #c678dd;">setData</span>(documentData: [<span style="color: #c678dd;">String</span> : Any])
</pre>
</div></li>
<li><p>
setData and catch error
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span>store.<span style="color: #c678dd;">collection</span>(<span style="color: #98be65;">"tasks"</span>).<span style="color: #c678dd;">document</span>().<span style="color: #c678dd;">setData</span>(documentData: [<span style="color: #c678dd;">String</span> : Any]) {
<span class="linenr">2: </span>    err <span style="color: #51afef;">in</span>
<span class="linenr">3: </span>    <span style="color: #51afef;">if</span> <span style="color: #51afef;">let</span> err = err {
<span class="linenr">4: </span>        <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"Error writing document: \(</span>err<span style="color: #98be65;">)"</span>)
<span class="linenr">5: </span>    } <span style="color: #51afef;">else</span> {
<span class="linenr">6: </span>        <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"Document successfully written!"</span>)
<span class="linenr">7: </span>    }
<span class="linenr">8: </span>}
<span class="linenr">9: </span>
</pre>
</div></li>
<li><p>
範例
ContentView.swift
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">Created by yen yung chin on 2021/3/17.</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">import</span> SwiftUI
<span class="linenr"> 3: </span><span style="color: #51afef;">import</span> Firebase
<span class="linenr"> 4: </span>
<span class="linenr"> 5: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">ContentView</span>: View {
<span class="linenr"> 6: </span>    <span style="color: #51afef;">var</span> body: <span style="color: #51afef;">some</span> View {
<span class="linenr"> 7: </span>        <span style="color: #51afef;">let</span> store = Firestore.<span style="color: #c678dd;">firestore</span>()
<span class="linenr"> 8: </span>        <span style="color: #c678dd;">Button</span>(action: {
<span class="linenr"> 9: </span>            store.<span style="color: #c678dd;">collection</span>(<span style="color: #98be65;">"tasks"</span>).<span style="color: #c678dd;">document</span>(<span style="color: #98be65;">"new"</span>).<span style="color: #c678dd;">setData</span>([<span style="color: #98be65;">"title"</span> : <span style="color: #98be65;">"testing setData()"</span>, <span style="color: #98be65;">"completion"</span> : <span style="color: #a9a1e1;">true</span>])
<span class="linenr">10: </span>        }, label: {
<span class="linenr">11: </span>            <span style="color: #c678dd;">Text</span>(<span style="color: #98be65;">"New Task"</span>)
<span class="linenr">12: </span>        })
<span class="linenr">13: </span>    }
<span class="linenr">14: </span>}
</pre>
</div></li>
<li>Question: What happen if you try to repeat clicking button to add document with the same ID</li>
</ul>
</div>
</div>
<div id="outline-container-orgdbbbbe2" class="outline-4">
<h4 id="orgdbbbbe2"><span class="section-number-4">6.1.2</span> create a document with auto-generate document ID</h4>
<div class="outline-text-4" id="text-6-1-2">
<ul class="org-ul">
<li><p>
addDocument()
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span>store.<span style="color: #c678dd;">collection</span>(<span style="color: #98be65;">"tasks"</span>).<span style="color: #c678dd;">addDocument</span>(data: [<span style="color: #c678dd;">String</span> : Any]&gt;)
</pre>
</div></li>
<li><p>
add document and catch error
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">Created by yen yung chin on 2021/3/17.</span>
<span class="linenr">2: </span>store.<span style="color: #c678dd;">collection</span>().<span style="color: #c678dd;">addDocument</span>(data) { err <span style="color: #51afef;">in</span>
<span class="linenr">3: </span>    <span style="color: #51afef;">if</span> <span style="color: #51afef;">let</span> err = err {
<span class="linenr">4: </span>        <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"Error adding document: \(</span>err<span style="color: #98be65;">)."</span>)
<span class="linenr">5: </span>    } <span style="color: #51afef;">else</span> {
<span class="linenr">6: </span>        <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"Adding Document successfully."</span>)
<span class="linenr">7: </span>    }
<span class="linenr">8: </span>}
</pre>
</div></li>
<li>範例
ContentView.swift</li>
</ul>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">Created by yen yung chin on 2021/3/17.</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">import</span> SwiftUI
<span class="linenr"> 3: </span><span style="color: #51afef;">import</span> Firebase
<span class="linenr"> 4: </span>
<span class="linenr"> 5: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">ContentView</span>: View {
<span class="linenr"> 6: </span>    <span style="color: #51afef;">var</span> body: <span style="color: #51afef;">some</span> View {
<span class="linenr"> 7: </span>        <span style="color: #51afef;">let</span> store = Firestore.<span style="color: #c678dd;">firestore</span>()
<span class="linenr"> 8: </span>        <span style="color: #c678dd;">Button</span>(action: {
<span class="linenr"> 9: </span>                store.<span style="color: #c678dd;">collection</span>(<span style="color: #98be65;">"tasks"</span>).<span style="color: #c678dd;">addDocument</span>(data: [<span style="color: #98be65;">"title"</span>: <span style="color: #98be65;">"222"</span>, <span style="color: #98be65;">"completion"</span> : <span style="color: #a9a1e1;">false</span>]) { err <span style="color: #51afef;">in</span>
<span class="linenr">10: </span>                <span style="color: #51afef;">if</span> <span style="color: #51afef;">let</span> err = err {
<span class="linenr">11: </span>                    <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"Error adding document: \(</span>err<span style="color: #98be65;">)."</span>)
<span class="linenr">12: </span>                } <span style="color: #51afef;">else</span> {
<span class="linenr">13: </span>                    <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"Adding Document successfully."</span>)
<span class="linenr">14: </span>                }
<span class="linenr">15: </span>            }
<span class="linenr">16: </span>        }, label: {
<span class="linenr">17: </span>            <span style="color: #c678dd;">Text</span>(<span style="color: #98be65;">"New Task"</span>)
<span class="linenr">18: </span>        })
<span class="linenr">19: </span>    }
<span class="linenr">20: </span>}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org0a34c29" class="outline-3">
<h3 id="org0a34c29"><span class="section-number-3">6.2</span> Get data from Cloud Firestore: Basic</h3>
<div class="outline-text-3" id="text-6-2">
</div>
<div id="outline-container-org9f29909" class="outline-4">
<h4 id="org9f29909"><span class="section-number-4">6.2.1</span> Getting collection</h4>
<div class="outline-text-4" id="text-6-2-1">
<ul class="org-ul">
<li><p>
語法
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span>
</pre>
</div></li>
<li><p>
範例
ContentView.swift
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">Created by yen yung chin on 2021/3/17.</span>
<span class="linenr"> 2: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span><span style="color: #51afef;">import</span> SwiftUI
<span class="linenr"> 5: </span><span style="color: #51afef;">import</span> Firebase
<span class="linenr"> 6: </span>
<span class="linenr"> 7: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">ContentView</span>: View {
<span class="linenr"> 8: </span>    <span style="color: #51afef;">var</span> body: <span style="color: #51afef;">some</span> View {
<span class="linenr"> 9: </span>        <span style="color: #51afef;">let</span> store = Firestore.<span style="color: #c678dd;">firestore</span>()
<span class="linenr">10: </span>        <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#36889;&#20491;Firebase&#36039;&#26009;&#24235;&#29289;&#20214;&#28858;&#26085;&#24460;&#23384;&#21462;&#12289;&#22686;&#21034;Firebase&#36039;&#26009;</span>
<span class="linenr">11: </span>        <span style="color: #c678dd;">Button</span>(action: {
<span class="linenr">12: </span>            store.<span style="color: #c678dd;">collection</span>(<span style="color: #98be65;">"tasks"</span>).<span style="color: #dcaeea;">getDocuments</span> { (querySnapshot, error) <span style="color: #51afef;">in</span>
<span class="linenr">13: </span>                <span style="color: #51afef;">if</span> <span style="color: #51afef;">let</span> querySnapshot = querySnapshot {
<span class="linenr">14: </span>                    <span style="color: #51afef;">for</span> document <span style="color: #51afef;">in</span> querySnapshot.<span style="color: #dcaeea;">documents</span> {
<span class="linenr">15: </span>                        <span style="color: #c678dd;">print</span>(document.<span style="color: #c678dd;">data</span>())
<span class="linenr">16: </span>                    }
<span class="linenr">17: </span>                }
<span class="linenr">18: </span>            }
<span class="linenr">19: </span>        }, label: {
<span class="linenr">20: </span>            <span style="color: #c678dd;">Text</span>(<span style="color: #98be65;">"Button"</span>)
<span class="linenr">21: </span>        })
<span class="linenr">22: </span>    }
<span class="linenr">23: </span>}
</pre>
</div></li>
</ul>
</div>
</div>
<div id="outline-container-org13b4bd5" class="outline-4">
<h4 id="org13b4bd5"><span class="section-number-4">6.2.2</span> Getting document</h4>
<div class="outline-text-4" id="text-6-2-2">
<ul class="org-ul">
<li><p>
語法
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span><span style="color: #51afef;">let</span> docRef = db.<span style="color: #c678dd;">collection</span>().<span style="color: #c678dd;">document</span>()
<span class="linenr">2: </span>docRef.<span style="color: #c678dd;">getDocument</span>(source: .<span style="color: #dcaeea;">cache</span>) { (document, error) <span style="color: #51afef;">in</span>
<span class="linenr">3: </span>    <span style="color: #51afef;">if</span> <span style="color: #51afef;">let</span> document = document {
<span class="linenr">4: </span>        <span style="color: #51afef;">let</span> dataDescription = document.<span style="color: #c678dd;">data</span>().<span style="color: #c678dd;">map</span>(<span style="color: #c678dd;">String</span>.<span style="color: #51afef;">init</span>(describing:)) ?? <span style="color: #98be65;">"nil"</span>
<span class="linenr">5: </span>        <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"Cached document data: \(</span>dataDescription<span style="color: #98be65;">)"</span>)
<span class="linenr">6: </span>    } <span style="color: #51afef;">else</span> {
<span class="linenr">7: </span>        <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"Document does not exist in cache"</span>)
<span class="linenr">8: </span>    }
<span class="linenr">9: </span>}
</pre>
</div></li>
<li><p>
範例
ContentView.swift
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">Created by yen yung chin on 2021/3/17.</span>
<span class="linenr"> 2: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span><span style="color: #51afef;">import</span> SwiftUI
<span class="linenr"> 5: </span><span style="color: #51afef;">import</span> Firebase
<span class="linenr"> 6: </span>
<span class="linenr"> 7: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">ContentView</span>: View {
<span class="linenr"> 8: </span>    <span style="color: #51afef;">var</span> body: <span style="color: #51afef;">some</span> View {
<span class="linenr"> 9: </span>        <span style="color: #51afef;">let</span> store = Firestore.<span style="color: #c678dd;">firestore</span>()
<span class="linenr">10: </span>        <span style="color: #c678dd;">Button</span>(action: {
<span class="linenr">11: </span>            <span style="color: #51afef;">let</span> docRef = store.<span style="color: #c678dd;">collection</span>(<span style="color: #98be65;">"tasks"</span>).<span style="color: #c678dd;">document</span>(<span style="color: #98be65;">"new"</span>)
<span class="linenr">12: </span>            docRef.<span style="color: #dcaeea;">getDocument</span> { (document, error) <span style="color: #51afef;">in</span>
<span class="linenr">13: </span>                <span style="color: #51afef;">if</span> <span style="color: #51afef;">let</span> document = document, document.<span style="color: #dcaeea;">exists</span> {
<span class="linenr">14: </span>                    <span style="color: #51afef;">let</span> dataDescription = document.<span style="color: #c678dd;">data</span>().<span style="color: #c678dd;">map</span>(<span style="color: #c678dd;">String</span>.<span style="color: #51afef;">init</span>(describing: )) ?? <span style="color: #98be65;">"nil"</span>
<span class="linenr">15: </span>                    <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"Document data: \(</span>dataDescription<span style="color: #98be65;">)"</span>)
<span class="linenr">16: </span>                } <span style="color: #51afef;">else</span> {
<span class="linenr">17: </span>                    <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"Document does not exist"</span>)
<span class="linenr">18: </span>                }
<span class="linenr">19: </span>            }
<span class="linenr">20: </span>        }, label: {
<span class="linenr">21: </span>            <span style="color: #c678dd;">Text</span>(<span style="color: #98be65;">"Button"</span>)
<span class="linenr">22: </span>        })
<span class="linenr">23: </span>    }
<span class="linenr">24: </span>}
</pre>
</div></li>
</ul>
</div>
</div>
</div>
</div>

<div id="outline-container-SW-GetDataFromCloud" class="outline-2">
<h2 id="SW-GetDataFromCloud"><span class="section-number-2">7</span> Get data from Cloud: UI with Firebase [MVVM]</h2>
<div class="outline-text-2" id="text-SW-GetDataFromCloud">
</div>
<div id="outline-container-org8672b36" class="outline-3">
<h3 id="org8672b36"><span class="section-number-3">7.1</span> MVVM architecture</h3>
<div class="outline-text-3" id="text-7-1">

<div id="org02357d6" class="figure">
<p><img src="images/mvvm-d2.png" alt="mvvm-d2.png" width="500" />
</p>
<p><span class="figure-number">Figure 7: </span>MVVM for FirebaseApp</p>
</div>
</div>
</div>
<div id="outline-container-orgeaed1b5" class="outline-3">
<h3 id="orgeaed1b5"><span class="section-number-3">7.2</span> Model</h3>
<div class="outline-text-3" id="text-7-2">
<p>
Task.swift
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #51afef;">import</span> Foundation
<span class="linenr"> 2: </span><span style="color: #51afef;">import</span> FirebaseFirestore
<span class="linenr"> 3: </span><span style="color: #51afef;">import</span> FirebaseFirestoreSwift
<span class="linenr"> 4: </span>
<span class="linenr"> 5: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">Task</span>: Identifiable, <span style="color: #c678dd;">Codable</span> {
<span class="linenr"> 6: </span>    <span style="color: #51afef;">@DocumentID</span> <span style="color: #51afef;">var</span> id: <span style="color: #c678dd;">String</span>?
<span class="linenr"> 7: </span>    <span style="color: #51afef;">var</span> title: <span style="color: #c678dd;">String</span>
<span class="linenr"> 8: </span>    <span style="color: #51afef;">var</span> completion: <span style="color: #c678dd;">Bool</span>
<span class="linenr"> 9: </span>}
<span class="linenr">10: </span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org7200dc0" class="outline-3">
<h3 id="org7200dc0"><span class="section-number-3">7.3</span> View</h3>
<div class="outline-text-3" id="text-7-3">
<p>
TaskListView.swift
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #51afef;">import</span> SwiftUI
<span class="linenr"> 2: </span>
<span class="linenr"> 3: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">TaskListView</span>: View {
<span class="linenr"> 4: </span>    <span style="color: #51afef;">@ObservedObject</span> <span style="color: #51afef;">var</span> taskListVM = <span style="color: #c678dd;">TaskListViewModel</span>()
<span class="linenr"> 5: </span>    <span style="color: #51afef;">var</span> body: <span style="color: #51afef;">some</span> View {
<span class="linenr"> 6: </span>        VStack {
<span class="linenr"> 7: </span>            <span style="color: #c678dd;">List</span>(taskListVM.<span style="color: #dcaeea;">taskCellViewModels</span>) { taskCellVM <span style="color: #51afef;">in</span>
<span class="linenr"> 8: </span>                <span style="color: #c678dd;">Text</span>(<span style="color: #98be65;">"\(</span>taskCellVM.<span style="color: #c678dd;">task</span>.<span style="color: #c678dd;">title</span><span style="color: #98be65;">)"</span>)
<span class="linenr"> 9: </span>            }
<span class="linenr">10: </span>        }
<span class="linenr">11: </span>    }
<span class="linenr">12: </span>}
</pre>
</div>
</div>
</div>
<div id="outline-container-org9893b5c" class="outline-3">
<h3 id="org9893b5c"><span class="section-number-3">7.4</span> ViewModel</h3>
<div class="outline-text-3" id="text-7-4">
<ul class="org-ul">
<li><p>
TaskCellViewModel.swift
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #51afef;">import</span> Foundation
<span class="linenr"> 2: </span><span style="color: #51afef;">import</span> Combine
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span><span style="color: #51afef;">class</span> <span style="color: #c678dd;">TaskCellViewModel</span>: <span style="color: #c678dd;">ObservableObject</span>, Identifiable {
<span class="linenr"> 5: </span>    <span style="color: #51afef;">@Published</span> <span style="color: #51afef;">var</span> task: Task
<span class="linenr"> 6: </span>
<span class="linenr"> 7: </span>    <span style="color: #51afef;">private</span> <span style="color: #51afef;">var</span> cancellables = <span style="color: #c678dd;">Set</span>&lt;AnyCancellable&gt;()
<span class="linenr"> 8: </span>    <span style="color: #51afef;">var</span> id = <span style="color: #98be65;">""</span>
<span class="linenr"> 9: </span>
<span class="linenr">10: </span>    <span style="color: #51afef;">init</span>(task: Task) {
<span class="linenr">11: </span>        <span style="color: #51afef;">self</span>.<span style="color: #c678dd;">task</span> = task
<span class="linenr">12: </span>        $task
<span class="linenr">13: </span>            .<span style="color: #c678dd;">compactMap</span> { $0.<span style="color: #dcaeea;">id</span> }
<span class="linenr">14: </span>            .<span style="color: #c678dd;">assign</span>(to: \.<span style="color: #dcaeea;">id</span>, on: <span style="color: #51afef;">self</span>)
<span class="linenr">15: </span>            .<span style="color: #c678dd;">store</span>(<span style="color: #51afef;">in</span>: &amp;cancellables)
<span class="linenr">16: </span>    }
<span class="linenr">17: </span>
<span class="linenr">18: </span>}
<span class="linenr">19: </span>
</pre>
</div></li>
<li><p>
TaskListViewModel.swift
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #51afef;">import</span> Foundation
<span class="linenr"> 2: </span><span style="color: #51afef;">import</span> Combine
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span><span style="color: #51afef;">class</span> <span style="color: #c678dd;">TaskListViewModel</span>: <span style="color: #c678dd;">ObservableObject</span> {
<span class="linenr"> 5: </span>    <span style="color: #51afef;">@Published</span> <span style="color: #51afef;">var</span> taskRepository = <span style="color: #c678dd;">TaskRepository</span>()
<span class="linenr"> 6: </span>    <span style="color: #51afef;">@Published</span> <span style="color: #51afef;">var</span> taskCellViewModels = [TaskCellViewModel]()
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span>    <span style="color: #51afef;">private</span> <span style="color: #51afef;">var</span> cancellables = <span style="color: #c678dd;">Set</span>&lt;AnyCancellable&gt;()
<span class="linenr"> 9: </span>    <span style="color: #51afef;">init</span>() {
<span class="linenr">10: </span>        taskRepository.<span style="color: #c678dd;">loadData</span>()
<span class="linenr">11: </span>
<span class="linenr">12: </span>        taskRepository.$tasks.<span style="color: #c678dd;">map</span> { tasks <span style="color: #51afef;">in</span>
<span class="linenr">13: </span>            tasks.<span style="color: #c678dd;">map</span>(TaskCellViewModel.<span style="color: #51afef;">init</span>)
<span class="linenr">14: </span>        }
<span class="linenr">15: </span>        .<span style="color: #c678dd;">assign</span>(to: \.<span style="color: #dcaeea;">taskCellViewModels</span>, on: <span style="color: #51afef;">self</span>)
<span class="linenr">16: </span>        .<span style="color: #c678dd;">store</span>(<span style="color: #51afef;">in</span>: &amp;cancellables)
<span class="linenr">17: </span>    }
<span class="linenr">18: </span>}
<span class="linenr">19: </span>
</pre>
</div></li>
</ul>
</div>
</div>
<div id="outline-container-org467cdea" class="outline-3">
<h3 id="org467cdea"><span class="section-number-3">7.5</span> Repository</h3>
<div class="outline-text-3" id="text-7-5">
<p>
TaskRepository.swift
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span>
<span class="linenr"> 2: </span><span style="color: #51afef;">import</span> Foundation
<span class="linenr"> 3: </span><span style="color: #51afef;">import</span> FirebaseFirestore
<span class="linenr"> 4: </span><span style="color: #51afef;">import</span> FirebaseFirestoreSwift
<span class="linenr"> 5: </span><span style="color: #51afef;">import</span> Combine
<span class="linenr"> 6: </span>
<span class="linenr"> 7: </span><span style="color: #51afef;">class</span> <span style="color: #c678dd;">TaskRepository</span>: <span style="color: #c678dd;">ObservableObject</span> {
<span class="linenr"> 8: </span>    <span style="color: #51afef;">private</span> <span style="color: #51afef;">let</span> db = Firestore.<span style="color: #c678dd;">firestore</span>()
<span class="linenr"> 9: </span>    <span style="color: #51afef;">@Published</span> <span style="color: #51afef;">var</span> tasks = [Task]()
<span class="linenr">10: </span>
<span class="linenr">11: </span>    <span style="color: #51afef;">func</span> <span style="color: #c678dd;">loadData</span>() {
<span class="linenr">12: </span>        db.<span style="color: #c678dd;">collection</span>(<span style="color: #98be65;">"tasks"</span>).<span style="color: #dcaeea;">addSnapshotListener</span> { (querySanpshot, error) <span style="color: #51afef;">in</span>
<span class="linenr">13: </span>
<span class="linenr">14: </span>            <span style="color: #51afef;">if</span> <span style="color: #51afef;">let</span> error = error {
<span class="linenr">15: </span>                <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"&#37679;&#35492;: \(</span>error.<span style="color: #c678dd;">localizedDescription</span><span style="color: #98be65;">)"</span>)
<span class="linenr">16: </span>            }
<span class="linenr">17: </span>
<span class="linenr">18: </span>            <span style="color: #51afef;">if</span> <span style="color: #51afef;">let</span> querySnapshot = querySanpshot {
<span class="linenr">19: </span>                <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#25226;Firebase&#20659;&#22238;&#20358;&#30340;documents&#36681;&#28858;&#31243;&#24335;&#25152;&#38656;&#30340;Model</span>
<span class="linenr">20: </span>                <span style="color: #51afef;">self</span>.<span style="color: #dcaeea;">tasks</span> = querySnapshot.<span style="color: #dcaeea;">documents</span>.<span style="color: #c678dd;">compactMap</span>({ (queryDocumentSnapshot) -&gt; Task? <span style="color: #51afef;">in</span>
<span class="linenr">21: </span>                    <span style="color: #51afef;">return</span> <span style="color: #51afef;">try</span>? queryDocumentSnapshot.<span style="color: #c678dd;">data</span>(<span style="color: #51afef;">as</span>: Task.<span style="color: #51afef;">self</span>)
<span class="linenr">22: </span>                })
<span class="linenr">23: </span>            }
<span class="linenr">24: </span>        }
<span class="linenr">25: </span>    }
<span class="linenr">26: </span>}
<span class="linenr">27: </span>
<span class="linenr">28: </span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb4f8983" class="outline-3">
<h3 id="orgb4f8983"><span class="section-number-3">7.6</span> 資料來源</h3>
<div class="outline-text-3" id="text-7-6">
<ul class="org-ul">
<li><a href="https://www.raywenderlich.com/11609977-getting-started-with-cloud-firestore-and-swiftui">Getting Started with Cloud Firestore and SwiftUI</a></li>
<li><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E8%AE%80%E5%8F%96-cloud-firestore-%E7%9A%84-database-203bdcdb5661">讀取 Cloud Firestore 的 database</a></li>
<li><a href="https://cloud.google.com/firestore/docs/query-data/get-data">Getting data</a></li>
<li><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%88%A9%E7%94%A8-firebasefirestoreswift-%E5%B0%87-firestore-%E7%9A%84%E8%B3%87%E6%96%99%E8%AE%8A%E6%88%90%E8%87%AA%E8%A8%82%E5%9E%8B%E5%88%A5-89f33c852018">利用 FirebaseFirestoreSwift 將 Firestore 的資料變成自訂型別</a></li>
<li><a href="https://peterfriese.dev/swiftui-firebase-codable/">SwiftUI: Mapping Firestore Documents using Swift Codable</a></li>
<li><a href="https://peterfriese.dev/swiftui-firebase-fetch-data/">SwiftUI: Fetching Data from Firestore in Real Time</a></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-SW-Delete" class="outline-2">
<h2 id="SW-Delete"><span class="section-number-2">8</span> Add, Delete #1 data from Cloud: UI with Firebase [MVVM]</h2>
<div class="outline-text-2" id="text-SW-Delete">
</div>
<div id="outline-container-org00bf9cf" class="outline-3">
<h3 id="org00bf9cf"><span class="section-number-3">8.1</span> Repository</h3>
<div class="outline-text-3" id="text-8-1">
<p>
TaskRepository.swift
</p>
<div class="org-src-container">
<pre class="src src-python"><span class="linenr"> 1: </span>func add(task: Task) {
<span class="linenr"> 2: </span>        do {
<span class="linenr"> 3: </span>            _ = <span style="color: #51afef;">try</span> db.collection(<span style="color: #98be65;">"todo"</span>).addDocument(<span style="color: #51afef;">from</span>: task)
<span class="linenr"> 4: </span>        } catch {
<span class="linenr"> 5: </span>            fatalError(<span style="color: #98be65;">"Add a task failed"</span>)
<span class="linenr"> 6: </span>        }
<span class="linenr"> 7: </span>    }
<span class="linenr"> 8: </span>
<span class="linenr"> 9: </span>    func delete(indexset: IndexSet) {
<span class="linenr">10: </span>        // Just show what does indexset contain
<span class="linenr">11: </span>        <span style="color: #51afef;">for</span> i <span style="color: #51afef;">in</span> indexset {
<span class="linenr">12: </span>            <span style="color: #51afef;">print</span>(i)
<span class="linenr">13: </span>        }
<span class="linenr">14: </span>        indexset.forEach { index <span style="color: #51afef;">in</span>
<span class="linenr">15: </span>            let task = tasks[index]
<span class="linenr">16: </span>            db.collection(<span style="color: #98be65;">"todo"</span>).document(task.<span style="color: #c678dd;">id</span>!).delete() { error <span style="color: #51afef;">in</span>
<span class="linenr">17: </span>                <span style="color: #51afef;">if</span> let error = error {
<span class="linenr">18: </span>                    fatalError(<span style="color: #98be65;">"Deleting a task failed, \(error.localizedDescription)"</span>)
<span class="linenr">19: </span>                }
<span class="linenr">20: </span>
<span class="linenr">21: </span>            }
<span class="linenr">22: </span>        }
<span class="linenr">23: </span>    }
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf22e0cf" class="outline-3">
<h3 id="orgf22e0cf"><span class="section-number-3">8.2</span> View</h3>
<div class="outline-text-3" id="text-8-2">
<p>
TaskListView.swift
</p>
<div class="org-src-container">
<pre class="src src-python"><span class="linenr"> 1: </span>//
<span class="linenr"> 2: </span>//  ContentView.swift
<span class="linenr"> 3: </span>//  FireTask
<span class="linenr"> 4: </span>//
<span class="linenr"> 5: </span>//  Created by yen yung chin on <span style="color: #da8548; font-weight: bold;">2021</span>/<span style="color: #da8548; font-weight: bold;">3</span>/<span style="color: #da8548; font-weight: bold;">31</span>.
<span class="linenr"> 6: </span>//
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #51afef;">import</span> SwiftUI
<span class="linenr"> 9: </span>
<span class="linenr">10: </span>struct TaskListView: View {
<span class="linenr">11: </span>    <span style="color: #ECBE7B;">@ObservedObject</span> var taskListVM = TaskListViewModel()
<span class="linenr">12: </span>    <span style="color: #ECBE7B;">@State</span> var title: String = <span style="color: #98be65;">""</span>
<span class="linenr">13: </span>    var body: some View {
<span class="linenr">14: </span>        NavigationView {
<span class="linenr">15: </span>            VStack {
<span class="linenr">16: </span>                TextField(<span style="color: #98be65;">"Task Title"</span>, text: $title)
<span class="linenr">17: </span>                    .textFieldStyle(RoundedBorderTextFieldStyle())
<span class="linenr">18: </span>
<span class="linenr">19: </span>                Button(action: {
<span class="linenr">20: </span>                    let task = Task(title: title, completed: false)
<span class="linenr">21: </span>                    taskListVM.add(task: task)
<span class="linenr">22: </span>                }, label: {
<span class="linenr">23: </span>                    Text(<span style="color: #98be65;">"Add Task"</span>)
<span class="linenr">24: </span>                }).disabled(title == <span style="color: #98be65;">""</span>) // trick 
<span class="linenr">25: </span>                Form {
<span class="linenr">26: </span>                    ForEach(taskListVM.taskCellViewModels) { taskCellVM <span style="color: #51afef;">in</span>
<span class="linenr">27: </span>                        Text(<span style="color: #98be65;">"\(taskCellVM.task.title)"</span>)
<span class="linenr">28: </span>                    }
<span class="linenr">29: </span>                    .onDelete(perform: { indexSet <span style="color: #51afef;">in</span>
<span class="linenr">30: </span>                        taskListVM.delete(indexset: indexSet)
<span class="linenr">31: </span>                    })
<span class="linenr">32: </span>                }
<span class="linenr">33: </span>                .navigationBarTitle(Text(<span style="color: #98be65;">"Task Manager"</span>), displayMode: .inline)
<span class="linenr">34: </span>            }
<span class="linenr">35: </span>        }.padding()
<span class="linenr">36: </span>    }
<span class="linenr">37: </span>}
<span class="linenr">38: </span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbefaa84" class="outline-3">
<h3 id="orgbefaa84"><span class="section-number-3">8.3</span> ViewModel</h3>
<div class="outline-text-3" id="text-8-3">
<p>
TaskListViewModel.swift
</p>
<div class="org-src-container">
<pre class="src src-python"><span class="linenr"> 1: </span>//
<span class="linenr"> 2: </span>//  TaskListViewModel.swift
<span class="linenr"> 3: </span>//  FireTask
<span class="linenr"> 4: </span>//
<span class="linenr"> 5: </span>//  Created by yen yung chin on <span style="color: #da8548; font-weight: bold;">2021</span>/<span style="color: #da8548; font-weight: bold;">4</span>/<span style="color: #da8548; font-weight: bold;">1</span>.
<span class="linenr"> 6: </span>//
<span class="linenr"> 7: </span><span style="color: #51afef;">import</span> Foundation
<span class="linenr"> 8: </span><span style="color: #51afef;">import</span> Combine
<span class="linenr"> 9: </span>
<span class="linenr">10: </span><span style="color: #51afef;">class</span> <span style="color: #ECBE7B;">TaskListViewModel</span>: ObservableObject {
<span class="linenr">11: </span>    <span style="color: #ECBE7B;">@Published</span> var taskRepository = TaskRepository()
<span class="linenr">12: </span>    <span style="color: #ECBE7B;">@Published</span> var taskCellViewModels = [TaskCellViewModel]()
<span class="linenr">13: </span>
<span class="linenr">14: </span>    private var cancellables = Set&lt;AnyCancellable&gt;()
<span class="linenr">15: </span>    init() {
<span class="linenr">16: </span>        taskRepository.loadData()
<span class="linenr">17: </span>        // &#35712;&#21462;Firebase docs&#24460;&#65292;&#36681;&#25563;id&#65292;&#20197;taskCellViewModel&#38499;&#21015;&#20786;&#23384;
<span class="linenr">18: </span>        taskRepository.$tasks.<span style="color: #c678dd;">map</span> { tasks <span style="color: #51afef;">in</span>
<span class="linenr">19: </span>            tasks.<span style="color: #c678dd;">map</span>(TaskCellViewModel.init)
<span class="linenr">20: </span>        }
<span class="linenr">21: </span>        .assign(to: \.taskCellViewModels, on: <span style="color: #51afef;">self</span>)
<span class="linenr">22: </span>        .store(<span style="color: #51afef;">in</span>: &amp;cancellables)
<span class="linenr">23: </span>    }
<span class="linenr">24: </span>
<span class="linenr">25: </span>    func add(task: Task) {
<span class="linenr">26: </span>        taskRepository.add(task: task)
<span class="linenr">27: </span>    }
<span class="linenr">28: </span>
<span class="linenr">29: </span>    func delete(indexset: IndexSet) {
<span class="linenr">30: </span>        // <span style="color: #51afef;">pass</span> indexSet
<span class="linenr">31: </span>        taskRepository.delete(indexset: indexset)
<span class="linenr">32: </span>    }
<span class="linenr">33: </span>}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgfc7ee79" class="outline-2">
<h2 id="orgfc7ee79"><span class="section-number-2">9</span> Delete #2 data from Cloud: UI with Firebase [MVVM]</h2>
<div class="outline-text-2" id="text-9">
</div>
<div id="outline-container-orgbd9964b" class="outline-3">
<h3 id="orgbd9964b"><span class="section-number-3">9.1</span> Repository</h3>
<div class="outline-text-3" id="text-9-1">
<div class="org-src-container">
<pre class="src src-python"><span class="linenr"> 1: </span>//
<span class="linenr"> 2: </span>//  TaskRepository.swift
<span class="linenr"> 3: </span>//  FireTask
<span class="linenr"> 4: </span>//
<span class="linenr"> 5: </span>//  Created by yen yung chin on <span style="color: #da8548; font-weight: bold;">2021</span>/<span style="color: #da8548; font-weight: bold;">4</span>/<span style="color: #da8548; font-weight: bold;">1</span>.
<span class="linenr"> 6: </span>//
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span>
<span class="linenr"> 9: </span><span style="color: #51afef;">import</span> Foundation
<span class="linenr">10: </span><span style="color: #51afef;">import</span> FirebaseFirestore
<span class="linenr">11: </span><span style="color: #51afef;">import</span> FirebaseFirestoreSwift
<span class="linenr">12: </span><span style="color: #51afef;">import</span> Combine
<span class="linenr">13: </span>
<span class="linenr">14: </span><span style="color: #51afef;">class</span> <span style="color: #ECBE7B;">TaskRepository</span>: ObservableObject {
<span class="linenr">15: </span>    private let db = Firestore.firestore()
<span class="linenr">16: </span>    <span style="color: #ECBE7B;">@Published</span> var tasks = [Task]()
<span class="linenr">17: </span>    func loadData() {
<span class="linenr">18: </span>
<span class="linenr">19: </span>        db.collection(<span style="color: #98be65;">"todo"</span>).addSnapshotListener { (querySanpshot, error) <span style="color: #51afef;">in</span>
<span class="linenr">20: </span>
<span class="linenr">21: </span>            <span style="color: #51afef;">if</span> let error = error {
<span class="linenr">22: </span>                <span style="color: #51afef;">print</span>(<span style="color: #98be65;">"&#37679;&#35492;: \(error.localizedDescription)"</span>)
<span class="linenr">23: </span>            }
<span class="linenr">24: </span>            // method <span style="color: #5B6268;">#</span><span style="color: #5B6268;">1</span>
<span class="linenr">25: </span>            <span style="color: #51afef;">self</span>.tasks = querySanpshot?.documents.compactMap { document <span style="color: #51afef;">in</span>
<span class="linenr">26: </span>                <span style="color: #51afef;">try</span>? document.data(<span style="color: #51afef;">as</span>: Task.<span style="color: #51afef;">self</span>)
<span class="linenr">27: </span>            } ?? []
<span class="linenr">28: </span>
<span class="linenr">29: </span>            // method <span style="color: #5B6268;">#</span><span style="color: #5B6268;">2</span>
<span class="linenr">30: </span>            <span style="color: #51afef;">if</span> let querySnapshot = querySanpshot {
<span class="linenr">31: </span>                <span style="color: #51afef;">self</span>.tasks = querySnapshot.documents.compactMap({ (queryDocumentSnapshot) -&gt; Task? <span style="color: #51afef;">in</span>
<span class="linenr">32: </span>                    <span style="color: #51afef;">return</span> <span style="color: #51afef;">try</span>? queryDocumentSnapshot.data(<span style="color: #51afef;">as</span>: Task.<span style="color: #51afef;">self</span>)
<span class="linenr">33: </span>                })
<span class="linenr">34: </span>            }
<span class="linenr">35: </span>        }
<span class="linenr">36: </span>    }
<span class="linenr">37: </span>
<span class="linenr">38: </span>    func add(task: Task) {
<span class="linenr">39: </span>        do {
<span class="linenr">40: </span>            _ = <span style="color: #51afef;">try</span> db.collection(<span style="color: #98be65;">"todo"</span>).addDocument(<span style="color: #51afef;">from</span>: task)
<span class="linenr">41: </span>        } catch {
<span class="linenr">42: </span>            fatalError(<span style="color: #98be65;">"Add a task failed"</span>)
<span class="linenr">43: </span>        }
<span class="linenr">44: </span>    }
<span class="linenr">45: </span>
<span class="linenr">46: </span>    func delete(indexset: IndexSet) {
<span class="linenr">47: </span>        // <span style="color: #51afef;">pass</span> <span style="color: #51afef;">in</span> IndexSet
<span class="linenr">48: </span>        <span style="color: #51afef;">for</span> i <span style="color: #51afef;">in</span> indexset {
<span class="linenr">49: </span>            <span style="color: #51afef;">print</span>(i)
<span class="linenr">50: </span>        }
<span class="linenr">51: </span>        indexset.forEach { index <span style="color: #51afef;">in</span>
<span class="linenr">52: </span>            let task = tasks[index]
<span class="linenr">53: </span>            db.collection(<span style="color: #98be65;">"todo"</span>).document(task.<span style="color: #c678dd;">id</span>!).delete() { error <span style="color: #51afef;">in</span>
<span class="linenr">54: </span>                <span style="color: #51afef;">if</span> let error = error {
<span class="linenr">55: </span>                    fatalError(<span style="color: #98be65;">"Deleting a task failed, \(error.localizedDescription)"</span>)
<span class="linenr">56: </span>                }
<span class="linenr">57: </span>
<span class="linenr">58: </span>            }
<span class="linenr">59: </span>        }
<span class="linenr">60: </span>    }
<span class="linenr">61: </span>
<span class="linenr">62: </span>    func delete(task: Task) {
<span class="linenr">63: </span>        // <span style="color: #51afef;">pass</span> <span style="color: #51afef;">in</span> Task
<span class="linenr">64: </span>        guard let documentID = task.<span style="color: #c678dd;">id</span> <span style="color: #51afef;">else</span> { <span style="color: #51afef;">return</span> }
<span class="linenr">65: </span>        db.collection(<span style="color: #98be65;">"todo"</span>).document(documentID).delete { error <span style="color: #51afef;">in</span>
<span class="linenr">66: </span>            <span style="color: #51afef;">if</span> let error = error {
<span class="linenr">67: </span>                <span style="color: #51afef;">print</span>(<span style="color: #98be65;">"Deleteing a task failed, \(error.localizedDescription)"</span>)
<span class="linenr">68: </span>            }
<span class="linenr">69: </span>        }
<span class="linenr">70: </span>    }
<span class="linenr">71: </span>}
<span class="linenr">72: </span>
<span class="linenr">73: </span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org68faf35" class="outline-3">
<h3 id="org68faf35"><span class="section-number-3">9.2</span> View</h3>
<div class="outline-text-3" id="text-9-2">
<div class="org-src-container">
<pre class="src src-python"><span class="linenr"> 1: </span>//
<span class="linenr"> 2: </span>//  ContentView.swift
<span class="linenr"> 3: </span>//  FireTask
<span class="linenr"> 4: </span>//
<span class="linenr"> 5: </span>//  Created by yen yung chin on <span style="color: #da8548; font-weight: bold;">2021</span>/<span style="color: #da8548; font-weight: bold;">3</span>/<span style="color: #da8548; font-weight: bold;">31</span>.
<span class="linenr"> 6: </span>//
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #51afef;">import</span> SwiftUI
<span class="linenr"> 9: </span>
<span class="linenr">10: </span>struct TaskListView: View {
<span class="linenr">11: </span>    <span style="color: #ECBE7B;">@ObservedObject</span> var taskListVM = TaskListViewModel()
<span class="linenr">12: </span>    <span style="color: #ECBE7B;">@State</span> var title: String = <span style="color: #98be65;">""</span>
<span class="linenr">13: </span>    var body: some View {
<span class="linenr">14: </span>        NavigationView {
<span class="linenr">15: </span>            VStack {
<span class="linenr">16: </span>                TextField(<span style="color: #98be65;">"Task Title"</span>, text: $title)
<span class="linenr">17: </span>                    .textFieldStyle(RoundedBorderTextFieldStyle())
<span class="linenr">18: </span>
<span class="linenr">19: </span>                Button(action: {
<span class="linenr">20: </span>                    let task = Task(title: title, completed: false)
<span class="linenr">21: </span>                    taskListVM.add(task: task)
<span class="linenr">22: </span>                }, label: {
<span class="linenr">23: </span>                    Text(<span style="color: #98be65;">"Add Task"</span>)
<span class="linenr">24: </span>                })
<span class="linenr">25: </span>                Form {
<span class="linenr">26: </span>                    ForEach(taskListVM.taskCellViewModels) { taskCellVM <span style="color: #51afef;">in</span>
<span class="linenr">27: </span>                        Text(<span style="color: #98be65;">"\(taskCellVM.task.title)"</span>)
<span class="linenr">28: </span>                    }
<span class="linenr">29: </span>                    .onDelete(perform: { indexSet <span style="color: #51afef;">in</span>
<span class="linenr">30: </span>                        indexSet.<span style="color: #c678dd;">map</span> {
<span class="linenr">31: </span>                            taskListVM.taskCellViewModels[$<span style="color: #da8548; font-weight: bold;">0</span>].task
<span class="linenr">32: </span>                        }.forEach(taskListVM.delete(task:))
<span class="linenr">33: </span>                    })
<span class="linenr">34: </span>                }
<span class="linenr">35: </span>                .navigationBarTitle(Text(<span style="color: #98be65;">"Task Manager"</span>), displayMode: .inline)
<span class="linenr">36: </span>            }
<span class="linenr">37: </span>        }.padding()
<span class="linenr">38: </span>    }
<span class="linenr">39: </span>}
<span class="linenr">40: </span>
<span class="linenr">41: </span>
<span class="linenr">42: </span>struct ContentView_Previews: PreviewProvider {
<span class="linenr">43: </span>    static var previews: some View {
<span class="linenr">44: </span>        TaskListView()
<span class="linenr">45: </span>    }
<span class="linenr">46: </span>}
<span class="linenr">47: </span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org48ee1c6" class="outline-3">
<h3 id="org48ee1c6"><span class="section-number-3">9.3</span> ViewModel</h3>
<div class="outline-text-3" id="text-9-3">
<div class="org-src-container">
<pre class="src src-python"><span class="linenr"> 1: </span>//
<span class="linenr"> 2: </span>//  TaskListViewModel.swift
<span class="linenr"> 3: </span>//  FireTask
<span class="linenr"> 4: </span>//
<span class="linenr"> 5: </span>//  Created by yen yung chin on <span style="color: #da8548; font-weight: bold;">2021</span>/<span style="color: #da8548; font-weight: bold;">4</span>/<span style="color: #da8548; font-weight: bold;">1</span>.
<span class="linenr"> 6: </span>//
<span class="linenr"> 7: </span><span style="color: #51afef;">import</span> Foundation
<span class="linenr"> 8: </span><span style="color: #51afef;">import</span> Combine
<span class="linenr"> 9: </span>
<span class="linenr">10: </span><span style="color: #51afef;">class</span> <span style="color: #ECBE7B;">TaskListViewModel</span>: ObservableObject {
<span class="linenr">11: </span>    <span style="color: #ECBE7B;">@Published</span> var taskRepository = TaskRepository()
<span class="linenr">12: </span>    <span style="color: #ECBE7B;">@Published</span> var taskCellViewModels = [TaskCellViewModel]()
<span class="linenr">13: </span>
<span class="linenr">14: </span>    private var cancellables = Set&lt;AnyCancellable&gt;()
<span class="linenr">15: </span>    init() {
<span class="linenr">16: </span>        taskRepository.loadData()
<span class="linenr">17: </span>        // &#35712;&#21462;Firebase docs&#24460;&#65292;&#36681;&#25563;id&#65292;&#20197;taskCellViewModel&#38499;&#21015;&#20786;&#23384;
<span class="linenr">18: </span>        taskRepository.$tasks.<span style="color: #c678dd;">map</span> { tasks <span style="color: #51afef;">in</span>
<span class="linenr">19: </span>            tasks.<span style="color: #c678dd;">map</span>(TaskCellViewModel.init)
<span class="linenr">20: </span>        }
<span class="linenr">21: </span>        .assign(to: \.taskCellViewModels, on: <span style="color: #51afef;">self</span>)
<span class="linenr">22: </span>        .store(<span style="color: #51afef;">in</span>: &amp;cancellables)
<span class="linenr">23: </span>    }
<span class="linenr">24: </span>
<span class="linenr">25: </span>    func add(task: Task) {
<span class="linenr">26: </span>        taskRepository.add(task: task)
<span class="linenr">27: </span>    }
<span class="linenr">28: </span>
<span class="linenr">29: </span>    func delete(indexset: IndexSet) {
<span class="linenr">30: </span>        taskRepository.delete(indexset: indexset)
<span class="linenr">31: </span>    }
<span class="linenr">32: </span>
<span class="linenr">33: </span>    func delete(task: Task) {
<span class="linenr">34: </span>        taskRepository.delete(task: task)
<span class="linenr">35: </span>    }
<span class="linenr">36: </span>}
<span class="linenr">37: </span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-SW-Detail" class="outline-2">
<h2 id="SW-Detail"><span class="section-number-2">10</span> Detail/Edit data from Cloud: UI with Firebase [MVVM]</h2>
<div class="outline-text-2" id="text-SW-Detail">
</div>
<div id="outline-container-orgd6acf0a" class="outline-3">
<h3 id="orgd6acf0a"><span class="section-number-3">10.1</span> Repository</h3>
<div class="outline-text-3" id="text-10-1">
<p>
TaskRepository.swift
</p>
<div class="org-src-container">
<pre class="src src-python"><span class="linenr"> 1: </span>//
<span class="linenr"> 2: </span>//  TaskRepository.swift
<span class="linenr"> 3: </span>//  FireTask
<span class="linenr"> 4: </span>//
<span class="linenr"> 5: </span>//  Created by yen yung chin on <span style="color: #da8548; font-weight: bold;">2021</span>/<span style="color: #da8548; font-weight: bold;">4</span>/<span style="color: #da8548; font-weight: bold;">1</span>.
<span class="linenr"> 6: </span>//
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span>
<span class="linenr"> 9: </span><span style="color: #51afef;">import</span> Foundation
<span class="linenr">10: </span><span style="color: #51afef;">import</span> FirebaseFirestore
<span class="linenr">11: </span><span style="color: #51afef;">import</span> FirebaseFirestoreSwift
<span class="linenr">12: </span><span style="color: #51afef;">import</span> Combine
<span class="linenr">13: </span>
<span class="linenr">14: </span><span style="color: #51afef;">class</span> <span style="color: #ECBE7B;">TaskRepository</span>: ObservableObject {
<span class="linenr">15: </span>    private let db = Firestore.firestore()
<span class="linenr">16: </span>    <span style="color: #ECBE7B;">@Published</span> var tasks = [Task]()
<span class="linenr">17: </span>    func loadData() {
<span class="linenr">18: </span>
<span class="linenr">19: </span>        db.collection(<span style="color: #98be65;">"todo"</span>).addSnapshotListener { (querySanpshot, error) <span style="color: #51afef;">in</span>
<span class="linenr">20: </span>
<span class="linenr">21: </span>            <span style="color: #51afef;">if</span> let error = error {
<span class="linenr">22: </span>                <span style="color: #51afef;">print</span>(<span style="color: #98be65;">"&#37679;&#35492;: \(error.localizedDescription)"</span>)
<span class="linenr">23: </span>            }
<span class="linenr">24: </span>            // method <span style="color: #5B6268;">#</span><span style="color: #5B6268;">1</span>
<span class="linenr">25: </span>            <span style="color: #51afef;">self</span>.tasks = querySanpshot?.documents.compactMap { document <span style="color: #51afef;">in</span>
<span class="linenr">26: </span>                <span style="color: #51afef;">try</span>? document.data(<span style="color: #51afef;">as</span>: Task.<span style="color: #51afef;">self</span>)
<span class="linenr">27: </span>            } ?? []
<span class="linenr">28: </span>
<span class="linenr">29: </span>            // method <span style="color: #5B6268;">#</span><span style="color: #5B6268;">2</span>
<span class="linenr">30: </span>            <span style="color: #51afef;">if</span> let querySnapshot = querySanpshot {
<span class="linenr">31: </span>                <span style="color: #51afef;">self</span>.tasks = querySnapshot.documents.compactMap({ (queryDocumentSnapshot) -&gt; Task? <span style="color: #51afef;">in</span>
<span class="linenr">32: </span>                    <span style="color: #51afef;">return</span> <span style="color: #51afef;">try</span>? queryDocumentSnapshot.data(<span style="color: #51afef;">as</span>: Task.<span style="color: #51afef;">self</span>)
<span class="linenr">33: </span>                })
<span class="linenr">34: </span>            }
<span class="linenr">35: </span>        }
<span class="linenr">36: </span>    }
<span class="linenr">37: </span>
<span class="linenr">38: </span>    func add(task: Task) {
<span class="linenr">39: </span>        do {
<span class="linenr">40: </span>            _ = <span style="color: #51afef;">try</span> db.collection(<span style="color: #98be65;">"todo"</span>).addDocument(<span style="color: #51afef;">from</span>: task)
<span class="linenr">41: </span>        } catch {
<span class="linenr">42: </span>            fatalError(<span style="color: #98be65;">"Add a task failed"</span>)
<span class="linenr">43: </span>        }
<span class="linenr">44: </span>    }
<span class="linenr">45: </span>
<span class="linenr">46: </span>    func delete(indexset: IndexSet) {
<span class="linenr">47: </span>        // <span style="color: #51afef;">pass</span> <span style="color: #51afef;">in</span> IndexSet
<span class="linenr">48: </span>        <span style="color: #51afef;">for</span> i <span style="color: #51afef;">in</span> indexset {
<span class="linenr">49: </span>            <span style="color: #51afef;">print</span>(i)
<span class="linenr">50: </span>        }
<span class="linenr">51: </span>        indexset.forEach { index <span style="color: #51afef;">in</span>
<span class="linenr">52: </span>            let task = tasks[index]
<span class="linenr">53: </span>            db.collection(<span style="color: #98be65;">"todo"</span>).document(task.<span style="color: #c678dd;">id</span>!).delete() { error <span style="color: #51afef;">in</span>
<span class="linenr">54: </span>                <span style="color: #51afef;">if</span> let error = error {
<span class="linenr">55: </span>                    fatalError(<span style="color: #98be65;">"Deleting a task failed, \(error.localizedDescription)"</span>)
<span class="linenr">56: </span>                }
<span class="linenr">57: </span>
<span class="linenr">58: </span>            }
<span class="linenr">59: </span>        }
<span class="linenr">60: </span>    }
<span class="linenr">61: </span>
<span class="linenr">62: </span>    func delete(task: Task) {
<span class="linenr">63: </span>        // <span style="color: #51afef;">pass</span> <span style="color: #51afef;">in</span> Task
<span class="linenr">64: </span>        guard let documentID = task.<span style="color: #c678dd;">id</span> <span style="color: #51afef;">else</span> { <span style="color: #51afef;">return</span> }
<span class="linenr">65: </span>        db.collection(<span style="color: #98be65;">"todo"</span>).document(documentID).delete { error <span style="color: #51afef;">in</span>
<span class="linenr">66: </span>            <span style="color: #51afef;">if</span> let error = error {
<span class="linenr">67: </span>                <span style="color: #51afef;">print</span>(<span style="color: #98be65;">"Deleteing a task failed, \(error.localizedDescription)"</span>)
<span class="linenr">68: </span>            }
<span class="linenr">69: </span>        }
<span class="linenr">70: </span>    }
<span class="linenr">71: </span>
<span class="linenr">72: </span>    func update(task: Task) {
<span class="linenr">73: </span>        guard let documentID = task.<span style="color: #c678dd;">id</span> <span style="color: #51afef;">else</span> {<span style="color: #51afef;">return</span>}
<span class="linenr">74: </span>        do {
<span class="linenr">75: </span>            <span style="color: #51afef;">try</span> db.collection(<span style="color: #98be65;">"todo"</span>).document(documentID).setData(<span style="color: #51afef;">from</span>: task)
<span class="linenr">76: </span>        } catch {
<span class="linenr">77: </span>            fatalError(<span style="color: #98be65;">"Update a task failed, \(error.localizedDescription)"</span>)
<span class="linenr">78: </span>        }
<span class="linenr">79: </span>    }
<span class="linenr">80: </span>}
</pre>
</div>
</div>
</div>

<div id="outline-container-org90c839c" class="outline-3">
<h3 id="org90c839c"><span class="section-number-3">10.2</span> View</h3>
<div class="outline-text-3" id="text-10-2">
</div>
<div id="outline-container-org9ffe39f" class="outline-4">
<h4 id="org9ffe39f"><span class="section-number-4">10.2.1</span> TaskListView.swift</h4>
<div class="outline-text-4" id="text-10-2-1">
<div class="org-src-container">
<pre class="src src-python"><span class="linenr"> 1: </span>//
<span class="linenr"> 2: </span>//  ContentView.swift
<span class="linenr"> 3: </span>//  FireTask
<span class="linenr"> 4: </span>//
<span class="linenr"> 5: </span>//  Created by yen yung chin on <span style="color: #da8548; font-weight: bold;">2021</span>/<span style="color: #da8548; font-weight: bold;">3</span>/<span style="color: #da8548; font-weight: bold;">31</span>.
<span class="linenr"> 6: </span>//
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #51afef;">import</span> SwiftUI
<span class="linenr"> 9: </span>
<span class="linenr">10: </span>struct TaskListView: View {
<span class="linenr">11: </span>    <span style="color: #ECBE7B;">@ObservedObject</span> var taskListVM = TaskListViewModel()
<span class="linenr">12: </span>    <span style="color: #ECBE7B;">@State</span> var title: String = <span style="color: #98be65;">""</span>
<span class="linenr">13: </span>    var body: some View {
<span class="linenr">14: </span>        NavigationView {
<span class="linenr">15: </span>            VStack {
<span class="linenr">16: </span>                TextField(<span style="color: #98be65;">"Task Title"</span>, text: $title)
<span class="linenr">17: </span>                    .textFieldStyle(RoundedBorderTextFieldStyle())
<span class="linenr">18: </span>
<span class="linenr">19: </span>                Button(action: {
<span class="linenr">20: </span>                    let task = Task(title: title, completed: false)
<span class="linenr">21: </span>                    taskListVM.add(task: task)
<span class="linenr">22: </span>                }, label: {
<span class="linenr">23: </span>                    Text(<span style="color: #98be65;">"Add Task"</span>)
<span class="linenr">24: </span>                }).disabled(title == <span style="color: #98be65;">""</span>)
<span class="linenr">25: </span>                Form {
<span class="linenr">26: </span>                    ForEach(taskListVM.taskCellViewModels) { taskCellVM <span style="color: #51afef;">in</span>
<span class="linenr">27: </span>                        NavigationLink(
<span class="linenr">28: </span>                            destination: TaskDetailView(taskCellVM: taskCellVM),
<span class="linenr">29: </span>                            label: {
<span class="linenr">30: </span>                                Text(<span style="color: #98be65;">"\(taskCellVM.task.title)"</span>)
<span class="linenr">31: </span>                            })
<span class="linenr">32: </span>                    }
<span class="linenr">33: </span>                    .onDelete(perform: { indexSet <span style="color: #51afef;">in</span>
<span class="linenr">34: </span>                        // taskListVM.delete(indexset: indexSet)
<span class="linenr">35: </span>                        indexSet.<span style="color: #c678dd;">map</span> {
<span class="linenr">36: </span>                            taskListVM.taskCellViewModels[$<span style="color: #da8548; font-weight: bold;">0</span>].task
<span class="linenr">37: </span>                        }.forEach(taskListVM.delete(task:))
<span class="linenr">38: </span>                    })
<span class="linenr">39: </span>                }
<span class="linenr">40: </span>                .navigationBarTitle(Text(<span style="color: #98be65;">"Task Manager"</span>), displayMode: .inline)
<span class="linenr">41: </span>            }
<span class="linenr">42: </span>        }
<span class="linenr">43: </span>    }
<span class="linenr">44: </span>}
<span class="linenr">45: </span>
<span class="linenr">46: </span>
<span class="linenr">47: </span>struct ContentView_Previews: PreviewProvider {
<span class="linenr">48: </span>    static var previews: some View {
<span class="linenr">49: </span>        TaskListView()
<span class="linenr">50: </span>    }
<span class="linenr">51: </span>}
<span class="linenr">52: </span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org34a528e" class="outline-4">
<h4 id="org34a528e"><span class="section-number-4">10.2.2</span> TaskDetailView.swift</h4>
<div class="outline-text-4" id="text-10-2-2">
<div class="org-src-container">
<pre class="src src-python"><span class="linenr"> 1: </span>//
<span class="linenr"> 2: </span>//  TaskCellView.swift
<span class="linenr"> 3: </span>//  FireTask
<span class="linenr"> 4: </span>//
<span class="linenr"> 5: </span>//  Created by yen yung chin on <span style="color: #da8548; font-weight: bold;">2021</span>/<span style="color: #da8548; font-weight: bold;">4</span>/<span style="color: #da8548; font-weight: bold;">3</span>.
<span class="linenr"> 6: </span>//
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #51afef;">import</span> SwiftUI
<span class="linenr"> 9: </span>
<span class="linenr">10: </span>struct TaskDetailView: View {
<span class="linenr">11: </span>    <span style="color: #ECBE7B;">@ObservedObject</span> var taskCellVM: TaskCellViewModel
<span class="linenr">12: </span>
<span class="linenr">13: </span>
<span class="linenr">14: </span>    var body: some View {
<span class="linenr">15: </span>        NavigationView {
<span class="linenr">16: </span>            Form {
<span class="linenr">17: </span>                Section(header: Text(<span style="color: #98be65;">"Task"</span>)) {
<span class="linenr">18: </span>                    Text(taskCellVM.task.title)
<span class="linenr">19: </span>
<span class="linenr">20: </span>                }
<span class="linenr">21: </span>                Section(header: Text(<span style="color: #98be65;">"Done"</span>)) {
<span class="linenr">22: </span>                    Text(taskCellVM.task.completed ? <span style="color: #98be65;">"Completed"</span> : <span style="color: #98be65;">"Not Yet"</span> )
<span class="linenr">23: </span>                }
<span class="linenr">24: </span>            }
<span class="linenr">25: </span>            .navigationBarTitle(<span style="color: #98be65;">"Detail"</span>)
<span class="linenr">26: </span>            .navigationBarTitleDisplayMode(.inline)
<span class="linenr">27: </span>            .navigationBarItems(trailing: NavigationLink(
<span class="linenr">28: </span>                                    destination: UpdateTaskView(taskCellVM: taskCellVM),
<span class="linenr">29: </span>                                    label: {
<span class="linenr">30: </span>                                        Text(<span style="color: #98be65;">"Update"</span>)
<span class="linenr">31: </span>                                    }))
<span class="linenr">32: </span>        }
<span class="linenr">33: </span>    }
<span class="linenr">34: </span>}
<span class="linenr">35: </span>
<span class="linenr">36: </span>struct TaskCellView_Previews: PreviewProvider {
<span class="linenr">37: </span>
<span class="linenr">38: </span>    static var previews: some View {
<span class="linenr">39: </span>        TaskDetailView(taskCellVM: TaskCellViewModel(task: Task(<span style="color: #c678dd;">id</span>: <span style="color: #98be65;">""</span>, title: <span style="color: #98be65;">""</span>, completed: false)))
<span class="linenr">40: </span>    }
<span class="linenr">41: </span>}
<span class="linenr">42: </span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfe630b6" class="outline-4">
<h4 id="orgfe630b6"><span class="section-number-4">10.2.3</span> UpdateListView.swift</h4>
<div class="outline-text-4" id="text-10-2-3">
<div class="org-src-container">
<pre class="src src-python"><span class="linenr"> 1: </span>//
<span class="linenr"> 2: </span>//  UpdateTaskView.swift
<span class="linenr"> 3: </span>//  FireTask
<span class="linenr"> 4: </span>//
<span class="linenr"> 5: </span>//  Created by yen yung chin on <span style="color: #da8548; font-weight: bold;">2021</span>/<span style="color: #da8548; font-weight: bold;">4</span>/<span style="color: #da8548; font-weight: bold;">3</span>.
<span class="linenr"> 6: </span>//
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #51afef;">import</span> SwiftUI
<span class="linenr"> 9: </span>
<span class="linenr">10: </span>struct UpdateTaskView: View {
<span class="linenr">11: </span>    <span style="color: #ECBE7B;">@ObservedObject</span> var taskCellVM: TaskCellViewModel
<span class="linenr">12: </span>    <span style="color: #ECBE7B;">@Environment</span>(\.presentationMode) var presentationMode
<span class="linenr">13: </span>    var body: some View {
<span class="linenr">14: </span>        Form {
<span class="linenr">15: </span>            Section(header: Text(<span style="color: #98be65;">"Updage detail"</span>)) {
<span class="linenr">16: </span>                TextField(<span style="color: #98be65;">"title"</span>, text: $taskCellVM.task.title)
<span class="linenr">17: </span>            }
<span class="linenr">18: </span>            Section(header: Text(<span style="color: #98be65;">"Done"</span>)) {
<span class="linenr">19: </span>                Toggle(<span style="color: #98be65;">"Task Completed"</span>, isOn: $taskCellVM.task.completed)
<span class="linenr">20: </span>            }
<span class="linenr">21: </span>            Button(action: {
<span class="linenr">22: </span>                taskCellVM.update(task: taskCellVM.task)
<span class="linenr">23: </span>                <span style="color: #51afef;">self</span>.presentationMode.wrappedValue.dismiss()
<span class="linenr">24: </span>            }, label: {
<span class="linenr">25: </span>                Text(<span style="color: #98be65;">"Update"</span>)
<span class="linenr">26: </span>            })
<span class="linenr">27: </span>        }
<span class="linenr">28: </span>        .navigationBarTitle(<span style="color: #98be65;">"Updating"</span>)
<span class="linenr">29: </span>        .navigationBarTitleDisplayMode(.inline)
<span class="linenr">30: </span>    }
<span class="linenr">31: </span>}
<span class="linenr">32: </span>
<span class="linenr">33: </span>struct UpdateTaskView_Previews: PreviewProvider {
<span class="linenr">34: </span>    static var previews: some View {
<span class="linenr">35: </span>        UpdateTaskView(taskCellVM: TaskCellViewModel(task: Task(<span style="color: #c678dd;">id</span>: <span style="color: #98be65;">""</span>, title: <span style="color: #98be65;">""</span>, completed: false)))
<span class="linenr">36: </span>    }
<span class="linenr">37: </span>}
<span class="linenr">38: </span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orga61e1d1" class="outline-3">
<h3 id="orga61e1d1"><span class="section-number-3">10.3</span> ViewModel</h3>
<div class="outline-text-3" id="text-10-3">
</div>
<div id="outline-container-org67cea7a" class="outline-4">
<h4 id="org67cea7a"><span class="section-number-4">10.3.1</span> TaskListViewModel.swift</h4>
<div class="outline-text-4" id="text-10-3-1">
<div class="org-src-container">
<pre class="src src-python"><span class="linenr"> 1: </span>//
<span class="linenr"> 2: </span>//  TaskListViewModel.swift
<span class="linenr"> 3: </span>//  FireTask
<span class="linenr"> 4: </span>//
<span class="linenr"> 5: </span>//  Created by yen yung chin on <span style="color: #da8548; font-weight: bold;">2021</span>/<span style="color: #da8548; font-weight: bold;">4</span>/<span style="color: #da8548; font-weight: bold;">1</span>.
<span class="linenr"> 6: </span>//
<span class="linenr"> 7: </span><span style="color: #51afef;">import</span> Foundation
<span class="linenr"> 8: </span><span style="color: #51afef;">import</span> Combine
<span class="linenr"> 9: </span>
<span class="linenr">10: </span><span style="color: #51afef;">class</span> <span style="color: #ECBE7B;">TaskListViewModel</span>: ObservableObject {
<span class="linenr">11: </span>    <span style="color: #ECBE7B;">@Published</span> var taskRepository = TaskRepository()
<span class="linenr">12: </span>    <span style="color: #ECBE7B;">@Published</span> var taskCellViewModels = [TaskCellViewModel]()
<span class="linenr">13: </span>
<span class="linenr">14: </span>    private var cancellables = Set&lt;AnyCancellable&gt;()
<span class="linenr">15: </span>    init() {
<span class="linenr">16: </span>        taskRepository.loadData()
<span class="linenr">17: </span>        // &#35712;&#21462;Firebase docs&#24460;&#65292;&#36681;&#25563;id&#65292;&#20197;taskCellViewModel&#38499;&#21015;&#20786;&#23384;
<span class="linenr">18: </span>        taskRepository.$tasks.<span style="color: #c678dd;">map</span> { tasks <span style="color: #51afef;">in</span>
<span class="linenr">19: </span>            tasks.<span style="color: #c678dd;">map</span>(TaskCellViewModel.init)
<span class="linenr">20: </span>        }
<span class="linenr">21: </span>        .assign(to: \.taskCellViewModels, on: <span style="color: #51afef;">self</span>)
<span class="linenr">22: </span>        .store(<span style="color: #51afef;">in</span>: &amp;cancellables)
<span class="linenr">23: </span>    }
<span class="linenr">24: </span>
<span class="linenr">25: </span>    func add(task: Task) {
<span class="linenr">26: </span>        taskRepository.add(task: task)
<span class="linenr">27: </span>    }
<span class="linenr">28: </span>
<span class="linenr">29: </span>    func delete(indexset: IndexSet) {
<span class="linenr">30: </span>        taskRepository.delete(indexset: indexset)
<span class="linenr">31: </span>    }
<span class="linenr">32: </span>
<span class="linenr">33: </span>    func delete(task: Task) {
<span class="linenr">34: </span>        taskRepository.delete(task: task)
<span class="linenr">35: </span>    }
<span class="linenr">36: </span>
<span class="linenr">37: </span>    func update(task: Task) {
<span class="linenr">38: </span>        taskRepository.update(task: task)
<span class="linenr">39: </span>    }
<span class="linenr">40: </span>}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgef49500" class="outline-4">
<h4 id="orgef49500"><span class="section-number-4">10.3.2</span> TaskCellViewModel.swift</h4>
<div class="outline-text-4" id="text-10-3-2">
<div class="org-src-container">
<pre class="src src-python"><span class="linenr"> 1: </span>//
<span class="linenr"> 2: </span>//  TaskCellViewModel.swift
<span class="linenr"> 3: </span>//  FireTask
<span class="linenr"> 4: </span>//
<span class="linenr"> 5: </span>//  Created by yen yung chin on <span style="color: #da8548; font-weight: bold;">2021</span>/<span style="color: #da8548; font-weight: bold;">4</span>/<span style="color: #da8548; font-weight: bold;">1</span>.
<span class="linenr"> 6: </span>//
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #51afef;">import</span> Foundation
<span class="linenr"> 9: </span><span style="color: #51afef;">import</span> Combine
<span class="linenr">10: </span>
<span class="linenr">11: </span><span style="color: #51afef;">class</span> <span style="color: #ECBE7B;">TaskCellViewModel</span>: ObservableObject, Identifiable {
<span class="linenr">12: </span>    <span style="color: #ECBE7B;">@Published</span> var task: Task
<span class="linenr">13: </span>    <span style="color: #ECBE7B;">@Published</span> var taskRepository = TaskRepository()
<span class="linenr">14: </span>    private var cancellables = Set&lt;AnyCancellable&gt;()
<span class="linenr">15: </span>    var <span style="color: #c678dd;">id</span> = <span style="color: #98be65;">""</span>
<span class="linenr">16: </span>    // &#25226;Firestore document&#30340;id&#36681;&#25563;&#25104;model struct&#30340;&#27396;&#20301;
<span class="linenr">17: </span>    init(task: Task) {
<span class="linenr">18: </span>        <span style="color: #51afef;">self</span>.task = task
<span class="linenr">19: </span>        $task
<span class="linenr">20: </span>            .compactMap { $<span style="color: #da8548; font-weight: bold;">0</span>.<span style="color: #c678dd;">id</span> }
<span class="linenr">21: </span>            .assign(to: \.<span style="color: #c678dd;">id</span>, on: <span style="color: #51afef;">self</span>)
<span class="linenr">22: </span>            .store(<span style="color: #51afef;">in</span>: &amp;cancellables)
<span class="linenr">23: </span>    }
<span class="linenr">24: </span>
<span class="linenr">25: </span>    func update(task: Task) {
<span class="linenr">26: </span>        taskRepository.update(task: task)
<span class="linenr">27: </span>    }
<span class="linenr">28: </span>}
</pre>
</div>
</div>
</div>

<div id="outline-container-org179c0e2" class="outline-4">
<h4 id="org179c0e2"><span class="section-number-4">10.3.3</span> DEMO</h4>
<div class="outline-text-4" id="text-10-3-3">

<div id="org30cda38" class="figure">
<p><img src="images/Update-Edit.gif" alt="Update-Edit.gif" width="300" />
</p>
<p><span class="figure-number">Figure 8: </span>Detail / Edit DEMO</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org36a65d7" class="outline-3">
<h3 id="org36a65d7"><span class="section-number-3">10.4</span> Topics:</h3>
<div class="outline-text-3" id="text-10-4">
<ul class="org-ul">
<li>Detection of Modified: <a href="https://www.youtube.com/watch?v=imTjGvSjBEw">Adding data to Firestore from a SwiftUI App</a></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-SW-Icon" class="outline-2">
<h2 id="SW-Icon"><span class="section-number-2">11</span> Add Icon to App</h2>
<div class="outline-text-2" id="text-SW-Icon">
</div>
<div id="outline-container-orga030ffc" class="outline-3">
<h3 id="orga030ffc"><span class="section-number-3">11.1</span> ViewModel</h3>
<div class="outline-text-3" id="text-11-1">
</div>
<div id="outline-container-org2c0e6fe" class="outline-4">
<h4 id="org2c0e6fe"><span class="section-number-4">11.1.1</span> TaskCellViewModel.swift</h4>
<div class="outline-text-4" id="text-11-1-1">
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 2: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">TaskCellViewModel.swift</span>
<span class="linenr"> 3: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">FireTask</span>
<span class="linenr"> 4: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 5: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">Created by yen yung chin on 2021/4/1.</span>
<span class="linenr"> 6: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #51afef;">import</span> Foundation
<span class="linenr"> 9: </span><span style="color: #51afef;">import</span> Combine
<span class="linenr">10: </span>
<span class="linenr">11: </span><span style="color: #51afef;">class</span> <span style="color: #c678dd;">TaskCellViewModel</span>: <span style="color: #c678dd;">ObservableObject</span>, Identifiable {
<span class="linenr">12: </span>    <span style="color: #51afef;">@Published</span> <span style="color: #51afef;">var</span> task: Task
<span class="linenr">13: </span>    <span style="color: #51afef;">@Published</span> <span style="color: #51afef;">var</span> taskRepository = <span style="color: #c678dd;">TaskRepository</span>()
<span class="linenr">14: </span>    <span style="color: #51afef;">@Published</span> <span style="color: #51afef;">var</span> completionStateIconName = <span style="color: #98be65;">""</span>
<span class="linenr">15: </span>    <span style="color: #51afef;">private</span> <span style="color: #51afef;">var</span> cancellables = <span style="color: #c678dd;">Set</span>&lt;AnyCancellable&gt;()
<span class="linenr">16: </span>    <span style="color: #51afef;">var</span> id = <span style="color: #98be65;">""</span>
<span class="linenr">17: </span>    <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#25226;Firestore document&#30340;id&#36681;&#25563;&#25104;model struct&#30340;&#27396;&#20301;</span>
<span class="linenr">18: </span>    <span style="color: #51afef;">init</span>(task: Task) {
<span class="linenr">19: </span>        <span style="color: #51afef;">self</span>.<span style="color: #c678dd;">task</span> = task
<span class="linenr">20: </span>        <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#36681;&#25563;id</span>
<span class="linenr">21: </span>        $task
<span class="linenr">22: </span>            .<span style="color: #c678dd;">compactMap</span> { $0.<span style="color: #dcaeea;">id</span> }
<span class="linenr">23: </span>            .<span style="color: #c678dd;">assign</span>(to: \.<span style="color: #dcaeea;">id</span>, on: <span style="color: #51afef;">self</span>)
<span class="linenr">24: </span>            .<span style="color: #c678dd;">store</span>(<span style="color: #51afef;">in</span>: &amp;cancellables)
<span class="linenr">25: </span>        $task
<span class="linenr">26: </span>            .<span style="color: #c678dd;">map</span> { task <span style="color: #51afef;">in</span>
<span class="linenr">27: </span>                <span style="color: #51afef;">return</span> task.<span style="color: #c678dd;">completed</span> ? <span style="color: #98be65;">"checkmark.circle.fill"</span> : <span style="color: #98be65;">"circle"</span>
<span class="linenr">28: </span>            }
<span class="linenr">29: </span>            .<span style="color: #c678dd;">assign</span>(to: \.<span style="color: #dcaeea;">completionStateIconName</span>, on: <span style="color: #51afef;">self</span>)
<span class="linenr">30: </span>            .<span style="color: #c678dd;">store</span>(<span style="color: #51afef;">in</span>: &amp;cancellables)
<span class="linenr">31: </span>    }
<span class="linenr">32: </span>
<span class="linenr">33: </span>    <span style="color: #51afef;">func</span> <span style="color: #c678dd;">update</span>(task: Task) {
<span class="linenr">34: </span>        taskRepository.<span style="color: #c678dd;">update</span>(task: task)
<span class="linenr">35: </span>    }
<span class="linenr">36: </span>}
<span class="linenr">37: </span>
<span class="linenr">38: </span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orge471da1" class="outline-3">
<h3 id="orge471da1"><span class="section-number-3">11.2</span> View</h3>
<div class="outline-text-3" id="text-11-2">
</div>
<div id="outline-container-org3fb64e6" class="outline-4">
<h4 id="org3fb64e6"><span class="section-number-4">11.2.1</span> TaskListView.swift</h4>
<div class="outline-text-4" id="text-11-2-1">
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 2: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">ContentView.swift</span>
<span class="linenr"> 3: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">FireTask</span>
<span class="linenr"> 4: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 5: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">Created by yen yung chin on 2021/3/31.</span>
<span class="linenr"> 6: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #51afef;">import</span> SwiftUI
<span class="linenr"> 9: </span>
<span class="linenr">10: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">TaskListView</span>: View {
<span class="linenr">11: </span>    <span style="color: #51afef;">@ObservedObject</span> <span style="color: #51afef;">var</span> taskListVM = <span style="color: #c678dd;">TaskListViewModel</span>()
<span class="linenr">12: </span>    <span style="color: #51afef;">@State</span> <span style="color: #51afef;">var</span> title: <span style="color: #c678dd;">String</span> = <span style="color: #98be65;">""</span>
<span class="linenr">13: </span>
<span class="linenr">14: </span>    <span style="color: #51afef;">var</span> body: <span style="color: #51afef;">some</span> View {
<span class="linenr">15: </span>        NavigationView {
<span class="linenr">16: </span>            VStack {
<span class="linenr">17: </span>                <span style="color: #c678dd;">TextField</span>(<span style="color: #98be65;">"Task Title"</span>, text: $title)
<span class="linenr">18: </span>                    .<span style="color: #c678dd;">textFieldStyle</span>(<span style="color: #c678dd;">RoundedBorderTextFieldStyle</span>())
<span class="linenr">19: </span>
<span class="linenr">20: </span>                <span style="color: #c678dd;">Button</span>(action: {
<span class="linenr">21: </span>                    <span style="color: #51afef;">let</span> task = <span style="color: #c678dd;">Task</span>(title: title, completed: <span style="color: #a9a1e1;">false</span>)
<span class="linenr">22: </span>                    taskListVM.<span style="color: #c678dd;">add</span>(task: task)
<span class="linenr">23: </span>                    <span style="color: #51afef;">self</span>.<span style="color: #c678dd;">title</span> = <span style="color: #98be65;">""</span>
<span class="linenr">24: </span>                }, label: {
<span class="linenr">25: </span>                    <span style="color: #c678dd;">Text</span>(<span style="color: #98be65;">"Add Task"</span>)
<span class="linenr">26: </span>                }).<span style="color: #c678dd;">disabled</span>(title == <span style="color: #98be65;">""</span>)
<span class="linenr">27: </span>                Form {
<span class="linenr">28: </span>                    <span style="color: #c678dd;">ForEach</span>(taskListVM.<span style="color: #dcaeea;">taskCellViewModels</span>) { taskCellVM <span style="color: #51afef;">in</span>
<span class="linenr">29: </span>                        HStack {
<span class="linenr">30: </span>                            <span style="color: #c678dd;">Image</span>(systemName: taskCellVM.<span style="color: #dcaeea;">completionStateIconName</span>)
<span class="linenr">31: </span>                            <span style="color: #c678dd;">NavigationLink</span>(
<span class="linenr">32: </span>                                destination: <span style="color: #c678dd;">TaskDetailView</span>(taskCellVM: taskCellVM),
<span class="linenr">33: </span>                                label: {
<span class="linenr">34: </span>                                    <span style="color: #c678dd;">Text</span>(<span style="color: #98be65;">"\(</span>taskCellVM.<span style="color: #c678dd;">task</span>.<span style="color: #c678dd;">title</span><span style="color: #98be65;">)"</span>)
<span class="linenr">35: </span>                                })
<span class="linenr">36: </span>                        }
<span class="linenr">37: </span>
<span class="linenr">38: </span>                    }
<span class="linenr">39: </span>                    .<span style="color: #c678dd;">onDelete</span>(perform: { indexSet <span style="color: #51afef;">in</span>
<span class="linenr">40: </span>                        <span style="color: #5B6268;">// </span><span style="color: #5B6268;">taskListVM.delete(indexset: indexSet)</span>
<span class="linenr">41: </span>                        indexSet.<span style="color: #c678dd;">map</span> {
<span class="linenr">42: </span>                            taskListVM.<span style="color: #dcaeea;">taskCellViewModels</span>[$0].<span style="color: #c678dd;">task</span>
<span class="linenr">43: </span>                        }.<span style="color: #c678dd;">forEach</span>(taskListVM.<span style="color: #c678dd;">delete</span>(task:))
<span class="linenr">44: </span>                    })
<span class="linenr">45: </span>                }
<span class="linenr">46: </span>                .<span style="color: #c678dd;">navigationBarTitle</span>(<span style="color: #c678dd;">Text</span>(<span style="color: #98be65;">"Task Manager"</span>), displayMode: .<span style="color: #c678dd;">inline</span>)
<span class="linenr">47: </span>            }
<span class="linenr">48: </span>        }
<span class="linenr">49: </span>    }
<span class="linenr">50: </span>}
<span class="linenr">51: </span>
<span class="linenr">52: </span>
<span class="linenr">53: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">ContentView_Previews</span>: PreviewProvider {
<span class="linenr">54: </span>    <span style="color: #51afef;">static</span> <span style="color: #51afef;">var</span> previews: <span style="color: #51afef;">some</span> View {
<span class="linenr">55: </span>        <span style="color: #c678dd;">TaskListView</span>()
<span class="linenr">56: </span>    }
<span class="linenr">57: </span>}
<span class="linenr">58: </span>
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-SW-Firebase-Storage" class="outline-2">
<h2 id="SW-Firebase-Storage"><span class="section-number-2">12</span> Storage</h2>
<div class="outline-text-2" id="text-SW-Firebase-Storage">
</div>
<div id="outline-container-org7722427" class="outline-3">
<h3 id="org7722427"><span class="section-number-3">12.1</span> preparation</h3>
<div class="outline-text-3" id="text-12-1">
<ol class="org-ol">
<li>Add Firebase/Strage Library</li>
<li>Restart Xcode</li>
<li>Check if you can import FirebaseStorage</li>
<li>Enable Firebase/Storage on console</li>
<li>Change Storage Rules</li>
</ol>
</div>
</div>

<div id="outline-container-org375f287" class="outline-3">
<h3 id="org375f287"><span class="section-number-3">12.2</span> tips</h3>
<div class="outline-text-3" id="text-12-2">
<ol class="org-ol">
<li><p>
References point to files
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span><span style="color: #51afef;">let</span> storageRef = FIRStorage.<span style="color: #c678dd;">reference</span>().<span style="color: #c678dd;">child</span>(<span style="color: #98be65;">"folderName/file.jpg"</span>)
</pre>
</div></li>
<li><p>
Upload files with one method
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span><span style="color: #51afef;">let</span> storageRef = FIRStorage.<span style="color: #c678dd;">reference</span>().<span style="color: #c678dd;">child</span>(<span style="color: #98be65;">"folderName/file.jpg"</span>);
<span class="linenr">2: </span><span style="color: #51afef;">let</span> localFile: <span style="color: #c678dd;">NSURL</span> = <span style="color: #5B6268;">// </span><span style="color: #5B6268;">get a file;</span>
<span class="linenr">3: </span>
<span class="linenr">4: </span><span style="color: #5B6268;">// </span><span style="color: #5B6268;">Upload the file to the path "folderName/file.jpg"</span>
<span class="linenr">5: </span><span style="color: #51afef;">let</span> uploadTask = storageRef.<span style="color: #c678dd;">putFile</span>(localFile, metadata: <span style="color: #a9a1e1;">nil</span>)
</pre>
</div></li>
<li><p>
Monitor progress with Tasks
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span><span style="color: #51afef;">let</span> storageRef = FIRStorage.<span style="color: #c678dd;">reference</span>().<span style="color: #c678dd;">child</span>(<span style="color: #98be65;">"folderName/file.jpg"</span>);
<span class="linenr">2: </span><span style="color: #51afef;">let</span> localFile: <span style="color: #c678dd;">NSURL</span> = <span style="color: #5B6268;">// </span><span style="color: #5B6268;">get a file;</span>
<span class="linenr">3: </span>
<span class="linenr">4: </span><span style="color: #5B6268;">// </span><span style="color: #5B6268;">Upload the file to the path "folderName/file.jpg"</span>
<span class="linenr">5: </span><span style="color: #51afef;">let</span> uploadTask = storageRef.<span style="color: #c678dd;">putFile</span>(localFile, metadata: <span style="color: #a9a1e1;">nil</span>)
<span class="linenr">6: </span>
<span class="linenr">7: </span><span style="color: #51afef;">let</span> observer = uploadTask.<span style="color: #c678dd;">observeStatus</span>(.<span style="color: #c678dd;">Progress</span>) { snapshot <span style="color: #51afef;">in</span>
<span class="linenr">8: </span>  <span style="color: #c678dd;">print</span>(snapshot.<span style="color: #c678dd;">progress</span>) <span style="color: #5B6268;">// </span><span style="color: #5B6268;">NSProgress object</span>
<span class="linenr">9: </span>}
</pre>
</div></li>
<li><p>
Download files with one method
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span><span style="color: #51afef;">let</span> storageRef = FIRStorage.<span style="color: #c678dd;">reference</span>().<span style="color: #c678dd;">child</span>(<span style="color: #98be65;">"folderName/file.jpg"</span>);
<span class="linenr">2: </span>storageRef.<span style="color: #dcaeea;">downloadURLWithCompletion</span> { (<span style="color: #c678dd;">URL</span>, error) -&gt; <span style="color: #c678dd;">Void</span> <span style="color: #51afef;">in</span>
<span class="linenr">3: </span>  <span style="color: #51afef;">if</span> (error != <span style="color: #a9a1e1;">nil</span>) {
<span class="linenr">4: </span>    <span style="color: #5B6268;">// </span><span style="color: #5B6268;">Handle any errors</span>
<span class="linenr">5: </span>  } <span style="color: #51afef;">else</span> {
<span class="linenr">6: </span>    <span style="color: #5B6268;">// </span><span style="color: #5B6268;">Get the download URL for 'images/stars.jpg'</span>
<span class="linenr">7: </span>  }
<span class="linenr">8: </span>}
</pre>
</div></li>
<li><p>
User based security with Storage Security Rules
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #5B6268;">// </span><span style="color: #5B6268;">Only a user can upload their profile picture, but anyone can view it</span>
<span class="linenr"> 2: </span>service firebase.<span style="color: #dcaeea;">storage</span> {
<span class="linenr"> 3: </span>  match /b/&lt;bucket&gt;/o {
<span class="linenr"> 4: </span>    match /users/{userId}/profilePicture.<span style="color: #dcaeea;">png</span> {
<span class="linenr"> 5: </span>      allow read;
<span class="linenr"> 6: </span>      allow write: <span style="color: #51afef;">if</span> request.<span style="color: #dcaeea;">auth</span>.<span style="color: #dcaeea;">uid</span> == userId;
<span class="linenr"> 7: </span>    }
<span class="linenr"> 8: </span>  }
<span class="linenr"> 9: </span>}
<span class="linenr">10: </span>
</pre>
</div></li>
</ol>
<p>
<a href="https://firebase.googleblog.com/2016/07/5-tips-for-firebase-storage.html">5 tips for Firebase Storage </a>
</p>
</div>
</div>

<div id="outline-container-SW-ImagePicker" class="outline-3">
<h3 id="SW-ImagePicker"><span class="section-number-3">12.3</span> How to pick image in iOS</h3>
<div class="outline-text-3" id="text-SW-ImagePicker">
</div>
<div id="outline-container-org8886ced" class="outline-4">
<h4 id="org8886ced"><span class="section-number-4">12.3.1</span> Utility: ImagePicker</h4>
<div class="outline-text-4" id="text-12-3-1">
<p>
ImagePicker.swift
</p>
<div class="org-src-container">
<pre class="src src-swift"><span style="color: #51afef;">import</span> SwiftUI

<span style="color: #51afef;">struct</span> <span style="color: #c678dd;">ImagePicker</span>: UIViewControllerRepresentable {

  <span style="color: #51afef;">@Binding</span> <span style="color: #51afef;">var</span> image: UIImage?
  <span style="color: #51afef;">@Binding</span> <span style="color: #51afef;">var</span> isShown: <span style="color: #c678dd;">Bool</span>

  <span style="color: #51afef;">func</span> <span style="color: #c678dd;">makeCoordinator</span>() -&gt; Coordinator {
    <span style="color: #51afef;">return</span> <span style="color: #c678dd;">Coordinator</span>(isShown: $isShown, image: $image)
  }

  <span style="color: #51afef;">func</span> <span style="color: #c678dd;">makeUIViewController</span>(context: UIViewControllerRepresentableContext&lt;ImagePicker&gt;) -&gt; UIImagePickerController {
    <span style="color: #51afef;">let</span> picker = <span style="color: #c678dd;">UIImagePickerController</span>()
    picker.<span style="color: #c678dd;">delegate</span> = context.<span style="color: #dcaeea;">coordinator</span>
    <span style="color: #51afef;">return</span> picker
  }

  <span style="color: #51afef;">func</span> <span style="color: #c678dd;">updateUIViewController</span>(_ uiViewController: UIImagePickerController,
                              context: UIViewControllerRepresentableContext&lt;ImagePicker&gt;) {

  }

  <span style="color: #51afef;">class</span> <span style="color: #c678dd;">Coordinator</span>: <span style="color: #c678dd;">NSObject</span>, UINavigationControllerDelegate, UIImagePickerControllerDelegate {

    <span style="color: #51afef;">@Binding</span> <span style="color: #51afef;">var</span> image: UIImage?
    <span style="color: #51afef;">@Binding</span> <span style="color: #51afef;">var</span> isShown: <span style="color: #c678dd;">Bool</span>

    <span style="color: #51afef;">init</span>(isShown: Binding&lt;<span style="color: #c678dd;">Bool</span>&gt;, image: Binding&lt;UIImage?&gt;) {
      _isShown = isShown
      _image = image
    }

    <span style="color: #51afef;">func</span> <span style="color: #c678dd;">imagePickerController</span>(_ picker: UIImagePickerController,
                               didFinishPickingMediaWithInfo info: [UIImagePickerController.<span style="color: #dcaeea;">InfoKey</span> : Any]) {
      image = info[UIImagePickerController.<span style="color: #dcaeea;">InfoKey</span>.<span style="color: #dcaeea;">originalImage</span>] <span style="color: #51afef;">as</span>? UIImage
      isShown.<span style="color: #c678dd;">toggle</span>()
    }

    <span style="color: #51afef;">func</span> <span style="color: #c678dd;">imagePickerControllerDidCancel</span>(_ picker: UIImagePickerController) {
      isShown.<span style="color: #c678dd;">toggle</span>()
    }
  }
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orgab6bcb6" class="outline-4">
<h4 id="orgab6bcb6"><span class="section-number-4">12.3.2</span> How to call ImagePicker in SwiftUI</h4>
<div class="outline-text-4" id="text-12-3-2">
<p>
TaskNewView.swift
</p>
<div class="org-src-container">
<pre class="src src-python"><span class="linenr"> 1: </span>//
<span class="linenr"> 2: </span>//  TaskNewView.swift
<span class="linenr"> 3: </span>//  FireTask
<span class="linenr"> 4: </span>//
<span class="linenr"> 5: </span>//  Created by yen yung chin on <span style="color: #da8548; font-weight: bold;">2021</span>/<span style="color: #da8548; font-weight: bold;">5</span>/<span style="color: #da8548; font-weight: bold;">3</span>.
<span class="linenr"> 6: </span>//
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #51afef;">import</span> SwiftUI
<span class="linenr"> 9: </span><span style="color: #51afef;">import</span> FirebaseStorage
<span class="linenr">10: </span>
<span class="linenr">11: </span>struct TaskNewView: View {
<span class="linenr">12: </span>    <span style="color: #ECBE7B;">@Environment</span>(\.presentationMode) var presentationMode
<span class="linenr">13: </span>
<span class="linenr">14: </span>    <span style="color: #ECBE7B;">@ObservedObject</span> var taskListVM = TaskListViewModel()
<span class="linenr">15: </span>    <span style="color: #ECBE7B;">@State</span> private var title: String = <span style="color: #98be65;">""</span>
<span class="linenr">16: </span>    <span style="color: #ECBE7B;">@State</span> private var showPhotoLibrary = false
<span class="linenr">17: </span>    <span style="color: #ECBE7B;">@State</span> var pickedImage: UIImage? = nil
<span class="linenr">18: </span>    <span style="color: #ECBE7B;">@State</span> private var urlString: String = <span style="color: #98be65;">""</span>
<span class="linenr">19: </span>
<span class="linenr">20: </span>    var body: some View {
<span class="linenr">21: </span>        VStack {
<span class="linenr">22: </span>            Image(uiImage: ((pickedImage ?? UIImage(systemName: <span style="color: #98be65;">"camera"</span>))!))
<span class="linenr">23: </span>                .resizable()
<span class="linenr">24: </span>                .aspectRatio(contentMode: .fill)
<span class="linenr">25: </span>                .frame(width: <span style="color: #da8548; font-weight: bold;">200</span>, height: <span style="color: #da8548; font-weight: bold;">180</span>, alignment: .center)
<span class="linenr">26: </span>                .clipped()
<span class="linenr">27: </span>                .aspectRatio(contentMode: .fit)
<span class="linenr">28: </span>
<span class="linenr">29: </span>                .onTapGesture {
<span class="linenr">30: </span>                    <span style="color: #51afef;">self</span>.showPhotoLibrary.toggle()
<span class="linenr">31: </span>                }
<span class="linenr">32: </span>            TextField(<span style="color: #98be65;">"Task Title"</span>, text: <span style="color: #51afef;">self</span>.$title)
<span class="linenr">33: </span>                .textFieldStyle(RoundedBorderTextFieldStyle())
<span class="linenr">34: </span>
<span class="linenr">35: </span>            Button(<span style="color: #98be65;">"Add Task"</span>) {
<span class="linenr">36: </span>                // Upload image <span style="color: #51afef;">and</span> <span style="color: #51afef;">return</span> URL
<span class="linenr">37: </span>                let task = Task(title: <span style="color: #51afef;">self</span>.title, imageRefStr: <span style="color: #98be65;">""</span>, imageUrlStr: <span style="color: #98be65;">""</span>, completed: false)
<span class="linenr">38: </span>                taskListVM.add(task: task, image: pickedImage!)
<span class="linenr">39: </span>                <span style="color: #51afef;">self</span>.presentationMode.wrappedValue.dismiss()
<span class="linenr">40: </span>            }.disabled(title == <span style="color: #98be65;">""</span> || pickedImage==nil)
<span class="linenr">41: </span>
<span class="linenr">42: </span>        }
<span class="linenr">43: </span>        .padding()
<span class="linenr">44: </span>        .sheet(isPresented: $showPhotoLibrary, onDismiss: {
<span class="linenr">45: </span>            <span style="color: #51afef;">self</span>.showPhotoLibrary = false
<span class="linenr">46: </span>        }, content: {
<span class="linenr">47: </span>            ImagePicker(image: <span style="color: #51afef;">self</span>.$pickedImage, isShown: <span style="color: #51afef;">self</span>.$showPhotoLibrary)
<span class="linenr">48: </span>        })
<span class="linenr">49: </span>    }
<span class="linenr">50: </span>}
<span class="linenr">51: </span>
<span class="linenr">52: </span>struct TaskNewView_Previews: PreviewProvider {
<span class="linenr">53: </span>    static var previews: some View {
<span class="linenr">54: </span>        TaskNewView()
<span class="linenr">55: </span>    }
<span class="linenr">56: </span>}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-SW-UploadImage" class="outline-3">
<h3 id="SW-UploadImage"><span class="section-number-3">12.4</span> Just Upload Image to Firebase Storage</h3>
<div class="outline-text-3" id="text-SW-UploadImage">
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#38568;&#27231;&#29986;&#29983;&#19978;&#20659;&#30340;&#27284;&#21517;</span>
<span class="linenr"> 2: </span><span style="color: #51afef;">let</span> imageRefStr = <span style="color: #98be65;">"images/\(</span><span style="color: #c678dd;">UUID</span>().<span style="color: #c678dd;">uuidString</span><span style="color: #98be65;">).jpg"</span>
<span class="linenr"> 3: </span><span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#35373;&#22909;&#27284;&#26696;&#30340;storage reference</span>
<span class="linenr"> 4: </span><span style="color: #51afef;">let</span> imageRef = Storage.<span style="color: #c678dd;">storage</span>().<span style="color: #c678dd;">reference</span>().<span style="color: #c678dd;">child</span>(imageRefStr)
<span class="linenr"> 5: </span><span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#22739;&#32302;&#22294;&#29255;</span>
<span class="linenr"> 6: </span><span style="color: #51afef;">guard</span> <span style="color: #51afef;">let</span> sureImage = image.<span style="color: #c678dd;">jpegData</span>(compressionQuality: <span style="color: #da8548; font-weight: bold;">1</span>) <span style="color: #51afef;">else</span> {
<span class="linenr"> 7: </span>    <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"error when processing image compression"</span>)
<span class="linenr"> 8: </span>    <span style="color: #51afef;">return</span>
<span class="linenr"> 9: </span>}
<span class="linenr">10: </span><span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#19978;&#20659;</span>
<span class="linenr">11: </span>imageRef.<span style="color: #c678dd;">putData</span>(sureImage, metadata: <span style="color: #a9a1e1;">nil</span>) { (meta, err) <span style="color: #51afef;">in</span>
<span class="linenr">12: </span>    <span style="color: #51afef;">if</span> <span style="color: #51afef;">let</span> err = err {
<span class="linenr">13: </span>        <span style="color: #c678dd;">print</span>(err)
<span class="linenr">14: </span>        <span style="color: #51afef;">return</span>
<span class="linenr">15: </span>    }}
<span class="linenr">16: </span>
</pre>
</div>
</div>
</div>

<div id="outline-container-SW-UploadSaveImage" class="outline-3">
<h3 id="SW-UploadSaveImage"><span class="section-number-3">12.5</span> How to upload image to Firebase storage and get download URL (for saving into database)</h3>
<div class="outline-text-3" id="text-SW-UploadSaveImage">
<p>
TaskRepository.swift: Upload image and get image URL
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">  1: </span><span style="color: #5B6268;">//</span>
<span class="linenr">  2: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">TaskRepository.swift</span>
<span class="linenr">  3: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">FireTask</span>
<span class="linenr">  4: </span><span style="color: #5B6268;">//</span>
<span class="linenr">  5: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">Created by yen yung chin on 2021/4/1.</span>
<span class="linenr">  6: </span><span style="color: #5B6268;">//</span>
<span class="linenr">  7: </span>
<span class="linenr">  8: </span>
<span class="linenr">  9: </span><span style="color: #51afef;">import</span> Foundation
<span class="linenr"> 10: </span><span style="color: #51afef;">import</span> FirebaseFirestore
<span class="linenr"> 11: </span><span style="color: #51afef;">import</span> FirebaseFirestoreSwift
<span class="linenr"> 12: </span><span style="color: #51afef;">import</span> Combine
<span class="linenr"> 13: </span><span style="color: #51afef;">import</span> FirebaseStorage
<span class="linenr"> 14: </span><span style="color: #51afef;">import</span> SwiftUI
<span class="linenr"> 15: </span>
<span class="linenr"> 16: </span><span style="color: #51afef;">class</span> <span style="color: #c678dd;">TaskRepository</span>: <span style="color: #c678dd;">ObservableObject</span> {
<span class="linenr"> 17: </span>    <span style="color: #51afef;">private</span> <span style="color: #51afef;">let</span> db = Firestore.<span style="color: #c678dd;">firestore</span>()
<span class="linenr"> 18: </span>    <span style="color: #51afef;">@Published</span> <span style="color: #51afef;">var</span> tasks = [Task]()
<span class="linenr"> 19: </span>
<span class="linenr"> 20: </span>    <span style="color: #51afef;">init</span>() {
<span class="linenr"> 21: </span>        <span style="color: #c678dd;">loadData</span>()
<span class="linenr"> 22: </span>    }
<span class="linenr"> 23: </span>
<span class="linenr"> 24: </span>    <span style="color: #51afef;">func</span> <span style="color: #c678dd;">loadData</span>() {
<span class="linenr"> 25: </span>
<span class="linenr"> 26: </span>        db.<span style="color: #c678dd;">collection</span>(<span style="color: #98be65;">"todo"</span>).<span style="color: #dcaeea;">addSnapshotListener</span> { (querySanpshot, error) <span style="color: #51afef;">in</span>
<span class="linenr"> 27: </span>
<span class="linenr"> 28: </span>            <span style="color: #51afef;">if</span> <span style="color: #51afef;">let</span> error = error {
<span class="linenr"> 29: </span>                <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"&#37679;&#35492;: \(</span>error.<span style="color: #c678dd;">localizedDescription</span><span style="color: #98be65;">)"</span>)
<span class="linenr"> 30: </span>            }
<span class="linenr"> 31: </span>
<span class="linenr"> 32: </span>            <span style="color: #51afef;">if</span> <span style="color: #51afef;">let</span> querySnapshot = querySanpshot {
<span class="linenr"> 33: </span>                <span style="color: #51afef;">self</span>.<span style="color: #dcaeea;">tasks</span> = querySnapshot.<span style="color: #dcaeea;">documents</span>.<span style="color: #c678dd;">compactMap</span>({ (queryDocumentSnapshot) -&gt; Task? <span style="color: #51afef;">in</span>
<span class="linenr"> 34: </span>                    <span style="color: #51afef;">return</span> <span style="color: #51afef;">try</span>? queryDocumentSnapshot.<span style="color: #c678dd;">data</span>(<span style="color: #51afef;">as</span>: Task.<span style="color: #51afef;">self</span>)
<span class="linenr"> 35: </span>                })
<span class="linenr"> 36: </span>            }
<span class="linenr"> 37: </span>        }
<span class="linenr"> 38: </span>    }
<span class="linenr"> 39: </span>
<span class="linenr"> 40: </span>    <span style="color: #51afef;">func</span> <span style="color: #c678dd;">add</span>(task: Task, image: UIImage) {
<span class="linenr"> 41: </span>        <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#35373;&#23450;&#22294;&#29255;&#27284;&#21517;&#21450;&#23384;&#27284;&#20301;&#32622;</span>
<span class="linenr"> 42: </span>        <span style="color: #51afef;">let</span> imageRefStr = <span style="color: #98be65;">"images/\(</span><span style="color: #c678dd;">UUID</span>().<span style="color: #c678dd;">uuidString</span><span style="color: #98be65;">).jpg"</span>
<span class="linenr"> 43: </span>        <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20197;&#19978;&#36848;&#36039;&#26009;&#24314;&#31435;Storage reference</span>
<span class="linenr"> 44: </span>        <span style="color: #51afef;">let</span> imageRef = Storage.<span style="color: #c678dd;">storage</span>().<span style="color: #c678dd;">reference</span>().<span style="color: #c678dd;">child</span>(imageRefStr)
<span class="linenr"> 45: </span>        <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#19978;&#20659; &#21069;&#23565;&#22294;&#29255;&#36914;&#34892;&#22739;&#32302;</span>
<span class="linenr"> 46: </span>        <span style="color: #51afef;">guard</span> <span style="color: #51afef;">let</span> imageData = image.<span style="color: #c678dd;">jpegData</span>(compressionQuality: <span style="color: #da8548; font-weight: bold;">0.5</span>) <span style="color: #51afef;">else</span> {
<span class="linenr"> 47: </span>            <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"compress jpg failed"</span>)
<span class="linenr"> 48: </span>            <span style="color: #51afef;">return</span>
<span class="linenr"> 49: </span>        }
<span class="linenr"> 50: </span>        <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#19978;&#20659;&#22294;&#29255;</span>
<span class="linenr"> 51: </span>        imageRef.<span style="color: #c678dd;">putData</span>(imageData, metadata: <span style="color: #a9a1e1;">nil</span>, completion: { (metadata, error) <span style="color: #51afef;">in</span>
<span class="linenr"> 52: </span>            <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#33509;&#20986;&#29694;&#37679;&#35492;&#21063;&#36664;&#20986;&#37679;&#35492;&#12289;&#32080;&#26463;add</span>
<span class="linenr"> 53: </span>            <span style="color: #51afef;">if</span> <span style="color: #51afef;">let</span> error = error {
<span class="linenr"> 54: </span>                <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"putData Errir: \(</span>error.<span style="color: #c678dd;">localizedDescription</span><span style="color: #98be65;">)"</span>)
<span class="linenr"> 55: </span>                <span style="color: #51afef;">return</span>
<span class="linenr"> 56: </span>            }
<span class="linenr"> 57: </span>            <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#21462;&#24471;&#35442;&#22294;&#29255;&#30340;&#19979;&#36617;&#32178;&#22336;</span>
<span class="linenr"> 58: </span>            imageRef.<span style="color: #c678dd;">downloadURL</span>(completion: { (url, error) <span style="color: #51afef;">in</span>
<span class="linenr"> 59: </span>                <span style="color: #51afef;">if</span> <span style="color: #51afef;">let</span> error = error {
<span class="linenr"> 60: </span>                    <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"getting downloadURL Errir: \(</span>error<span style="color: #98be65;">)"</span>)
<span class="linenr"> 61: </span>                    <span style="color: #51afef;">return</span>
<span class="linenr"> 62: </span>                }
<span class="linenr"> 63: </span>                <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#30906;&#23450;&#26377;&#25343;&#21040;&#32178;&#22336;</span>
<span class="linenr"> 64: </span>                <span style="color: #51afef;">guard</span> <span style="color: #51afef;">let</span> imageURL = url <span style="color: #51afef;">else</span> {
<span class="linenr"> 65: </span>                    <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"Error while uploading image"</span>)
<span class="linenr"> 66: </span>                    <span style="color: #51afef;">return</span>
<span class="linenr"> 67: </span>                }
<span class="linenr"> 68: </span>                <span style="color: #51afef;">let</span> urlString = imageURL.<span style="color: #c678dd;">absoluteString</span>
<span class="linenr"> 69: </span>                <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#25104;&#21151;&#19978;&#20659;&#27284;&#26696;&#12289;&#21462;&#24471;&#19979;&#36617;&#32178;&#22336;&#65292;&#36914;&#34892;&#26032;&#22686;&#20219;&#21209;</span>
<span class="linenr"> 70: </span>                <span style="color: #51afef;">let</span> newTask = <span style="color: #c678dd;">Task</span>(title: task.<span style="color: #c678dd;">title</span>, imageRefStr: imageRefStr, imageUrlStr: urlString, completed: task.<span style="color: #c678dd;">completed</span>)
<span class="linenr"> 71: </span>                <span style="color: #51afef;">do</span> {
<span class="linenr"> 72: </span>                    _ = <span style="color: #51afef;">try</span> <span style="color: #51afef;">self</span>.<span style="color: #dcaeea;">db</span>.<span style="color: #c678dd;">collection</span>(<span style="color: #98be65;">"todo"</span>).<span style="color: #c678dd;">addDocument</span>(from: newTask)
<span class="linenr"> 73: </span>                } <span style="color: #51afef;">catch</span> {
<span class="linenr"> 74: </span>                    <span style="color: #c678dd;">fatalError</span>(<span style="color: #98be65;">"Add a task failed"</span>)
<span class="linenr"> 75: </span>                }
<span class="linenr"> 76: </span>            })
<span class="linenr"> 77: </span>        })
<span class="linenr"> 78: </span>
<span class="linenr"> 79: </span>    }
<span class="linenr"> 80: </span>
<span class="linenr"> 81: </span>    <span style="color: #51afef;">func</span> <span style="color: #c678dd;">delete</span>(indexset: <span style="color: #c678dd;">IndexSet</span>) {
<span class="linenr"> 82: </span>        indexset.<span style="color: #c678dd;">forEach</span> { index <span style="color: #51afef;">in</span>
<span class="linenr"> 83: </span>            <span style="color: #51afef;">let</span> task = tasks[index]
<span class="linenr"> 84: </span>            db.<span style="color: #c678dd;">collection</span>(<span style="color: #98be65;">"todo"</span>).<span style="color: #c678dd;">document</span>(task.<span style="color: #dcaeea;">id</span>!).<span style="color: #c678dd;">delete</span>() { error <span style="color: #51afef;">in</span>
<span class="linenr"> 85: </span>                <span style="color: #51afef;">if</span> <span style="color: #51afef;">let</span> error = error {
<span class="linenr"> 86: </span>                    <span style="color: #c678dd;">fatalError</span>(<span style="color: #98be65;">"Deleting a task failed, \(</span>error.<span style="color: #c678dd;">localizedDescription</span><span style="color: #98be65;">)"</span>)
<span class="linenr"> 87: </span>                }
<span class="linenr"> 88: </span>
<span class="linenr"> 89: </span>            }
<span class="linenr"> 90: </span>        }
<span class="linenr"> 91: </span>    }
<span class="linenr"> 92: </span>    <span style="color: #51afef;">func</span> <span style="color: #c678dd;">delete</span>(task: Task) {
<span class="linenr"> 93: </span>        <span style="color: #5B6268;">// </span><span style="color: #5B6268;">pass in Task</span>
<span class="linenr"> 94: </span>        <span style="color: #51afef;">guard</span> <span style="color: #51afef;">let</span> documentID = task.<span style="color: #dcaeea;">id</span> <span style="color: #51afef;">else</span> { <span style="color: #51afef;">return</span> }
<span class="linenr"> 95: </span>        <span style="color: #51afef;">let</span> imageRef = Storage.<span style="color: #c678dd;">storage</span>().<span style="color: #c678dd;">reference</span>().<span style="color: #c678dd;">child</span>(task.<span style="color: #dcaeea;">imageRefStr</span>)
<span class="linenr"> 96: </span>
<span class="linenr"> 97: </span>        imageRef.<span style="color: #dcaeea;">delete</span> { error <span style="color: #51afef;">in</span>
<span class="linenr"> 98: </span>            <span style="color: #51afef;">if</span> <span style="color: #51afef;">let</span> error = error {
<span class="linenr"> 99: </span>                <span style="color: #5B6268;">// </span><span style="color: #5B6268;">Uh-oh, an error occurred!</span>
<span class="linenr">100: </span>                <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"Unable to delete image, error: \(</span>error<span style="color: #98be65;">)"</span>)
<span class="linenr">101: </span>            } <span style="color: #51afef;">else</span> {
<span class="linenr">102: </span>                <span style="color: #5B6268;">// </span><span style="color: #5B6268;">File deleted successfully</span>
<span class="linenr">103: </span>                <span style="color: #5B6268;">// </span><span style="color: #5B6268;">Now Delete Task</span>
<span class="linenr">104: </span>
<span class="linenr">105: </span>                <span style="color: #51afef;">self</span>.<span style="color: #dcaeea;">db</span>.<span style="color: #c678dd;">collection</span>(<span style="color: #98be65;">"todo"</span>).<span style="color: #c678dd;">document</span>(documentID).<span style="color: #dcaeea;">delete</span> { error <span style="color: #51afef;">in</span>
<span class="linenr">106: </span>                    <span style="color: #51afef;">if</span> <span style="color: #51afef;">let</span> error = error {
<span class="linenr">107: </span>                        <span style="color: #c678dd;">print</span>(<span style="color: #98be65;">"Deleteing a task failed, \(</span>error.<span style="color: #c678dd;">localizedDescription</span><span style="color: #98be65;">)"</span>)
<span class="linenr">108: </span>                    }
<span class="linenr">109: </span>                }
<span class="linenr">110: </span>            }
<span class="linenr">111: </span>        }
<span class="linenr">112: </span>
<span class="linenr">113: </span>    }
<span class="linenr">114: </span>
<span class="linenr">115: </span>    <span style="color: #51afef;">func</span> <span style="color: #c678dd;">update</span>(task: Task) {
<span class="linenr">116: </span>        <span style="color: #51afef;">guard</span> <span style="color: #51afef;">let</span> documentID = task.<span style="color: #dcaeea;">id</span> <span style="color: #51afef;">else</span> {<span style="color: #51afef;">return</span>}
<span class="linenr">117: </span>        <span style="color: #51afef;">do</span> {
<span class="linenr">118: </span>            <span style="color: #51afef;">try</span> db.<span style="color: #c678dd;">collection</span>(<span style="color: #98be65;">"todo"</span>).<span style="color: #c678dd;">document</span>(documentID).<span style="color: #c678dd;">setData</span>(from: task)
<span class="linenr">119: </span>        } <span style="color: #51afef;">catch</span> {
<span class="linenr">120: </span>            <span style="color: #c678dd;">fatalError</span>(<span style="color: #98be65;">"Update a task failed, \(</span>error.<span style="color: #c678dd;">localizedDescription</span><span style="color: #98be65;">)"</span>)
<span class="linenr">121: </span>        }
<span class="linenr">122: </span>    }
<span class="linenr">123: </span>}
<span class="linenr">124: </span>
<span class="linenr">125: </span>
</pre>
</div>
</div>
</div>

<div id="outline-container-SW-URLImage" class="outline-3">
<h3 id="SW-URLImage"><span class="section-number-3">12.6</span> Show online image: URLImage</h3>
<div class="outline-text-3" id="text-SW-URLImage">
</div>
<div id="outline-container-org22f24ec" class="outline-4">
<h4 id="org22f24ec"><span class="section-number-4">12.6.1</span> url-image</h4>
<div class="outline-text-4" id="text-12-6-1">
<p>
URLImage is a SwiftUI view that displays an image downloaded from provided URL. URLImage manages downloading remote image and caching it locally, both in memory and on disk, for you.
</p>
</div>
<ol class="org-ol">
<li><a id="org578cacf"></a>Install<br />
<div class="outline-text-5" id="text-12-6-1-1">
<p>
<a href="https://github.com/dmytro-anokhin/url-image">https://github.com/dmytro-anokhin/url-image</a>
</p>
</div>
</li>
<li><a id="org64cee8d"></a>Using<br />
<div class="outline-text-5" id="text-12-6-1-2">
<p>
Using URLImage is dead simple:
</p>
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr">1: </span><span style="color: #c678dd;">URLImage</span>(url: url) { image <span style="color: #51afef;">in</span>
<span class="linenr">2: </span>    image
<span class="linenr">3: </span>        .<span style="color: #c678dd;">resizable</span>()
<span class="linenr">4: </span>        .<span style="color: #c678dd;">aspectRatio</span>(contentMode: .<span style="color: #dcaeea;">fit</span>)
<span class="linenr">5: </span>}
</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-orgb9e4095" class="outline-4">
<h4 id="orgb9e4095"><span class="section-number-4">12.6.2</span> TaskDetailView.swift</h4>
<div class="outline-text-4" id="text-12-6-2">
<div class="org-src-container">
<pre class="src src-swift"><span class="linenr"> 1: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 2: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">TaskCellView.swift</span>
<span class="linenr"> 3: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">FireTask</span>
<span class="linenr"> 4: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 5: </span><span style="color: #5B6268;">//  </span><span style="color: #5B6268;">Created by yen yung chin on 2021/4/3.</span>
<span class="linenr"> 6: </span><span style="color: #5B6268;">//</span>
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #51afef;">import</span> SwiftUI
<span class="linenr"> 9: </span><span style="color: #51afef;">import</span> Kingfisher
<span class="linenr">10: </span><span style="color: #51afef;">import</span> URLImage
<span class="linenr">11: </span>
<span class="linenr">12: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">TaskDetailView</span>: View {
<span class="linenr">13: </span>    <span style="color: #51afef;">@ObservedObject</span> <span style="color: #51afef;">var</span> taskCellVM: TaskCellViewModel
<span class="linenr">14: </span>
<span class="linenr">15: </span>    <span style="color: #51afef;">var</span> body: <span style="color: #51afef;">some</span> View {
<span class="linenr">16: </span>        NavigationView {
<span class="linenr">17: </span>            Form {
<span class="linenr">18: </span>                <span style="color: #c678dd;">Section</span>(header: <span style="color: #c678dd;">Text</span>(<span style="color: #98be65;">"Task"</span>)) {
<span class="linenr">19: </span>                    <span style="color: #c678dd;">VStack</span> (alignment: .<span style="color: #c678dd;">center</span>, spacing: <span style="color: #da8548; font-weight: bold;">20</span>) {
<span class="linenr">20: </span>                        <span style="color: #c678dd;">Text</span>(taskCellVM.<span style="color: #c678dd;">task</span>.<span style="color: #c678dd;">title</span>)
<span class="linenr">21: </span>                        <span style="color: #c678dd;">Divider</span>()
<span class="linenr">22: </span>                        <span style="color: #c678dd;">URLImage</span>(<span style="color: #c678dd;">URL</span>(string: taskCellVM.<span style="color: #c678dd;">task</span>.<span style="color: #dcaeea;">imageUrlStr</span>)!) { Image <span style="color: #51afef;">in</span>
<span class="linenr">23: </span>                            Image
<span class="linenr">24: </span>                                .<span style="color: #c678dd;">resizable</span>()
<span class="linenr">25: </span>                                .<span style="color: #c678dd;">frame</span>(width: <span style="color: #da8548; font-weight: bold;">200</span>, height: <span style="color: #da8548; font-weight: bold;">200</span>, alignment: .<span style="color: #c678dd;">center</span>)
<span class="linenr">26: </span>                                .<span style="color: #c678dd;">aspectRatio</span>(contentMode: .<span style="color: #dcaeea;">fit</span>)
<span class="linenr">27: </span>                        }
<span class="linenr">28: </span>                    }
<span class="linenr">29: </span>                }
<span class="linenr">30: </span>                <span style="color: #c678dd;">Section</span>(header: <span style="color: #c678dd;">Text</span>(<span style="color: #98be65;">"Done"</span>)) {
<span class="linenr">31: </span>                    <span style="color: #c678dd;">Text</span>(taskCellVM.<span style="color: #c678dd;">task</span>.<span style="color: #c678dd;">completed</span> ? <span style="color: #98be65;">"Completed"</span> : <span style="color: #98be65;">"Not Yet"</span> )
<span class="linenr">32: </span>                }
<span class="linenr">33: </span>            }
<span class="linenr">34: </span>            .<span style="color: #c678dd;">navigationBarTitle</span>(<span style="color: #98be65;">"Detail"</span>)
<span class="linenr">35: </span>            .<span style="color: #c678dd;">navigationBarTitleDisplayMode</span>(.<span style="color: #c678dd;">inline</span>)
<span class="linenr">36: </span>            .<span style="color: #c678dd;">navigationBarItems</span>(trailing: <span style="color: #c678dd;">NavigationLink</span>(
<span class="linenr">37: </span>                                    destination: <span style="color: #c678dd;">UpdateTaskView</span>(taskCellVM: taskCellVM),
<span class="linenr">38: </span>                                    label: {
<span class="linenr">39: </span>                                        <span style="color: #c678dd;">Text</span>(<span style="color: #98be65;">"Update"</span>)
<span class="linenr">40: </span>                                    }))
<span class="linenr">41: </span>        }
<span class="linenr">42: </span>    }
<span class="linenr">43: </span>}
<span class="linenr">44: </span>
<span class="linenr">45: </span><span style="color: #51afef;">struct</span> <span style="color: #c678dd;">TaskDetailView_Previews</span>: PreviewProvider {
<span class="linenr">46: </span>
<span class="linenr">47: </span>    <span style="color: #51afef;">static</span> <span style="color: #51afef;">var</span> previews: <span style="color: #51afef;">some</span> View {
<span class="linenr">48: </span>        <span style="color: #c678dd;">TaskDetailView</span>(taskCellVM: <span style="color: #c678dd;">TaskCellViewModel</span>(task: <span style="color: #c678dd;">Task</span>(id: <span style="color: #98be65;">""</span>, title: <span style="color: #98be65;">""</span>, imageRefStr: <span style="color: #98be65;">""</span>, imageUrlStr: <span style="color: #98be65;">""</span>,  completed: <span style="color: #a9a1e1;">false</span>)))
<span class="linenr">49: </span>    }
<span class="linenr">50: </span>}
<span class="linenr">51: </span>
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-SW-Firebase-LearningResource" class="outline-2">
<h2 id="SW-Firebase-LearningResource"><span class="section-number-2">13</span> Learning resources</h2>
<div class="outline-text-2" id="text-SW-Firebase-LearningResource">
</div>
<div id="outline-container-org3792176" class="outline-3">
<h3 id="org3792176"><span class="section-number-3">13.1</span> web</h3>
<div class="outline-text-3" id="text-13-1">
<ul class="org-ul">
<li><a href="https://medium.com/flawless-app-stories/how-to-build-a-firebase-app-with-swiftui-5919d2d8a396">How To Build A Firebase App With SwiftUI</a></li>
<li><a href="https://benmcmahen.com/authentication-with-swiftui-and-firebase/">Using Firebase Authentication with SwiftUI</a></li>
</ul>
</div>
</div>
<div id="outline-container-orgf54e7c7" class="outline-3">
<h3 id="orgf54e7c7"><span class="section-number-3">13.2</span> Videos</h3>
<div class="outline-text-3" id="text-13-2">
<ul class="org-ul">
<li><a href="https://www.youtube.com/watch?v=GGp-wT693IY">Downloading Images in SwiftUI</a></li>
<li><a href="https://www.youtube.com/watch?v=1HN7usMROt8">Firebase Authentication Tutorial 2020 - Custom iOS Login Page (Swift)</a></li>
<li><a href="https://www.youtube.com/watch?v=4RUeW5rUcww">Building a to-do list app with SwiftUI and Firebase - Part 1</a></li>
<li><a href="https://www.youtube.com/watch?v=2k6_Mi2ERWc">Building a Todo List App Using Firebase and SwiftUI - Part 2 </a></li>
<li><a href="https://www.youtube.com/watch?v=HDde7TqKCpk">Build a to-do list app w/ SwiftUI &amp; Firebase - Pt 2: Firestore &amp; Anonymous Auth</a></li>
<li><a href="https://www.youtube.com/watch?v=elhzkcoBl-A">https://www.youtube.com/watch?v=elhzkcoBl-A</a></li>
<li><a href="https://www.youtube.com/watch?v=9VpaaJ3eLWk&amp;list=PLY_qIufNHc292EYDwe3B6sGYO_vQ7pOLx&amp;index=8">https://www.youtube.com/watch?v=9VpaaJ3eLWk&amp;list=PLY_qIufNHc292EYDwe3B6sGYO_vQ7pOLx&amp;index=8</a></li>
<li><a href="https://www.hackingwithswift.com/books/ios-swiftui/creating-a-form">https://www.hackingwithswift.com/books/ios-swiftui/creating-a-form</a></li>
<li><a href="https://www.youtube.com/watch?v=1QcekWFK2d8">https://www.youtube.com/watch?v=1QcekWFK2d8</a></li>
<li><a href="https://www.youtube.com/watch?v=ZCFz9Mj4gkU">#1 Grocery App - Setting Up Firebase with Xcode 12</a></li>
<li><a href="https://www.youtube.com/watch?v=dxgQZWIdRC0&amp;t=339s">#2 Grocery App - Saving Grocery Store to Firestore Database</a></li>
<li><a href="https://www.youtube.com/watch?v=XXcrBVViFv4">#3 Grocery App - Fetching and Displaying Stores</a></li>
<li><a href="https://www.youtube.com/watch?v=4d3ctNyKNbE">#4 Grocery App - Deleting Store from Firestore Database Using SwiftUI</a></li>
<li><a href="https://www.youtube.com/watch?v=nYSqDY-dqT4">#5 Grocery App - Updating Store in Firestore Database Using SwiftUI</a></li>
<li><a href="https://www.youtube.com/watch?v=1HN7usMROt8">Firebase Authentication Tutorial 2020 - Custom iOS Login Page (Swift)</a></li>
<li><a href="https://www.youtube.com/watch?v=tdyT_v4lwos">Storing Custom Objects in @AppStorage in SwiftUI for iOS 14</a></li>
</ul>
</div>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup> <div class="footpara"><p class="footpara">
<a href="https://medium.com/ho-japan/%E5%89%8D%E7%AB%AF%E4%BA%BA%E7%9A%84%E6%95%91%E6%98%9Ffirebase%E7%9A%84%E7%94%A8%E9%80%94%E8%88%87%E5%AF%A6%E4%BD%9Ctodolist-c7af49fe3104">前端工程師的救星，Firebase的簡介與實作TodoList</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.2" class="footnum" href="#fnr.2">2</a></sup> <div class="footpara"><p class="footpara">
<a href="https://medium.com/codingurukul/introduction-to-firebase-f9f6ccc8a785">Introduction to Firebase</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.3" class="footnum" href="#fnr.3">3</a></sup> <div class="footpara"><p class="footpara">
<a href="https://firebase.google.com/docs/firestore/rtdb-vs-firestore">Choose a database: Cloud Firestore or Realtime Database</a>
</p></div></div>


</div>
</div></div>
<div id="postamble" class="status">
<p class="author">Author: Yung Chin, Yen</p>
<p class="date">Created: 2021-05-29 Sat 21:46</p>
</div>
</body>
</html>
